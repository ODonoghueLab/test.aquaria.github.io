(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["vendor~wrapper"],{"00ad":function(e,t,n){"use strict";e.exports=function(e,t,n){var r=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||"");if(!1===e.opts.format)return u&&(r+=" if (true) { "),r;var h,d=e.opts.$data&&s&&s.$data;d?(r+=" var schema"+i+" = "+e.util.getData(s.$data,o,e.dataPathArr)+"; ",h="schema"+i):h=s;var p=e.opts.unknownFormats,f=Array.isArray(p);if(d){var m="format"+i,g="isObject"+i,v="formatType"+i;r+=" var "+m+" = formats["+h+"]; var "+g+" = typeof "+m+" == 'object' && !("+m+" instanceof RegExp) && "+m+".validate; var "+v+" = "+g+" && "+m+".type || 'string'; if ("+g+") { ",e.async&&(r+=" var async"+i+" = "+m+".async; "),r+=" "+m+" = "+m+".validate; } if (  ",d&&(r+=" ("+h+" !== undefined && typeof "+h+" != 'string') || "),r+=" (","ignore"!=p&&(r+=" ("+h+" && !"+m+" ",f&&(r+=" && self._opts.unknownFormats.indexOf("+h+") == -1 "),r+=") || "),r+=" ("+m+" && "+v+" == '"+n+"' && !(typeof "+m+" == 'function' ? ",e.async?r+=" (async"+i+" ? await "+m+"("+c+") : "+m+"("+c+")) ":r+=" "+m+"("+c+") ",r+=" : "+m+".test("+c+"))))) {"}else{m=e.formats[s];if(!m){if("ignore"==p)return e.logger.warn('unknown format "'+s+'" ignored in schema at path "'+e.errSchemaPath+'"'),u&&(r+=" if (true) { "),r;if(f&&p.indexOf(s)>=0)return u&&(r+=" if (true) { "),r;throw new Error('unknown format "'+s+'" is used in schema at path "'+e.errSchemaPath+'"')}g="object"==typeof m&&!(m instanceof RegExp)&&m.validate,v=g&&m.type||"string";if(g){var y=!0===m.async;m=m.validate}if(v!=n)return u&&(r+=" if (true) { "),r;if(y){if(!e.async)throw new Error("async format in sync schema");var x="formats"+e.util.getProperty(s)+".validate";r+=" if (!(await "+x+"("+c+"))) { "}else{r+=" if (! ";x="formats"+e.util.getProperty(s);g&&(x+=".validate"),r+="function"==typeof m?" "+x+"("+c+") ":" "+x+".test("+c+") ",r+=") { "}}var b=b||[];b.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { format:  ",r+=d?""+h:""+e.util.toQuotedString(s),r+="  } ",!1!==e.opts.messages&&(r+=" , message: 'should match format \"",r+=d?"' + "+h+" + '":""+e.util.escapeQuotes(s),r+="\"' "),e.opts.verbose&&(r+=" , schema:  ",r+=d?"validate.schema"+a:""+e.util.toQuotedString(s),r+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var w=r;return r=b.pop(),!e.compositeRule&&u?e.async?r+=" throw new ValidationError(["+w+"]); ":r+=" validate.errors = ["+w+"]; return false; ":r+=" var err = "+w+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } ",u&&(r+=" else { "),r}},"00f5":function(e,t,n){"use strict";e.exports=function(e,t,n){var r=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="errs__"+i,d=e.util.copy(e);d.level++;var p="valid"+d.level;if(e.opts.strictKeywords?"object"==typeof s&&Object.keys(s).length>0:e.util.schemaHasRules(s,e.RULES.all)){d.schema=s,d.schemaPath=a,d.errSchemaPath=l,r+=" var "+h+" = errors;  ";var f,m=e.compositeRule;e.compositeRule=d.compositeRule=!0,d.createErrors=!1,d.opts.allErrors&&(f=d.opts.allErrors,d.opts.allErrors=!1),r+=" "+e.validate(d)+" ",d.createErrors=!0,f&&(d.opts.allErrors=f),e.compositeRule=d.compositeRule=m,r+=" if ("+p+") {   ";var g=g||[];g.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(r+=" , message: 'should NOT be valid' "),e.opts.verbose&&(r+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var v=r;r=g.pop(),!e.compositeRule&&u?e.async?r+=" throw new ValidationError(["+v+"]); ":r+=" validate.errors = ["+v+"]; return false; ":r+=" var err = "+v+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } else {  errors = "+h+"; if (vErrors !== null) { if ("+h+") vErrors.length = "+h+"; else vErrors = null; } ",e.opts.allErrors&&(r+=" } ")}else r+="  var err =   ",!1!==e.createErrors?(r+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(r+=" , message: 'should NOT be valid' "),e.opts.verbose&&(r+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",u&&(r+=" if (false) { ");return r}},"02a1":function(e,t,n){"use strict";(function(e){var n={name:"ExpandableTextLine",props:{useClick:Boolean,forceExpand:Boolean,duration:{type:Number,default:.2},collapseTextOnLeaveRatio:{type:Number,default:1}},data:function(){return{expandedClass:"__extl-expanded",timeoutOnCollapse:null,timeoutOnExpand:null,touch:!1,initialH:null,initialW:null}},computed:{shouldHover:function(){return!this.useClick&&!this.touch},style:function(){return{transitionDuration:this.duration+"s"}}},mounted:function(){this.manageWidth(),this.addClickOrTouchListener()},methods:{click:function(){var e=this.$refs["text-line"];e.classList.contains(this.expandedClass)?this.collapse():this.expand()},expand:function(){var e=this.$refs["text-line"];if(!this.forceExpand||!e.classList.contains(this.expandedClass)){var t=this.dimensionsForExpand(e);clearTimeout(this.timeoutOnCollapse),e.style.height=t.expandHeight,e.style.whiteSpace="unset",e.classList.add(this.expandedClass),this.$emit("start-expand"),this.timeoutOnExpand=setTimeout((function(){e.style.height="auto"}),1e3*this.duration)}},collapse:function(){var e=this;if(!this.forceExpand){var t=this.$refs["text-line"],n=this.dimensionsForCollapse(t);clearTimeout(this.timeoutOnExpand),setTimeout((function(){t.style.height=n.collapseHeight,t.scroll({top:0,behavior:"smooth"}),e.$emit("start-collaps"),e.timeoutOnCollapse=setTimeout((function(){t.style.whiteSpace=null,t.classList.remove(e.expandedClass),t.scrollTop=0,t.style.height=null}),1e3*e.duration*e.collapseTextOnLeaveRatio)}))}},dimensionsForExpand:function(e,t){var n=getComputedStyle(e),r=n.height,i=n.width,o=r,s=i,a=e.style.height;e.style.height="auto",e.style.whiteSpace="initial",e.classList.add(this.expandedClass);var l=getComputedStyle(e),u=l.height,c=l.width;return e.style.whiteSpace=null,e.style.height=t?a:o,e.classList.remove(this.expandedClass),getComputedStyle(e).height,{collapseWidth:s,expandWidth:c,collapseHeight:o,expandHeight:u}},dimensionsForCollapse:function(e){var t=getComputedStyle(e),n=t.height,r=t.width,i=t.whiteSpace,o=n,s=r;e.style.height=null,e.style.whiteSpace="nowrap",e.classList.remove(this.expandedClass);var a=getComputedStyle(e),l=a.height,u=a.width;return e.style.whiteSpace=i,e.style.height=o,e.classList.add(this.expandedClass),getComputedStyle(e).height,{collapseWidth:u,expandWidth:s,collapseHeight:l,expandHeight:o}},manageWidth:function(){var e=this,t=this.$refs["text-line"];if(t){var n=this.dimensionsForExpand(t,!0);n.collapseWidth!==n.expandWidth&&(console.warn("ExpandableTextLine: The parent width does not seem to be set explicitly. Therefore, the maximum width of the collapsed line must be set on the fly to match the natural dimensions in the expanded state. This can potentially affect performance. Please consider explicitly setting the width of the parent element or the width of the line itself."),t.style.width=n.expandWidth,window.addEventListener("resize",(function(){setTimeout((function(){requestAnimationFrame((function(){e.setMaxWidth(t)}))}),10)})))}},setMaxWidth:function(e){var t=e.style.width;if(e.style.width=null,e.classList.contains(this.expandedClass))e.style.width=getComputedStyle(e).width;else{var n=this.dimensionsForExpand(e);n.collapseWidth!==n.expandWidth?e.style.width=n.expandWidth:e.style.width=t}},addClickOrTouchListener:function(){document.addEventListener("touchstart",this.onFirstTouch),document.addEventListener("click",this.onFirstClick)},onFirstTouch:function(e){var t=this;this.touch=!0,document.removeEventListener("click",this.leaveOnClickOutside),document.removeEventListener("touchstart",this.onFirstTouch),document.addEventListener("touchstart",(function(e){t.leaveOnClickOutside(e)})),this.leaveOnClickOutside(e)},onFirstClick:function(e){var t=this;document.removeEventListener("click",this.onFirstClick),this.touch||(document.removeEventListener("touchstart",this.onFirstTouch),document.addEventListener("click",(function(e){t.leaveOnClickOutside(e)})),this.leaveOnClickOutside(e))},leaveOnClickOutside:function(e){if(!this.forceExpand){var t=this.$refs["text-line"];t&&!t.contains(e.target)&&t.classList.contains(this.expandedClass)&&this.collapse()}}}};function r(e,t,n,r,i,o,s,a,l,u){"boolean"!==typeof s&&(l=a,a=s,s=!1);var c,h="function"===typeof n?n.options:n;if(e&&e.render&&(h.render=e.render,h.staticRenderFns=e.staticRenderFns,h._compiled=!0,i&&(h.functional=!0)),r&&(h._scopeId=r),o?(c=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,l(e)),e&&e._registeredComponents&&e._registeredComponents.add(o)},h._ssrRegister=c):t&&(c=s?function(e){t.call(this,u(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,a(e))}),c)if(h.functional){var d=h.render;h.render=function(e,t){return c.call(t),d(e,t)}}else{var p=h.beforeCreate;h.beforeCreate=p?[].concat(p,c):[c]}return n}var i,o="undefined"!==typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function s(e){return function(e,t){return l(e,t)}}var a={};function l(e,t){var n=o?t.media||"default":e,r=a[n]||(a[n]={ids:new Set,styles:[]});if(!r.ids.has(e)){r.ids.add(e);var s=t.source;if(t.map&&(s+="\n/*# sourceURL="+t.map.sources[0]+" */",s+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t.map))))+" */"),r.element||(r.element=document.createElement("style"),r.element.type="text/css",t.media&&r.element.setAttribute("media",t.media),void 0===i&&(i=document.head||document.getElementsByTagName("head")[0]),i.appendChild(r.element)),"styleSheet"in r.element)r.styles.push(s),r.element.styleSheet.cssText=r.styles.filter(Boolean).join("\n");else{var l=r.ids.size-1,u=document.createTextNode(s),c=r.element.childNodes;c[l]&&r.element.removeChild(c[l]),c.length?r.element.insertBefore(u,c[l]):r.element.appendChild(u)}}}var u=n,c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",e._g({ref:"text-line",staticClass:"expandable-text-line",style:e.style},e.shouldHover?{mouseenter:e.expand,mouseleave:e.collapse}:{click:e.click}),[e._t("default")],2)},h=[];c._withStripped=!0;var d=function(e){e&&(e("data-v-bee853a2_0",{source:"\n*[data-v-bee853a2] {\n  will-change: height;\n  transform: translateZ(0);\n  backface-visibility: hidden;\n  perspective: 1000px;\n}\n",map:{version:3,sources:["/Users/maxim/PROJECTs/job/vue-expandable-text-line/src/ExpandableTextLine.vue"],names:[],mappings:";AAyNA;EACA,mBAAA;EACA,wBAAA;EACA,2BAAA;EACA,mBAAA;AACA",file:"ExpandableTextLine.vue",sourcesContent:["<template>\n  <div ref=\"text-line\"\n       class=\"expandable-text-line\"\n       :style=\"style\"\n       v-on=\"shouldHover ? { mouseenter: expand, mouseleave: collapse } : { click }\">\n    <slot />\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'ExpandableTextLine',\n\n  props: {\n    useClick: Boolean,\n    forceExpand: Boolean,\n    duration: { type: Number, default: 0.2 },\n    collapseTextOnLeaveRatio: { type: Number, default: 1 }\n  },\n\n  data () {\n    return {\n      expandedClass: '__extl-expanded',\n      timeoutOnCollapse: null,\n      timeoutOnExpand: null,\n      touch: false,\n      initialH: null,\n      initialW: null\n    }\n  },\n\n  computed: {\n    shouldHover () {\n      return !this.useClick && !this.touch\n    },\n    style () {\n      return {\n        transitionDuration: `${this.duration}s`\n      }\n    }\n  },\n\n  mounted () {\n    this.manageWidth()\n    this.addClickOrTouchListener()\n  },\n\n  methods: {\n    click () {\n      const el = this.$refs['text-line']\n      if (!el.classList.contains(this.expandedClass)) {\n        this.expand()\n      } else {\n        this.collapse()\n      }\n    },\n\n    expand () {\n      /** @type HTMLElement */\n      const el = this.$refs['text-line']\n      if (this.forceExpand && el.classList.contains(this.expandedClass)) return\n      const dimensions = this.dimensionsForExpand(el)\n      clearTimeout(this.timeoutOnCollapse)\n      el.style.height = dimensions.expandHeight\n      el.style.whiteSpace = 'unset'\n      el.classList.add(this.expandedClass)\n      this.$emit('start-expand')\n      this.timeoutOnExpand = setTimeout(() => {\n        el.style.height = 'auto'\n      }, this.duration * 1000)\n    },\n\n    collapse () {\n      if (this.forceExpand) return\n      const el = this.$refs['text-line']\n      const dimensions = this.dimensionsForCollapse(el)\n      clearTimeout(this.timeoutOnExpand)\n      setTimeout(() => {\n        el.style.height = dimensions.collapseHeight\n        el.scroll({ top: 0, behavior: 'smooth' })\n        this.$emit('start-collaps')\n        this.timeoutOnCollapse = setTimeout(() => {\n          el.style.whiteSpace = null\n          el.classList.remove(this.expandedClass)\n          el.scrollTop = 0\n          el.style.height = null\n        }, this.duration * 1000 * this.collapseTextOnLeaveRatio)\n      })\n    },\n\n    /**\n     * @param {HTMLElement} lineEl\n     * @param {boolean} resetH\n     * @return {{collapseWidth:string, expandWidth:string, collapseHeight:string, expandHeight:string}}\n     */\n    dimensionsForExpand (lineEl, resetH) {\n      let { height, width } = getComputedStyle(lineEl)\n      const collapseHeight = height\n      const collapseWidth = width\n      const preH = lineEl.style.height\n\n      lineEl.style.height = 'auto'\n      lineEl.style.whiteSpace = 'initial'\n      lineEl.classList.add(this.expandedClass)\n\n      const expandRect = getComputedStyle(lineEl)\n      const expandHeight = expandRect.height\n      const expandWidth = expandRect.width\n\n      lineEl.style.whiteSpace = null\n      lineEl.style.height = resetH ? preH : collapseHeight\n      lineEl.classList.remove(this.expandedClass)\n      // Force repaint to make sure the animation is triggered correctly.\n      // eslint-disable-next-line no-unused-expressions\n      getComputedStyle(lineEl).height\n\n      return { collapseWidth, expandWidth, collapseHeight, expandHeight }\n    },\n\n    /**\n     * @param {HTMLElement} lineEl\n     * @return {{collapseWidth:string, expandWidth:string, collapseHeight:string, expandHeight:string}}\n     */\n    dimensionsForCollapse (lineEl) {\n      let { height, width, whiteSpace } = getComputedStyle(lineEl)\n      const expandHeight = height\n      const expandWidth = width\n\n      lineEl.style.height = null\n      lineEl.style.whiteSpace = 'nowrap'\n      lineEl.classList.remove(this.expandedClass)\n\n      const collapseRect = getComputedStyle(lineEl)\n      const collapseHeight = collapseRect.height\n      const collapseWidth = collapseRect.width\n\n      lineEl.style.whiteSpace = whiteSpace\n      lineEl.style.height = expandHeight\n      lineEl.classList.add(this.expandedClass)\n\n      // eslint-disable-next-line no-unused-expressions\n      getComputedStyle(lineEl).height\n\n      return { collapseWidth, expandWidth, collapseHeight, expandHeight }\n    },\n\n    manageWidth () {\n      const el = this.$refs['text-line']\n      if (!el) return\n      const dimensions = this.dimensionsForExpand(el, true)\n      if (dimensions.collapseWidth !== dimensions.expandWidth) {\n      // this could be a case when the line's paren doesn't have an explicit width\n      // make sure that the line will be the same width in both states (expanded & collapsed)\n        console.warn(`ExpandableTextLine: The parent width does not seem to be set explicitly. Therefore, the maximum width of the collapsed line must be set on the fly to match the natural dimensions in the expanded state. This can potentially affect performance. Please consider explicitly setting the width of the parent element or the width of the line itself.`)\n        el.style.width = dimensions.expandWidth\n        window.addEventListener('resize', () => {\n          setTimeout(() => {\n            requestAnimationFrame(() => { this.setMaxWidth(el) })\n          }, 10)\n        })\n      }\n    },\n\n    setMaxWidth (el) {\n      const preW = el.style.width\n      el.style.width = null\n      if (el.classList.contains(this.expandedClass)) {\n        el.style.width = getComputedStyle(el).width\n      } else {\n        const dim = this.dimensionsForExpand(el)\n        if (dim.collapseWidth !== dim.expandWidth) {\n          el.style.width = dim.expandWidth\n        } else {\n          el.style.width = preW\n        }\n      }\n    },\n\n    addClickOrTouchListener () {\n      document.addEventListener('touchstart', this.onFirstTouch)\n      document.addEventListener('click', this.onFirstClick)\n    },\n\n    onFirstTouch (e) {\n      this.touch = true\n      document.removeEventListener('click', this.leaveOnClickOutside)\n      document.removeEventListener('touchstart', this.onFirstTouch)\n      document.addEventListener('touchstart', e => {\n        this.leaveOnClickOutside(e)\n      })\n      this.leaveOnClickOutside(e)\n    },\n\n    onFirstClick (e) {\n      document.removeEventListener('click', this.onFirstClick)\n      if (!this.touch) {\n        document.removeEventListener('touchstart', this.onFirstTouch)\n        document.addEventListener('click', e => {\n          this.leaveOnClickOutside(e)\n        })\n        this.leaveOnClickOutside(e)\n      }\n    },\n\n    leaveOnClickOutside (event) {\n      if (this.forceExpand) return\n      const el = this.$refs['text-line']\n      if (!el) return\n      if (!el.contains(event.target) &&\n           el.classList.contains(this.expandedClass)) {\n        this.collapse()\n      }\n    }\n  }\n}\n<\/script>\n<style scoped>\n* {\n  will-change: height;\n  transform: translateZ(0);\n  backface-visibility: hidden;\n  perspective: 1000px;\n}\n</style>\n<style lang=\"scss\">\n  $blocks: p, h1, h2, h3, h4, h5, h6, ol, ul, pre, address, blockquote, dl, div, fieldset, form, hr, noscript, table;\n  @mixin all-blocks {\n    @each $el in $blocks {\n      #{$el} { @content }\n    }\n  }\n\n  .expandable-text-line {\n    box-sizing: border-box;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    cursor: pointer;\n    width: 100%;\n    max-width: 100vw;\n    transition: height 0.1s;\n\n    @include all-blocks {\n      display: inline;\n\n      &:not(:first-child)::before {\n        content: \"\\00a0 \"\n      }\n      &:not(:last-child)::after {\n        content: \"\\00a0 \"\n      }\n    }\n\n    br {\n      display: none;\n    }\n\n    &.__extl-expanded {\n      max-height: 100%;\n      overflow: auto;\n      cursor: auto;\n\n      @include all-blocks {\n        display: block;\n\n        &:before {\n          content: none\n        }\n\n        &:first-child {\n          margin-top: 0;\n        }\n      }\n\n      br {\n        display: inline;\n      }\n    }\n  }\n</style>\n"]},media:void 0}),e("data-v-bee853a2_1",{source:'@charset "UTF-8";\n.expandable-text-line {\n  box-sizing: border-box;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  cursor: pointer;\n  width: 100%;\n  max-width: 100vw;\n  transition: height 0.1s;\n}\n.expandable-text-line p {\n  display: inline;\n}\n.expandable-text-line p:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line p:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line h1 {\n  display: inline;\n}\n.expandable-text-line h1:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line h1:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line h2 {\n  display: inline;\n}\n.expandable-text-line h2:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line h2:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line h3 {\n  display: inline;\n}\n.expandable-text-line h3:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line h3:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line h4 {\n  display: inline;\n}\n.expandable-text-line h4:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line h4:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line h5 {\n  display: inline;\n}\n.expandable-text-line h5:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line h5:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line h6 {\n  display: inline;\n}\n.expandable-text-line h6:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line h6:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line ol {\n  display: inline;\n}\n.expandable-text-line ol:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line ol:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line ul {\n  display: inline;\n}\n.expandable-text-line ul:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line ul:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line pre {\n  display: inline;\n}\n.expandable-text-line pre:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line pre:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line address {\n  display: inline;\n}\n.expandable-text-line address:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line address:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line blockquote {\n  display: inline;\n}\n.expandable-text-line blockquote:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line blockquote:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line dl {\n  display: inline;\n}\n.expandable-text-line dl:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line dl:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line div {\n  display: inline;\n}\n.expandable-text-line div:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line div:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line fieldset {\n  display: inline;\n}\n.expandable-text-line fieldset:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line fieldset:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line form {\n  display: inline;\n}\n.expandable-text-line form:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line form:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line hr {\n  display: inline;\n}\n.expandable-text-line hr:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line hr:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line noscript {\n  display: inline;\n}\n.expandable-text-line noscript:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line noscript:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line table {\n  display: inline;\n}\n.expandable-text-line table:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line table:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line br {\n  display: none;\n}\n.expandable-text-line.__extl-expanded {\n  max-height: 100%;\n  overflow: auto;\n  cursor: auto;\n}\n.expandable-text-line.__extl-expanded p {\n  display: block;\n}\n.expandable-text-line.__extl-expanded p:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded p:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded h1 {\n  display: block;\n}\n.expandable-text-line.__extl-expanded h1:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded h1:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded h2 {\n  display: block;\n}\n.expandable-text-line.__extl-expanded h2:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded h2:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded h3 {\n  display: block;\n}\n.expandable-text-line.__extl-expanded h3:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded h3:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded h4 {\n  display: block;\n}\n.expandable-text-line.__extl-expanded h4:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded h4:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded h5 {\n  display: block;\n}\n.expandable-text-line.__extl-expanded h5:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded h5:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded h6 {\n  display: block;\n}\n.expandable-text-line.__extl-expanded h6:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded h6:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded ol {\n  display: block;\n}\n.expandable-text-line.__extl-expanded ol:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded ol:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded ul {\n  display: block;\n}\n.expandable-text-line.__extl-expanded ul:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded ul:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded pre {\n  display: block;\n}\n.expandable-text-line.__extl-expanded pre:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded pre:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded address {\n  display: block;\n}\n.expandable-text-line.__extl-expanded address:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded address:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded blockquote {\n  display: block;\n}\n.expandable-text-line.__extl-expanded blockquote:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded blockquote:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded dl {\n  display: block;\n}\n.expandable-text-line.__extl-expanded dl:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded dl:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded div {\n  display: block;\n}\n.expandable-text-line.__extl-expanded div:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded div:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded fieldset {\n  display: block;\n}\n.expandable-text-line.__extl-expanded fieldset:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded fieldset:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded form {\n  display: block;\n}\n.expandable-text-line.__extl-expanded form:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded form:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded hr {\n  display: block;\n}\n.expandable-text-line.__extl-expanded hr:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded hr:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded noscript {\n  display: block;\n}\n.expandable-text-line.__extl-expanded noscript:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded noscript:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded table {\n  display: block;\n}\n.expandable-text-line.__extl-expanded table:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded table:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded br {\n  display: inline;\n}\n\n/*# sourceMappingURL=ExpandableTextLine.vue.map */',map:{version:3,sources:["ExpandableTextLine.vue","/Users/maxim/PROJECTs/job/vue-expandable-text-line/src/ExpandableTextLine.vue"],names:[],mappings:"AAAA,gBAAgB;ACwOhB;EACA,sBAAA;EACA,mBAAA;EACA,uBAAA;EACA,gBAAA;EACA,eAAA;EACA,WAAA;EACA,gBAAA;EACA,uBAAA;ADtOA;AC0NA;EAeA,eAAA;ADtOA;ACwOA;EACA,YAAA;ADtOA;ACwOA;EACA,YAAA;ADtOA;ACiNA;EAeA,eAAA;AD7NA;AC+NA;EACA,YAAA;AD7NA;AC+NA;EACA,YAAA;AD7NA;ACwMA;EAeA,eAAA;ADpNA;ACsNA;EACA,YAAA;ADpNA;ACsNA;EACA,YAAA;ADpNA;AC+LA;EAeA,eAAA;AD3MA;AC6MA;EACA,YAAA;AD3MA;AC6MA;EACA,YAAA;AD3MA;ACsLA;EAeA,eAAA;ADlMA;ACoMA;EACA,YAAA;ADlMA;ACoMA;EACA,YAAA;ADlMA;AC6KA;EAeA,eAAA;ADzLA;AC2LA;EACA,YAAA;ADzLA;AC2LA;EACA,YAAA;ADzLA;ACoKA;EAeA,eAAA;ADhLA;ACkLA;EACA,YAAA;ADhLA;ACkLA;EACA,YAAA;ADhLA;AC2JA;EAeA,eAAA;ADvKA;ACyKA;EACA,YAAA;ADvKA;ACyKA;EACA,YAAA;ADvKA;ACkJA;EAeA,eAAA;AD9JA;ACgKA;EACA,YAAA;AD9JA;ACgKA;EACA,YAAA;AD9JA;ACyIA;EAeA,eAAA;ADrJA;ACuJA;EACA,YAAA;ADrJA;ACuJA;EACA,YAAA;ADrJA;ACgIA;EAeA,eAAA;AD5IA;AC8IA;EACA,YAAA;AD5IA;AC8IA;EACA,YAAA;AD5IA;ACuHA;EAeA,eAAA;ADnIA;ACqIA;EACA,YAAA;ADnIA;ACqIA;EACA,YAAA;ADnIA;AC8GA;EAeA,eAAA;AD1HA;AC4HA;EACA,YAAA;AD1HA;AC4HA;EACA,YAAA;AD1HA;ACqGA;EAeA,eAAA;ADjHA;ACmHA;EACA,YAAA;ADjHA;ACmHA;EACA,YAAA;ADjHA;AC4FA;EAeA,eAAA;ADxGA;AC0GA;EACA,YAAA;ADxGA;AC0GA;EACA,YAAA;ADxGA;ACmFA;EAeA,eAAA;AD/FA;ACiGA;EACA,YAAA;AD/FA;ACiGA;EACA,YAAA;AD/FA;AC0EA;EAeA,eAAA;ADtFA;ACwFA;EACA,YAAA;ADtFA;ACwFA;EACA,YAAA;ADtFA;ACiEA;EAeA,eAAA;AD7EA;AC+EA;EACA,YAAA;AD7EA;AC+EA;EACA,YAAA;AD7EA;ACwDA;EAeA,eAAA;ADpEA;ACsEA;EACA,YAAA;ADpEA;ACsEA;EACA,YAAA;ADpEA;ACwEA;EACA,aAAA;ADtEA;ACyEA;EACA,gBAAA;EACA,cAAA;EACA,YAAA;ADvEA;ACuCA;EAmCA,cAAA;ADvEA;ACyEA;EACA,aAAA;ADvEA;AC0EA;EACA,aAAA;ADxEA;AC8BA;EAmCA,cAAA;AD9DA;ACgEA;EACA,aAAA;AD9DA;ACiEA;EACA,aAAA;AD/DA;ACqBA;EAmCA,cAAA;ADrDA;ACuDA;EACA,aAAA;ADrDA;ACwDA;EACA,aAAA;ADtDA;ACYA;EAmCA,cAAA;AD5CA;AC8CA;EACA,aAAA;AD5CA;AC+CA;EACA,aAAA;AD7CA;ACGA;EAmCA,cAAA;ADnCA;ACqCA;EACA,aAAA;ADnCA;ACsCA;EACA,aAAA;ADpCA;ACNA;EAmCA,cAAA;AD1BA;AC4BA;EACA,aAAA;AD1BA;AC6BA;EACA,aAAA;AD3BA;ACfA;EAmCA,cAAA;ADjBA;ACmBA;EACA,aAAA;ADjBA;ACoBA;EACA,aAAA;ADlBA;ACxBA;EAmCA,cAAA;ADRA;ACUA;EACA,aAAA;ADRA;ACWA;EACA,aAAA;ADTA;ACjCA;EAmCA,cAAA;ADCA;ACCA;EACA,aAAA;ADCA;ACEA;EACA,aAAA;ADAA;AC1CA;EAmCA,cAAA;ADUA;ACRA;EACA,aAAA;ADUA;ACPA;EACA,aAAA;ADSA;ACnDA;EAmCA,cAAA;ADmBA;ACjBA;EACA,aAAA;ADmBA;AChBA;EACA,aAAA;ADkBA;AC5DA;EAmCA,cAAA;AD4BA;AC1BA;EACA,aAAA;AD4BA;ACzBA;EACA,aAAA;AD2BA;ACrEA;EAmCA,cAAA;ADqCA;ACnCA;EACA,aAAA;ADqCA;AClCA;EACA,aAAA;ADoCA;AC9EA;EAmCA,cAAA;AD8CA;AC5CA;EACA,aAAA;AD8CA;AC3CA;EACA,aAAA;AD6CA;ACvFA;EAmCA,cAAA;ADuDA;ACrDA;EACA,aAAA;ADuDA;ACpDA;EACA,aAAA;ADsDA;AChGA;EAmCA,cAAA;ADgEA;AC9DA;EACA,aAAA;ADgEA;AC7DA;EACA,aAAA;AD+DA;ACzGA;EAmCA,cAAA;ADyEA;ACvEA;EACA,aAAA;ADyEA;ACtEA;EACA,aAAA;ADwEA;AClHA;EAmCA,cAAA;ADkFA;AChFA;EACA,aAAA;ADkFA;AC/EA;EACA,aAAA;ADiFA;AC3HA;EAmCA,cAAA;AD2FA;ACzFA;EACA,aAAA;AD2FA;ACxFA;EACA,aAAA;AD0FA;ACtFA;EACA,eAAA;ADwFA;;AAEA,iDAAiD",file:"ExpandableTextLine.vue",sourcesContent:['@charset "UTF-8";\n.expandable-text-line {\n  box-sizing: border-box;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  cursor: pointer;\n  width: 100%;\n  max-width: 100vw;\n  transition: height 0.1s;\n}\n.expandable-text-line p {\n  display: inline;\n}\n.expandable-text-line p:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line p:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line h1 {\n  display: inline;\n}\n.expandable-text-line h1:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line h1:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line h2 {\n  display: inline;\n}\n.expandable-text-line h2:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line h2:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line h3 {\n  display: inline;\n}\n.expandable-text-line h3:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line h3:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line h4 {\n  display: inline;\n}\n.expandable-text-line h4:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line h4:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line h5 {\n  display: inline;\n}\n.expandable-text-line h5:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line h5:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line h6 {\n  display: inline;\n}\n.expandable-text-line h6:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line h6:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line ol {\n  display: inline;\n}\n.expandable-text-line ol:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line ol:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line ul {\n  display: inline;\n}\n.expandable-text-line ul:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line ul:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line pre {\n  display: inline;\n}\n.expandable-text-line pre:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line pre:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line address {\n  display: inline;\n}\n.expandable-text-line address:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line address:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line blockquote {\n  display: inline;\n}\n.expandable-text-line blockquote:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line blockquote:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line dl {\n  display: inline;\n}\n.expandable-text-line dl:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line dl:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line div {\n  display: inline;\n}\n.expandable-text-line div:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line div:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line fieldset {\n  display: inline;\n}\n.expandable-text-line fieldset:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line fieldset:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line form {\n  display: inline;\n}\n.expandable-text-line form:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line form:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line hr {\n  display: inline;\n}\n.expandable-text-line hr:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line hr:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line noscript {\n  display: inline;\n}\n.expandable-text-line noscript:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line noscript:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line table {\n  display: inline;\n}\n.expandable-text-line table:not(:first-child)::before {\n  content: " ";\n}\n.expandable-text-line table:not(:last-child)::after {\n  content: " ";\n}\n.expandable-text-line br {\n  display: none;\n}\n.expandable-text-line.__extl-expanded {\n  max-height: 100%;\n  overflow: auto;\n  cursor: auto;\n}\n.expandable-text-line.__extl-expanded p {\n  display: block;\n}\n.expandable-text-line.__extl-expanded p:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded p:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded h1 {\n  display: block;\n}\n.expandable-text-line.__extl-expanded h1:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded h1:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded h2 {\n  display: block;\n}\n.expandable-text-line.__extl-expanded h2:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded h2:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded h3 {\n  display: block;\n}\n.expandable-text-line.__extl-expanded h3:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded h3:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded h4 {\n  display: block;\n}\n.expandable-text-line.__extl-expanded h4:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded h4:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded h5 {\n  display: block;\n}\n.expandable-text-line.__extl-expanded h5:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded h5:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded h6 {\n  display: block;\n}\n.expandable-text-line.__extl-expanded h6:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded h6:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded ol {\n  display: block;\n}\n.expandable-text-line.__extl-expanded ol:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded ol:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded ul {\n  display: block;\n}\n.expandable-text-line.__extl-expanded ul:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded ul:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded pre {\n  display: block;\n}\n.expandable-text-line.__extl-expanded pre:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded pre:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded address {\n  display: block;\n}\n.expandable-text-line.__extl-expanded address:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded address:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded blockquote {\n  display: block;\n}\n.expandable-text-line.__extl-expanded blockquote:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded blockquote:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded dl {\n  display: block;\n}\n.expandable-text-line.__extl-expanded dl:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded dl:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded div {\n  display: block;\n}\n.expandable-text-line.__extl-expanded div:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded div:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded fieldset {\n  display: block;\n}\n.expandable-text-line.__extl-expanded fieldset:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded fieldset:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded form {\n  display: block;\n}\n.expandable-text-line.__extl-expanded form:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded form:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded hr {\n  display: block;\n}\n.expandable-text-line.__extl-expanded hr:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded hr:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded noscript {\n  display: block;\n}\n.expandable-text-line.__extl-expanded noscript:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded noscript:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded table {\n  display: block;\n}\n.expandable-text-line.__extl-expanded table:before {\n  content: none;\n}\n.expandable-text-line.__extl-expanded table:first-child {\n  margin-top: 0;\n}\n.expandable-text-line.__extl-expanded br {\n  display: inline;\n}\n\n/*# sourceMappingURL=ExpandableTextLine.vue.map */',"<template>\n  <div ref=\"text-line\"\n       class=\"expandable-text-line\"\n       :style=\"style\"\n       v-on=\"shouldHover ? { mouseenter: expand, mouseleave: collapse } : { click }\">\n    <slot />\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'ExpandableTextLine',\n\n  props: {\n    useClick: Boolean,\n    forceExpand: Boolean,\n    duration: { type: Number, default: 0.2 },\n    collapseTextOnLeaveRatio: { type: Number, default: 1 }\n  },\n\n  data () {\n    return {\n      expandedClass: '__extl-expanded',\n      timeoutOnCollapse: null,\n      timeoutOnExpand: null,\n      touch: false,\n      initialH: null,\n      initialW: null\n    }\n  },\n\n  computed: {\n    shouldHover () {\n      return !this.useClick && !this.touch\n    },\n    style () {\n      return {\n        transitionDuration: `${this.duration}s`\n      }\n    }\n  },\n\n  mounted () {\n    this.manageWidth()\n    this.addClickOrTouchListener()\n  },\n\n  methods: {\n    click () {\n      const el = this.$refs['text-line']\n      if (!el.classList.contains(this.expandedClass)) {\n        this.expand()\n      } else {\n        this.collapse()\n      }\n    },\n\n    expand () {\n      /** @type HTMLElement */\n      const el = this.$refs['text-line']\n      if (this.forceExpand && el.classList.contains(this.expandedClass)) return\n      const dimensions = this.dimensionsForExpand(el)\n      clearTimeout(this.timeoutOnCollapse)\n      el.style.height = dimensions.expandHeight\n      el.style.whiteSpace = 'unset'\n      el.classList.add(this.expandedClass)\n      this.$emit('start-expand')\n      this.timeoutOnExpand = setTimeout(() => {\n        el.style.height = 'auto'\n      }, this.duration * 1000)\n    },\n\n    collapse () {\n      if (this.forceExpand) return\n      const el = this.$refs['text-line']\n      const dimensions = this.dimensionsForCollapse(el)\n      clearTimeout(this.timeoutOnExpand)\n      setTimeout(() => {\n        el.style.height = dimensions.collapseHeight\n        el.scroll({ top: 0, behavior: 'smooth' })\n        this.$emit('start-collaps')\n        this.timeoutOnCollapse = setTimeout(() => {\n          el.style.whiteSpace = null\n          el.classList.remove(this.expandedClass)\n          el.scrollTop = 0\n          el.style.height = null\n        }, this.duration * 1000 * this.collapseTextOnLeaveRatio)\n      })\n    },\n\n    /**\n     * @param {HTMLElement} lineEl\n     * @param {boolean} resetH\n     * @return {{collapseWidth:string, expandWidth:string, collapseHeight:string, expandHeight:string}}\n     */\n    dimensionsForExpand (lineEl, resetH) {\n      let { height, width } = getComputedStyle(lineEl)\n      const collapseHeight = height\n      const collapseWidth = width\n      const preH = lineEl.style.height\n\n      lineEl.style.height = 'auto'\n      lineEl.style.whiteSpace = 'initial'\n      lineEl.classList.add(this.expandedClass)\n\n      const expandRect = getComputedStyle(lineEl)\n      const expandHeight = expandRect.height\n      const expandWidth = expandRect.width\n\n      lineEl.style.whiteSpace = null\n      lineEl.style.height = resetH ? preH : collapseHeight\n      lineEl.classList.remove(this.expandedClass)\n      // Force repaint to make sure the animation is triggered correctly.\n      // eslint-disable-next-line no-unused-expressions\n      getComputedStyle(lineEl).height\n\n      return { collapseWidth, expandWidth, collapseHeight, expandHeight }\n    },\n\n    /**\n     * @param {HTMLElement} lineEl\n     * @return {{collapseWidth:string, expandWidth:string, collapseHeight:string, expandHeight:string}}\n     */\n    dimensionsForCollapse (lineEl) {\n      let { height, width, whiteSpace } = getComputedStyle(lineEl)\n      const expandHeight = height\n      const expandWidth = width\n\n      lineEl.style.height = null\n      lineEl.style.whiteSpace = 'nowrap'\n      lineEl.classList.remove(this.expandedClass)\n\n      const collapseRect = getComputedStyle(lineEl)\n      const collapseHeight = collapseRect.height\n      const collapseWidth = collapseRect.width\n\n      lineEl.style.whiteSpace = whiteSpace\n      lineEl.style.height = expandHeight\n      lineEl.classList.add(this.expandedClass)\n\n      // eslint-disable-next-line no-unused-expressions\n      getComputedStyle(lineEl).height\n\n      return { collapseWidth, expandWidth, collapseHeight, expandHeight }\n    },\n\n    manageWidth () {\n      const el = this.$refs['text-line']\n      if (!el) return\n      const dimensions = this.dimensionsForExpand(el, true)\n      if (dimensions.collapseWidth !== dimensions.expandWidth) {\n      // this could be a case when the line's paren doesn't have an explicit width\n      // make sure that the line will be the same width in both states (expanded & collapsed)\n        console.warn(`ExpandableTextLine: The parent width does not seem to be set explicitly. Therefore, the maximum width of the collapsed line must be set on the fly to match the natural dimensions in the expanded state. This can potentially affect performance. Please consider explicitly setting the width of the parent element or the width of the line itself.`)\n        el.style.width = dimensions.expandWidth\n        window.addEventListener('resize', () => {\n          setTimeout(() => {\n            requestAnimationFrame(() => { this.setMaxWidth(el) })\n          }, 10)\n        })\n      }\n    },\n\n    setMaxWidth (el) {\n      const preW = el.style.width\n      el.style.width = null\n      if (el.classList.contains(this.expandedClass)) {\n        el.style.width = getComputedStyle(el).width\n      } else {\n        const dim = this.dimensionsForExpand(el)\n        if (dim.collapseWidth !== dim.expandWidth) {\n          el.style.width = dim.expandWidth\n        } else {\n          el.style.width = preW\n        }\n      }\n    },\n\n    addClickOrTouchListener () {\n      document.addEventListener('touchstart', this.onFirstTouch)\n      document.addEventListener('click', this.onFirstClick)\n    },\n\n    onFirstTouch (e) {\n      this.touch = true\n      document.removeEventListener('click', this.leaveOnClickOutside)\n      document.removeEventListener('touchstart', this.onFirstTouch)\n      document.addEventListener('touchstart', e => {\n        this.leaveOnClickOutside(e)\n      })\n      this.leaveOnClickOutside(e)\n    },\n\n    onFirstClick (e) {\n      document.removeEventListener('click', this.onFirstClick)\n      if (!this.touch) {\n        document.removeEventListener('touchstart', this.onFirstTouch)\n        document.addEventListener('click', e => {\n          this.leaveOnClickOutside(e)\n        })\n        this.leaveOnClickOutside(e)\n      }\n    },\n\n    leaveOnClickOutside (event) {\n      if (this.forceExpand) return\n      const el = this.$refs['text-line']\n      if (!el) return\n      if (!el.contains(event.target) &&\n           el.classList.contains(this.expandedClass)) {\n        this.collapse()\n      }\n    }\n  }\n}\n<\/script>\n<style scoped>\n* {\n  will-change: height;\n  transform: translateZ(0);\n  backface-visibility: hidden;\n  perspective: 1000px;\n}\n</style>\n<style lang=\"scss\">\n  $blocks: p, h1, h2, h3, h4, h5, h6, ol, ul, pre, address, blockquote, dl, div, fieldset, form, hr, noscript, table;\n  @mixin all-blocks {\n    @each $el in $blocks {\n      #{$el} { @content }\n    }\n  }\n\n  .expandable-text-line {\n    box-sizing: border-box;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    cursor: pointer;\n    width: 100%;\n    max-width: 100vw;\n    transition: height 0.1s;\n\n    @include all-blocks {\n      display: inline;\n\n      &:not(:first-child)::before {\n        content: \"\\00a0 \"\n      }\n      &:not(:last-child)::after {\n        content: \"\\00a0 \"\n      }\n    }\n\n    br {\n      display: none;\n    }\n\n    &.__extl-expanded {\n      max-height: 100%;\n      overflow: auto;\n      cursor: auto;\n\n      @include all-blocks {\n        display: block;\n\n        &:before {\n          content: none\n        }\n\n        &:first-child {\n          margin-top: 0;\n        }\n      }\n\n      br {\n        display: inline;\n      }\n    }\n  }\n</style>\n"]},media:void 0}))},p="data-v-bee853a2",f=void 0,m=!1,g=r({render:c,staticRenderFns:h},d,u,p,m,f,!1,s,void 0,void 0);function v(e){v.installed||(v.installed=!0,e.component("ExpandableTextLine",g))}var y={install:v},x=null;"undefined"!==typeof window?x=window.Vue:"undefined"!==typeof e&&(x=e.Vue),x&&x.use(y),t["a"]=g}).call(this,n("c8ba"))},"0302":function(e,t,n){"use strict";e.exports=function(e,t,n){var r=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d=e.opts.$data&&s&&s.$data;d&&(r+=" var schema"+i+" = "+e.util.getData(s.$data,o,e.dataPathArr)+"; "),d||(r+=" var schema"+i+" = validate.schema"+a+";"),r+="var "+h+" = equal("+c+", schema"+i+"); if (!"+h+") {   ";var p=p||[];p.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'const' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { allowedValue: schema"+i+" } ",!1!==e.opts.messages&&(r+=" , message: 'should be equal to constant' "),e.opts.verbose&&(r+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var f=r;return r=p.pop(),!e.compositeRule&&u?e.async?r+=" throw new ValidationError(["+f+"]); ":r+=" validate.errors = ["+f+"]; return false; ":r+=" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" }",u&&(r+=" else { "),r}},"077a":function(e,t){e.exports={full:"0.6.4",major:0,minor:6,dot:4}},"07d6":function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},"08dc":function(e,t,n){var r=n("9bdf");e.exports.leap=r},"0b16":function(e,t,n){"use strict";var r=n("1985"),i=n("35e8");function o(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=w,t.resolve=A,t.resolveObject=S,t.format=_,t.Url=o;var s=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,u=["<",">",'"',"`"," ","\r","\n","\t"],c=["{","}","|","\\","^","`"].concat(u),h=["'"].concat(c),d=["%","/","?",";","#"].concat(h),p=["/","?","#"],f=255,m=/^[+a-z0-9A-Z_-]{0,63}$/,g=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,v={javascript:!0,"javascript:":!0},y={javascript:!0,"javascript:":!0},x={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},b=n("b383");function w(e,t,n){if(e&&i.isObject(e)&&e instanceof o)return e;var r=new o;return r.parse(e,t,n),r}function _(e){return i.isString(e)&&(e=w(e)),e instanceof o?e.format():o.prototype.format.call(e)}function A(e,t){return w(e,!1,!0).resolve(t)}function S(e,t){return e?w(e,!1,!0).resolveObject(t):t}o.prototype.parse=function(e,t,n){if(!i.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var o=e.indexOf("?"),a=-1!==o&&o<e.indexOf("#")?"?":"#",u=e.split(a),c=/\\/g;u[0]=u[0].replace(c,"/"),e=u.join(a);var w=e;if(w=w.trim(),!n&&1===e.split("#").length){var _=l.exec(w);if(_)return this.path=w,this.href=w,this.pathname=_[1],_[2]?(this.search=_[2],this.query=t?b.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var A=s.exec(w);if(A){A=A[0];var S=A.toLowerCase();this.protocol=S,w=w.substr(A.length)}if(n||A||w.match(/^\/\/[^@\/]+@[^@\/]+/)){var E="//"===w.substr(0,2);!E||A&&y[A]||(w=w.substr(2),this.slashes=!0)}if(!y[A]&&(E||A&&!x[A])){for(var M,T,C=-1,P=0;P<p.length;P++){var R=w.indexOf(p[P]);-1!==R&&(-1===C||R<C)&&(C=R)}T=-1===C?w.lastIndexOf("@"):w.lastIndexOf("@",C),-1!==T&&(M=w.slice(0,T),w=w.slice(T+1),this.auth=decodeURIComponent(M)),C=-1;for(P=0;P<d.length;P++){R=w.indexOf(d[P]);-1!==R&&(-1===C||R<C)&&(C=R)}-1===C&&(C=w.length),this.host=w.slice(0,C),w=w.slice(C),this.parseHost(),this.hostname=this.hostname||"";var L="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!L)for(var O=this.hostname.split(/\./),D=(P=0,O.length);P<D;P++){var I=O[P];if(I&&!I.match(m)){for(var k="",N=0,F=I.length;N<F;N++)I.charCodeAt(N)>127?k+="x":k+=I[N];if(!k.match(m)){var V=O.slice(0,P),z=O.slice(P+1),U=I.match(g);U&&(V.push(U[1]),z.unshift(U[2])),z.length&&(w="/"+z.join(".")+w),this.hostname=V.join(".");break}}}this.hostname.length>f?this.hostname="":this.hostname=this.hostname.toLowerCase(),L||(this.hostname=r.toASCII(this.hostname));var j=this.port?":"+this.port:"",B=this.hostname||"";this.host=B+j,this.href+=this.host,L&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==w[0]&&(w="/"+w))}if(!v[S])for(P=0,D=h.length;P<D;P++){var H=h[P];if(-1!==w.indexOf(H)){var G=encodeURIComponent(H);G===H&&(G=escape(H)),w=w.split(H).join(G)}}var q=w.indexOf("#");-1!==q&&(this.hash=w.substr(q),w=w.slice(0,q));var W=w.indexOf("?");if(-1!==W?(this.search=w.substr(W),this.query=w.substr(W+1),t&&(this.query=b.parse(this.query)),w=w.slice(0,W)):t&&(this.search="",this.query={}),w&&(this.pathname=w),x[S]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){j=this.pathname||"";var $=this.search||"";this.path=j+$}return this.href=this.format(),this},o.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",o=!1,s="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(s=b.stringify(this.query));var a=this.search||s&&"?"+s||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||x[t])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),r&&"#"!==r.charAt(0)&&(r="#"+r),a&&"?"!==a.charAt(0)&&(a="?"+a),n=n.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})),a=a.replace("#","%23"),t+o+n+a+r},o.prototype.resolve=function(e){return this.resolveObject(w(e,!1,!0)).format()},o.prototype.resolveObject=function(e){if(i.isString(e)){var t=new o;t.parse(e,!1,!0),e=t}for(var n=new o,r=Object.keys(this),s=0;s<r.length;s++){var a=r[s];n[a]=this[a]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),u=0;u<l.length;u++){var c=l[u];"protocol"!==c&&(n[c]=e[c])}return x[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!x[e.protocol]){for(var h=Object.keys(e),d=0;d<h.length;d++){var p=h[d];n[p]=e[p]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||y[e.protocol])n.pathname=e.pathname;else{var f=(e.pathname||"").split("/");while(f.length&&!(e.host=f.shift()));e.host||(e.host=""),e.hostname||(e.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),n.pathname=f.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var m=n.pathname||"",g=n.search||"";n.path=m+g}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var v=n.pathname&&"/"===n.pathname.charAt(0),b=e.host||e.pathname&&"/"===e.pathname.charAt(0),w=b||v||n.host&&e.pathname,_=w,A=n.pathname&&n.pathname.split("/")||[],S=(f=e.pathname&&e.pathname.split("/")||[],n.protocol&&!x[n.protocol]);if(S&&(n.hostname="",n.port=null,n.host&&(""===A[0]?A[0]=n.host:A.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===f[0]?f[0]=e.host:f.unshift(e.host)),e.host=null),w=w&&(""===f[0]||""===A[0])),b)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,A=f;else if(f.length)A||(A=[]),A.pop(),A=A.concat(f),n.search=e.search,n.query=e.query;else if(!i.isNullOrUndefined(e.search)){if(S){n.hostname=n.host=A.shift();var E=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");E&&(n.auth=E.shift(),n.host=n.hostname=E.shift())}return n.search=e.search,n.query=e.query,i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!A.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var M=A.slice(-1)[0],T=(n.host||e.host||A.length>1)&&("."===M||".."===M)||""===M,C=0,P=A.length;P>=0;P--)M=A[P],"."===M?A.splice(P,1):".."===M?(A.splice(P,1),C++):C&&(A.splice(P,1),C--);if(!w&&!_)for(;C--;C)A.unshift("..");!w||""===A[0]||A[0]&&"/"===A[0].charAt(0)||A.unshift(""),T&&"/"!==A.join("/").substr(-1)&&A.push("");var R=""===A[0]||A[0]&&"/"===A[0].charAt(0);if(S){n.hostname=n.host=R?"":A.length?A.shift():"";E=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@");E&&(n.auth=E.shift(),n.host=n.hostname=E.shift())}return w=w||n.host&&A.length,w&&!R&&A.unshift(""),A.length?n.pathname=A.join("/"):(n.pathname=null,n.path=null),i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},o.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(t=t[0],":"!==t&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},"0b25":function(e,t,n){var r=n("a691"),i=n("50c4");e.exports=function(e){if(void 0===e)return 0;var t=r(e),n=i(t);if(t!==n)throw RangeError("Wrong length or index");return n}},"0e33":function(e,t,n){(function(r){var i,o,s;(function(r){o=[n("1157")],i=r,s="function"===typeof i?i.apply(t,o):i,void 0===s||(e.exports=s)})((function(e){var t=function(){if(e&&e.fn&&e.fn.select2&&e.fn.select2.amd)var t=e.fn.select2.amd;return function(){
/**
 * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/almond/LICENSE
 */
var e,n,r;t&&t.requirejs||(t?n=t:t={},function(t){var i,o,s,a,l={},u={},c={},h={},d=Object.prototype.hasOwnProperty,p=[].slice,f=/\.js$/;function m(e,t){return d.call(e,t)}function g(e,t){var n,r,i,o,s,a,l,u,h,d,p,m,g=t&&t.split("/"),v=c.map,y=v&&v["*"]||{};if(e){for(e=e.split("/"),s=e.length-1,c.nodeIdCompat&&f.test(e[s])&&(e[s]=e[s].replace(f,"")),"."===e[0].charAt(0)&&g&&(m=g.slice(0,g.length-1),e=m.concat(e)),h=0;h<e.length;h++)if(p=e[h],"."===p)e.splice(h,1),h-=1;else if(".."===p){if(0===h||1===h&&".."===e[2]||".."===e[h-1])continue;h>0&&(e.splice(h-1,2),h-=2)}e=e.join("/")}if((g||y)&&v){for(n=e.split("/"),h=n.length;h>0;h-=1){if(r=n.slice(0,h).join("/"),g)for(d=g.length;d>0;d-=1)if(i=v[g.slice(0,d).join("/")],i&&(i=i[r],i)){o=i,a=h;break}if(o)break;!l&&y&&y[r]&&(l=y[r],u=h)}!o&&l&&(o=l,a=u),o&&(n.splice(0,a,o),e=n.join("/"))}return e}function v(e,n){return function(){var r=p.call(arguments,0);return"string"!==typeof r[0]&&1===r.length&&r.push(null),o.apply(t,r.concat([e,n]))}}function y(e){return function(t){return g(t,e)}}function x(e){return function(t){l[e]=t}}function b(e){if(m(u,e)){var n=u[e];delete u[e],h[e]=!0,i.apply(t,n)}if(!m(l,e)&&!m(h,e))throw new Error("No "+e);return l[e]}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function _(e){return e?w(e):[]}function A(e){return function(){return c&&c.config&&c.config[e]||{}}}s=function(e,t){var n,r=w(e),i=r[0],o=t[1];return e=r[1],i&&(i=g(i,o),n=b(i)),i?e=n&&n.normalize?n.normalize(e,y(o)):g(e,o):(e=g(e,o),r=w(e),i=r[0],e=r[1],i&&(n=b(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},a={require:function(e){return v(e)},exports:function(e){var t=l[e];return"undefined"!==typeof t?t:l[e]={}},module:function(e){return{id:e,uri:"",exports:l[e],config:A(e)}}},i=function(e,n,r,i){var o,c,d,p,f,g,y,w=[],A=typeof r;if(i=i||e,g=_(i),"undefined"===A||"function"===A){for(n=!n.length&&r.length?["require","exports","module"]:n,f=0;f<n.length;f+=1)if(p=s(n[f],g),c=p.f,"require"===c)w[f]=a.require(e);else if("exports"===c)w[f]=a.exports(e),y=!0;else if("module"===c)o=w[f]=a.module(e);else if(m(l,c)||m(u,c)||m(h,c))w[f]=b(c);else{if(!p.p)throw new Error(e+" missing "+c);p.p.load(p.n,v(i,!0),x(c),{}),w[f]=l[c]}d=r?r.apply(l[e],w):void 0,e&&(o&&o.exports!==t&&o.exports!==l[e]?l[e]=o.exports:d===t&&y||(l[e]=d))}else e&&(l[e]=r)},e=n=o=function(e,n,r,l,u){if("string"===typeof e)return a[e]?a[e](n):b(s(e,_(n)).f);if(!e.splice){if(c=e,c.deps&&o(c.deps,c.callback),!n)return;n.splice?(e=n,n=r,r=null):e=t}return n=n||function(){},"function"===typeof r&&(r=l,l=u),l?i(t,e,n,r):setTimeout((function(){i(t,e,n,r)}),4),o},o.config=function(e){return o(e)},e._defined=l,r=function(e,t,n){if("string"!==typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),m(l,e)||m(u,e)||(u[e]=[e,t,n])},r.amd={jQuery:!0}}(),t.requirejs=e,t.require=n,t.define=r)}(),t.define("almond",(function(){})),t.define("jquery",[],(function(){var t=e||r;return null==t&&console&&console.error&&console.error("Select2: An instance of jQuery or a jQuery-compatible library was not found. Make sure that you are including jQuery before Select2 on your web page."),t})),t.define("select2/utils",["jquery"],(function(e){var t={};function n(e){var t=e.prototype,n=[];for(var r in t){var i=t[r];"function"===typeof i&&("constructor"!==r&&n.push(r))}return n}t.Extend=function(e,t){var n={}.hasOwnProperty;function r(){this.constructor=e}for(var i in t)n.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},t.Decorate=function(e,t){var r=n(t),i=n(e);function o(){var n=Array.prototype.unshift,r=t.prototype.constructor.length,i=e.prototype.constructor;r>0&&(n.call(arguments,e.prototype.constructor),i=t.prototype.constructor),i.apply(this,arguments)}function s(){this.constructor=o}t.displayName=e.displayName,o.prototype=new s;for(var a=0;a<i.length;a++){var l=i[a];o.prototype[l]=e.prototype[l]}for(var u=function(e){var n=function(){};e in o.prototype&&(n=o.prototype[e]);var r=t.prototype[e];return function(){var e=Array.prototype.unshift;return e.call(arguments,n),r.apply(this,arguments)}},c=0;c<r.length;c++){var h=r[c];o.prototype[h]=u(h)}return o};var r=function(){this.listeners={}};r.prototype.on=function(e,t){this.listeners=this.listeners||{},e in this.listeners?this.listeners[e].push(t):this.listeners[e]=[t]},r.prototype.trigger=function(e){var t=Array.prototype.slice,n=t.call(arguments,1);this.listeners=this.listeners||{},null==n&&(n=[]),0===n.length&&n.push({}),n[0]._type=e,e in this.listeners&&this.invoke(this.listeners[e],t.call(arguments,1)),"*"in this.listeners&&this.invoke(this.listeners["*"],arguments)},r.prototype.invoke=function(e,t){for(var n=0,r=e.length;n<r;n++)e[n].apply(this,t)},t.Observable=r,t.generateChars=function(e){for(var t="",n=0;n<e;n++){var r=Math.floor(36*Math.random());t+=r.toString(36)}return t},t.bind=function(e,t){return function(){e.apply(t,arguments)}},t._convertData=function(e){for(var t in e){var n=t.split("-"),r=e;if(1!==n.length){for(var i=0;i<n.length;i++){var o=n[i];o=o.substring(0,1).toLowerCase()+o.substring(1),o in r||(r[o]={}),i==n.length-1&&(r[o]=e[t]),r=r[o]}delete e[t]}}return e},t.hasScroll=function(t,n){var r=e(n),i=n.style.overflowX,o=n.style.overflowY;return(i!==o||"hidden"!==o&&"visible"!==o)&&("scroll"===i||"scroll"===o||(r.innerHeight()<n.scrollHeight||r.innerWidth()<n.scrollWidth))},t.escapeMarkup=function(e){var t={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return"string"!==typeof e?e:String(e).replace(/[&<>"'\/\\]/g,(function(e){return t[e]}))},t.appendMany=function(t,n){if("1.7"===e.fn.jquery.substr(0,3)){var r=e();e.map(n,(function(e){r=r.add(e)})),n=r}t.append(n)},t.__cache={};var i=0;return t.GetUniqueElementId=function(e){var t=e.getAttribute("data-select2-id");return null==t&&(e.id?(t=e.id,e.setAttribute("data-select2-id",t)):(e.setAttribute("data-select2-id",++i),t=i.toString())),t},t.StoreData=function(e,n,r){var i=t.GetUniqueElementId(e);t.__cache[i]||(t.__cache[i]={}),t.__cache[i][n]=r},t.GetData=function(n,r){var i=t.GetUniqueElementId(n);return r?t.__cache[i]&&null!=t.__cache[i][r]?t.__cache[i][r]:e(n).data(r):t.__cache[i]},t.RemoveData=function(e){var n=t.GetUniqueElementId(e);null!=t.__cache[n]&&delete t.__cache[n],e.removeAttribute("data-select2-id")},t})),t.define("select2/results",["jquery","./utils"],(function(e,t){function n(e,t,r){this.$element=e,this.data=r,this.options=t,n.__super__.constructor.call(this)}return t.Extend(n,t.Observable),n.prototype.render=function(){var t=e('<ul class="select2-results__options" role="listbox"></ul>');return this.options.get("multiple")&&t.attr("aria-multiselectable","true"),this.$results=t,t},n.prototype.clear=function(){this.$results.empty()},n.prototype.displayMessage=function(t){var n=this.options.get("escapeMarkup");this.clear(),this.hideLoading();var r=e('<li role="alert" aria-live="assertive" class="select2-results__option"></li>'),i=this.options.get("translations").get(t.message);r.append(n(i(t.args))),r[0].className+=" select2-results__message",this.$results.append(r)},n.prototype.hideMessages=function(){this.$results.find(".select2-results__message").remove()},n.prototype.append=function(e){this.hideLoading();var t=[];if(null!=e.results&&0!==e.results.length){e.results=this.sort(e.results);for(var n=0;n<e.results.length;n++){var r=e.results[n],i=this.option(r);t.push(i)}this.$results.append(t)}else 0===this.$results.children().length&&this.trigger("results:message",{message:"noResults"})},n.prototype.position=function(e,t){var n=t.find(".select2-results");n.append(e)},n.prototype.sort=function(e){var t=this.options.get("sorter");return t(e)},n.prototype.highlightFirstItem=function(){var e=this.$results.find(".select2-results__option[aria-selected]"),t=e.filter("[aria-selected=true]");t.length>0?t.first().trigger("mouseenter"):e.first().trigger("mouseenter"),this.ensureHighlightVisible()},n.prototype.setClasses=function(){var n=this;this.data.current((function(r){var i=e.map(r,(function(e){return e.id.toString()})),o=n.$results.find(".select2-results__option[aria-selected]");o.each((function(){var n=e(this),r=t.GetData(this,"data"),o=""+r.id;null!=r.element&&r.element.selected||null==r.element&&e.inArray(o,i)>-1?n.attr("aria-selected","true"):n.attr("aria-selected","false")}))}))},n.prototype.showLoading=function(e){this.hideLoading();var t=this.options.get("translations").get("searching"),n={disabled:!0,loading:!0,text:t(e)},r=this.option(n);r.className+=" loading-results",this.$results.prepend(r)},n.prototype.hideLoading=function(){this.$results.find(".loading-results").remove()},n.prototype.option=function(n){var r=document.createElement("li");r.className="select2-results__option";var i={role:"option","aria-selected":"false"},o=window.Element.prototype.matches||window.Element.prototype.msMatchesSelector||window.Element.prototype.webkitMatchesSelector;for(var s in(null!=n.element&&o.call(n.element,":disabled")||null==n.element&&n.disabled)&&(delete i["aria-selected"],i["aria-disabled"]="true"),null==n.id&&delete i["aria-selected"],null!=n._resultId&&(r.id=n._resultId),n.title&&(r.title=n.title),n.children&&(i.role="group",i["aria-label"]=n.text,delete i["aria-selected"]),i){var a=i[s];r.setAttribute(s,a)}if(n.children){var l=e(r),u=document.createElement("strong");u.className="select2-results__group";e(u);this.template(n,u);for(var c=[],h=0;h<n.children.length;h++){var d=n.children[h],p=this.option(d);c.push(p)}var f=e("<ul></ul>",{class:"select2-results__options select2-results__options--nested"});f.append(c),l.append(u),l.append(f)}else this.template(n,r);return t.StoreData(r,"data",n),r},n.prototype.bind=function(n,r){var i=this,o=n.id+"-results";this.$results.attr("id",o),n.on("results:all",(function(e){i.clear(),i.append(e.data),n.isOpen()&&(i.setClasses(),i.highlightFirstItem())})),n.on("results:append",(function(e){i.append(e.data),n.isOpen()&&i.setClasses()})),n.on("query",(function(e){i.hideMessages(),i.showLoading(e)})),n.on("select",(function(){n.isOpen()&&(i.setClasses(),i.options.get("scrollAfterSelect")&&i.highlightFirstItem())})),n.on("unselect",(function(){n.isOpen()&&(i.setClasses(),i.options.get("scrollAfterSelect")&&i.highlightFirstItem())})),n.on("open",(function(){i.$results.attr("aria-expanded","true"),i.$results.attr("aria-hidden","false"),i.setClasses(),i.ensureHighlightVisible()})),n.on("close",(function(){i.$results.attr("aria-expanded","false"),i.$results.attr("aria-hidden","true"),i.$results.removeAttr("aria-activedescendant")})),n.on("results:toggle",(function(){var e=i.getHighlightedResults();0!==e.length&&e.trigger("mouseup")})),n.on("results:select",(function(){var e=i.getHighlightedResults();if(0!==e.length){var n=t.GetData(e[0],"data");"true"==e.attr("aria-selected")?i.trigger("close",{}):i.trigger("select",{data:n})}})),n.on("results:previous",(function(){var e=i.getHighlightedResults(),t=i.$results.find("[aria-selected]"),n=t.index(e);if(!(n<=0)){var r=n-1;0===e.length&&(r=0);var o=t.eq(r);o.trigger("mouseenter");var s=i.$results.offset().top,a=o.offset().top,l=i.$results.scrollTop()+(a-s);0===r?i.$results.scrollTop(0):a-s<0&&i.$results.scrollTop(l)}})),n.on("results:next",(function(){var e=i.getHighlightedResults(),t=i.$results.find("[aria-selected]"),n=t.index(e),r=n+1;if(!(r>=t.length)){var o=t.eq(r);o.trigger("mouseenter");var s=i.$results.offset().top+i.$results.outerHeight(!1),a=o.offset().top+o.outerHeight(!1),l=i.$results.scrollTop()+a-s;0===r?i.$results.scrollTop(0):a>s&&i.$results.scrollTop(l)}})),n.on("results:focus",(function(e){e.element.addClass("select2-results__option--highlighted")})),n.on("results:message",(function(e){i.displayMessage(e)})),e.fn.mousewheel&&this.$results.on("mousewheel",(function(e){var t=i.$results.scrollTop(),n=i.$results.get(0).scrollHeight-t+e.deltaY,r=e.deltaY>0&&t-e.deltaY<=0,o=e.deltaY<0&&n<=i.$results.height();r?(i.$results.scrollTop(0),e.preventDefault(),e.stopPropagation()):o&&(i.$results.scrollTop(i.$results.get(0).scrollHeight-i.$results.height()),e.preventDefault(),e.stopPropagation())})),this.$results.on("mouseup",".select2-results__option[aria-selected]",(function(n){var r=e(this),o=t.GetData(this,"data");"true"!==r.attr("aria-selected")?i.trigger("select",{originalEvent:n,data:o}):i.options.get("multiple")?i.trigger("unselect",{originalEvent:n,data:o}):i.trigger("close",{})})),this.$results.on("mouseenter",".select2-results__option[aria-selected]",(function(n){var r=t.GetData(this,"data");i.getHighlightedResults().removeClass("select2-results__option--highlighted"),i.trigger("results:focus",{data:r,element:e(this)})}))},n.prototype.getHighlightedResults=function(){var e=this.$results.find(".select2-results__option--highlighted");return e},n.prototype.destroy=function(){this.$results.remove()},n.prototype.ensureHighlightVisible=function(){var e=this.getHighlightedResults();if(0!==e.length){var t=this.$results.find("[aria-selected]"),n=t.index(e),r=this.$results.offset().top,i=e.offset().top,o=this.$results.scrollTop()+(i-r),s=i-r;o-=2*e.outerHeight(!1),n<=2?this.$results.scrollTop(0):(s>this.$results.outerHeight()||s<0)&&this.$results.scrollTop(o)}},n.prototype.template=function(t,n){var r=this.options.get("templateResult"),i=this.options.get("escapeMarkup"),o=r(t,n);null==o?n.style.display="none":"string"===typeof o?n.innerHTML=i(o):e(n).append(o)},n})),t.define("select2/keys",[],(function(){var e={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46};return e})),t.define("select2/selection/base",["jquery","../utils","../keys"],(function(e,t,n){function r(e,t){this.$element=e,this.options=t,r.__super__.constructor.call(this)}return t.Extend(r,t.Observable),r.prototype.render=function(){var n=e('<span class="select2-selection" role="combobox"  aria-haspopup="true" aria-expanded="false"></span>');return this._tabindex=0,null!=t.GetData(this.$element[0],"old-tabindex")?this._tabindex=t.GetData(this.$element[0],"old-tabindex"):null!=this.$element.attr("tabindex")&&(this._tabindex=this.$element.attr("tabindex")),n.attr("title",this.$element.attr("title")),n.attr("tabindex",this._tabindex),n.attr("aria-disabled","false"),this.$selection=n,n},r.prototype.bind=function(e,t){var r=this,i=e.id+"-results";this.container=e,this.$selection.on("focus",(function(e){r.trigger("focus",e)})),this.$selection.on("blur",(function(e){r._handleBlur(e)})),this.$selection.on("keydown",(function(e){r.trigger("keypress",e),e.which===n.SPACE&&e.preventDefault()})),e.on("results:focus",(function(e){r.$selection.attr("aria-activedescendant",e.data._resultId)})),e.on("selection:update",(function(e){r.update(e.data)})),e.on("open",(function(){r.$selection.attr("aria-expanded","true"),r.$selection.attr("aria-owns",i),r._attachCloseHandler(e)})),e.on("close",(function(){r.$selection.attr("aria-expanded","false"),r.$selection.removeAttr("aria-activedescendant"),r.$selection.removeAttr("aria-owns"),r.$selection.trigger("focus"),r._detachCloseHandler(e)})),e.on("enable",(function(){r.$selection.attr("tabindex",r._tabindex),r.$selection.attr("aria-disabled","false")})),e.on("disable",(function(){r.$selection.attr("tabindex","-1"),r.$selection.attr("aria-disabled","true")}))},r.prototype._handleBlur=function(t){var n=this;window.setTimeout((function(){document.activeElement==n.$selection[0]||e.contains(n.$selection[0],document.activeElement)||n.trigger("blur",t)}),1)},r.prototype._attachCloseHandler=function(n){e(document.body).on("mousedown.select2."+n.id,(function(n){var r=e(n.target),i=r.closest(".select2"),o=e(".select2.select2-container--open");o.each((function(){if(this!=i[0]){var e=t.GetData(this,"element");e.select2("close")}}))}))},r.prototype._detachCloseHandler=function(t){e(document.body).off("mousedown.select2."+t.id)},r.prototype.position=function(e,t){var n=t.find(".selection");n.append(e)},r.prototype.destroy=function(){this._detachCloseHandler(this.container)},r.prototype.update=function(e){throw new Error("The `update` method must be defined in child classes.")},r.prototype.isEnabled=function(){return!this.isDisabled()},r.prototype.isDisabled=function(){return this.options.get("disabled")},r})),t.define("select2/selection/single",["jquery","./base","../utils","../keys"],(function(e,t,n,r){function i(){i.__super__.constructor.apply(this,arguments)}return n.Extend(i,t),i.prototype.render=function(){var e=i.__super__.render.call(this);return e.addClass("select2-selection--single"),e.html('<span class="select2-selection__rendered"></span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span>'),e},i.prototype.bind=function(e,t){var n=this;i.__super__.bind.apply(this,arguments);var r=e.id+"-container";this.$selection.find(".select2-selection__rendered").attr("id",r).attr("role","textbox").attr("aria-readonly","true"),this.$selection.attr("aria-labelledby",r),this.$selection.on("mousedown",(function(e){1===e.which&&n.trigger("toggle",{originalEvent:e})})),this.$selection.on("focus",(function(e){})),this.$selection.on("blur",(function(e){})),e.on("focus",(function(t){e.isOpen()||n.$selection.trigger("focus")}))},i.prototype.clear=function(){var e=this.$selection.find(".select2-selection__rendered");e.empty(),e.removeAttr("title")},i.prototype.display=function(e,t){var n=this.options.get("templateSelection"),r=this.options.get("escapeMarkup");return r(n(e,t))},i.prototype.selectionContainer=function(){return e("<span></span>")},i.prototype.update=function(e){if(0!==e.length){var t=e[0],n=this.$selection.find(".select2-selection__rendered"),r=this.display(t,n);n.empty().append(r);var i=t.title||t.text;i?n.attr("title",i):n.removeAttr("title")}else this.clear()},i})),t.define("select2/selection/multiple",["jquery","./base","../utils"],(function(e,t,n){function r(e,t){r.__super__.constructor.apply(this,arguments)}return n.Extend(r,t),r.prototype.render=function(){var e=r.__super__.render.call(this);return e.addClass("select2-selection--multiple"),e.html('<ul class="select2-selection__rendered"></ul>'),e},r.prototype.bind=function(t,i){var o=this;r.__super__.bind.apply(this,arguments),this.$selection.on("click",(function(e){o.trigger("toggle",{originalEvent:e})})),this.$selection.on("click",".select2-selection__choice__remove",(function(t){if(!o.isDisabled()){var r=e(this),i=r.parent(),s=n.GetData(i[0],"data");o.trigger("unselect",{originalEvent:t,data:s})}}))},r.prototype.clear=function(){var e=this.$selection.find(".select2-selection__rendered");e.empty(),e.removeAttr("title")},r.prototype.display=function(e,t){var n=this.options.get("templateSelection"),r=this.options.get("escapeMarkup");return r(n(e,t))},r.prototype.selectionContainer=function(){var t=e('<li class="select2-selection__choice"><span class="select2-selection__choice__remove" role="presentation">&times;</span></li>');return t},r.prototype.update=function(e){if(this.clear(),0!==e.length){for(var t=[],r=0;r<e.length;r++){var i=e[r],o=this.selectionContainer(),s=this.display(i,o);o.append(s);var a=i.title||i.text;a&&o.attr("title",a),n.StoreData(o[0],"data",i),t.push(o)}var l=this.$selection.find(".select2-selection__rendered");n.appendMany(l,t)}},r})),t.define("select2/selection/placeholder",["../utils"],(function(e){function t(e,t,n){this.placeholder=this.normalizePlaceholder(n.get("placeholder")),e.call(this,t,n)}return t.prototype.normalizePlaceholder=function(e,t){return"string"===typeof t&&(t={id:"",text:t}),t},t.prototype.createPlaceholder=function(e,t){var n=this.selectionContainer();return n.html(this.display(t)),n.addClass("select2-selection__placeholder").removeClass("select2-selection__choice"),n},t.prototype.update=function(e,t){var n=1==t.length&&t[0].id!=this.placeholder.id,r=t.length>1;if(r||n)return e.call(this,t);this.clear();var i=this.createPlaceholder(this.placeholder);this.$selection.find(".select2-selection__rendered").append(i)},t})),t.define("select2/selection/allowClear",["jquery","../keys","../utils"],(function(e,t,n){function r(){}return r.prototype.bind=function(e,t,n){var r=this;e.call(this,t,n),null==this.placeholder&&this.options.get("debug")&&window.console&&console.error&&console.error("Select2: The `allowClear` option should be used in combination with the `placeholder` option."),this.$selection.on("mousedown",".select2-selection__clear",(function(e){r._handleClear(e)})),t.on("keypress",(function(e){r._handleKeyboardClear(e,t)}))},r.prototype._handleClear=function(e,t){if(!this.isDisabled()){var r=this.$selection.find(".select2-selection__clear");if(0!==r.length){t.stopPropagation();var i=n.GetData(r[0],"data"),o=this.$element.val();this.$element.val(this.placeholder.id);var s={data:i};if(this.trigger("clear",s),s.prevented)this.$element.val(o);else{for(var a=0;a<i.length;a++)if(s={data:i[a]},this.trigger("unselect",s),s.prevented)return void this.$element.val(o);this.$element.trigger("input").trigger("change"),this.trigger("toggle",{})}}}},r.prototype._handleKeyboardClear=function(e,n,r){r.isOpen()||n.which!=t.DELETE&&n.which!=t.BACKSPACE||this._handleClear(n)},r.prototype.update=function(t,r){if(t.call(this,r),!(this.$selection.find(".select2-selection__placeholder").length>0||0===r.length)){var i=this.options.get("translations").get("removeAllItems"),o=e('<span class="select2-selection__clear" title="'+i()+'">&times;</span>');n.StoreData(o[0],"data",r),this.$selection.find(".select2-selection__rendered").prepend(o)}},r})),t.define("select2/selection/search",["jquery","../utils","../keys"],(function(e,t,n){function r(e,t,n){e.call(this,t,n)}return r.prototype.render=function(t){var n=e('<li class="select2-search select2-search--inline"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="searchbox" aria-autocomplete="list" /></li>');this.$searchContainer=n,this.$search=n.find("input");var r=t.call(this);return this._transferTabIndex(),r},r.prototype.bind=function(e,r,i){var o=this,s=r.id+"-results";e.call(this,r,i),r.on("open",(function(){o.$search.attr("aria-controls",s),o.$search.trigger("focus")})),r.on("close",(function(){o.$search.val(""),o.$search.removeAttr("aria-controls"),o.$search.removeAttr("aria-activedescendant"),o.$search.trigger("focus")})),r.on("enable",(function(){o.$search.prop("disabled",!1),o._transferTabIndex()})),r.on("disable",(function(){o.$search.prop("disabled",!0)})),r.on("focus",(function(e){o.$search.trigger("focus")})),r.on("results:focus",(function(e){e.data._resultId?o.$search.attr("aria-activedescendant",e.data._resultId):o.$search.removeAttr("aria-activedescendant")})),this.$selection.on("focusin",".select2-search--inline",(function(e){o.trigger("focus",e)})),this.$selection.on("focusout",".select2-search--inline",(function(e){o._handleBlur(e)})),this.$selection.on("keydown",".select2-search--inline",(function(e){e.stopPropagation(),o.trigger("keypress",e),o._keyUpPrevented=e.isDefaultPrevented();var r=e.which;if(r===n.BACKSPACE&&""===o.$search.val()){var i=o.$searchContainer.prev(".select2-selection__choice");if(i.length>0){var s=t.GetData(i[0],"data");o.searchRemoveChoice(s),e.preventDefault()}}})),this.$selection.on("click",".select2-search--inline",(function(e){o.$search.val()&&e.stopPropagation()}));var a=document.documentMode,l=a&&a<=11;this.$selection.on("input.searchcheck",".select2-search--inline",(function(e){l?o.$selection.off("input.search input.searchcheck"):o.$selection.off("keyup.search")})),this.$selection.on("keyup.search input.search",".select2-search--inline",(function(e){if(l&&"input"===e.type)o.$selection.off("input.search input.searchcheck");else{var t=e.which;t!=n.SHIFT&&t!=n.CTRL&&t!=n.ALT&&t!=n.TAB&&o.handleSearch(e)}}))},r.prototype._transferTabIndex=function(e){this.$search.attr("tabindex",this.$selection.attr("tabindex")),this.$selection.attr("tabindex","-1")},r.prototype.createPlaceholder=function(e,t){this.$search.attr("placeholder",t.text)},r.prototype.update=function(e,t){var n=this.$search[0]==document.activeElement;this.$search.attr("placeholder",""),e.call(this,t),this.$selection.find(".select2-selection__rendered").append(this.$searchContainer),this.resizeSearch(),n&&this.$search.trigger("focus")},r.prototype.handleSearch=function(){if(this.resizeSearch(),!this._keyUpPrevented){var e=this.$search.val();this.trigger("query",{term:e})}this._keyUpPrevented=!1},r.prototype.searchRemoveChoice=function(e,t){this.trigger("unselect",{data:t}),this.$search.val(t.text),this.handleSearch()},r.prototype.resizeSearch=function(){this.$search.css("width","25px");var e="";if(""!==this.$search.attr("placeholder"))e=this.$selection.find(".select2-selection__rendered").width();else{var t=this.$search.val().length+1;e=.75*t+"em"}this.$search.css("width",e)},r})),t.define("select2/selection/eventRelay",["jquery"],(function(e){function t(){}return t.prototype.bind=function(t,n,r){var i=this,o=["open","opening","close","closing","select","selecting","unselect","unselecting","clear","clearing"],s=["opening","closing","selecting","unselecting","clearing"];t.call(this,n,r),n.on("*",(function(t,n){if(-1!==e.inArray(t,o)){n=n||{};var r=e.Event("select2:"+t,{params:n});i.$element.trigger(r),-1!==e.inArray(t,s)&&(n.prevented=r.isDefaultPrevented())}}))},t})),t.define("select2/translation",["jquery","require"],(function(e,t){function n(e){this.dict=e||{}}return n.prototype.all=function(){return this.dict},n.prototype.get=function(e){return this.dict[e]},n.prototype.extend=function(t){this.dict=e.extend({},t.all(),this.dict)},n._cache={},n.loadPath=function(e){if(!(e in n._cache)){var r=t(e);n._cache[e]=r}return new n(n._cache[e])},n})),t.define("select2/diacritics",[],(function(){var e={"Ⓐ":"A","Ａ":"A","À":"A","Á":"A","Â":"A","Ầ":"A","Ấ":"A","Ẫ":"A","Ẩ":"A","Ã":"A","Ā":"A","Ă":"A","Ằ":"A","Ắ":"A","Ẵ":"A","Ẳ":"A","Ȧ":"A","Ǡ":"A","Ä":"A","Ǟ":"A","Ả":"A","Å":"A","Ǻ":"A","Ǎ":"A","Ȁ":"A","Ȃ":"A","Ạ":"A","Ậ":"A","Ặ":"A","Ḁ":"A","Ą":"A","Ⱥ":"A","Ɐ":"A","Ꜳ":"AA","Æ":"AE","Ǽ":"AE","Ǣ":"AE","Ꜵ":"AO","Ꜷ":"AU","Ꜹ":"AV","Ꜻ":"AV","Ꜽ":"AY","Ⓑ":"B","Ｂ":"B","Ḃ":"B","Ḅ":"B","Ḇ":"B","Ƀ":"B","Ƃ":"B","Ɓ":"B","Ⓒ":"C","Ｃ":"C","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","Ç":"C","Ḉ":"C","Ƈ":"C","Ȼ":"C","Ꜿ":"C","Ⓓ":"D","Ｄ":"D","Ḋ":"D","Ď":"D","Ḍ":"D","Ḑ":"D","Ḓ":"D","Ḏ":"D","Đ":"D","Ƌ":"D","Ɗ":"D","Ɖ":"D","Ꝺ":"D","Ǳ":"DZ","Ǆ":"DZ","ǲ":"Dz","ǅ":"Dz","Ⓔ":"E","Ｅ":"E","È":"E","É":"E","Ê":"E","Ề":"E","Ế":"E","Ễ":"E","Ể":"E","Ẽ":"E","Ē":"E","Ḕ":"E","Ḗ":"E","Ĕ":"E","Ė":"E","Ë":"E","Ẻ":"E","Ě":"E","Ȅ":"E","Ȇ":"E","Ẹ":"E","Ệ":"E","Ȩ":"E","Ḝ":"E","Ę":"E","Ḙ":"E","Ḛ":"E","Ɛ":"E","Ǝ":"E","Ⓕ":"F","Ｆ":"F","Ḟ":"F","Ƒ":"F","Ꝼ":"F","Ⓖ":"G","Ｇ":"G","Ǵ":"G","Ĝ":"G","Ḡ":"G","Ğ":"G","Ġ":"G","Ǧ":"G","Ģ":"G","Ǥ":"G","Ɠ":"G","Ꞡ":"G","Ᵹ":"G","Ꝿ":"G","Ⓗ":"H","Ｈ":"H","Ĥ":"H","Ḣ":"H","Ḧ":"H","Ȟ":"H","Ḥ":"H","Ḩ":"H","Ḫ":"H","Ħ":"H","Ⱨ":"H","Ⱶ":"H","Ɥ":"H","Ⓘ":"I","Ｉ":"I","Ì":"I","Í":"I","Î":"I","Ĩ":"I","Ī":"I","Ĭ":"I","İ":"I","Ï":"I","Ḯ":"I","Ỉ":"I","Ǐ":"I","Ȉ":"I","Ȋ":"I","Ị":"I","Į":"I","Ḭ":"I","Ɨ":"I","Ⓙ":"J","Ｊ":"J","Ĵ":"J","Ɉ":"J","Ⓚ":"K","Ｋ":"K","Ḱ":"K","Ǩ":"K","Ḳ":"K","Ķ":"K","Ḵ":"K","Ƙ":"K","Ⱪ":"K","Ꝁ":"K","Ꝃ":"K","Ꝅ":"K","Ꞣ":"K","Ⓛ":"L","Ｌ":"L","Ŀ":"L","Ĺ":"L","Ľ":"L","Ḷ":"L","Ḹ":"L","Ļ":"L","Ḽ":"L","Ḻ":"L","Ł":"L","Ƚ":"L","Ɫ":"L","Ⱡ":"L","Ꝉ":"L","Ꝇ":"L","Ꞁ":"L","Ǉ":"LJ","ǈ":"Lj","Ⓜ":"M","Ｍ":"M","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ɱ":"M","Ɯ":"M","Ⓝ":"N","Ｎ":"N","Ǹ":"N","Ń":"N","Ñ":"N","Ṅ":"N","Ň":"N","Ṇ":"N","Ņ":"N","Ṋ":"N","Ṉ":"N","Ƞ":"N","Ɲ":"N","Ꞑ":"N","Ꞥ":"N","Ǌ":"NJ","ǋ":"Nj","Ⓞ":"O","Ｏ":"O","Ò":"O","Ó":"O","Ô":"O","Ồ":"O","Ố":"O","Ỗ":"O","Ổ":"O","Õ":"O","Ṍ":"O","Ȭ":"O","Ṏ":"O","Ō":"O","Ṑ":"O","Ṓ":"O","Ŏ":"O","Ȯ":"O","Ȱ":"O","Ö":"O","Ȫ":"O","Ỏ":"O","Ő":"O","Ǒ":"O","Ȍ":"O","Ȏ":"O","Ơ":"O","Ờ":"O","Ớ":"O","Ỡ":"O","Ở":"O","Ợ":"O","Ọ":"O","Ộ":"O","Ǫ":"O","Ǭ":"O","Ø":"O","Ǿ":"O","Ɔ":"O","Ɵ":"O","Ꝋ":"O","Ꝍ":"O","Œ":"OE","Ƣ":"OI","Ꝏ":"OO","Ȣ":"OU","Ⓟ":"P","Ｐ":"P","Ṕ":"P","Ṗ":"P","Ƥ":"P","Ᵽ":"P","Ꝑ":"P","Ꝓ":"P","Ꝕ":"P","Ⓠ":"Q","Ｑ":"Q","Ꝗ":"Q","Ꝙ":"Q","Ɋ":"Q","Ⓡ":"R","Ｒ":"R","Ŕ":"R","Ṙ":"R","Ř":"R","Ȑ":"R","Ȓ":"R","Ṛ":"R","Ṝ":"R","Ŗ":"R","Ṟ":"R","Ɍ":"R","Ɽ":"R","Ꝛ":"R","Ꞧ":"R","Ꞃ":"R","Ⓢ":"S","Ｓ":"S","ẞ":"S","Ś":"S","Ṥ":"S","Ŝ":"S","Ṡ":"S","Š":"S","Ṧ":"S","Ṣ":"S","Ṩ":"S","Ș":"S","Ş":"S","Ȿ":"S","Ꞩ":"S","Ꞅ":"S","Ⓣ":"T","Ｔ":"T","Ṫ":"T","Ť":"T","Ṭ":"T","Ț":"T","Ţ":"T","Ṱ":"T","Ṯ":"T","Ŧ":"T","Ƭ":"T","Ʈ":"T","Ⱦ":"T","Ꞇ":"T","Ꜩ":"TZ","Ⓤ":"U","Ｕ":"U","Ù":"U","Ú":"U","Û":"U","Ũ":"U","Ṹ":"U","Ū":"U","Ṻ":"U","Ŭ":"U","Ü":"U","Ǜ":"U","Ǘ":"U","Ǖ":"U","Ǚ":"U","Ủ":"U","Ů":"U","Ű":"U","Ǔ":"U","Ȕ":"U","Ȗ":"U","Ư":"U","Ừ":"U","Ứ":"U","Ữ":"U","Ử":"U","Ự":"U","Ụ":"U","Ṳ":"U","Ų":"U","Ṷ":"U","Ṵ":"U","Ʉ":"U","Ⓥ":"V","Ｖ":"V","Ṽ":"V","Ṿ":"V","Ʋ":"V","Ꝟ":"V","Ʌ":"V","Ꝡ":"VY","Ⓦ":"W","Ｗ":"W","Ẁ":"W","Ẃ":"W","Ŵ":"W","Ẇ":"W","Ẅ":"W","Ẉ":"W","Ⱳ":"W","Ⓧ":"X","Ｘ":"X","Ẋ":"X","Ẍ":"X","Ⓨ":"Y","Ｙ":"Y","Ỳ":"Y","Ý":"Y","Ŷ":"Y","Ỹ":"Y","Ȳ":"Y","Ẏ":"Y","Ÿ":"Y","Ỷ":"Y","Ỵ":"Y","Ƴ":"Y","Ɏ":"Y","Ỿ":"Y","Ⓩ":"Z","Ｚ":"Z","Ź":"Z","Ẑ":"Z","Ż":"Z","Ž":"Z","Ẓ":"Z","Ẕ":"Z","Ƶ":"Z","Ȥ":"Z","Ɀ":"Z","Ⱬ":"Z","Ꝣ":"Z","ⓐ":"a","ａ":"a","ẚ":"a","à":"a","á":"a","â":"a","ầ":"a","ấ":"a","ẫ":"a","ẩ":"a","ã":"a","ā":"a","ă":"a","ằ":"a","ắ":"a","ẵ":"a","ẳ":"a","ȧ":"a","ǡ":"a","ä":"a","ǟ":"a","ả":"a","å":"a","ǻ":"a","ǎ":"a","ȁ":"a","ȃ":"a","ạ":"a","ậ":"a","ặ":"a","ḁ":"a","ą":"a","ⱥ":"a","ɐ":"a","ꜳ":"aa","æ":"ae","ǽ":"ae","ǣ":"ae","ꜵ":"ao","ꜷ":"au","ꜹ":"av","ꜻ":"av","ꜽ":"ay","ⓑ":"b","ｂ":"b","ḃ":"b","ḅ":"b","ḇ":"b","ƀ":"b","ƃ":"b","ɓ":"b","ⓒ":"c","ｃ":"c","ć":"c","ĉ":"c","ċ":"c","č":"c","ç":"c","ḉ":"c","ƈ":"c","ȼ":"c","ꜿ":"c","ↄ":"c","ⓓ":"d","ｄ":"d","ḋ":"d","ď":"d","ḍ":"d","ḑ":"d","ḓ":"d","ḏ":"d","đ":"d","ƌ":"d","ɖ":"d","ɗ":"d","ꝺ":"d","ǳ":"dz","ǆ":"dz","ⓔ":"e","ｅ":"e","è":"e","é":"e","ê":"e","ề":"e","ế":"e","ễ":"e","ể":"e","ẽ":"e","ē":"e","ḕ":"e","ḗ":"e","ĕ":"e","ė":"e","ë":"e","ẻ":"e","ě":"e","ȅ":"e","ȇ":"e","ẹ":"e","ệ":"e","ȩ":"e","ḝ":"e","ę":"e","ḙ":"e","ḛ":"e","ɇ":"e","ɛ":"e","ǝ":"e","ⓕ":"f","ｆ":"f","ḟ":"f","ƒ":"f","ꝼ":"f","ⓖ":"g","ｇ":"g","ǵ":"g","ĝ":"g","ḡ":"g","ğ":"g","ġ":"g","ǧ":"g","ģ":"g","ǥ":"g","ɠ":"g","ꞡ":"g","ᵹ":"g","ꝿ":"g","ⓗ":"h","ｈ":"h","ĥ":"h","ḣ":"h","ḧ":"h","ȟ":"h","ḥ":"h","ḩ":"h","ḫ":"h","ẖ":"h","ħ":"h","ⱨ":"h","ⱶ":"h","ɥ":"h","ƕ":"hv","ⓘ":"i","ｉ":"i","ì":"i","í":"i","î":"i","ĩ":"i","ī":"i","ĭ":"i","ï":"i","ḯ":"i","ỉ":"i","ǐ":"i","ȉ":"i","ȋ":"i","ị":"i","į":"i","ḭ":"i","ɨ":"i","ı":"i","ⓙ":"j","ｊ":"j","ĵ":"j","ǰ":"j","ɉ":"j","ⓚ":"k","ｋ":"k","ḱ":"k","ǩ":"k","ḳ":"k","ķ":"k","ḵ":"k","ƙ":"k","ⱪ":"k","ꝁ":"k","ꝃ":"k","ꝅ":"k","ꞣ":"k","ⓛ":"l","ｌ":"l","ŀ":"l","ĺ":"l","ľ":"l","ḷ":"l","ḹ":"l","ļ":"l","ḽ":"l","ḻ":"l","ſ":"l","ł":"l","ƚ":"l","ɫ":"l","ⱡ":"l","ꝉ":"l","ꞁ":"l","ꝇ":"l","ǉ":"lj","ⓜ":"m","ｍ":"m","ḿ":"m","ṁ":"m","ṃ":"m","ɱ":"m","ɯ":"m","ⓝ":"n","ｎ":"n","ǹ":"n","ń":"n","ñ":"n","ṅ":"n","ň":"n","ṇ":"n","ņ":"n","ṋ":"n","ṉ":"n","ƞ":"n","ɲ":"n","ŉ":"n","ꞑ":"n","ꞥ":"n","ǌ":"nj","ⓞ":"o","ｏ":"o","ò":"o","ó":"o","ô":"o","ồ":"o","ố":"o","ỗ":"o","ổ":"o","õ":"o","ṍ":"o","ȭ":"o","ṏ":"o","ō":"o","ṑ":"o","ṓ":"o","ŏ":"o","ȯ":"o","ȱ":"o","ö":"o","ȫ":"o","ỏ":"o","ő":"o","ǒ":"o","ȍ":"o","ȏ":"o","ơ":"o","ờ":"o","ớ":"o","ỡ":"o","ở":"o","ợ":"o","ọ":"o","ộ":"o","ǫ":"o","ǭ":"o","ø":"o","ǿ":"o","ɔ":"o","ꝋ":"o","ꝍ":"o","ɵ":"o","œ":"oe","ƣ":"oi","ȣ":"ou","ꝏ":"oo","ⓟ":"p","ｐ":"p","ṕ":"p","ṗ":"p","ƥ":"p","ᵽ":"p","ꝑ":"p","ꝓ":"p","ꝕ":"p","ⓠ":"q","ｑ":"q","ɋ":"q","ꝗ":"q","ꝙ":"q","ⓡ":"r","ｒ":"r","ŕ":"r","ṙ":"r","ř":"r","ȑ":"r","ȓ":"r","ṛ":"r","ṝ":"r","ŗ":"r","ṟ":"r","ɍ":"r","ɽ":"r","ꝛ":"r","ꞧ":"r","ꞃ":"r","ⓢ":"s","ｓ":"s","ß":"s","ś":"s","ṥ":"s","ŝ":"s","ṡ":"s","š":"s","ṧ":"s","ṣ":"s","ṩ":"s","ș":"s","ş":"s","ȿ":"s","ꞩ":"s","ꞅ":"s","ẛ":"s","ⓣ":"t","ｔ":"t","ṫ":"t","ẗ":"t","ť":"t","ṭ":"t","ț":"t","ţ":"t","ṱ":"t","ṯ":"t","ŧ":"t","ƭ":"t","ʈ":"t","ⱦ":"t","ꞇ":"t","ꜩ":"tz","ⓤ":"u","ｕ":"u","ù":"u","ú":"u","û":"u","ũ":"u","ṹ":"u","ū":"u","ṻ":"u","ŭ":"u","ü":"u","ǜ":"u","ǘ":"u","ǖ":"u","ǚ":"u","ủ":"u","ů":"u","ű":"u","ǔ":"u","ȕ":"u","ȗ":"u","ư":"u","ừ":"u","ứ":"u","ữ":"u","ử":"u","ự":"u","ụ":"u","ṳ":"u","ų":"u","ṷ":"u","ṵ":"u","ʉ":"u","ⓥ":"v","ｖ":"v","ṽ":"v","ṿ":"v","ʋ":"v","ꝟ":"v","ʌ":"v","ꝡ":"vy","ⓦ":"w","ｗ":"w","ẁ":"w","ẃ":"w","ŵ":"w","ẇ":"w","ẅ":"w","ẘ":"w","ẉ":"w","ⱳ":"w","ⓧ":"x","ｘ":"x","ẋ":"x","ẍ":"x","ⓨ":"y","ｙ":"y","ỳ":"y","ý":"y","ŷ":"y","ỹ":"y","ȳ":"y","ẏ":"y","ÿ":"y","ỷ":"y","ẙ":"y","ỵ":"y","ƴ":"y","ɏ":"y","ỿ":"y","ⓩ":"z","ｚ":"z","ź":"z","ẑ":"z","ż":"z","ž":"z","ẓ":"z","ẕ":"z","ƶ":"z","ȥ":"z","ɀ":"z","ⱬ":"z","ꝣ":"z","Ά":"Α","Έ":"Ε","Ή":"Η","Ί":"Ι","Ϊ":"Ι","Ό":"Ο","Ύ":"Υ","Ϋ":"Υ","Ώ":"Ω","ά":"α","έ":"ε","ή":"η","ί":"ι","ϊ":"ι","ΐ":"ι","ό":"ο","ύ":"υ","ϋ":"υ","ΰ":"υ","ώ":"ω","ς":"σ","’":"'"};return e})),t.define("select2/data/base",["../utils"],(function(e){function t(e,n){t.__super__.constructor.call(this)}return e.Extend(t,e.Observable),t.prototype.current=function(e){throw new Error("The `current` method must be defined in child classes.")},t.prototype.query=function(e,t){throw new Error("The `query` method must be defined in child classes.")},t.prototype.bind=function(e,t){},t.prototype.destroy=function(){},t.prototype.generateResultId=function(t,n){var r=t.id+"-result-";return r+=e.generateChars(4),null!=n.id?r+="-"+n.id.toString():r+="-"+e.generateChars(4),r},t})),t.define("select2/data/select",["./base","../utils","jquery"],(function(e,t,n){function r(e,t){this.$element=e,this.options=t,r.__super__.constructor.call(this)}return t.Extend(r,e),r.prototype.current=function(e){var t=[],r=this;this.$element.find(":selected").each((function(){var e=n(this),i=r.item(e);t.push(i)})),e(t)},r.prototype.select=function(e){var t=this;if(e.selected=!0,n(e.element).is("option"))return e.element.selected=!0,void this.$element.trigger("input").trigger("change");if(this.$element.prop("multiple"))this.current((function(r){var i=[];e=[e],e.push.apply(e,r);for(var o=0;o<e.length;o++){var s=e[o].id;-1===n.inArray(s,i)&&i.push(s)}t.$element.val(i),t.$element.trigger("input").trigger("change")}));else{var r=e.id;this.$element.val(r),this.$element.trigger("input").trigger("change")}},r.prototype.unselect=function(e){var t=this;if(this.$element.prop("multiple")){if(e.selected=!1,n(e.element).is("option"))return e.element.selected=!1,void this.$element.trigger("input").trigger("change");this.current((function(r){for(var i=[],o=0;o<r.length;o++){var s=r[o].id;s!==e.id&&-1===n.inArray(s,i)&&i.push(s)}t.$element.val(i),t.$element.trigger("input").trigger("change")}))}},r.prototype.bind=function(e,t){var n=this;this.container=e,e.on("select",(function(e){n.select(e.data)})),e.on("unselect",(function(e){n.unselect(e.data)}))},r.prototype.destroy=function(){this.$element.find("*").each((function(){t.RemoveData(this)}))},r.prototype.query=function(e,t){var r=[],i=this,o=this.$element.children();o.each((function(){var t=n(this);if(t.is("option")||t.is("optgroup")){var o=i.item(t),s=i.matches(e,o);null!==s&&r.push(s)}})),t({results:r})},r.prototype.addOptions=function(e){t.appendMany(this.$element,e)},r.prototype.option=function(e){var r;e.children?(r=document.createElement("optgroup"),r.label=e.text):(r=document.createElement("option"),void 0!==r.textContent?r.textContent=e.text:r.innerText=e.text),void 0!==e.id&&(r.value=e.id),e.disabled&&(r.disabled=!0),e.selected&&(r.selected=!0),e.title&&(r.title=e.title);var i=n(r),o=this._normalizeItem(e);return o.element=r,t.StoreData(r,"data",o),i},r.prototype.item=function(e){var r={};if(r=t.GetData(e[0],"data"),null!=r)return r;if(e.is("option"))r={id:e.val(),text:e.text(),disabled:e.prop("disabled"),selected:e.prop("selected"),title:e.prop("title")};else if(e.is("optgroup")){r={text:e.prop("label"),children:[],title:e.prop("title")};for(var i=e.children("option"),o=[],s=0;s<i.length;s++){var a=n(i[s]),l=this.item(a);o.push(l)}r.children=o}return r=this._normalizeItem(r),r.element=e[0],t.StoreData(e[0],"data",r),r},r.prototype._normalizeItem=function(e){e!==Object(e)&&(e={id:e,text:e}),e=n.extend({},{text:""},e);var t={selected:!1,disabled:!1};return null!=e.id&&(e.id=e.id.toString()),null!=e.text&&(e.text=e.text.toString()),null==e._resultId&&e.id&&null!=this.container&&(e._resultId=this.generateResultId(this.container,e)),n.extend({},t,e)},r.prototype.matches=function(e,t){var n=this.options.get("matcher");return n(e,t)},r})),t.define("select2/data/array",["./select","../utils","jquery"],(function(e,t,n){function r(e,t){this._dataToConvert=t.get("data")||[],r.__super__.constructor.call(this,e,t)}return t.Extend(r,e),r.prototype.bind=function(e,t){r.__super__.bind.call(this,e,t),this.addOptions(this.convertToOptions(this._dataToConvert))},r.prototype.select=function(e){var t=this.$element.find("option").filter((function(t,n){return n.value==e.id.toString()}));0===t.length&&(t=this.option(e),this.addOptions(t)),r.__super__.select.call(this,e)},r.prototype.convertToOptions=function(e){var r=this,i=this.$element.find("option"),o=i.map((function(){return r.item(n(this)).id})).get(),s=[];function a(e){return function(){return n(this).val()==e.id}}for(var l=0;l<e.length;l++){var u=this._normalizeItem(e[l]);if(n.inArray(u.id,o)>=0){var c=i.filter(a(u)),h=this.item(c),d=n.extend(!0,{},u,h),p=this.option(d);c.replaceWith(p)}else{var f=this.option(u);if(u.children){var m=this.convertToOptions(u.children);t.appendMany(f,m)}s.push(f)}}return s},r})),t.define("select2/data/ajax",["./array","../utils","jquery"],(function(e,t,n){function r(e,t){this.ajaxOptions=this._applyDefaults(t.get("ajax")),null!=this.ajaxOptions.processResults&&(this.processResults=this.ajaxOptions.processResults),r.__super__.constructor.call(this,e,t)}return t.Extend(r,e),r.prototype._applyDefaults=function(e){var t={data:function(e){return n.extend({},e,{q:e.term})},transport:function(e,t,r){var i=n.ajax(e);return i.then(t),i.fail(r),i}};return n.extend({},t,e,!0)},r.prototype.processResults=function(e){return e},r.prototype.query=function(e,t){var r=this;null!=this._request&&(n.isFunction(this._request.abort)&&this._request.abort(),this._request=null);var i=n.extend({type:"GET"},this.ajaxOptions);function o(){var o=i.transport(i,(function(i){var o=r.processResults(i,e);r.options.get("debug")&&window.console&&console.error&&(o&&o.results&&n.isArray(o.results)||console.error("Select2: The AJAX results did not return an array in the `results` key of the response.")),t(o)}),(function(){(!("status"in o)||0!==o.status&&"0"!==o.status)&&r.trigger("results:message",{message:"errorLoading"})}));r._request=o}"function"===typeof i.url&&(i.url=i.url.call(this.$element,e)),"function"===typeof i.data&&(i.data=i.data.call(this.$element,e)),this.ajaxOptions.delay&&null!=e.term?(this._queryTimeout&&window.clearTimeout(this._queryTimeout),this._queryTimeout=window.setTimeout(o,this.ajaxOptions.delay)):o()},r})),t.define("select2/data/tags",["jquery"],(function(e){function t(t,n,r){var i=r.get("tags"),o=r.get("createTag");void 0!==o&&(this.createTag=o);var s=r.get("insertTag");if(void 0!==s&&(this.insertTag=s),t.call(this,n,r),e.isArray(i))for(var a=0;a<i.length;a++){var l=i[a],u=this._normalizeItem(l),c=this.option(u);this.$element.append(c)}}return t.prototype.query=function(e,t,n){var r=this;function i(e,o){for(var s=e.results,a=0;a<s.length;a++){var l=s[a],u=null!=l.children&&!i({results:l.children},!0),c=(l.text||"").toUpperCase(),h=(t.term||"").toUpperCase(),d=c===h;if(d||u)return!o&&(e.data=s,void n(e))}if(o)return!0;var p=r.createTag(t);if(null!=p){var f=r.option(p);f.attr("data-select2-tag",!0),r.addOptions([f]),r.insertTag(s,p)}e.results=s,n(e)}this._removeOldTags(),null!=t.term&&null==t.page?e.call(this,t,i):e.call(this,t,n)},t.prototype.createTag=function(t,n){var r=e.trim(n.term);return""===r?null:{id:r,text:r}},t.prototype.insertTag=function(e,t,n){t.unshift(n)},t.prototype._removeOldTags=function(t){var n=this.$element.find("option[data-select2-tag]");n.each((function(){this.selected||e(this).remove()}))},t})),t.define("select2/data/tokenizer",["jquery"],(function(e){function t(e,t,n){var r=n.get("tokenizer");void 0!==r&&(this.tokenizer=r),e.call(this,t,n)}return t.prototype.bind=function(e,t,n){e.call(this,t,n),this.$search=t.dropdown.$search||t.selection.$search||n.find(".select2-search__field")},t.prototype.query=function(t,n,r){var i=this;function o(t){var n=i._normalizeItem(t),r=i.$element.find("option").filter((function(){return e(this).val()===n.id}));if(!r.length){var o=i.option(n);o.attr("data-select2-tag",!0),i._removeOldTags(),i.addOptions([o])}s(n)}function s(e){i.trigger("select",{data:e})}n.term=n.term||"";var a=this.tokenizer(n,this.options,o);a.term!==n.term&&(this.$search.length&&(this.$search.val(a.term),this.$search.trigger("focus")),n.term=a.term),t.call(this,n,r)},t.prototype.tokenizer=function(t,n,r,i){var o=r.get("tokenSeparators")||[],s=n.term,a=0,l=this.createTag||function(e){return{id:e.term,text:e.term}};while(a<s.length){var u=s[a];if(-1!==e.inArray(u,o)){var c=s.substr(0,a),h=e.extend({},n,{term:c}),d=l(h);null!=d?(i(d),s=s.substr(a+1)||"",a=0):a++}else a++}return{term:s}},t})),t.define("select2/data/minimumInputLength",[],(function(){function e(e,t,n){this.minimumInputLength=n.get("minimumInputLength"),e.call(this,t,n)}return e.prototype.query=function(e,t,n){t.term=t.term||"",t.term.length<this.minimumInputLength?this.trigger("results:message",{message:"inputTooShort",args:{minimum:this.minimumInputLength,input:t.term,params:t}}):e.call(this,t,n)},e})),t.define("select2/data/maximumInputLength",[],(function(){function e(e,t,n){this.maximumInputLength=n.get("maximumInputLength"),e.call(this,t,n)}return e.prototype.query=function(e,t,n){t.term=t.term||"",this.maximumInputLength>0&&t.term.length>this.maximumInputLength?this.trigger("results:message",{message:"inputTooLong",args:{maximum:this.maximumInputLength,input:t.term,params:t}}):e.call(this,t,n)},e})),t.define("select2/data/maximumSelectionLength",[],(function(){function e(e,t,n){this.maximumSelectionLength=n.get("maximumSelectionLength"),e.call(this,t,n)}return e.prototype.bind=function(e,t,n){var r=this;e.call(this,t,n),t.on("select",(function(){r._checkIfMaximumSelected()}))},e.prototype.query=function(e,t,n){var r=this;this._checkIfMaximumSelected((function(){e.call(r,t,n)}))},e.prototype._checkIfMaximumSelected=function(e,t){var n=this;this.current((function(e){var r=null!=e?e.length:0;n.maximumSelectionLength>0&&r>=n.maximumSelectionLength?n.trigger("results:message",{message:"maximumSelected",args:{maximum:n.maximumSelectionLength}}):t&&t()}))},e})),t.define("select2/dropdown",["jquery","./utils"],(function(e,t){function n(e,t){this.$element=e,this.options=t,n.__super__.constructor.call(this)}return t.Extend(n,t.Observable),n.prototype.render=function(){var t=e('<span class="select2-dropdown"><span class="select2-results"></span></span>');return t.attr("dir",this.options.get("dir")),this.$dropdown=t,t},n.prototype.bind=function(){},n.prototype.position=function(e,t){},n.prototype.destroy=function(){this.$dropdown.remove()},n})),t.define("select2/dropdown/search",["jquery","../utils"],(function(e,t){function n(){}return n.prototype.render=function(t){var n=t.call(this),r=e('<span class="select2-search select2-search--dropdown"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="searchbox" aria-autocomplete="list" /></span>');return this.$searchContainer=r,this.$search=r.find("input"),n.prepend(r),n},n.prototype.bind=function(t,n,r){var i=this,o=n.id+"-results";t.call(this,n,r),this.$search.on("keydown",(function(e){i.trigger("keypress",e),i._keyUpPrevented=e.isDefaultPrevented()})),this.$search.on("input",(function(t){e(this).off("keyup")})),this.$search.on("keyup input",(function(e){i.handleSearch(e)})),n.on("open",(function(){i.$search.attr("tabindex",0),i.$search.attr("aria-controls",o),i.$search.trigger("focus"),window.setTimeout((function(){i.$search.trigger("focus")}),0)})),n.on("close",(function(){i.$search.attr("tabindex",-1),i.$search.removeAttr("aria-controls"),i.$search.removeAttr("aria-activedescendant"),i.$search.val(""),i.$search.trigger("blur")})),n.on("focus",(function(){n.isOpen()||i.$search.trigger("focus")})),n.on("results:all",(function(e){if(null==e.query.term||""===e.query.term){var t=i.showSearch(e);t?i.$searchContainer.removeClass("select2-search--hide"):i.$searchContainer.addClass("select2-search--hide")}})),n.on("results:focus",(function(e){e.data._resultId?i.$search.attr("aria-activedescendant",e.data._resultId):i.$search.removeAttr("aria-activedescendant")}))},n.prototype.handleSearch=function(e){if(!this._keyUpPrevented){var t=this.$search.val();this.trigger("query",{term:t})}this._keyUpPrevented=!1},n.prototype.showSearch=function(e,t){return!0},n})),t.define("select2/dropdown/hidePlaceholder",[],(function(){function e(e,t,n,r){this.placeholder=this.normalizePlaceholder(n.get("placeholder")),e.call(this,t,n,r)}return e.prototype.append=function(e,t){t.results=this.removePlaceholder(t.results),e.call(this,t)},e.prototype.normalizePlaceholder=function(e,t){return"string"===typeof t&&(t={id:"",text:t}),t},e.prototype.removePlaceholder=function(e,t){for(var n=t.slice(0),r=t.length-1;r>=0;r--){var i=t[r];this.placeholder.id===i.id&&n.splice(r,1)}return n},e})),t.define("select2/dropdown/infiniteScroll",["jquery"],(function(e){function t(e,t,n,r){this.lastParams={},e.call(this,t,n,r),this.$loadingMore=this.createLoadingMore(),this.loading=!1}return t.prototype.append=function(e,t){this.$loadingMore.remove(),this.loading=!1,e.call(this,t),this.showLoadingMore(t)&&(this.$results.append(this.$loadingMore),this.loadMoreIfNeeded())},t.prototype.bind=function(e,t,n){var r=this;e.call(this,t,n),t.on("query",(function(e){r.lastParams=e,r.loading=!0})),t.on("query:append",(function(e){r.lastParams=e,r.loading=!0})),this.$results.on("scroll",this.loadMoreIfNeeded.bind(this))},t.prototype.loadMoreIfNeeded=function(){var t=e.contains(document.documentElement,this.$loadingMore[0]);if(!this.loading&&t){var n=this.$results.offset().top+this.$results.outerHeight(!1),r=this.$loadingMore.offset().top+this.$loadingMore.outerHeight(!1);n+50>=r&&this.loadMore()}},t.prototype.loadMore=function(){this.loading=!0;var t=e.extend({},{page:1},this.lastParams);t.page++,this.trigger("query:append",t)},t.prototype.showLoadingMore=function(e,t){return t.pagination&&t.pagination.more},t.prototype.createLoadingMore=function(){var t=e('<li class="select2-results__option select2-results__option--load-more"role="option" aria-disabled="true"></li>'),n=this.options.get("translations").get("loadingMore");return t.html(n(this.lastParams)),t},t})),t.define("select2/dropdown/attachBody",["jquery","../utils"],(function(e,t){function n(t,n,r){this.$dropdownParent=e(r.get("dropdownParent")||document.body),t.call(this,n,r)}return n.prototype.bind=function(e,t,n){var r=this;e.call(this,t,n),t.on("open",(function(){r._showDropdown(),r._attachPositioningHandler(t),r._bindContainerResultHandlers(t)})),t.on("close",(function(){r._hideDropdown(),r._detachPositioningHandler(t)})),this.$dropdownContainer.on("mousedown",(function(e){e.stopPropagation()}))},n.prototype.destroy=function(e){e.call(this),this.$dropdownContainer.remove()},n.prototype.position=function(e,t,n){t.attr("class",n.attr("class")),t.removeClass("select2"),t.addClass("select2-container--open"),t.css({position:"absolute",top:-999999}),this.$container=n},n.prototype.render=function(t){var n=e("<span></span>"),r=t.call(this);return n.append(r),this.$dropdownContainer=n,n},n.prototype._hideDropdown=function(e){this.$dropdownContainer.detach()},n.prototype._bindContainerResultHandlers=function(e,t){if(!this._containerResultsHandlersBound){var n=this;t.on("results:all",(function(){n._positionDropdown(),n._resizeDropdown()})),t.on("results:append",(function(){n._positionDropdown(),n._resizeDropdown()})),t.on("results:message",(function(){n._positionDropdown(),n._resizeDropdown()})),t.on("select",(function(){n._positionDropdown(),n._resizeDropdown()})),t.on("unselect",(function(){n._positionDropdown(),n._resizeDropdown()})),this._containerResultsHandlersBound=!0}},n.prototype._attachPositioningHandler=function(n,r){var i=this,o="scroll.select2."+r.id,s="resize.select2."+r.id,a="orientationchange.select2."+r.id,l=this.$container.parents().filter(t.hasScroll);l.each((function(){t.StoreData(this,"select2-scroll-position",{x:e(this).scrollLeft(),y:e(this).scrollTop()})})),l.on(o,(function(n){var r=t.GetData(this,"select2-scroll-position");e(this).scrollTop(r.y)})),e(window).on(o+" "+s+" "+a,(function(e){i._positionDropdown(),i._resizeDropdown()}))},n.prototype._detachPositioningHandler=function(n,r){var i="scroll.select2."+r.id,o="resize.select2."+r.id,s="orientationchange.select2."+r.id,a=this.$container.parents().filter(t.hasScroll);a.off(i),e(window).off(i+" "+o+" "+s)},n.prototype._positionDropdown=function(){var t=e(window),n=this.$dropdown.hasClass("select2-dropdown--above"),r=this.$dropdown.hasClass("select2-dropdown--below"),i=null,o=this.$container.offset();o.bottom=o.top+this.$container.outerHeight(!1);var s={height:this.$container.outerHeight(!1)};s.top=o.top,s.bottom=o.top+s.height;var a={height:this.$dropdown.outerHeight(!1)},l={top:t.scrollTop(),bottom:t.scrollTop()+t.height()},u=l.top<o.top-a.height,c=l.bottom>o.bottom+a.height,h={left:o.left,top:s.bottom},d=this.$dropdownParent;"static"===d.css("position")&&(d=d.offsetParent());var p={top:0,left:0};(e.contains(document.body,d[0])||d[0].isConnected)&&(p=d.offset()),h.top-=p.top,h.left-=p.left,n||r||(i="below"),c||!u||n?!u&&c&&n&&(i="below"):i="above",("above"==i||n&&"below"!==i)&&(h.top=s.top-p.top-a.height),null!=i&&(this.$dropdown.removeClass("select2-dropdown--below select2-dropdown--above").addClass("select2-dropdown--"+i),this.$container.removeClass("select2-container--below select2-container--above").addClass("select2-container--"+i)),this.$dropdownContainer.css(h)},n.prototype._resizeDropdown=function(){var e={width:this.$container.outerWidth(!1)+"px"};this.options.get("dropdownAutoWidth")&&(e.minWidth=e.width,e.position="relative",e.width="auto"),this.$dropdown.css(e)},n.prototype._showDropdown=function(e){this.$dropdownContainer.appendTo(this.$dropdownParent),this._positionDropdown(),this._resizeDropdown()},n})),t.define("select2/dropdown/minimumResultsForSearch",[],(function(){function e(t){for(var n=0,r=0;r<t.length;r++){var i=t[r];i.children?n+=e(i.children):n++}return n}function t(e,t,n,r){this.minimumResultsForSearch=n.get("minimumResultsForSearch"),this.minimumResultsForSearch<0&&(this.minimumResultsForSearch=1/0),e.call(this,t,n,r)}return t.prototype.showSearch=function(t,n){return!(e(n.data.results)<this.minimumResultsForSearch)&&t.call(this,n)},t})),t.define("select2/dropdown/selectOnClose",["../utils"],(function(e){function t(){}return t.prototype.bind=function(e,t,n){var r=this;e.call(this,t,n),t.on("close",(function(e){r._handleSelectOnClose(e)}))},t.prototype._handleSelectOnClose=function(t,n){if(n&&null!=n.originalSelect2Event){var r=n.originalSelect2Event;if("select"===r._type||"unselect"===r._type)return}var i=this.getHighlightedResults();if(!(i.length<1)){var o=e.GetData(i[0],"data");null!=o.element&&o.element.selected||null==o.element&&o.selected||this.trigger("select",{data:o})}},t})),t.define("select2/dropdown/closeOnSelect",[],(function(){function e(){}return e.prototype.bind=function(e,t,n){var r=this;e.call(this,t,n),t.on("select",(function(e){r._selectTriggered(e)})),t.on("unselect",(function(e){r._selectTriggered(e)}))},e.prototype._selectTriggered=function(e,t){var n=t.originalEvent;n&&(n.ctrlKey||n.metaKey)||this.trigger("close",{originalEvent:n,originalSelect2Event:t})},e})),t.define("select2/i18n/en",[],(function(){return{errorLoading:function(){return"The results could not be loaded."},inputTooLong:function(e){var t=e.input.length-e.maximum,n="Please delete "+t+" character";return 1!=t&&(n+="s"),n},inputTooShort:function(e){var t=e.minimum-e.input.length,n="Please enter "+t+" or more characters";return n},loadingMore:function(){return"Loading more results…"},maximumSelected:function(e){var t="You can only select "+e.maximum+" item";return 1!=e.maximum&&(t+="s"),t},noResults:function(){return"No results found"},searching:function(){return"Searching…"},removeAllItems:function(){return"Remove all items"}}})),t.define("select2/defaults",["jquery","require","./results","./selection/single","./selection/multiple","./selection/placeholder","./selection/allowClear","./selection/search","./selection/eventRelay","./utils","./translation","./diacritics","./data/select","./data/array","./data/ajax","./data/tags","./data/tokenizer","./data/minimumInputLength","./data/maximumInputLength","./data/maximumSelectionLength","./dropdown","./dropdown/search","./dropdown/hidePlaceholder","./dropdown/infiniteScroll","./dropdown/attachBody","./dropdown/minimumResultsForSearch","./dropdown/selectOnClose","./dropdown/closeOnSelect","./i18n/en"],(function(e,t,n,r,i,o,s,a,l,u,c,h,d,p,f,m,g,v,y,x,b,w,_,A,S,E,M,T,C){function P(){this.reset()}P.prototype.apply=function(c){if(c=e.extend(!0,{},this.defaults,c),null==c.dataAdapter){if(null!=c.ajax?c.dataAdapter=f:null!=c.data?c.dataAdapter=p:c.dataAdapter=d,c.minimumInputLength>0&&(c.dataAdapter=u.Decorate(c.dataAdapter,v)),c.maximumInputLength>0&&(c.dataAdapter=u.Decorate(c.dataAdapter,y)),c.maximumSelectionLength>0&&(c.dataAdapter=u.Decorate(c.dataAdapter,x)),c.tags&&(c.dataAdapter=u.Decorate(c.dataAdapter,m)),null==c.tokenSeparators&&null==c.tokenizer||(c.dataAdapter=u.Decorate(c.dataAdapter,g)),null!=c.query){var h=t(c.amdBase+"compat/query");c.dataAdapter=u.Decorate(c.dataAdapter,h)}if(null!=c.initSelection){var C=t(c.amdBase+"compat/initSelection");c.dataAdapter=u.Decorate(c.dataAdapter,C)}}if(null==c.resultsAdapter&&(c.resultsAdapter=n,null!=c.ajax&&(c.resultsAdapter=u.Decorate(c.resultsAdapter,A)),null!=c.placeholder&&(c.resultsAdapter=u.Decorate(c.resultsAdapter,_)),c.selectOnClose&&(c.resultsAdapter=u.Decorate(c.resultsAdapter,M))),null==c.dropdownAdapter){if(c.multiple)c.dropdownAdapter=b;else{var P=u.Decorate(b,w);c.dropdownAdapter=P}if(0!==c.minimumResultsForSearch&&(c.dropdownAdapter=u.Decorate(c.dropdownAdapter,E)),c.closeOnSelect&&(c.dropdownAdapter=u.Decorate(c.dropdownAdapter,T)),null!=c.dropdownCssClass||null!=c.dropdownCss||null!=c.adaptDropdownCssClass){var R=t(c.amdBase+"compat/dropdownCss");c.dropdownAdapter=u.Decorate(c.dropdownAdapter,R)}c.dropdownAdapter=u.Decorate(c.dropdownAdapter,S)}if(null==c.selectionAdapter){if(c.multiple?c.selectionAdapter=i:c.selectionAdapter=r,null!=c.placeholder&&(c.selectionAdapter=u.Decorate(c.selectionAdapter,o)),c.allowClear&&(c.selectionAdapter=u.Decorate(c.selectionAdapter,s)),c.multiple&&(c.selectionAdapter=u.Decorate(c.selectionAdapter,a)),null!=c.containerCssClass||null!=c.containerCss||null!=c.adaptContainerCssClass){var L=t(c.amdBase+"compat/containerCss");c.selectionAdapter=u.Decorate(c.selectionAdapter,L)}c.selectionAdapter=u.Decorate(c.selectionAdapter,l)}c.language=this._resolveLanguage(c.language),c.language.push("en");for(var O=[],D=0;D<c.language.length;D++){var I=c.language[D];-1===O.indexOf(I)&&O.push(I)}return c.language=O,c.translations=this._processTranslations(c.language,c.debug),c},P.prototype.reset=function(){function t(e){function t(e){return h[e]||e}return e.replace(/[^\u0000-\u007E]/g,t)}function n(r,i){if(""===e.trim(r.term))return i;if(i.children&&i.children.length>0){for(var o=e.extend(!0,{},i),s=i.children.length-1;s>=0;s--){var a=i.children[s],l=n(r,a);null==l&&o.children.splice(s,1)}return o.children.length>0?o:n(r,o)}var u=t(i.text).toUpperCase(),c=t(r.term).toUpperCase();return u.indexOf(c)>-1?i:null}this.defaults={amdBase:"./",amdLanguageBase:"./i18n/",closeOnSelect:!0,debug:!1,dropdownAutoWidth:!1,escapeMarkup:u.escapeMarkup,language:{},matcher:n,minimumInputLength:0,maximumInputLength:0,maximumSelectionLength:0,minimumResultsForSearch:0,selectOnClose:!1,scrollAfterSelect:!1,sorter:function(e){return e},templateResult:function(e){return e.text},templateSelection:function(e){return e.text},theme:"default",width:"resolve"}},P.prototype.applyFromElement=function(e,t){var n=e.language,r=this.defaults.language,i=t.prop("lang"),o=t.closest("[lang]").prop("lang"),s=Array.prototype.concat.call(this._resolveLanguage(i),this._resolveLanguage(n),this._resolveLanguage(r),this._resolveLanguage(o));return e.language=s,e},P.prototype._resolveLanguage=function(t){if(!t)return[];if(e.isEmptyObject(t))return[];if(e.isPlainObject(t))return[t];var n;n=e.isArray(t)?t:[t];for(var r=[],i=0;i<n.length;i++)if(r.push(n[i]),"string"===typeof n[i]&&n[i].indexOf("-")>0){var o=n[i].split("-"),s=o[0];r.push(s)}return r},P.prototype._processTranslations=function(t,n){for(var r=new c,i=0;i<t.length;i++){var o=new c,s=t[i];if("string"===typeof s)try{o=c.loadPath(s)}catch(a){try{s=this.defaults.amdLanguageBase+s,o=c.loadPath(s)}catch(l){n&&window.console&&console.warn&&console.warn('Select2: The language file for "'+s+'" could not be automatically loaded. A fallback will be used instead.')}}else o=e.isPlainObject(s)?new c(s):s;r.extend(o)}return r},P.prototype.set=function(t,n){var r=e.camelCase(t),i={};i[r]=n;var o=u._convertData(i);e.extend(!0,this.defaults,o)};var R=new P;return R})),t.define("select2/options",["require","jquery","./defaults","./utils"],(function(e,t,n,r){function i(t,i){if(this.options=t,null!=i&&this.fromElement(i),null!=i&&(this.options=n.applyFromElement(this.options,i)),this.options=n.apply(this.options),i&&i.is("input")){var o=e(this.get("amdBase")+"compat/inputData");this.options.dataAdapter=r.Decorate(this.options.dataAdapter,o)}}return i.prototype.fromElement=function(e){var n=["select2"];null==this.options.multiple&&(this.options.multiple=e.prop("multiple")),null==this.options.disabled&&(this.options.disabled=e.prop("disabled")),null==this.options.dir&&(e.prop("dir")?this.options.dir=e.prop("dir"):e.closest("[dir]").prop("dir")?this.options.dir=e.closest("[dir]").prop("dir"):this.options.dir="ltr"),e.prop("disabled",this.options.disabled),e.prop("multiple",this.options.multiple),r.GetData(e[0],"select2Tags")&&(this.options.debug&&window.console&&console.warn&&console.warn('Select2: The `data-select2-tags` attribute has been changed to use the `data-data` and `data-tags="true"` attributes and will be removed in future versions of Select2.'),r.StoreData(e[0],"data",r.GetData(e[0],"select2Tags")),r.StoreData(e[0],"tags",!0)),r.GetData(e[0],"ajaxUrl")&&(this.options.debug&&window.console&&console.warn&&console.warn("Select2: The `data-ajax-url` attribute has been changed to `data-ajax--url` and support for the old attribute will be removed in future versions of Select2."),e.attr("ajax--url",r.GetData(e[0],"ajaxUrl")),r.StoreData(e[0],"ajax-Url",r.GetData(e[0],"ajaxUrl")));var i={};function o(e,t){return t.toUpperCase()}for(var s=0;s<e[0].attributes.length;s++){var a=e[0].attributes[s].name,l="data-";if(a.substr(0,l.length)==l){var u=a.substring(l.length),c=r.GetData(e[0],u),h=u.replace(/-([a-z])/g,o);i[h]=c}}t.fn.jquery&&"1."==t.fn.jquery.substr(0,2)&&e[0].dataset&&(i=t.extend(!0,{},e[0].dataset,i));var d=t.extend(!0,{},r.GetData(e[0]),i);for(var p in d=r._convertData(d),d)t.inArray(p,n)>-1||(t.isPlainObject(this.options[p])?t.extend(this.options[p],d[p]):this.options[p]=d[p]);return this},i.prototype.get=function(e){return this.options[e]},i.prototype.set=function(e,t){this.options[e]=t},i})),t.define("select2/core",["jquery","./options","./utils","./keys"],(function(e,t,n,r){var i=function(e,r){null!=n.GetData(e[0],"select2")&&n.GetData(e[0],"select2").destroy(),this.$element=e,this.id=this._generateId(e),r=r||{},this.options=new t(r,e),i.__super__.constructor.call(this);var o=e.attr("tabindex")||0;n.StoreData(e[0],"old-tabindex",o),e.attr("tabindex","-1");var s=this.options.get("dataAdapter");this.dataAdapter=new s(e,this.options);var a=this.render();this._placeContainer(a);var l=this.options.get("selectionAdapter");this.selection=new l(e,this.options),this.$selection=this.selection.render(),this.selection.position(this.$selection,a);var u=this.options.get("dropdownAdapter");this.dropdown=new u(e,this.options),this.$dropdown=this.dropdown.render(),this.dropdown.position(this.$dropdown,a);var c=this.options.get("resultsAdapter");this.results=new c(e,this.options,this.dataAdapter),this.$results=this.results.render(),this.results.position(this.$results,this.$dropdown);var h=this;this._bindAdapters(),this._registerDomEvents(),this._registerDataEvents(),this._registerSelectionEvents(),this._registerDropdownEvents(),this._registerResultsEvents(),this._registerEvents(),this.dataAdapter.current((function(e){h.trigger("selection:update",{data:e})})),e.addClass("select2-hidden-accessible"),e.attr("aria-hidden","true"),this._syncAttributes(),n.StoreData(e[0],"select2",this),e.data("select2",this)};return n.Extend(i,n.Observable),i.prototype._generateId=function(e){var t="";return t=null!=e.attr("id")?e.attr("id"):null!=e.attr("name")?e.attr("name")+"-"+n.generateChars(2):n.generateChars(4),t=t.replace(/(:|\.|\[|\]|,)/g,""),t="select2-"+t,t},i.prototype._placeContainer=function(e){e.insertAfter(this.$element);var t=this._resolveWidth(this.$element,this.options.get("width"));null!=t&&e.css("width",t)},i.prototype._resolveWidth=function(e,t){var n=/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i;if("resolve"==t){var r=this._resolveWidth(e,"style");return null!=r?r:this._resolveWidth(e,"element")}if("element"==t){var i=e.outerWidth(!1);return i<=0?"auto":i+"px"}if("style"==t){var o=e.attr("style");if("string"!==typeof o)return null;for(var s=o.split(";"),a=0,l=s.length;a<l;a+=1){var u=s[a].replace(/\s/g,""),c=u.match(n);if(null!==c&&c.length>=1)return c[1]}return null}if("computedstyle"==t){var h=window.getComputedStyle(e[0]);return h.width}return t},i.prototype._bindAdapters=function(){this.dataAdapter.bind(this,this.$container),this.selection.bind(this,this.$container),this.dropdown.bind(this,this.$container),this.results.bind(this,this.$container)},i.prototype._registerDomEvents=function(){var e=this;this.$element.on("change.select2",(function(){e.dataAdapter.current((function(t){e.trigger("selection:update",{data:t})}))})),this.$element.on("focus.select2",(function(t){e.trigger("focus",t)})),this._syncA=n.bind(this._syncAttributes,this),this._syncS=n.bind(this._syncSubtree,this),this.$element[0].attachEvent&&this.$element[0].attachEvent("onpropertychange",this._syncA);var t=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;null!=t?(this._observer=new t((function(t){e._syncA(),e._syncS(null,t)})),this._observer.observe(this.$element[0],{attributes:!0,childList:!0,subtree:!1})):this.$element[0].addEventListener&&(this.$element[0].addEventListener("DOMAttrModified",e._syncA,!1),this.$element[0].addEventListener("DOMNodeInserted",e._syncS,!1),this.$element[0].addEventListener("DOMNodeRemoved",e._syncS,!1))},i.prototype._registerDataEvents=function(){var e=this;this.dataAdapter.on("*",(function(t,n){e.trigger(t,n)}))},i.prototype._registerSelectionEvents=function(){var t=this,n=["toggle","focus"];this.selection.on("toggle",(function(){t.toggleDropdown()})),this.selection.on("focus",(function(e){t.focus(e)})),this.selection.on("*",(function(r,i){-1===e.inArray(r,n)&&t.trigger(r,i)}))},i.prototype._registerDropdownEvents=function(){var e=this;this.dropdown.on("*",(function(t,n){e.trigger(t,n)}))},i.prototype._registerResultsEvents=function(){var e=this;this.results.on("*",(function(t,n){e.trigger(t,n)}))},i.prototype._registerEvents=function(){var e=this;this.on("open",(function(){e.$container.addClass("select2-container--open")})),this.on("close",(function(){e.$container.removeClass("select2-container--open")})),this.on("enable",(function(){e.$container.removeClass("select2-container--disabled")})),this.on("disable",(function(){e.$container.addClass("select2-container--disabled")})),this.on("blur",(function(){e.$container.removeClass("select2-container--focus")})),this.on("query",(function(t){e.isOpen()||e.trigger("open",{}),this.dataAdapter.query(t,(function(n){e.trigger("results:all",{data:n,query:t})}))})),this.on("query:append",(function(t){this.dataAdapter.query(t,(function(n){e.trigger("results:append",{data:n,query:t})}))})),this.on("keypress",(function(t){var n=t.which;e.isOpen()?n===r.ESC||n===r.TAB||n===r.UP&&t.altKey?(e.close(t),t.preventDefault()):n===r.ENTER?(e.trigger("results:select",{}),t.preventDefault()):n===r.SPACE&&t.ctrlKey?(e.trigger("results:toggle",{}),t.preventDefault()):n===r.UP?(e.trigger("results:previous",{}),t.preventDefault()):n===r.DOWN&&(e.trigger("results:next",{}),t.preventDefault()):(n===r.ENTER||n===r.SPACE||n===r.DOWN&&t.altKey)&&(e.open(),t.preventDefault())}))},i.prototype._syncAttributes=function(){this.options.set("disabled",this.$element.prop("disabled")),this.isDisabled()?(this.isOpen()&&this.close(),this.trigger("disable",{})):this.trigger("enable",{})},i.prototype._isChangeMutation=function(t,n){var r=!1,i=this;if(!t||!t.target||"OPTION"===t.target.nodeName||"OPTGROUP"===t.target.nodeName){if(n)if(n.addedNodes&&n.addedNodes.length>0)for(var o=0;o<n.addedNodes.length;o++){var s=n.addedNodes[o];s.selected&&(r=!0)}else n.removedNodes&&n.removedNodes.length>0?r=!0:e.isArray(n)&&e.each(n,(function(e,t){if(i._isChangeMutation(e,t))return r=!0,!1}));else r=!0;return r}},i.prototype._syncSubtree=function(e,t){var n=this._isChangeMutation(e,t),r=this;n&&this.dataAdapter.current((function(e){r.trigger("selection:update",{data:e})}))},i.prototype.trigger=function(e,t){var n=i.__super__.trigger,r={open:"opening",close:"closing",select:"selecting",unselect:"unselecting",clear:"clearing"};if(void 0===t&&(t={}),e in r){var o=r[e],s={prevented:!1,name:e,args:t};if(n.call(this,o,s),s.prevented)return void(t.prevented=!0)}n.call(this,e,t)},i.prototype.toggleDropdown=function(){this.isDisabled()||(this.isOpen()?this.close():this.open())},i.prototype.open=function(){this.isOpen()||this.isDisabled()||this.trigger("query",{})},i.prototype.close=function(e){this.isOpen()&&this.trigger("close",{originalEvent:e})},i.prototype.isEnabled=function(){return!this.isDisabled()},i.prototype.isDisabled=function(){return this.options.get("disabled")},i.prototype.isOpen=function(){return this.$container.hasClass("select2-container--open")},i.prototype.hasFocus=function(){return this.$container.hasClass("select2-container--focus")},i.prototype.focus=function(e){this.hasFocus()||(this.$container.addClass("select2-container--focus"),this.trigger("focus",{}))},i.prototype.enable=function(e){this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("enable")` method has been deprecated and will be removed in later Select2 versions. Use $element.prop("disabled") instead.'),null!=e&&0!==e.length||(e=[!0]);var t=!e[0];this.$element.prop("disabled",t)},i.prototype.data=function(){this.options.get("debug")&&arguments.length>0&&window.console&&console.warn&&console.warn('Select2: Data can no longer be set using `select2("data")`. You should consider setting the value instead using `$element.val()`.');var e=[];return this.dataAdapter.current((function(t){e=t})),e},i.prototype.val=function(t){if(this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("val")` method has been deprecated and will be removed in later Select2 versions. Use $element.val() instead.'),null==t||0===t.length)return this.$element.val();var n=t[0];e.isArray(n)&&(n=e.map(n,(function(e){return e.toString()}))),this.$element.val(n).trigger("input").trigger("change")},i.prototype.destroy=function(){this.$container.remove(),this.$element[0].detachEvent&&this.$element[0].detachEvent("onpropertychange",this._syncA),null!=this._observer?(this._observer.disconnect(),this._observer=null):this.$element[0].removeEventListener&&(this.$element[0].removeEventListener("DOMAttrModified",this._syncA,!1),this.$element[0].removeEventListener("DOMNodeInserted",this._syncS,!1),this.$element[0].removeEventListener("DOMNodeRemoved",this._syncS,!1)),this._syncA=null,this._syncS=null,this.$element.off(".select2"),this.$element.attr("tabindex",n.GetData(this.$element[0],"old-tabindex")),this.$element.removeClass("select2-hidden-accessible"),this.$element.attr("aria-hidden","false"),n.RemoveData(this.$element[0]),this.$element.removeData("select2"),this.dataAdapter.destroy(),this.selection.destroy(),this.dropdown.destroy(),this.results.destroy(),this.dataAdapter=null,this.selection=null,this.dropdown=null,this.results=null},i.prototype.render=function(){var t=e('<span class="select2 select2-container"><span class="selection"></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>');return t.attr("dir",this.options.get("dir")),this.$container=t,this.$container.addClass("select2-container--"+this.options.get("theme")),n.StoreData(t[0],"element",this.$element),t},i})),t.define("jquery-mousewheel",["jquery"],(function(e){return e})),t.define("jquery.select2",["jquery","jquery-mousewheel","./select2/core","./select2/defaults","./select2/utils"],(function(e,t,n,r,i){if(null==e.fn.select2){var o=["open","close","destroy"];e.fn.select2=function(t){if(t=t||{},"object"===typeof t)return this.each((function(){var r=e.extend(!0,{},t);new n(e(this),r)})),this;if("string"===typeof t){var r,s=Array.prototype.slice.call(arguments,1);return this.each((function(){var e=i.GetData(this,"select2");null==e&&window.console&&console.error&&console.error("The select2('"+t+"') method was called on an element that is not using Select2."),r=e[t].apply(e,s)})),e.inArray(t,o)>-1?this:r}throw new Error("Invalid arguments for Select2: "+t)}}return null==e.fn.select2.defaults&&(e.fn.select2.defaults=r),n})),{define:t.define,require:t.require}}(),n=t.require("jquery.select2");return e.fn.select2.amd=t,n}))}).call(this,n("1157"))},1212:function(e,t,n){(function(e){var r;(function(e,i,o){function s(e){var t=this,n=u();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function a(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function l(e,t){var n=new s(e),r=t&&t.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,r&&("object"==typeof r&&a(r,n),i.state=function(){return a(n,{})}),i}function u(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){e+=t.charCodeAt(n);var r=.02519603282416938*e;e=r>>>0,r-=e,r*=e,e=r>>>0,r-=e,e+=4294967296*r}return 2.3283064365386963e-10*(e>>>0)};return t}i&&i.exports?i.exports=l:n("07d6")&&n("3c35")?(r=function(){return l}.call(t,n,t,i),void 0===r||(i.exports=r)):this.alea=l})(0,e,n("07d6"))}).call(this,n("62e4")(e))},"131a":function(e,t,n){var r=n("23e7"),i=n("d2bb");r({target:"Object",stat:!0},{setPrototypeOf:i})},"13d5":function(e,t,n){"use strict";var r=n("23e7"),i=n("d58f").left,o=n("a640"),s=n("ae40"),a=o("reduce"),l=s("reduce",{1:0});r({target:"Array",proto:!0,forced:!a||!l},{reduce:function(e){return i(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},"143c":function(e,t,n){var r=n("74e8");r("Int32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"145e":function(e,t,n){"use strict";var r=n("7b0b"),i=n("23cb"),o=n("50c4"),s=Math.min;e.exports=[].copyWithin||function(e,t){var n=r(this),a=o(n.length),l=i(e,a),u=i(t,a),c=arguments.length>2?arguments[2]:void 0,h=s((void 0===c?a:i(c,a))-u,a-l),d=1;u<l&&l<u+h&&(d=-1,u+=h-1,l+=h-1);while(h-- >0)u in n?n[l]=n[u]:delete n[l],l+=d,u+=d;return n}},"16c3":function(e,t,n){var r=n("1f8f"),i=n("74d0"),o=n("9052"),s=o.mat3,a=o.vec3,l=n("17fb"),u=e.exports=function(e){this.id=e.id,this.palmPosition=e.palmPosition,this.direction=e.direction,this.palmVelocity=e.palmVelocity,this.palmNormal=e.palmNormal,this.sphereCenter=e.sphereCenter,this.sphereRadius=e.sphereRadius,this.valid=!0,this.pointables=[],this.fingers=[],e.armBasis?this.arm=new i(this,{type:4,width:e.armWidth,prevJoint:e.elbow,nextJoint:e.wrist,basis:e.armBasis}):this.arm=null,this.tools=[],this._translation=e.t,this._rotation=l.flatten(e.r),this._scaleFactor=e.s,this.timeVisible=e.timeVisible,this.stabilizedPalmPosition=e.stabilizedPalmPosition,this.type=e.type,this.grabStrength=e.grabStrength,this.pinchStrength=e.pinchStrength,this.confidence=e.confidence};u.prototype.finger=function(e){var t=this.frame.finger(e);return t&&t.handId==this.id?t:r.Invalid},u.prototype.rotationAngle=function(e,t){if(!this.valid||!e.valid)return 0;var n=e.hand(this.id);if(!n.valid)return 0;var r=this.rotationMatrix(e),i=.5*(r[0]+r[4]+r[8]-1),o=Math.acos(i);if(o=isNaN(o)?0:o,void 0!==t){var s=this.rotationAxis(e);o*=a.dot(s,a.normalize(a.create(),t))}return o},u.prototype.rotationAxis=function(e){if(!this.valid||!e.valid)return a.create();var t=e.hand(this.id);return t.valid?a.normalize(a.create(),[this._rotation[7]-t._rotation[5],this._rotation[2]-t._rotation[6],this._rotation[3]-t._rotation[1]]):a.create()},u.prototype.rotationMatrix=function(e){if(!this.valid||!e.valid)return s.create();var t=e.hand(this.id);if(!t.valid)return s.create();var n=s.transpose(s.create(),this._rotation),r=s.multiply(s.create(),t._rotation,n);return r},u.prototype.scaleFactor=function(e){if(!this.valid||!e.valid)return 1;var t=e.hand(this.id);return t.valid?Math.exp(this._scaleFactor-t._scaleFactor):1},u.prototype.translation=function(e){if(!this.valid||!e.valid)return a.create();var t=e.hand(this.id);return t.valid?[this._translation[0]-t._translation[0],this._translation[1]-t._translation[1],this._translation[2]-t._translation[2]]:a.create()},u.prototype.toString=function(){return"Hand ("+this.type+") [ id: "+this.id+" | palm velocity:"+this.palmVelocity+" | sphere center:"+this.sphereCenter+" ] "},u.prototype.pitch=function(){return Math.atan2(this.direction[1],-this.direction[2])},u.prototype.yaw=function(){return Math.atan2(this.direction[0],-this.direction[2])},u.prototype.roll=function(){return Math.atan2(this.palmNormal[0],-this.palmNormal[1])},u.Invalid={valid:!1,fingers:[],tools:[],pointables:[],left:!1,pointable:function(){return r.Invalid},finger:function(){return r.Invalid},toString:function(){return"invalid frame"},dump:function(){return this.toString()},rotationAngle:function(){return 0},rotationMatrix:function(){return s.create()},rotationAxis:function(){return a.create()},scaleFactor:function(){return 1},translation:function(){return a.create()}}},"170b":function(e,t,n){"use strict";var r=n("ebb5"),i=n("50c4"),o=n("23cb"),s=n("4840"),a=r.aTypedArray,l=r.exportTypedArrayMethod;l("subarray",(function(e,t){var n=a(this),r=n.length,l=o(e,r);return new(s(n,n.constructor))(n.buffer,n.byteOffset+l*n.BYTES_PER_ELEMENT,i((void 0===t?r:o(t,r))-l))}))},1739:function(e,t){var n=function(){this.functionType="atan",this.power={division:300,divisionRange:[1,1e4],power:1,powerRange:[0,3]},this.atan={division1:660,division1Range:[0,1e4],division2:.5,division2Range:[0,1]},this.asymp1={max:.5,maxRange:[0,1],min:.001,minRange:[0,.1],Vo:200,VoRange:[1,1e4]},this.asymp2={max:.001,maxRange:[0,.01],min:.001,minRange:[0,.01],Vo:1500,VoRange:[0,3e3]},this.mouseSize=10,this.frameOpacity=800,this.gainGraphFrames=200,this.resetPosition=function(){i.x=window.innerWidth/2,i.y=window.innerHeight/2}},r=new n,i={x:window.innerWidth/2,y:window.innerHeight/2},o=function(e){var t=s(e.tipVelocity[0],e.tipVelocity[1],r.functionType),n={x:i.x+t.x,y:i.y+t.y};return n.x>=window.innerWidth&&(n.x=window.innerWidth),n.x<=0&&(n.x=0),n.y>=window.innerHeight&&(n.y=window.innerHeight),n.y<=0&&(n.y=0),i=n,n};function s(e,t,n){var i=Math.sqrt(e*e+t*t),o=1;return"power"==n?o=Math.pow(i,r.power.power)/Math.pow(r.power.division,r.power.power):"atan"==n?o=Math.atan(i/r.atan.division1)/r.atan.division2:"asymp1"==n?o=r.asymp1.max*(1-Math.exp(-i/r.asymp1.Vo))+r.asymp1.min:"asymp2"==n&&(o=r.asymp2.max*i*Math.exp(-i/r.asymp2.Vo)+r.asymp2.min),toReturn={x:o*e,y:-o*t},toReturn}e.exports=o,e.exports.reset=r.resetPosition},"17fb":function(e,t,n){(function(){var n=this,r=n._,i={},o=Array.prototype,s=Object.prototype,a=Function.prototype,l=o.push,u=o.slice,c=o.concat,h=s.toString,d=s.hasOwnProperty,p=o.forEach,f=o.map,m=o.reduce,g=o.reduceRight,v=o.filter,y=o.every,x=o.some,b=o.indexOf,w=o.lastIndexOf,_=Array.isArray,A=Object.keys,S=a.bind,E=function(e){return e instanceof E?e:this instanceof E?void(this._wrapped=e):new E(e)};e.exports&&(t=e.exports=E),t._=E,E.VERSION="1.4.4";var M=E.each=E.forEach=function(e,t,n){if(null!=e)if(p&&e.forEach===p)e.forEach(t,n);else if(e.length===+e.length){for(var r=0,o=e.length;r<o;r++)if(t.call(n,e[r],r,e)===i)return}else for(var s in e)if(E.has(e,s)&&t.call(n,e[s],s,e)===i)return};E.map=E.collect=function(e,t,n){var r=[];return null==e?r:f&&e.map===f?e.map(t,n):(M(e,(function(e,i,o){r[r.length]=t.call(n,e,i,o)})),r)};var T="Reduce of empty array with no initial value";E.reduce=E.foldl=E.inject=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),m&&e.reduce===m)return r&&(t=E.bind(t,r)),i?e.reduce(t,n):e.reduce(t);if(M(e,(function(e,o,s){i?n=t.call(r,n,e,o,s):(n=e,i=!0)})),!i)throw new TypeError(T);return n},E.reduceRight=E.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),g&&e.reduceRight===g)return r&&(t=E.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var o=e.length;if(o!==+o){var s=E.keys(e);o=s.length}if(M(e,(function(a,l,u){l=s?s[--o]:--o,i?n=t.call(r,n,e[l],l,u):(n=e[l],i=!0)})),!i)throw new TypeError(T);return n},E.find=E.detect=function(e,t,n){var r;return C(e,(function(e,i,o){if(t.call(n,e,i,o))return r=e,!0})),r},E.filter=E.select=function(e,t,n){var r=[];return null==e?r:v&&e.filter===v?e.filter(t,n):(M(e,(function(e,i,o){t.call(n,e,i,o)&&(r[r.length]=e)})),r)},E.reject=function(e,t,n){return E.filter(e,(function(e,r,i){return!t.call(n,e,r,i)}),n)},E.every=E.all=function(e,t,n){t||(t=E.identity);var r=!0;return null==e?r:y&&e.every===y?e.every(t,n):(M(e,(function(e,o,s){if(!(r=r&&t.call(n,e,o,s)))return i})),!!r)};var C=E.some=E.any=function(e,t,n){t||(t=E.identity);var r=!1;return null==e?r:x&&e.some===x?e.some(t,n):(M(e,(function(e,o,s){if(r||(r=t.call(n,e,o,s)))return i})),!!r)};E.contains=E.include=function(e,t){return null!=e&&(b&&e.indexOf===b?-1!=e.indexOf(t):C(e,(function(e){return e===t})))},E.invoke=function(e,t){var n=u.call(arguments,2),r=E.isFunction(t);return E.map(e,(function(e){return(r?t:e[t]).apply(e,n)}))},E.pluck=function(e,t){return E.map(e,(function(e){return e[t]}))},E.where=function(e,t,n){return E.isEmpty(t)?n?null:[]:E[n?"find":"filter"](e,(function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0}))},E.findWhere=function(e,t){return E.where(e,t,!0)},E.max=function(e,t,n){if(!t&&E.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&E.isEmpty(e))return-1/0;var r={computed:-1/0,value:-1/0};return M(e,(function(e,i,o){var s=t?t.call(n,e,i,o):e;s>=r.computed&&(r={value:e,computed:s})})),r.value},E.min=function(e,t,n){if(!t&&E.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&E.isEmpty(e))return 1/0;var r={computed:1/0,value:1/0};return M(e,(function(e,i,o){var s=t?t.call(n,e,i,o):e;s<r.computed&&(r={value:e,computed:s})})),r.value},E.shuffle=function(e){var t,n=0,r=[];return M(e,(function(e){t=E.random(n++),r[n-1]=r[t],r[t]=e})),r};var P=function(e){return E.isFunction(e)?e:function(t){return t[e]}};E.sortBy=function(e,t,n){var r=P(t);return E.pluck(E.map(e,(function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}})).sort((function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return e.index<t.index?-1:1})),"value")};var R=function(e,t,n,r){var i={},o=P(t||E.identity);return M(e,(function(t,s){var a=o.call(n,t,s,e);r(i,a,t)})),i};E.groupBy=function(e,t,n){return R(e,t,n,(function(e,t,n){(E.has(e,t)?e[t]:e[t]=[]).push(n)}))},E.countBy=function(e,t,n){return R(e,t,n,(function(e,t){E.has(e,t)||(e[t]=0),e[t]++}))},E.sortedIndex=function(e,t,n,r){n=null==n?E.identity:P(n);var i=n.call(r,t),o=0,s=e.length;while(o<s){var a=o+s>>>1;n.call(r,e[a])<i?o=a+1:s=a}return o},E.toArray=function(e){return e?E.isArray(e)?u.call(e):e.length===+e.length?E.map(e,E.identity):E.values(e):[]},E.size=function(e){return null==e?0:e.length===+e.length?e.length:E.keys(e).length},E.first=E.head=E.take=function(e,t,n){if(null!=e)return null==t||n?e[0]:u.call(e,0,t)},E.initial=function(e,t,n){return u.call(e,0,e.length-(null==t||n?1:t))},E.last=function(e,t,n){if(null!=e)return null==t||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},E.rest=E.tail=E.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},E.compact=function(e){return E.filter(e,E.identity)};var L=function(e,t,n){return M(e,(function(e){E.isArray(e)?t?l.apply(n,e):L(e,t,n):n.push(e)})),n};E.flatten=function(e,t){return L(e,t,[])},E.without=function(e){return E.difference(e,u.call(arguments,1))},E.uniq=E.unique=function(e,t,n,r){E.isFunction(t)&&(r=n,n=t,t=!1);var i=n?E.map(e,n,r):e,o=[],s=[];return M(i,(function(n,r){(t?r&&s[s.length-1]===n:E.contains(s,n))||(s.push(n),o.push(e[r]))})),o},E.union=function(){return E.uniq(c.apply(o,arguments))},E.intersection=function(e){var t=u.call(arguments,1);return E.filter(E.uniq(e),(function(e){return E.every(t,(function(t){return E.indexOf(t,e)>=0}))}))},E.difference=function(e){var t=c.apply(o,u.call(arguments,1));return E.filter(e,(function(e){return!E.contains(t,e)}))},E.zip=function(){for(var e=u.call(arguments),t=E.max(E.pluck(e,"length")),n=new Array(t),r=0;r<t;r++)n[r]=E.pluck(e,""+r);return n},E.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},E.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=E.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(b&&e.indexOf===b)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},E.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(w&&e.lastIndexOf===w)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},E.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,o=new Array(r);while(i<r)o[i++]=e,e+=n;return o},E.bind=function(e,t){if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));var n=u.call(arguments,2);return function(){return e.apply(t,n.concat(u.call(arguments)))}},E.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},E.bindAll=function(e){var t=u.call(arguments,1);return 0===t.length&&(t=E.functions(e)),M(t,(function(t){e[t]=E.bind(e[t],e)})),e},E.memoize=function(e,t){var n={};return t||(t=E.identity),function(){var r=t.apply(this,arguments);return E.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},E.delay=function(e,t){var n=u.call(arguments,2);return setTimeout((function(){return e.apply(null,n)}),t)},E.defer=function(e){return E.delay.apply(E,[e,1].concat(u.call(arguments,1)))},E.throttle=function(e,t){var n,r,i,o,s=0,a=function(){s=new Date,i=null,o=e.apply(n,r)};return function(){var l=new Date,u=t-(l-s);return n=this,r=arguments,u<=0?(clearTimeout(i),i=null,s=l,o=e.apply(n,r)):i||(i=setTimeout(a,u)),o}},E.debounce=function(e,t,n){var r,i;return function(){var o=this,s=arguments,a=function(){r=null,n||(i=e.apply(o,s))},l=n&&!r;return clearTimeout(r),r=setTimeout(a,t),l&&(i=e.apply(o,s)),i}},E.once=function(e){var t,n=!1;return function(){return n||(n=!0,t=e.apply(this,arguments),e=null),t}},E.wrap=function(e,t){return function(){var n=[e];return l.apply(n,arguments),t.apply(this,n)}},E.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},E.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},E.keys=A||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)E.has(e,n)&&(t[t.length]=n);return t},E.values=function(e){var t=[];for(var n in e)E.has(e,n)&&t.push(e[n]);return t},E.pairs=function(e){var t=[];for(var n in e)E.has(e,n)&&t.push([n,e[n]]);return t},E.invert=function(e){var t={};for(var n in e)E.has(e,n)&&(t[e[n]]=n);return t},E.functions=E.methods=function(e){var t=[];for(var n in e)E.isFunction(e[n])&&t.push(n);return t.sort()},E.extend=function(e){return M(u.call(arguments,1),(function(t){if(t)for(var n in t)e[n]=t[n]})),e},E.pick=function(e){var t={},n=c.apply(o,u.call(arguments,1));return M(n,(function(n){n in e&&(t[n]=e[n])})),t},E.omit=function(e){var t={},n=c.apply(o,u.call(arguments,1));for(var r in e)E.contains(n,r)||(t[r]=e[r]);return t},E.defaults=function(e){return M(u.call(arguments,1),(function(t){if(t)for(var n in t)null==e[n]&&(e[n]=t[n])})),e},E.clone=function(e){return E.isObject(e)?E.isArray(e)?e.slice():E.extend({},e):e},E.tap=function(e,t){return t(e),e};var O=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof E&&(e=e._wrapped),t instanceof E&&(t=t._wrapped);var i=h.call(e);if(i!=h.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;var o=n.length;while(o--)if(n[o]==e)return r[o]==t;n.push(e),r.push(t);var s=0,a=!0;if("[object Array]"==i){if(s=e.length,a=s==t.length,a)while(s--)if(!(a=O(e[s],t[s],n,r)))break}else{var l=e.constructor,u=t.constructor;if(l!==u&&!(E.isFunction(l)&&l instanceof l&&E.isFunction(u)&&u instanceof u))return!1;for(var c in e)if(E.has(e,c)&&(s++,!(a=E.has(t,c)&&O(e[c],t[c],n,r))))break;if(a){for(c in t)if(E.has(t,c)&&!s--)break;a=!s}}return n.pop(),r.pop(),a};E.isEqual=function(e,t){return O(e,t,[],[])},E.isEmpty=function(e){if(null==e)return!0;if(E.isArray(e)||E.isString(e))return 0===e.length;for(var t in e)if(E.has(e,t))return!1;return!0},E.isElement=function(e){return!(!e||1!==e.nodeType)},E.isArray=_||function(e){return"[object Array]"==h.call(e)},E.isObject=function(e){return e===Object(e)},M(["Arguments","Function","String","Number","Date","RegExp"],(function(e){E["is"+e]=function(t){return h.call(t)=="[object "+e+"]"}})),E.isArguments(arguments)||(E.isArguments=function(e){return!(!e||!E.has(e,"callee"))}),E.isFunction=function(e){return"function"===typeof e},E.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},E.isNaN=function(e){return E.isNumber(e)&&e!=+e},E.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==h.call(e)},E.isNull=function(e){return null===e},E.isUndefined=function(e){return void 0===e},E.has=function(e,t){return d.call(e,t)},E.noConflict=function(){return n._=r,this},E.identity=function(e){return e},E.times=function(e,t,n){for(var r=Array(e),i=0;i<e;i++)r[i]=t.call(n,i);return r},E.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var D={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};D.unescape=E.invert(D.escape);var I={escape:new RegExp("["+E.keys(D.escape).join("")+"]","g"),unescape:new RegExp("("+E.keys(D.unescape).join("|")+")","g")};E.each(["escape","unescape"],(function(e){E[e]=function(t){return null==t?"":(""+t).replace(I[e],(function(t){return D[e][t]}))}})),E.result=function(e,t){if(null==e)return null;var n=e[t];return E.isFunction(n)?n.call(e):n},E.mixin=function(e){M(E.functions(e),(function(t){var n=E[t]=e[t];E.prototype[t]=function(){var e=[this._wrapped];return l.apply(e,arguments),z.call(this,n.apply(E,e))}}))};var k=0;E.uniqueId=function(e){var t=++k+"";return e?e+t:t},E.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var N=/(.)^/,F={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},V=/\\|'|\r|\n|\t|\u2028|\u2029/g;E.template=function(e,t,n){var r;n=E.defaults({},n,E.templateSettings);var i=new RegExp([(n.escape||N).source,(n.interpolate||N).source,(n.evaluate||N).source].join("|")+"|$","g"),o=0,s="__p+='";e.replace(i,(function(t,n,r,i,a){return s+=e.slice(o,a).replace(V,(function(e){return"\\"+F[e]})),n&&(s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(s+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(s+="';\n"+i+"\n__p+='"),o=a+t.length,t})),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{r=new Function(n.variable||"obj","_",s)}catch(l){throw l.source=s,l}if(t)return r(t,E);var a=function(e){return r.call(this,e,E)};return a.source="function("+(n.variable||"obj")+"){\n"+s+"}",a},E.chain=function(e){return E(e).chain()};var z=function(e){return this._chain?E(e).chain():e};E.mixin(E),M(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=o[e];E.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],z.call(this,n)}})),M(["concat","join","slice"],(function(e){var t=o[e];E.prototype[e]=function(){return z.call(this,t.apply(this._wrapped,arguments))}})),E.extend(E.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},"182d":function(e,t,n){var r=n("f8cd");e.exports=function(e,t){var n=r(e);if(n%t)throw RangeError("Wrong offset");return n}},1985:function(e,t,n){(function(e,r){var i;/*! https://mths.be/punycode v1.4.1 by @mathias */(function(o){t&&t.nodeType,e&&e.nodeType;var s="object"==typeof r&&r;s.global!==s&&s.window!==s&&s.self;var a,l=2147483647,u=36,c=1,h=26,d=38,p=700,f=72,m=128,g="-",v=/^xn--/,y=/[^\x20-\x7E]/,x=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=u-c,_=Math.floor,A=String.fromCharCode;function S(e){throw new RangeError(b[e])}function E(e,t){var n=e.length,r=[];while(n--)r[n]=t(e[n]);return r}function M(e,t){var n=e.split("@"),r="";n.length>1&&(r=n[0]+"@",e=n[1]),e=e.replace(x,".");var i=e.split("."),o=E(i,t).join(".");return r+o}function T(e){var t,n,r=[],i=0,o=e.length;while(i<o)t=e.charCodeAt(i++),t>=55296&&t<=56319&&i<o?(n=e.charCodeAt(i++),56320==(64512&n)?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--)):r.push(t);return r}function C(e){return E(e,(function(e){var t="";return e>65535&&(e-=65536,t+=A(e>>>10&1023|55296),e=56320|1023&e),t+=A(e),t})).join("")}function P(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:u}function R(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function L(e,t,n){var r=0;for(e=n?_(e/p):e>>1,e+=_(e/t);e>w*h>>1;r+=u)e=_(e/w);return _(r+(w+1)*e/(e+d))}function O(e){var t,n,r,i,o,s,a,d,p,v,y=[],x=e.length,b=0,w=m,A=f;for(n=e.lastIndexOf(g),n<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&S("not-basic"),y.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<x;){for(o=b,s=1,a=u;;a+=u){if(i>=x&&S("invalid-input"),d=P(e.charCodeAt(i++)),(d>=u||d>_((l-b)/s))&&S("overflow"),b+=d*s,p=a<=A?c:a>=A+h?h:a-A,d<p)break;v=u-p,s>_(l/v)&&S("overflow"),s*=v}t=y.length+1,A=L(b-o,t,0==o),_(b/t)>l-w&&S("overflow"),w+=_(b/t),b%=t,y.splice(b++,0,w)}return C(y)}function D(e){var t,n,r,i,o,s,a,d,p,v,y,x,b,w,E,M=[];for(e=T(e),x=e.length,t=m,n=0,o=f,s=0;s<x;++s)y=e[s],y<128&&M.push(A(y));r=i=M.length,i&&M.push(g);while(r<x){for(a=l,s=0;s<x;++s)y=e[s],y>=t&&y<a&&(a=y);for(b=r+1,a-t>_((l-n)/b)&&S("overflow"),n+=(a-t)*b,t=a,s=0;s<x;++s)if(y=e[s],y<t&&++n>l&&S("overflow"),y==t){for(d=n,p=u;;p+=u){if(v=p<=o?c:p>=o+h?h:p-o,d<v)break;E=d-v,w=u-v,M.push(A(R(v+E%w,0))),d=_(E/w)}M.push(A(R(d,0))),o=L(n,b,r==i),n=0,++r}++n,++t}return M.join("")}function I(e){return M(e,(function(e){return v.test(e)?O(e.slice(4).toLowerCase()):e}))}function k(e){return M(e,(function(e){return y.test(e)?"xn--"+D(e):e}))}a={version:"1.4.1",ucs2:{decode:T,encode:C},decode:O,encode:D,toASCII:k,toUnicode:I},i=function(){return a}.call(t,n,t,e),void 0===i||(e.exports=i)})()}).call(this,n("62e4")(e),n("c8ba"))},"1f03":function(e,t,n){"use strict";e.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}},"1f25":function(e,t,n){"use strict";const r=n("5cf7"),i=Symbol("max"),o=Symbol("length"),s=Symbol("lengthCalculator"),a=Symbol("allowStale"),l=Symbol("maxAge"),u=Symbol("dispose"),c=Symbol("noDisposeOnSet"),h=Symbol("lruList"),d=Symbol("cache"),p=Symbol("updateAgeOnGet"),f=()=>1;class m{constructor(e){if("number"===typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!==typeof e.max||e.max<0))throw new TypeError("max must be a non-negative number");this[i]=e.max||1/0;const t=e.length||f;if(this[s]="function"!==typeof t?f:t,this[a]=e.stale||!1,e.maxAge&&"number"!==typeof e.maxAge)throw new TypeError("maxAge must be a number");this[l]=e.maxAge||0,this[u]=e.dispose,this[c]=e.noDisposeOnSet||!1,this[p]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!==typeof e||e<0)throw new TypeError("max must be a non-negative number");this[i]=e||1/0,y(this)}get max(){return this[i]}set allowStale(e){this[a]=!!e}get allowStale(){return this[a]}set maxAge(e){if("number"!==typeof e)throw new TypeError("maxAge must be a non-negative number");this[l]=e,y(this)}get maxAge(){return this[l]}set lengthCalculator(e){"function"!==typeof e&&(e=f),e!==this[s]&&(this[s]=e,this[o]=0,this[h].forEach(e=>{e.length=this[s](e.value,e.key),this[o]+=e.length})),y(this)}get lengthCalculator(){return this[s]}get length(){return this[o]}get itemCount(){return this[h].length}rforEach(e,t){t=t||this;for(let n=this[h].tail;null!==n;){const r=n.prev;w(this,e,n,t),n=r}}forEach(e,t){t=t||this;for(let n=this[h].head;null!==n;){const r=n.next;w(this,e,n,t),n=r}}keys(){return this[h].toArray().map(e=>e.key)}values(){return this[h].toArray().map(e=>e.value)}reset(){this[u]&&this[h]&&this[h].length&&this[h].forEach(e=>this[u](e.key,e.value)),this[d]=new Map,this[h]=new r,this[o]=0}dump(){return this[h].map(e=>!v(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[h]}set(e,t,n){if(n=n||this[l],n&&"number"!==typeof n)throw new TypeError("maxAge must be a number");const r=n?Date.now():0,a=this[s](t,e);if(this[d].has(e)){if(a>this[i])return x(this,this[d].get(e)),!1;const s=this[d].get(e),l=s.value;return this[u]&&(this[c]||this[u](e,l.value)),l.now=r,l.maxAge=n,l.value=t,this[o]+=a-l.length,l.length=a,this.get(e),y(this),!0}const p=new b(e,t,a,r,n);return p.length>this[i]?(this[u]&&this[u](e,t),!1):(this[o]+=p.length,this[h].unshift(p),this[d].set(e,this[h].head),y(this),!0)}has(e){if(!this[d].has(e))return!1;const t=this[d].get(e).value;return!v(this,t)}get(e){return g(this,e,!0)}peek(e){return g(this,e,!1)}pop(){const e=this[h].tail;return e?(x(this,e),e.value):null}del(e){x(this,this[d].get(e))}load(e){this.reset();const t=Date.now();for(let n=e.length-1;n>=0;n--){const r=e[n],i=r.e||0;if(0===i)this.set(r.k,r.v);else{const e=i-t;e>0&&this.set(r.k,r.v,e)}}}prune(){this[d].forEach((e,t)=>g(this,t,!1))}}const g=(e,t,n)=>{const r=e[d].get(t);if(r){const t=r.value;if(v(e,t)){if(x(e,r),!e[a])return}else n&&(e[p]&&(r.value.now=Date.now()),e[h].unshiftNode(r));return t.value}},v=(e,t)=>{if(!t||!t.maxAge&&!e[l])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[l]&&n>e[l]},y=e=>{if(e[o]>e[i])for(let t=e[h].tail;e[o]>e[i]&&null!==t;){const n=t.prev;x(e,t),t=n}},x=(e,t)=>{if(t){const n=t.value;e[u]&&e[u](n.key,n.value),e[o]-=n.length,e[d].delete(n.key),e[h].removeNode(t)}};class b{constructor(e,t,n,r,i){this.key=e,this.value=t,this.length=n,this.now=r,this.maxAge=i||0}}const w=(e,t,n,r)=>{let i=n.value;v(e,i)&&(x(e,n),e[a]||(i=void 0)),i&&t.call(r,i.value,i.key,e)};e.exports=m},"1f8f":function(e,t,n){var r=n("9052"),i=(r.vec3,e.exports=function(e){this.valid=!0,this.id=e.id,this.handId=e.handId,this.length=e.length,this.tool=e.tool,this.width=e.width,this.direction=e.direction,this.stabilizedTipPosition=e.stabilizedTipPosition,this.tipPosition=e.tipPosition,this.tipVelocity=e.tipVelocity,this.touchZone=e.touchZone,this.touchDistance=e.touchDistance,this.timeVisible=e.timeVisible});i.prototype.toString=function(){return"Pointable [ id:"+this.id+" "+this.length+"mmx | width:"+this.width+"mm | direction:"+this.direction+" ]"},i.prototype.hand=function(){return this.frame.hand(this.handId)},i.Invalid={valid:!1}},"219c":function(e,t,n){"use strict";var r=n("ebb5"),i=r.aTypedArray,o=r.exportTypedArrayMethod,s=[].sort;o("sort",(function(e){return s.call(i(this),e)}))},"25a1":function(e,t,n){"use strict";var r=n("ebb5"),i=n("d58f").right,o=r.aTypedArray,s=r.exportTypedArrayMethod;s("reduceRight",(function(e){return i(o(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}))},2954:function(e,t,n){"use strict";var r=n("ebb5"),i=n("4840"),o=n("d039"),s=r.aTypedArray,a=r.aTypedArrayConstructor,l=r.exportTypedArrayMethod,u=[].slice,c=o((function(){new Int8Array(1).slice()}));l("slice",(function(e,t){var n=u.call(s(this),e,t),r=i(this,this.constructor),o=0,l=n.length,c=new(a(r))(l);while(l>o)c[o]=n[o++];return c}),c)},"2ca0":function(e,t,n){"use strict";var r=n("23e7"),i=n("06cf").f,o=n("50c4"),s=n("5a34"),a=n("1d80"),l=n("ab13"),u=n("c430"),c="".startsWith,h=Math.min,d=l("startsWith"),p=!u&&!d&&!!function(){var e=i(String.prototype,"startsWith");return e&&!e.writable}();r({target:"String",proto:!0,forced:!p&&!d},{startsWith:function(e){var t=String(a(this));s(e);var n=o(h(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return c?c.call(t,r,n):t.slice(n,n+r.length)===r}})},"2ef0":function(e,t,n){(function(e,r){var i;
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(){var o,s="4.17.19",a=200,l="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",u="Expected a function",c="__lodash_hash_undefined__",h=500,d="__lodash_placeholder__",p=1,f=2,m=4,g=1,v=2,y=1,x=2,b=4,w=8,_=16,A=32,S=64,E=128,M=256,T=512,C=30,P="...",R=800,L=16,O=1,D=2,I=3,k=1/0,N=9007199254740991,F=17976931348623157e292,V=NaN,z=4294967295,U=z-1,j=z>>>1,B=[["ary",E],["bind",y],["bindKey",x],["curry",w],["curryRight",_],["flip",T],["partial",A],["partialRight",S],["rearg",M]],H="[object Arguments]",G="[object Array]",q="[object AsyncFunction]",W="[object Boolean]",$="[object Date]",X="[object DOMException]",Y="[object Error]",Z="[object Function]",J="[object GeneratorFunction]",Q="[object Map]",K="[object Number]",ee="[object Null]",te="[object Object]",ne="[object Promise]",re="[object Proxy]",ie="[object RegExp]",oe="[object Set]",se="[object String]",ae="[object Symbol]",le="[object Undefined]",ue="[object WeakMap]",ce="[object WeakSet]",he="[object ArrayBuffer]",de="[object DataView]",pe="[object Float32Array]",fe="[object Float64Array]",me="[object Int8Array]",ge="[object Int16Array]",ve="[object Int32Array]",ye="[object Uint8Array]",xe="[object Uint8ClampedArray]",be="[object Uint16Array]",we="[object Uint32Array]",_e=/\b__p \+= '';/g,Ae=/\b(__p \+=) '' \+/g,Se=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ee=/&(?:amp|lt|gt|quot|#39);/g,Me=/[&<>"']/g,Te=RegExp(Ee.source),Ce=RegExp(Me.source),Pe=/<%-([\s\S]+?)%>/g,Re=/<%([\s\S]+?)%>/g,Le=/<%=([\s\S]+?)%>/g,Oe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,De=/^\w*$/,Ie=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ke=/[\\^$.*+?()[\]{}|]/g,Ne=RegExp(ke.source),Fe=/^\s+|\s+$/g,Ve=/^\s+/,ze=/\s+$/,Ue=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,je=/\{\n\/\* \[wrapped with (.+)\] \*/,Be=/,? & /,He=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ge=/\\(\\)?/g,qe=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,We=/\w*$/,$e=/^[-+]0x[0-9a-f]+$/i,Xe=/^0b[01]+$/i,Ye=/^\[object .+?Constructor\]$/,Ze=/^0o[0-7]+$/i,Je=/^(?:0|[1-9]\d*)$/,Qe=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ke=/($^)/,et=/['\n\r\u2028\u2029\\]/g,tt="\\ud800-\\udfff",nt="\\u0300-\\u036f",rt="\\ufe20-\\ufe2f",it="\\u20d0-\\u20ff",ot=nt+rt+it,st="\\u2700-\\u27bf",at="a-z\\xdf-\\xf6\\xf8-\\xff",lt="\\xac\\xb1\\xd7\\xf7",ut="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ct="\\u2000-\\u206f",ht=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",dt="A-Z\\xc0-\\xd6\\xd8-\\xde",pt="\\ufe0e\\ufe0f",ft=lt+ut+ct+ht,mt="['’]",gt="["+tt+"]",vt="["+ft+"]",yt="["+ot+"]",xt="\\d+",bt="["+st+"]",wt="["+at+"]",_t="[^"+tt+ft+xt+st+at+dt+"]",At="\\ud83c[\\udffb-\\udfff]",St="(?:"+yt+"|"+At+")",Et="[^"+tt+"]",Mt="(?:\\ud83c[\\udde6-\\uddff]){2}",Tt="[\\ud800-\\udbff][\\udc00-\\udfff]",Ct="["+dt+"]",Pt="\\u200d",Rt="(?:"+wt+"|"+_t+")",Lt="(?:"+Ct+"|"+_t+")",Ot="(?:"+mt+"(?:d|ll|m|re|s|t|ve))?",Dt="(?:"+mt+"(?:D|LL|M|RE|S|T|VE))?",It=St+"?",kt="["+pt+"]?",Nt="(?:"+Pt+"(?:"+[Et,Mt,Tt].join("|")+")"+kt+It+")*",Ft="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Vt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",zt=kt+It+Nt,Ut="(?:"+[bt,Mt,Tt].join("|")+")"+zt,jt="(?:"+[Et+yt+"?",yt,Mt,Tt,gt].join("|")+")",Bt=RegExp(mt,"g"),Ht=RegExp(yt,"g"),Gt=RegExp(At+"(?="+At+")|"+jt+zt,"g"),qt=RegExp([Ct+"?"+wt+"+"+Ot+"(?="+[vt,Ct,"$"].join("|")+")",Lt+"+"+Dt+"(?="+[vt,Ct+Rt,"$"].join("|")+")",Ct+"?"+Rt+"+"+Ot,Ct+"+"+Dt,Vt,Ft,xt,Ut].join("|"),"g"),Wt=RegExp("["+Pt+tt+ot+pt+"]"),$t=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Xt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Yt=-1,Zt={};Zt[pe]=Zt[fe]=Zt[me]=Zt[ge]=Zt[ve]=Zt[ye]=Zt[xe]=Zt[be]=Zt[we]=!0,Zt[H]=Zt[G]=Zt[he]=Zt[W]=Zt[de]=Zt[$]=Zt[Y]=Zt[Z]=Zt[Q]=Zt[K]=Zt[te]=Zt[ie]=Zt[oe]=Zt[se]=Zt[ue]=!1;var Jt={};Jt[H]=Jt[G]=Jt[he]=Jt[de]=Jt[W]=Jt[$]=Jt[pe]=Jt[fe]=Jt[me]=Jt[ge]=Jt[ve]=Jt[Q]=Jt[K]=Jt[te]=Jt[ie]=Jt[oe]=Jt[se]=Jt[ae]=Jt[ye]=Jt[xe]=Jt[be]=Jt[we]=!0,Jt[Y]=Jt[Z]=Jt[ue]=!1;var Qt={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"},Kt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},en={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},tn={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},nn=parseFloat,rn=parseInt,on="object"==typeof e&&e&&e.Object===Object&&e,sn="object"==typeof self&&self&&self.Object===Object&&self,an=on||sn||Function("return this")(),ln=t&&!t.nodeType&&t,un=ln&&"object"==typeof r&&r&&!r.nodeType&&r,cn=un&&un.exports===ln,hn=cn&&on.process,dn=function(){try{var e=un&&un.require&&un.require("util").types;return e||hn&&hn.binding&&hn.binding("util")}catch(t){}}(),pn=dn&&dn.isArrayBuffer,fn=dn&&dn.isDate,mn=dn&&dn.isMap,gn=dn&&dn.isRegExp,vn=dn&&dn.isSet,yn=dn&&dn.isTypedArray;function xn(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function bn(e,t,n,r){var i=-1,o=null==e?0:e.length;while(++i<o){var s=e[i];t(r,s,n(s),e)}return r}function wn(e,t){var n=-1,r=null==e?0:e.length;while(++n<r)if(!1===t(e[n],n,e))break;return e}function _n(e,t){var n=null==e?0:e.length;while(n--)if(!1===t(e[n],n,e))break;return e}function An(e,t){var n=-1,r=null==e?0:e.length;while(++n<r)if(!t(e[n],n,e))return!1;return!0}function Sn(e,t){var n=-1,r=null==e?0:e.length,i=0,o=[];while(++n<r){var s=e[n];t(s,n,e)&&(o[i++]=s)}return o}function En(e,t){var n=null==e?0:e.length;return!!n&&Fn(e,t,0)>-1}function Mn(e,t,n){var r=-1,i=null==e?0:e.length;while(++r<i)if(n(t,e[r]))return!0;return!1}function Tn(e,t){var n=-1,r=null==e?0:e.length,i=Array(r);while(++n<r)i[n]=t(e[n],n,e);return i}function Cn(e,t){var n=-1,r=t.length,i=e.length;while(++n<r)e[i+n]=t[n];return e}function Pn(e,t,n,r){var i=-1,o=null==e?0:e.length;r&&o&&(n=e[++i]);while(++i<o)n=t(n,e[i],i,e);return n}function Rn(e,t,n,r){var i=null==e?0:e.length;r&&i&&(n=e[--i]);while(i--)n=t(n,e[i],i,e);return n}function Ln(e,t){var n=-1,r=null==e?0:e.length;while(++n<r)if(t(e[n],n,e))return!0;return!1}var On=jn("length");function Dn(e){return e.split("")}function In(e){return e.match(He)||[]}function kn(e,t,n){var r;return n(e,(function(e,n,i){if(t(e,n,i))return r=n,!1})),r}function Nn(e,t,n,r){var i=e.length,o=n+(r?1:-1);while(r?o--:++o<i)if(t(e[o],o,e))return o;return-1}function Fn(e,t,n){return t===t?dr(e,t,n):Nn(e,zn,n)}function Vn(e,t,n,r){var i=n-1,o=e.length;while(++i<o)if(r(e[i],t))return i;return-1}function zn(e){return e!==e}function Un(e,t){var n=null==e?0:e.length;return n?qn(e,t)/n:V}function jn(e){return function(t){return null==t?o:t[e]}}function Bn(e){return function(t){return null==e?o:e[t]}}function Hn(e,t,n,r,i){return i(e,(function(e,i,o){n=r?(r=!1,e):t(n,e,i,o)})),n}function Gn(e,t){var n=e.length;e.sort(t);while(n--)e[n]=e[n].value;return e}function qn(e,t){var n,r=-1,i=e.length;while(++r<i){var s=t(e[r]);s!==o&&(n=n===o?s:n+s)}return n}function Wn(e,t){var n=-1,r=Array(e);while(++n<e)r[n]=t(n);return r}function $n(e,t){return Tn(t,(function(t){return[t,e[t]]}))}function Xn(e){return function(t){return e(t)}}function Yn(e,t){return Tn(t,(function(t){return e[t]}))}function Zn(e,t){return e.has(t)}function Jn(e,t){var n=-1,r=e.length;while(++n<r&&Fn(t,e[n],0)>-1);return n}function Qn(e,t){var n=e.length;while(n--&&Fn(t,e[n],0)>-1);return n}function Kn(e,t){var n=e.length,r=0;while(n--)e[n]===t&&++r;return r}var er=Bn(Qt),tr=Bn(Kt);function nr(e){return"\\"+tn[e]}function rr(e,t){return null==e?o:e[t]}function ir(e){return Wt.test(e)}function or(e){return $t.test(e)}function sr(e){var t,n=[];while(!(t=e.next()).done)n.push(t.value);return n}function ar(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function lr(e,t){return function(n){return e(t(n))}}function ur(e,t){var n=-1,r=e.length,i=0,o=[];while(++n<r){var s=e[n];s!==t&&s!==d||(e[n]=d,o[i++]=n)}return o}function cr(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}function hr(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=[e,e]})),n}function dr(e,t,n){var r=n-1,i=e.length;while(++r<i)if(e[r]===t)return r;return-1}function pr(e,t,n){var r=n+1;while(r--)if(e[r]===t)return r;return r}function fr(e){return ir(e)?vr(e):On(e)}function mr(e){return ir(e)?yr(e):Dn(e)}var gr=Bn(en);function vr(e){var t=Gt.lastIndex=0;while(Gt.test(e))++t;return t}function yr(e){return e.match(Gt)||[]}function xr(e){return e.match(qt)||[]}var br=function e(t){t=null==t?an:wr.defaults(an.Object(),t,wr.pick(an,Xt));var n=t.Array,r=t.Date,i=t.Error,He=t.Function,tt=t.Math,nt=t.Object,rt=t.RegExp,it=t.String,ot=t.TypeError,st=n.prototype,at=He.prototype,lt=nt.prototype,ut=t["__core-js_shared__"],ct=at.toString,ht=lt.hasOwnProperty,dt=0,pt=function(){var e=/[^.]+$/.exec(ut&&ut.keys&&ut.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),ft=lt.toString,mt=ct.call(nt),gt=an._,vt=rt("^"+ct.call(ht).replace(ke,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),yt=cn?t.Buffer:o,xt=t.Symbol,bt=t.Uint8Array,wt=yt?yt.allocUnsafe:o,_t=lr(nt.getPrototypeOf,nt),At=nt.create,St=lt.propertyIsEnumerable,Et=st.splice,Mt=xt?xt.isConcatSpreadable:o,Tt=xt?xt.iterator:o,Ct=xt?xt.toStringTag:o,Pt=function(){try{var e=qs(nt,"defineProperty");return e({},"",{}),e}catch(t){}}(),Rt=t.clearTimeout!==an.clearTimeout&&t.clearTimeout,Lt=r&&r.now!==an.Date.now&&r.now,Ot=t.setTimeout!==an.setTimeout&&t.setTimeout,Dt=tt.ceil,It=tt.floor,kt=nt.getOwnPropertySymbols,Nt=yt?yt.isBuffer:o,Ft=t.isFinite,Vt=st.join,zt=lr(nt.keys,nt),Ut=tt.max,jt=tt.min,Gt=r.now,qt=t.parseInt,Wt=tt.random,$t=st.reverse,Qt=qs(t,"DataView"),Kt=qs(t,"Map"),en=qs(t,"Promise"),tn=qs(t,"Set"),on=qs(t,"WeakMap"),sn=qs(nt,"create"),ln=on&&new on,un={},hn=Ra(Qt),dn=Ra(Kt),On=Ra(en),Dn=Ra(tn),Bn=Ra(on),dr=xt?xt.prototype:o,vr=dr?dr.valueOf:o,yr=dr?dr.toString:o;function br(e){if(Ac(e)&&!sc(e)&&!(e instanceof Er)){if(e instanceof Sr)return e;if(ht.call(e,"__wrapped__"))return Oa(e)}return new Sr(e)}var _r=function(){function e(){}return function(t){if(!_c(t))return{};if(At)return At(t);e.prototype=t;var n=new e;return e.prototype=o,n}}();function Ar(){}function Sr(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=o}function Er(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=z,this.__views__=[]}function Mr(){var e=new Er(this.__wrapped__);return e.__actions__=ns(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=ns(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=ns(this.__views__),e}function Tr(){if(this.__filtered__){var e=new Er(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Cr(){var e=this.__wrapped__.value(),t=this.__dir__,n=sc(e),r=t<0,i=n?e.length:0,o=Zs(0,i,this.__views__),s=o.start,a=o.end,l=a-s,u=r?a:s-1,c=this.__iteratees__,h=c.length,d=0,p=jt(l,this.__takeCount__);if(!n||!r&&i==l&&p==l)return Fo(e,this.__actions__);var f=[];e:while(l--&&d<p){u+=t;var m=-1,g=e[u];while(++m<h){var v=c[m],y=v.iteratee,x=v.type,b=y(g);if(x==D)g=b;else if(!b){if(x==O)continue e;break e}}f[d++]=g}return f}function Pr(e){var t=-1,n=null==e?0:e.length;this.clear();while(++t<n){var r=e[t];this.set(r[0],r[1])}}function Rr(){this.__data__=sn?sn(null):{},this.size=0}function Lr(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function Or(e){var t=this.__data__;if(sn){var n=t[e];return n===c?o:n}return ht.call(t,e)?t[e]:o}function Dr(e){var t=this.__data__;return sn?t[e]!==o:ht.call(t,e)}function Ir(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=sn&&t===o?c:t,this}function kr(e){var t=-1,n=null==e?0:e.length;this.clear();while(++t<n){var r=e[t];this.set(r[0],r[1])}}function Nr(){this.__data__=[],this.size=0}function Fr(e){var t=this.__data__,n=li(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():Et.call(t,n,1),--this.size,!0}function Vr(e){var t=this.__data__,n=li(t,e);return n<0?o:t[n][1]}function zr(e){return li(this.__data__,e)>-1}function Ur(e,t){var n=this.__data__,r=li(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function jr(e){var t=-1,n=null==e?0:e.length;this.clear();while(++t<n){var r=e[t];this.set(r[0],r[1])}}function Br(){this.size=0,this.__data__={hash:new Pr,map:new(Kt||kr),string:new Pr}}function Hr(e){var t=Hs(this,e)["delete"](e);return this.size-=t?1:0,t}function Gr(e){return Hs(this,e).get(e)}function qr(e){return Hs(this,e).has(e)}function Wr(e,t){var n=Hs(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function $r(e){var t=-1,n=null==e?0:e.length;this.__data__=new jr;while(++t<n)this.add(e[t])}function Xr(e){return this.__data__.set(e,c),this}function Yr(e){return this.__data__.has(e)}function Zr(e){var t=this.__data__=new kr(e);this.size=t.size}function Jr(){this.__data__=new kr,this.size=0}function Qr(e){var t=this.__data__,n=t["delete"](e);return this.size=t.size,n}function Kr(e){return this.__data__.get(e)}function ei(e){return this.__data__.has(e)}function ti(e,t){var n=this.__data__;if(n instanceof kr){var r=n.__data__;if(!Kt||r.length<a-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new jr(r)}return n.set(e,t),this.size=n.size,this}function ni(e,t){var n=sc(e),r=!n&&oc(e),i=!n&&!r&&hc(e),o=!n&&!r&&!i&&Vc(e),s=n||r||i||o,a=s?Wn(e.length,it):[],l=a.length;for(var u in e)!t&&!ht.call(e,u)||s&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||ia(u,l))||a.push(u);return a}function ri(e){var t=e.length;return t?e[go(0,t-1)]:o}function ii(e,t){return Ta(ns(e),fi(t,0,e.length))}function oi(e){return Ta(ns(e))}function si(e,t,n){(n!==o&&!nc(e[t],n)||n===o&&!(t in e))&&di(e,t,n)}function ai(e,t,n){var r=e[t];ht.call(e,t)&&nc(r,n)&&(n!==o||t in e)||di(e,t,n)}function li(e,t){var n=e.length;while(n--)if(nc(e[n][0],t))return n;return-1}function ui(e,t,n,r){return bi(e,(function(e,i,o){t(r,e,n(e),o)})),r}function ci(e,t){return e&&rs(t,bh(t),e)}function hi(e,t){return e&&rs(t,wh(t),e)}function di(e,t,n){"__proto__"==t&&Pt?Pt(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function pi(e,t){var r=-1,i=t.length,s=n(i),a=null==e;while(++r<i)s[r]=a?o:fh(e,t[r]);return s}function fi(e,t,n){return e===e&&(n!==o&&(e=e<=n?e:n),t!==o&&(e=e>=t?e:t)),e}function mi(e,t,n,r,i,s){var a,l=t&p,u=t&f,c=t&m;if(n&&(a=i?n(e,r,i,s):n(e)),a!==o)return a;if(!_c(e))return e;var h=sc(e);if(h){if(a=Ks(e),!l)return ns(e,a)}else{var d=Ys(e),g=d==Z||d==J;if(hc(e))return Wo(e,l);if(d==te||d==H||g&&!i){if(a=u||g?{}:ea(e),!l)return u?os(e,hi(a,e)):is(e,ci(a,e))}else{if(!Jt[d])return i?e:{};a=ta(e,d,l)}}s||(s=new Zr);var v=s.get(e);if(v)return v;s.set(e,a),kc(e)?e.forEach((function(r){a.add(mi(r,t,n,r,e,s))})):Sc(e)&&e.forEach((function(r,i){a.set(i,mi(r,t,n,i,e,s))}));var y=c?u?Vs:Fs:u?wh:bh,x=h?o:y(e);return wn(x||e,(function(r,i){x&&(i=r,r=e[i]),ai(a,i,mi(r,t,n,i,e,s))})),a}function gi(e){var t=bh(e);return function(n){return vi(n,e,t)}}function vi(e,t,n){var r=n.length;if(null==e)return!r;e=nt(e);while(r--){var i=n[r],s=t[i],a=e[i];if(a===o&&!(i in e)||!s(a))return!1}return!0}function yi(e,t,n){if("function"!=typeof e)throw new ot(u);return Aa((function(){e.apply(o,n)}),t)}function xi(e,t,n,r){var i=-1,o=En,s=!0,l=e.length,u=[],c=t.length;if(!l)return u;n&&(t=Tn(t,Xn(n))),r?(o=Mn,s=!1):t.length>=a&&(o=Zn,s=!1,t=new $r(t));e:while(++i<l){var h=e[i],d=null==n?h:n(h);if(h=r||0!==h?h:0,s&&d===d){var p=c;while(p--)if(t[p]===d)continue e;u.push(h)}else o(t,d,r)||u.push(h)}return u}br.templateSettings={escape:Pe,evaluate:Re,interpolate:Le,variable:"",imports:{_:br}},br.prototype=Ar.prototype,br.prototype.constructor=br,Sr.prototype=_r(Ar.prototype),Sr.prototype.constructor=Sr,Er.prototype=_r(Ar.prototype),Er.prototype.constructor=Er,Pr.prototype.clear=Rr,Pr.prototype["delete"]=Lr,Pr.prototype.get=Or,Pr.prototype.has=Dr,Pr.prototype.set=Ir,kr.prototype.clear=Nr,kr.prototype["delete"]=Fr,kr.prototype.get=Vr,kr.prototype.has=zr,kr.prototype.set=Ur,jr.prototype.clear=Br,jr.prototype["delete"]=Hr,jr.prototype.get=Gr,jr.prototype.has=qr,jr.prototype.set=Wr,$r.prototype.add=$r.prototype.push=Xr,$r.prototype.has=Yr,Zr.prototype.clear=Jr,Zr.prototype["delete"]=Qr,Zr.prototype.get=Kr,Zr.prototype.has=ei,Zr.prototype.set=ti;var bi=ls(Pi),wi=ls(Ri,!0);function _i(e,t){var n=!0;return bi(e,(function(e,r,i){return n=!!t(e,r,i),n})),n}function Ai(e,t,n){var r=-1,i=e.length;while(++r<i){var s=e[r],a=t(s);if(null!=a&&(l===o?a===a&&!Fc(a):n(a,l)))var l=a,u=s}return u}function Si(e,t,n,r){var i=e.length;n=Wc(n),n<0&&(n=-n>i?0:i+n),r=r===o||r>i?i:Wc(r),r<0&&(r+=i),r=n>r?0:$c(r);while(n<r)e[n++]=t;return e}function Ei(e,t){var n=[];return bi(e,(function(e,r,i){t(e,r,i)&&n.push(e)})),n}function Mi(e,t,n,r,i){var o=-1,s=e.length;n||(n=ra),i||(i=[]);while(++o<s){var a=e[o];t>0&&n(a)?t>1?Mi(a,t-1,n,r,i):Cn(i,a):r||(i[i.length]=a)}return i}var Ti=us(),Ci=us(!0);function Pi(e,t){return e&&Ti(e,t,bh)}function Ri(e,t){return e&&Ci(e,t,bh)}function Li(e,t){return Sn(t,(function(t){return xc(e[t])}))}function Oi(e,t){t=Bo(t,e);var n=0,r=t.length;while(null!=e&&n<r)e=e[Pa(t[n++])];return n&&n==r?e:o}function Di(e,t,n){var r=t(e);return sc(e)?r:Cn(r,n(e))}function Ii(e){return null==e?e===o?le:ee:Ct&&Ct in nt(e)?Ws(e):va(e)}function ki(e,t){return e>t}function Ni(e,t){return null!=e&&ht.call(e,t)}function Fi(e,t){return null!=e&&t in nt(e)}function Vi(e,t,n){return e>=jt(t,n)&&e<Ut(t,n)}function zi(e,t,r){var i=r?Mn:En,s=e[0].length,a=e.length,l=a,u=n(a),c=1/0,h=[];while(l--){var d=e[l];l&&t&&(d=Tn(d,Xn(t))),c=jt(d.length,c),u[l]=!r&&(t||s>=120&&d.length>=120)?new $r(l&&d):o}d=e[0];var p=-1,f=u[0];e:while(++p<s&&h.length<c){var m=d[p],g=t?t(m):m;if(m=r||0!==m?m:0,!(f?Zn(f,g):i(h,g,r))){l=a;while(--l){var v=u[l];if(!(v?Zn(v,g):i(e[l],g,r)))continue e}f&&f.push(g),h.push(m)}}return h}function Ui(e,t,n,r){return Pi(e,(function(e,i,o){t(r,n(e),i,o)})),r}function ji(e,t,n){t=Bo(t,e),e=xa(e,t);var r=null==e?e:e[Pa(rl(t))];return null==r?o:xn(r,e,n)}function Bi(e){return Ac(e)&&Ii(e)==H}function Hi(e){return Ac(e)&&Ii(e)==he}function Gi(e){return Ac(e)&&Ii(e)==$}function qi(e,t,n,r,i){return e===t||(null==e||null==t||!Ac(e)&&!Ac(t)?e!==e&&t!==t:Wi(e,t,n,r,qi,i))}function Wi(e,t,n,r,i,o){var s=sc(e),a=sc(t),l=s?G:Ys(e),u=a?G:Ys(t);l=l==H?te:l,u=u==H?te:u;var c=l==te,h=u==te,d=l==u;if(d&&hc(e)){if(!hc(t))return!1;s=!0,c=!1}if(d&&!c)return o||(o=new Zr),s||Vc(e)?Ds(e,t,n,r,i,o):Is(e,t,l,n,r,i,o);if(!(n&g)){var p=c&&ht.call(e,"__wrapped__"),f=h&&ht.call(t,"__wrapped__");if(p||f){var m=p?e.value():e,v=f?t.value():t;return o||(o=new Zr),i(m,v,n,r,o)}}return!!d&&(o||(o=new Zr),ks(e,t,n,r,i,o))}function $i(e){return Ac(e)&&Ys(e)==Q}function Xi(e,t,n,r){var i=n.length,s=i,a=!r;if(null==e)return!s;e=nt(e);while(i--){var l=n[i];if(a&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}while(++i<s){l=n[i];var u=l[0],c=e[u],h=l[1];if(a&&l[2]){if(c===o&&!(u in e))return!1}else{var d=new Zr;if(r)var p=r(c,h,u,e,t,d);if(!(p===o?qi(h,c,g|v,r,d):p))return!1}}return!0}function Yi(e){if(!_c(e)||ua(e))return!1;var t=xc(e)?vt:Ye;return t.test(Ra(e))}function Zi(e){return Ac(e)&&Ii(e)==ie}function Ji(e){return Ac(e)&&Ys(e)==oe}function Qi(e){return Ac(e)&&wc(e.length)&&!!Zt[Ii(e)]}function Ki(e){return"function"==typeof e?e:null==e?Cd:"object"==typeof e?sc(e)?oo(e[0],e[1]):io(e):jd(e)}function eo(e){if(!ha(e))return zt(e);var t=[];for(var n in nt(e))ht.call(e,n)&&"constructor"!=n&&t.push(n);return t}function to(e){if(!_c(e))return ga(e);var t=ha(e),n=[];for(var r in e)("constructor"!=r||!t&&ht.call(e,r))&&n.push(r);return n}function no(e,t){return e<t}function ro(e,t){var r=-1,i=lc(e)?n(e.length):[];return bi(e,(function(e,n,o){i[++r]=t(e,n,o)})),i}function io(e){var t=Gs(e);return 1==t.length&&t[0][2]?pa(t[0][0],t[0][1]):function(n){return n===e||Xi(n,e,t)}}function oo(e,t){return sa(e)&&da(t)?pa(Pa(e),t):function(n){var r=fh(n,e);return r===o&&r===t?gh(n,e):qi(t,r,g|v)}}function so(e,t,n,r,i){e!==t&&Ti(t,(function(s,a){if(i||(i=new Zr),_c(s))ao(e,t,a,n,so,r,i);else{var l=r?r(wa(e,a),s,a+"",e,t,i):o;l===o&&(l=s),si(e,a,l)}}),wh)}function ao(e,t,n,r,i,s,a){var l=wa(e,n),u=wa(t,n),c=a.get(u);if(c)si(e,n,c);else{var h=s?s(l,u,n+"",e,t,a):o,d=h===o;if(d){var p=sc(u),f=!p&&hc(u),m=!p&&!f&&Vc(u);h=u,p||f||m?sc(l)?h=l:uc(l)?h=ns(l):f?(d=!1,h=Wo(u,!0)):m?(d=!1,h=Jo(u,!0)):h=[]:Oc(u)||oc(u)?(h=l,oc(l)?h=Yc(l):_c(l)&&!xc(l)||(h=ea(u))):d=!1}d&&(a.set(u,h),i(h,u,r,s,a),a["delete"](u)),si(e,n,h)}}function lo(e,t){var n=e.length;if(n)return t+=t<0?n:0,ia(t,n)?e[t]:o}function uo(e,t,n){t=t.length?Tn(t,(function(e){return sc(e)?function(t){return Oi(t,1===e.length?e[0]:e)}:e})):[Cd];var r=-1;t=Tn(t,Xn(Bs()));var i=ro(e,(function(e,n,i){var o=Tn(t,(function(t){return t(e)}));return{criteria:o,index:++r,value:e}}));return Gn(i,(function(e,t){return Ko(e,t,n)}))}function co(e,t){return ho(e,t,(function(t,n){return gh(e,n)}))}function ho(e,t,n){var r=-1,i=t.length,o={};while(++r<i){var s=t[r],a=Oi(e,s);n(a,s)&&_o(o,Bo(s,e),a)}return o}function po(e){return function(t){return Oi(t,e)}}function fo(e,t,n,r){var i=r?Vn:Fn,o=-1,s=t.length,a=e;e===t&&(t=ns(t)),n&&(a=Tn(e,Xn(n)));while(++o<s){var l=0,u=t[o],c=n?n(u):u;while((l=i(a,c,l,r))>-1)a!==e&&Et.call(a,l,1),Et.call(e,l,1)}return e}function mo(e,t){var n=e?t.length:0,r=n-1;while(n--){var i=t[n];if(n==r||i!==o){var o=i;ia(i)?Et.call(e,i,1):Io(e,i)}}return e}function go(e,t){return e+It(Wt()*(t-e+1))}function vo(e,t,r,i){var o=-1,s=Ut(Dt((t-e)/(r||1)),0),a=n(s);while(s--)a[i?s:++o]=e,e+=r;return a}function yo(e,t){var n="";if(!e||t<1||t>N)return n;do{t%2&&(n+=e),t=It(t/2),t&&(e+=e)}while(t);return n}function xo(e,t){return Sa(ya(e,t,Cd),e+"")}function bo(e){return ri(zh(e))}function wo(e,t){var n=zh(e);return Ta(n,fi(t,0,n.length))}function _o(e,t,n,r){if(!_c(e))return e;t=Bo(t,e);var i=-1,s=t.length,a=s-1,l=e;while(null!=l&&++i<s){var u=Pa(t[i]),c=n;if("__proto__"===u||"constructor"===u||"prototype"===u)return e;if(i!=a){var h=l[u];c=r?r(h,u,l):o,c===o&&(c=_c(h)?h:ia(t[i+1])?[]:{})}ai(l,u,c),l=l[u]}return e}var Ao=ln?function(e,t){return ln.set(e,t),e}:Cd,So=Pt?function(e,t){return Pt(e,"toString",{configurable:!0,enumerable:!1,value:Sd(t),writable:!0})}:Cd;function Eo(e){return Ta(zh(e))}function Mo(e,t,r){var i=-1,o=e.length;t<0&&(t=-t>o?0:o+t),r=r>o?o:r,r<0&&(r+=o),o=t>r?0:r-t>>>0,t>>>=0;var s=n(o);while(++i<o)s[i]=e[i+t];return s}function To(e,t){var n;return bi(e,(function(e,r,i){return n=t(e,r,i),!n})),!!n}function Co(e,t,n){var r=0,i=null==e?r:e.length;if("number"==typeof t&&t===t&&i<=j){while(r<i){var o=r+i>>>1,s=e[o];null!==s&&!Fc(s)&&(n?s<=t:s<t)?r=o+1:i=o}return i}return Po(e,t,Cd,n)}function Po(e,t,n,r){var i=0,s=null==e?0:e.length;if(0===s)return 0;t=n(t);var a=t!==t,l=null===t,u=Fc(t),c=t===o;while(i<s){var h=It((i+s)/2),d=n(e[h]),p=d!==o,f=null===d,m=d===d,g=Fc(d);if(a)var v=r||m;else v=c?m&&(r||p):l?m&&p&&(r||!f):u?m&&p&&!f&&(r||!g):!f&&!g&&(r?d<=t:d<t);v?i=h+1:s=h}return jt(s,U)}function Ro(e,t){var n=-1,r=e.length,i=0,o=[];while(++n<r){var s=e[n],a=t?t(s):s;if(!n||!nc(a,l)){var l=a;o[i++]=0===s?0:s}}return o}function Lo(e){return"number"==typeof e?e:Fc(e)?V:+e}function Oo(e){if("string"==typeof e)return e;if(sc(e))return Tn(e,Oo)+"";if(Fc(e))return yr?yr.call(e):"";var t=e+"";return"0"==t&&1/e==-k?"-0":t}function Do(e,t,n){var r=-1,i=En,o=e.length,s=!0,l=[],u=l;if(n)s=!1,i=Mn;else if(o>=a){var c=t?null:Ts(e);if(c)return cr(c);s=!1,i=Zn,u=new $r}else u=t?[]:l;e:while(++r<o){var h=e[r],d=t?t(h):h;if(h=n||0!==h?h:0,s&&d===d){var p=u.length;while(p--)if(u[p]===d)continue e;t&&u.push(d),l.push(h)}else i(u,d,n)||(u!==l&&u.push(d),l.push(h))}return l}function Io(e,t){return t=Bo(t,e),e=xa(e,t),null==e||delete e[Pa(rl(t))]}function ko(e,t,n,r){return _o(e,t,n(Oi(e,t)),r)}function No(e,t,n,r){var i=e.length,o=r?i:-1;while((r?o--:++o<i)&&t(e[o],o,e));return n?Mo(e,r?0:o,r?o+1:i):Mo(e,r?o+1:0,r?i:o)}function Fo(e,t){var n=e;return n instanceof Er&&(n=n.value()),Pn(t,(function(e,t){return t.func.apply(t.thisArg,Cn([e],t.args))}),n)}function Vo(e,t,r){var i=e.length;if(i<2)return i?Do(e[0]):[];var o=-1,s=n(i);while(++o<i){var a=e[o],l=-1;while(++l<i)l!=o&&(s[o]=xi(s[o]||a,e[l],t,r))}return Do(Mi(s,1),t,r)}function zo(e,t,n){var r=-1,i=e.length,s=t.length,a={};while(++r<i){var l=r<s?t[r]:o;n(a,e[r],l)}return a}function Uo(e){return uc(e)?e:[]}function jo(e){return"function"==typeof e?e:Cd}function Bo(e,t){return sc(e)?e:sa(e,t)?[e]:Ca(Jc(e))}var Ho=xo;function Go(e,t,n){var r=e.length;return n=n===o?r:n,!t&&n>=r?e:Mo(e,t,n)}var qo=Rt||function(e){return an.clearTimeout(e)};function Wo(e,t){if(t)return e.slice();var n=e.length,r=wt?wt(n):new e.constructor(n);return e.copy(r),r}function $o(e){var t=new e.constructor(e.byteLength);return new bt(t).set(new bt(e)),t}function Xo(e,t){var n=t?$o(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function Yo(e){var t=new e.constructor(e.source,We.exec(e));return t.lastIndex=e.lastIndex,t}function Zo(e){return vr?nt(vr.call(e)):{}}function Jo(e,t){var n=t?$o(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Qo(e,t){if(e!==t){var n=e!==o,r=null===e,i=e===e,s=Fc(e),a=t!==o,l=null===t,u=t===t,c=Fc(t);if(!l&&!c&&!s&&e>t||s&&a&&u&&!l&&!c||r&&a&&u||!n&&u||!i)return 1;if(!r&&!s&&!c&&e<t||c&&n&&i&&!r&&!s||l&&n&&i||!a&&i||!u)return-1}return 0}function Ko(e,t,n){var r=-1,i=e.criteria,o=t.criteria,s=i.length,a=n.length;while(++r<s){var l=Qo(i[r],o[r]);if(l){if(r>=a)return l;var u=n[r];return l*("desc"==u?-1:1)}}return e.index-t.index}function es(e,t,r,i){var o=-1,s=e.length,a=r.length,l=-1,u=t.length,c=Ut(s-a,0),h=n(u+c),d=!i;while(++l<u)h[l]=t[l];while(++o<a)(d||o<s)&&(h[r[o]]=e[o]);while(c--)h[l++]=e[o++];return h}function ts(e,t,r,i){var o=-1,s=e.length,a=-1,l=r.length,u=-1,c=t.length,h=Ut(s-l,0),d=n(h+c),p=!i;while(++o<h)d[o]=e[o];var f=o;while(++u<c)d[f+u]=t[u];while(++a<l)(p||o<s)&&(d[f+r[a]]=e[o++]);return d}function ns(e,t){var r=-1,i=e.length;t||(t=n(i));while(++r<i)t[r]=e[r];return t}function rs(e,t,n,r){var i=!n;n||(n={});var s=-1,a=t.length;while(++s<a){var l=t[s],u=r?r(n[l],e[l],l,n,e):o;u===o&&(u=e[l]),i?di(n,l,u):ai(n,l,u)}return n}function is(e,t){return rs(e,$s(e),t)}function os(e,t){return rs(e,Xs(e),t)}function ss(e,t){return function(n,r){var i=sc(n)?bn:ui,o=t?t():{};return i(n,e,Bs(r,2),o)}}function as(e){return xo((function(t,n){var r=-1,i=n.length,s=i>1?n[i-1]:o,a=i>2?n[2]:o;s=e.length>3&&"function"==typeof s?(i--,s):o,a&&oa(n[0],n[1],a)&&(s=i<3?o:s,i=1),t=nt(t);while(++r<i){var l=n[r];l&&e(t,l,r,s)}return t}))}function ls(e,t){return function(n,r){if(null==n)return n;if(!lc(n))return e(n,r);var i=n.length,o=t?i:-1,s=nt(n);while(t?o--:++o<i)if(!1===r(s[o],o,s))break;return n}}function us(e){return function(t,n,r){var i=-1,o=nt(t),s=r(t),a=s.length;while(a--){var l=s[e?a:++i];if(!1===n(o[l],l,o))break}return t}}function cs(e,t,n){var r=t&y,i=ps(e);function o(){var t=this&&this!==an&&this instanceof o?i:e;return t.apply(r?n:this,arguments)}return o}function hs(e){return function(t){t=Jc(t);var n=ir(t)?mr(t):o,r=n?n[0]:t.charAt(0),i=n?Go(n,1).join(""):t.slice(1);return r[e]()+i}}function ds(e){return function(t){return Pn(xd(Wh(t).replace(Bt,"")),e,"")}}function ps(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=_r(e.prototype),r=e.apply(n,t);return _c(r)?r:n}}function fs(e,t,r){var i=ps(e);function s(){var a=arguments.length,l=n(a),u=a,c=js(s);while(u--)l[u]=arguments[u];var h=a<3&&l[0]!==c&&l[a-1]!==c?[]:ur(l,c);if(a-=h.length,a<r)return Es(e,t,vs,s.placeholder,o,l,h,o,o,r-a);var d=this&&this!==an&&this instanceof s?i:e;return xn(d,this,l)}return s}function ms(e){return function(t,n,r){var i=nt(t);if(!lc(t)){var s=Bs(n,3);t=bh(t),n=function(e){return s(i[e],e,i)}}var a=e(t,n,r);return a>-1?i[s?t[a]:a]:o}}function gs(e){return Ns((function(t){var n=t.length,r=n,i=Sr.prototype.thru;e&&t.reverse();while(r--){var s=t[r];if("function"!=typeof s)throw new ot(u);if(i&&!a&&"wrapper"==Us(s))var a=new Sr([],!0)}r=a?r:n;while(++r<n){s=t[r];var l=Us(s),c="wrapper"==l?zs(s):o;a=c&&la(c[0])&&c[1]==(E|w|A|M)&&!c[4].length&&1==c[9]?a[Us(c[0])].apply(a,c[3]):1==s.length&&la(s)?a[l]():a.thru(s)}return function(){var e=arguments,r=e[0];if(a&&1==e.length&&sc(r))return a.plant(r).value();var i=0,o=n?t[i].apply(this,e):r;while(++i<n)o=t[i].call(this,o);return o}}))}function vs(e,t,r,i,s,a,l,u,c,h){var d=t&E,p=t&y,f=t&x,m=t&(w|_),g=t&T,v=f?o:ps(e);function b(){var o=arguments.length,y=n(o),x=o;while(x--)y[x]=arguments[x];if(m)var w=js(b),_=Kn(y,w);if(i&&(y=es(y,i,s,m)),a&&(y=ts(y,a,l,m)),o-=_,m&&o<h){var A=ur(y,w);return Es(e,t,vs,b.placeholder,r,y,A,u,c,h-o)}var S=p?r:this,E=f?S[e]:e;return o=y.length,u?y=ba(y,u):g&&o>1&&y.reverse(),d&&c<o&&(y.length=c),this&&this!==an&&this instanceof b&&(E=v||ps(E)),E.apply(S,y)}return b}function ys(e,t){return function(n,r){return Ui(n,e,t(r),{})}}function xs(e,t){return function(n,r){var i;if(n===o&&r===o)return t;if(n!==o&&(i=n),r!==o){if(i===o)return r;"string"==typeof n||"string"==typeof r?(n=Oo(n),r=Oo(r)):(n=Lo(n),r=Lo(r)),i=e(n,r)}return i}}function bs(e){return Ns((function(t){return t=Tn(t,Xn(Bs())),xo((function(n){var r=this;return e(t,(function(e){return xn(e,r,n)}))}))}))}function ws(e,t){t=t===o?" ":Oo(t);var n=t.length;if(n<2)return n?yo(t,e):t;var r=yo(t,Dt(e/fr(t)));return ir(t)?Go(mr(r),0,e).join(""):r.slice(0,e)}function _s(e,t,r,i){var o=t&y,s=ps(e);function a(){var t=-1,l=arguments.length,u=-1,c=i.length,h=n(c+l),d=this&&this!==an&&this instanceof a?s:e;while(++u<c)h[u]=i[u];while(l--)h[u++]=arguments[++t];return xn(d,o?r:this,h)}return a}function As(e){return function(t,n,r){return r&&"number"!=typeof r&&oa(t,n,r)&&(n=r=o),t=qc(t),n===o?(n=t,t=0):n=qc(n),r=r===o?t<n?1:-1:qc(r),vo(t,n,r,e)}}function Ss(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=Xc(t),n=Xc(n)),e(t,n)}}function Es(e,t,n,r,i,s,a,l,u,c){var h=t&w,d=h?a:o,p=h?o:a,f=h?s:o,m=h?o:s;t|=h?A:S,t&=~(h?S:A),t&b||(t&=~(y|x));var g=[e,t,i,f,d,m,p,l,u,c],v=n.apply(o,g);return la(e)&&_a(v,g),v.placeholder=r,Ea(v,e,t)}function Ms(e){var t=tt[e];return function(e,n){if(e=Xc(e),n=null==n?0:jt(Wc(n),292),n&&Ft(e)){var r=(Jc(e)+"e").split("e"),i=t(r[0]+"e"+(+r[1]+n));return r=(Jc(i)+"e").split("e"),+(r[0]+"e"+(+r[1]-n))}return t(e)}}var Ts=tn&&1/cr(new tn([,-0]))[1]==k?function(e){return new tn(e)}:Nd;function Cs(e){return function(t){var n=Ys(t);return n==Q?ar(t):n==oe?hr(t):$n(t,e(t))}}function Ps(e,t,n,r,i,s,a,l){var c=t&x;if(!c&&"function"!=typeof e)throw new ot(u);var h=r?r.length:0;if(h||(t&=~(A|S),r=i=o),a=a===o?a:Ut(Wc(a),0),l=l===o?l:Wc(l),h-=i?i.length:0,t&S){var d=r,p=i;r=i=o}var f=c?o:zs(e),m=[e,t,n,r,i,d,p,s,a,l];if(f&&ma(m,f),e=m[0],t=m[1],n=m[2],r=m[3],i=m[4],l=m[9]=m[9]===o?c?0:e.length:Ut(m[9]-h,0),!l&&t&(w|_)&&(t&=~(w|_)),t&&t!=y)g=t==w||t==_?fs(e,t,l):t!=A&&t!=(y|A)||i.length?vs.apply(o,m):_s(e,t,n,r);else var g=cs(e,t,n);var v=f?Ao:_a;return Ea(v(g,m),e,t)}function Rs(e,t,n,r){return e===o||nc(e,lt[n])&&!ht.call(r,n)?t:e}function Ls(e,t,n,r,i,s){return _c(e)&&_c(t)&&(s.set(t,e),so(e,t,o,Ls,s),s["delete"](t)),e}function Os(e){return Oc(e)?o:e}function Ds(e,t,n,r,i,s){var a=n&g,l=e.length,u=t.length;if(l!=u&&!(a&&u>l))return!1;var c=s.get(e),h=s.get(t);if(c&&h)return c==t&&h==e;var d=-1,p=!0,f=n&v?new $r:o;s.set(e,t),s.set(t,e);while(++d<l){var m=e[d],y=t[d];if(r)var x=a?r(y,m,d,t,e,s):r(m,y,d,e,t,s);if(x!==o){if(x)continue;p=!1;break}if(f){if(!Ln(t,(function(e,t){if(!Zn(f,t)&&(m===e||i(m,e,n,r,s)))return f.push(t)}))){p=!1;break}}else if(m!==y&&!i(m,y,n,r,s)){p=!1;break}}return s["delete"](e),s["delete"](t),p}function Is(e,t,n,r,i,o,s){switch(n){case de:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case he:return!(e.byteLength!=t.byteLength||!o(new bt(e),new bt(t)));case W:case $:case K:return nc(+e,+t);case Y:return e.name==t.name&&e.message==t.message;case ie:case se:return e==t+"";case Q:var a=ar;case oe:var l=r&g;if(a||(a=cr),e.size!=t.size&&!l)return!1;var u=s.get(e);if(u)return u==t;r|=v,s.set(e,t);var c=Ds(a(e),a(t),r,i,o,s);return s["delete"](e),c;case ae:if(vr)return vr.call(e)==vr.call(t)}return!1}function ks(e,t,n,r,i,s){var a=n&g,l=Fs(e),u=l.length,c=Fs(t),h=c.length;if(u!=h&&!a)return!1;var d=u;while(d--){var p=l[d];if(!(a?p in t:ht.call(t,p)))return!1}var f=s.get(e),m=s.get(t);if(f&&m)return f==t&&m==e;var v=!0;s.set(e,t),s.set(t,e);var y=a;while(++d<u){p=l[d];var x=e[p],b=t[p];if(r)var w=a?r(b,x,p,t,e,s):r(x,b,p,e,t,s);if(!(w===o?x===b||i(x,b,n,r,s):w)){v=!1;break}y||(y="constructor"==p)}if(v&&!y){var _=e.constructor,A=t.constructor;_==A||!("constructor"in e)||!("constructor"in t)||"function"==typeof _&&_ instanceof _&&"function"==typeof A&&A instanceof A||(v=!1)}return s["delete"](e),s["delete"](t),v}function Ns(e){return Sa(ya(e,o,Wa),e+"")}function Fs(e){return Di(e,bh,$s)}function Vs(e){return Di(e,wh,Xs)}var zs=ln?function(e){return ln.get(e)}:Nd;function Us(e){var t=e.name+"",n=un[t],r=ht.call(un,t)?n.length:0;while(r--){var i=n[r],o=i.func;if(null==o||o==e)return i.name}return t}function js(e){var t=ht.call(br,"placeholder")?br:e;return t.placeholder}function Bs(){var e=br.iteratee||Pd;return e=e===Pd?Ki:e,arguments.length?e(arguments[0],arguments[1]):e}function Hs(e,t){var n=e.__data__;return aa(t)?n["string"==typeof t?"string":"hash"]:n.map}function Gs(e){var t=bh(e),n=t.length;while(n--){var r=t[n],i=e[r];t[n]=[r,i,da(i)]}return t}function qs(e,t){var n=rr(e,t);return Yi(n)?n:o}function Ws(e){var t=ht.call(e,Ct),n=e[Ct];try{e[Ct]=o;var r=!0}catch(s){}var i=ft.call(e);return r&&(t?e[Ct]=n:delete e[Ct]),i}var $s=kt?function(e){return null==e?[]:(e=nt(e),Sn(kt(e),(function(t){return St.call(e,t)})))}:qd,Xs=kt?function(e){var t=[];while(e)Cn(t,$s(e)),e=_t(e);return t}:qd,Ys=Ii;function Zs(e,t,n){var r=-1,i=n.length;while(++r<i){var o=n[r],s=o.size;switch(o.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=jt(t,e+s);break;case"takeRight":e=Ut(e,t-s);break}}return{start:e,end:t}}function Js(e){var t=e.match(je);return t?t[1].split(Be):[]}function Qs(e,t,n){t=Bo(t,e);var r=-1,i=t.length,o=!1;while(++r<i){var s=Pa(t[r]);if(!(o=null!=e&&n(e,s)))break;e=e[s]}return o||++r!=i?o:(i=null==e?0:e.length,!!i&&wc(i)&&ia(s,i)&&(sc(e)||oc(e)))}function Ks(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&ht.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function ea(e){return"function"!=typeof e.constructor||ha(e)?{}:_r(_t(e))}function ta(e,t,n){var r=e.constructor;switch(t){case he:return $o(e);case W:case $:return new r(+e);case de:return Xo(e,n);case pe:case fe:case me:case ge:case ve:case ye:case xe:case be:case we:return Jo(e,n);case Q:return new r;case K:case se:return new r(e);case ie:return Yo(e);case oe:return new r;case ae:return Zo(e)}}function na(e,t){var n=t.length;if(!n)return e;var r=n-1;return t[r]=(n>1?"& ":"")+t[r],t=t.join(n>2?", ":" "),e.replace(Ue,"{\n/* [wrapped with "+t+"] */\n")}function ra(e){return sc(e)||oc(e)||!!(Mt&&e&&e[Mt])}function ia(e,t){var n=typeof e;return t=null==t?N:t,!!t&&("number"==n||"symbol"!=n&&Je.test(e))&&e>-1&&e%1==0&&e<t}function oa(e,t,n){if(!_c(n))return!1;var r=typeof t;return!!("number"==r?lc(n)&&ia(t,n.length):"string"==r&&t in n)&&nc(n[t],e)}function sa(e,t){if(sc(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Fc(e))||(De.test(e)||!Oe.test(e)||null!=t&&e in nt(t))}function aa(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function la(e){var t=Us(e),n=br[t];if("function"!=typeof n||!(t in Er.prototype))return!1;if(e===n)return!0;var r=zs(n);return!!r&&e===r[0]}function ua(e){return!!pt&&pt in e}(Qt&&Ys(new Qt(new ArrayBuffer(1)))!=de||Kt&&Ys(new Kt)!=Q||en&&Ys(en.resolve())!=ne||tn&&Ys(new tn)!=oe||on&&Ys(new on)!=ue)&&(Ys=function(e){var t=Ii(e),n=t==te?e.constructor:o,r=n?Ra(n):"";if(r)switch(r){case hn:return de;case dn:return Q;case On:return ne;case Dn:return oe;case Bn:return ue}return t});var ca=ut?xc:Wd;function ha(e){var t=e&&e.constructor,n="function"==typeof t&&t.prototype||lt;return e===n}function da(e){return e===e&&!_c(e)}function pa(e,t){return function(n){return null!=n&&(n[e]===t&&(t!==o||e in nt(n)))}}function fa(e){var t=Vu(e,(function(e){return n.size===h&&n.clear(),e})),n=t.cache;return t}function ma(e,t){var n=e[1],r=t[1],i=n|r,o=i<(y|x|E),s=r==E&&n==w||r==E&&n==M&&e[7].length<=t[8]||r==(E|M)&&t[7].length<=t[8]&&n==w;if(!o&&!s)return e;r&y&&(e[2]=t[2],i|=n&y?0:b);var a=t[3];if(a){var l=e[3];e[3]=l?es(l,a,t[4]):a,e[4]=l?ur(e[3],d):t[4]}return a=t[5],a&&(l=e[5],e[5]=l?ts(l,a,t[6]):a,e[6]=l?ur(e[5],d):t[6]),a=t[7],a&&(e[7]=a),r&E&&(e[8]=null==e[8]?t[8]:jt(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=i,e}function ga(e){var t=[];if(null!=e)for(var n in nt(e))t.push(n);return t}function va(e){return ft.call(e)}function ya(e,t,r){return t=Ut(t===o?e.length-1:t,0),function(){var i=arguments,o=-1,s=Ut(i.length-t,0),a=n(s);while(++o<s)a[o]=i[t+o];o=-1;var l=n(t+1);while(++o<t)l[o]=i[o];return l[t]=r(a),xn(e,this,l)}}function xa(e,t){return t.length<2?e:Oi(e,Mo(t,0,-1))}function ba(e,t){var n=e.length,r=jt(t.length,n),i=ns(e);while(r--){var s=t[r];e[r]=ia(s,n)?i[s]:o}return e}function wa(e,t){if(("constructor"!==t||"function"!==typeof e[t])&&"__proto__"!=t)return e[t]}var _a=Ma(Ao),Aa=Ot||function(e,t){return an.setTimeout(e,t)},Sa=Ma(So);function Ea(e,t,n){var r=t+"";return Sa(e,na(r,La(Js(r),n)))}function Ma(e){var t=0,n=0;return function(){var r=Gt(),i=L-(r-n);if(n=r,i>0){if(++t>=R)return arguments[0]}else t=0;return e.apply(o,arguments)}}function Ta(e,t){var n=-1,r=e.length,i=r-1;t=t===o?r:t;while(++n<t){var s=go(n,i),a=e[s];e[s]=e[n],e[n]=a}return e.length=t,e}var Ca=fa((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Ie,(function(e,n,r,i){t.push(r?i.replace(Ge,"$1"):n||e)})),t}));function Pa(e){if("string"==typeof e||Fc(e))return e;var t=e+"";return"0"==t&&1/e==-k?"-0":t}function Ra(e){if(null!=e){try{return ct.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function La(e,t){return wn(B,(function(n){var r="_."+n[0];t&n[1]&&!En(e,r)&&e.push(r)})),e.sort()}function Oa(e){if(e instanceof Er)return e.clone();var t=new Sr(e.__wrapped__,e.__chain__);return t.__actions__=ns(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function Da(e,t,r){t=(r?oa(e,t,r):t===o)?1:Ut(Wc(t),0);var i=null==e?0:e.length;if(!i||t<1)return[];var s=0,a=0,l=n(Dt(i/t));while(s<i)l[a++]=Mo(e,s,s+=t);return l}function Ia(e){var t=-1,n=null==e?0:e.length,r=0,i=[];while(++t<n){var o=e[t];o&&(i[r++]=o)}return i}function ka(){var e=arguments.length;if(!e)return[];var t=n(e-1),r=arguments[0],i=e;while(i--)t[i-1]=arguments[i];return Cn(sc(r)?ns(r):[r],Mi(t,1))}var Na=xo((function(e,t){return uc(e)?xi(e,Mi(t,1,uc,!0)):[]})),Fa=xo((function(e,t){var n=rl(t);return uc(n)&&(n=o),uc(e)?xi(e,Mi(t,1,uc,!0),Bs(n,2)):[]})),Va=xo((function(e,t){var n=rl(t);return uc(n)&&(n=o),uc(e)?xi(e,Mi(t,1,uc,!0),o,n):[]}));function za(e,t,n){var r=null==e?0:e.length;return r?(t=n||t===o?1:Wc(t),Mo(e,t<0?0:t,r)):[]}function Ua(e,t,n){var r=null==e?0:e.length;return r?(t=n||t===o?1:Wc(t),t=r-t,Mo(e,0,t<0?0:t)):[]}function ja(e,t){return e&&e.length?No(e,Bs(t,3),!0,!0):[]}function Ba(e,t){return e&&e.length?No(e,Bs(t,3),!0):[]}function Ha(e,t,n,r){var i=null==e?0:e.length;return i?(n&&"number"!=typeof n&&oa(e,t,n)&&(n=0,r=i),Si(e,t,n,r)):[]}function Ga(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:Wc(n);return i<0&&(i=Ut(r+i,0)),Nn(e,Bs(t,3),i)}function qa(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r-1;return n!==o&&(i=Wc(n),i=n<0?Ut(r+i,0):jt(i,r-1)),Nn(e,Bs(t,3),i,!0)}function Wa(e){var t=null==e?0:e.length;return t?Mi(e,1):[]}function $a(e){var t=null==e?0:e.length;return t?Mi(e,k):[]}function Xa(e,t){var n=null==e?0:e.length;return n?(t=t===o?1:Wc(t),Mi(e,t)):[]}function Ya(e){var t=-1,n=null==e?0:e.length,r={};while(++t<n){var i=e[t];r[i[0]]=i[1]}return r}function Za(e){return e&&e.length?e[0]:o}function Ja(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:Wc(n);return i<0&&(i=Ut(r+i,0)),Fn(e,t,i)}function Qa(e){var t=null==e?0:e.length;return t?Mo(e,0,-1):[]}var Ka=xo((function(e){var t=Tn(e,Uo);return t.length&&t[0]===e[0]?zi(t):[]})),el=xo((function(e){var t=rl(e),n=Tn(e,Uo);return t===rl(n)?t=o:n.pop(),n.length&&n[0]===e[0]?zi(n,Bs(t,2)):[]})),tl=xo((function(e){var t=rl(e),n=Tn(e,Uo);return t="function"==typeof t?t:o,t&&n.pop(),n.length&&n[0]===e[0]?zi(n,o,t):[]}));function nl(e,t){return null==e?"":Vt.call(e,t)}function rl(e){var t=null==e?0:e.length;return t?e[t-1]:o}function il(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r;return n!==o&&(i=Wc(n),i=i<0?Ut(r+i,0):jt(i,r-1)),t===t?pr(e,t,i):Nn(e,zn,i,!0)}function ol(e,t){return e&&e.length?lo(e,Wc(t)):o}var sl=xo(al);function al(e,t){return e&&e.length&&t&&t.length?fo(e,t):e}function ll(e,t,n){return e&&e.length&&t&&t.length?fo(e,t,Bs(n,2)):e}function ul(e,t,n){return e&&e.length&&t&&t.length?fo(e,t,o,n):e}var cl=Ns((function(e,t){var n=null==e?0:e.length,r=pi(e,t);return mo(e,Tn(t,(function(e){return ia(e,n)?+e:e})).sort(Qo)),r}));function hl(e,t){var n=[];if(!e||!e.length)return n;var r=-1,i=[],o=e.length;t=Bs(t,3);while(++r<o){var s=e[r];t(s,r,e)&&(n.push(s),i.push(r))}return mo(e,i),n}function dl(e){return null==e?e:$t.call(e)}function pl(e,t,n){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&oa(e,t,n)?(t=0,n=r):(t=null==t?0:Wc(t),n=n===o?r:Wc(n)),Mo(e,t,n)):[]}function fl(e,t){return Co(e,t)}function ml(e,t,n){return Po(e,t,Bs(n,2))}function gl(e,t){var n=null==e?0:e.length;if(n){var r=Co(e,t);if(r<n&&nc(e[r],t))return r}return-1}function vl(e,t){return Co(e,t,!0)}function yl(e,t,n){return Po(e,t,Bs(n,2),!0)}function xl(e,t){var n=null==e?0:e.length;if(n){var r=Co(e,t,!0)-1;if(nc(e[r],t))return r}return-1}function bl(e){return e&&e.length?Ro(e):[]}function wl(e,t){return e&&e.length?Ro(e,Bs(t,2)):[]}function _l(e){var t=null==e?0:e.length;return t?Mo(e,1,t):[]}function Al(e,t,n){return e&&e.length?(t=n||t===o?1:Wc(t),Mo(e,0,t<0?0:t)):[]}function Sl(e,t,n){var r=null==e?0:e.length;return r?(t=n||t===o?1:Wc(t),t=r-t,Mo(e,t<0?0:t,r)):[]}function El(e,t){return e&&e.length?No(e,Bs(t,3),!1,!0):[]}function Ml(e,t){return e&&e.length?No(e,Bs(t,3)):[]}var Tl=xo((function(e){return Do(Mi(e,1,uc,!0))})),Cl=xo((function(e){var t=rl(e);return uc(t)&&(t=o),Do(Mi(e,1,uc,!0),Bs(t,2))})),Pl=xo((function(e){var t=rl(e);return t="function"==typeof t?t:o,Do(Mi(e,1,uc,!0),o,t)}));function Rl(e){return e&&e.length?Do(e):[]}function Ll(e,t){return e&&e.length?Do(e,Bs(t,2)):[]}function Ol(e,t){return t="function"==typeof t?t:o,e&&e.length?Do(e,o,t):[]}function Dl(e){if(!e||!e.length)return[];var t=0;return e=Sn(e,(function(e){if(uc(e))return t=Ut(e.length,t),!0})),Wn(t,(function(t){return Tn(e,jn(t))}))}function Il(e,t){if(!e||!e.length)return[];var n=Dl(e);return null==t?n:Tn(n,(function(e){return xn(t,o,e)}))}var kl=xo((function(e,t){return uc(e)?xi(e,t):[]})),Nl=xo((function(e){return Vo(Sn(e,uc))})),Fl=xo((function(e){var t=rl(e);return uc(t)&&(t=o),Vo(Sn(e,uc),Bs(t,2))})),Vl=xo((function(e){var t=rl(e);return t="function"==typeof t?t:o,Vo(Sn(e,uc),o,t)})),zl=xo(Dl);function Ul(e,t){return zo(e||[],t||[],ai)}function jl(e,t){return zo(e||[],t||[],_o)}var Bl=xo((function(e){var t=e.length,n=t>1?e[t-1]:o;return n="function"==typeof n?(e.pop(),n):o,Il(e,n)}));function Hl(e){var t=br(e);return t.__chain__=!0,t}function Gl(e,t){return t(e),e}function ql(e,t){return t(e)}var Wl=Ns((function(e){var t=e.length,n=t?e[0]:0,r=this.__wrapped__,i=function(t){return pi(t,e)};return!(t>1||this.__actions__.length)&&r instanceof Er&&ia(n)?(r=r.slice(n,+n+(t?1:0)),r.__actions__.push({func:ql,args:[i],thisArg:o}),new Sr(r,this.__chain__).thru((function(e){return t&&!e.length&&e.push(o),e}))):this.thru(i)}));function $l(){return Hl(this)}function Xl(){return new Sr(this.value(),this.__chain__)}function Yl(){this.__values__===o&&(this.__values__=Gc(this.value()));var e=this.__index__>=this.__values__.length,t=e?o:this.__values__[this.__index__++];return{done:e,value:t}}function Zl(){return this}function Jl(e){var t,n=this;while(n instanceof Ar){var r=Oa(n);r.__index__=0,r.__values__=o,t?i.__wrapped__=r:t=r;var i=r;n=n.__wrapped__}return i.__wrapped__=e,t}function Ql(){var e=this.__wrapped__;if(e instanceof Er){var t=e;return this.__actions__.length&&(t=new Er(this)),t=t.reverse(),t.__actions__.push({func:ql,args:[dl],thisArg:o}),new Sr(t,this.__chain__)}return this.thru(dl)}function Kl(){return Fo(this.__wrapped__,this.__actions__)}var eu=ss((function(e,t,n){ht.call(e,n)?++e[n]:di(e,n,1)}));function tu(e,t,n){var r=sc(e)?An:_i;return n&&oa(e,t,n)&&(t=o),r(e,Bs(t,3))}function nu(e,t){var n=sc(e)?Sn:Ei;return n(e,Bs(t,3))}var ru=ms(Ga),iu=ms(qa);function ou(e,t){return Mi(fu(e,t),1)}function su(e,t){return Mi(fu(e,t),k)}function au(e,t,n){return n=n===o?1:Wc(n),Mi(fu(e,t),n)}function lu(e,t){var n=sc(e)?wn:bi;return n(e,Bs(t,3))}function uu(e,t){var n=sc(e)?_n:wi;return n(e,Bs(t,3))}var cu=ss((function(e,t,n){ht.call(e,n)?e[n].push(t):di(e,n,[t])}));function hu(e,t,n,r){e=lc(e)?e:zh(e),n=n&&!r?Wc(n):0;var i=e.length;return n<0&&(n=Ut(i+n,0)),Nc(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&Fn(e,t,n)>-1}var du=xo((function(e,t,r){var i=-1,o="function"==typeof t,s=lc(e)?n(e.length):[];return bi(e,(function(e){s[++i]=o?xn(t,e,r):ji(e,t,r)})),s})),pu=ss((function(e,t,n){di(e,n,t)}));function fu(e,t){var n=sc(e)?Tn:ro;return n(e,Bs(t,3))}function mu(e,t,n,r){return null==e?[]:(sc(t)||(t=null==t?[]:[t]),n=r?o:n,sc(n)||(n=null==n?[]:[n]),uo(e,t,n))}var gu=ss((function(e,t,n){e[n?0:1].push(t)}),(function(){return[[],[]]}));function vu(e,t,n){var r=sc(e)?Pn:Hn,i=arguments.length<3;return r(e,Bs(t,4),n,i,bi)}function yu(e,t,n){var r=sc(e)?Rn:Hn,i=arguments.length<3;return r(e,Bs(t,4),n,i,wi)}function xu(e,t){var n=sc(e)?Sn:Ei;return n(e,zu(Bs(t,3)))}function bu(e){var t=sc(e)?ri:bo;return t(e)}function wu(e,t,n){t=(n?oa(e,t,n):t===o)?1:Wc(t);var r=sc(e)?ii:wo;return r(e,t)}function _u(e){var t=sc(e)?oi:Eo;return t(e)}function Au(e){if(null==e)return 0;if(lc(e))return Nc(e)?fr(e):e.length;var t=Ys(e);return t==Q||t==oe?e.size:eo(e).length}function Su(e,t,n){var r=sc(e)?Ln:To;return n&&oa(e,t,n)&&(t=o),r(e,Bs(t,3))}var Eu=xo((function(e,t){if(null==e)return[];var n=t.length;return n>1&&oa(e,t[0],t[1])?t=[]:n>2&&oa(t[0],t[1],t[2])&&(t=[t[0]]),uo(e,Mi(t,1),[])})),Mu=Lt||function(){return an.Date.now()};function Tu(e,t){if("function"!=typeof t)throw new ot(u);return e=Wc(e),function(){if(--e<1)return t.apply(this,arguments)}}function Cu(e,t,n){return t=n?o:t,t=e&&null==t?e.length:t,Ps(e,E,o,o,o,o,t)}function Pu(e,t){var n;if("function"!=typeof t)throw new ot(u);return e=Wc(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=o),n}}var Ru=xo((function(e,t,n){var r=y;if(n.length){var i=ur(n,js(Ru));r|=A}return Ps(e,r,t,n,i)})),Lu=xo((function(e,t,n){var r=y|x;if(n.length){var i=ur(n,js(Lu));r|=A}return Ps(t,r,e,n,i)}));function Ou(e,t,n){t=n?o:t;var r=Ps(e,w,o,o,o,o,o,t);return r.placeholder=Ou.placeholder,r}function Du(e,t,n){t=n?o:t;var r=Ps(e,_,o,o,o,o,o,t);return r.placeholder=Du.placeholder,r}function Iu(e,t,n){var r,i,s,a,l,c,h=0,d=!1,p=!1,f=!0;if("function"!=typeof e)throw new ot(u);function m(t){var n=r,s=i;return r=i=o,h=t,a=e.apply(s,n),a}function g(e){return h=e,l=Aa(x,t),d?m(e):a}function v(e){var n=e-c,r=e-h,i=t-n;return p?jt(i,s-r):i}function y(e){var n=e-c,r=e-h;return c===o||n>=t||n<0||p&&r>=s}function x(){var e=Mu();if(y(e))return b(e);l=Aa(x,v(e))}function b(e){return l=o,f&&r?m(e):(r=i=o,a)}function w(){l!==o&&qo(l),h=0,r=c=i=l=o}function _(){return l===o?a:b(Mu())}function A(){var e=Mu(),n=y(e);if(r=arguments,i=this,c=e,n){if(l===o)return g(c);if(p)return qo(l),l=Aa(x,t),m(c)}return l===o&&(l=Aa(x,t)),a}return t=Xc(t)||0,_c(n)&&(d=!!n.leading,p="maxWait"in n,s=p?Ut(Xc(n.maxWait)||0,t):s,f="trailing"in n?!!n.trailing:f),A.cancel=w,A.flush=_,A}var ku=xo((function(e,t){return yi(e,1,t)})),Nu=xo((function(e,t,n){return yi(e,Xc(t)||0,n)}));function Fu(e){return Ps(e,T)}function Vu(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new ot(u);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var s=e.apply(this,r);return n.cache=o.set(i,s)||o,s};return n.cache=new(Vu.Cache||jr),n}function zu(e){if("function"!=typeof e)throw new ot(u);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function Uu(e){return Pu(2,e)}Vu.Cache=jr;var ju=Ho((function(e,t){t=1==t.length&&sc(t[0])?Tn(t[0],Xn(Bs())):Tn(Mi(t,1),Xn(Bs()));var n=t.length;return xo((function(r){var i=-1,o=jt(r.length,n);while(++i<o)r[i]=t[i].call(this,r[i]);return xn(e,this,r)}))})),Bu=xo((function(e,t){var n=ur(t,js(Bu));return Ps(e,A,o,t,n)})),Hu=xo((function(e,t){var n=ur(t,js(Hu));return Ps(e,S,o,t,n)})),Gu=Ns((function(e,t){return Ps(e,M,o,o,o,t)}));function qu(e,t){if("function"!=typeof e)throw new ot(u);return t=t===o?t:Wc(t),xo(e,t)}function Wu(e,t){if("function"!=typeof e)throw new ot(u);return t=null==t?0:Ut(Wc(t),0),xo((function(n){var r=n[t],i=Go(n,0,t);return r&&Cn(i,r),xn(e,this,i)}))}function $u(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new ot(u);return _c(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),Iu(e,t,{leading:r,maxWait:t,trailing:i})}function Xu(e){return Cu(e,1)}function Yu(e,t){return Bu(jo(t),e)}function Zu(){if(!arguments.length)return[];var e=arguments[0];return sc(e)?e:[e]}function Ju(e){return mi(e,m)}function Qu(e,t){return t="function"==typeof t?t:o,mi(e,m,t)}function Ku(e){return mi(e,p|m)}function ec(e,t){return t="function"==typeof t?t:o,mi(e,p|m,t)}function tc(e,t){return null==t||vi(e,t,bh(t))}function nc(e,t){return e===t||e!==e&&t!==t}var rc=Ss(ki),ic=Ss((function(e,t){return e>=t})),oc=Bi(function(){return arguments}())?Bi:function(e){return Ac(e)&&ht.call(e,"callee")&&!St.call(e,"callee")},sc=n.isArray,ac=pn?Xn(pn):Hi;function lc(e){return null!=e&&wc(e.length)&&!xc(e)}function uc(e){return Ac(e)&&lc(e)}function cc(e){return!0===e||!1===e||Ac(e)&&Ii(e)==W}var hc=Nt||Wd,dc=fn?Xn(fn):Gi;function pc(e){return Ac(e)&&1===e.nodeType&&!Oc(e)}function fc(e){if(null==e)return!0;if(lc(e)&&(sc(e)||"string"==typeof e||"function"==typeof e.splice||hc(e)||Vc(e)||oc(e)))return!e.length;var t=Ys(e);if(t==Q||t==oe)return!e.size;if(ha(e))return!eo(e).length;for(var n in e)if(ht.call(e,n))return!1;return!0}function mc(e,t){return qi(e,t)}function gc(e,t,n){n="function"==typeof n?n:o;var r=n?n(e,t):o;return r===o?qi(e,t,o,n):!!r}function vc(e){if(!Ac(e))return!1;var t=Ii(e);return t==Y||t==X||"string"==typeof e.message&&"string"==typeof e.name&&!Oc(e)}function yc(e){return"number"==typeof e&&Ft(e)}function xc(e){if(!_c(e))return!1;var t=Ii(e);return t==Z||t==J||t==q||t==re}function bc(e){return"number"==typeof e&&e==Wc(e)}function wc(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=N}function _c(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Ac(e){return null!=e&&"object"==typeof e}var Sc=mn?Xn(mn):$i;function Ec(e,t){return e===t||Xi(e,t,Gs(t))}function Mc(e,t,n){return n="function"==typeof n?n:o,Xi(e,t,Gs(t),n)}function Tc(e){return Lc(e)&&e!=+e}function Cc(e){if(ca(e))throw new i(l);return Yi(e)}function Pc(e){return null===e}function Rc(e){return null==e}function Lc(e){return"number"==typeof e||Ac(e)&&Ii(e)==K}function Oc(e){if(!Ac(e)||Ii(e)!=te)return!1;var t=_t(e);if(null===t)return!0;var n=ht.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&ct.call(n)==mt}var Dc=gn?Xn(gn):Zi;function Ic(e){return bc(e)&&e>=-N&&e<=N}var kc=vn?Xn(vn):Ji;function Nc(e){return"string"==typeof e||!sc(e)&&Ac(e)&&Ii(e)==se}function Fc(e){return"symbol"==typeof e||Ac(e)&&Ii(e)==ae}var Vc=yn?Xn(yn):Qi;function zc(e){return e===o}function Uc(e){return Ac(e)&&Ys(e)==ue}function jc(e){return Ac(e)&&Ii(e)==ce}var Bc=Ss(no),Hc=Ss((function(e,t){return e<=t}));function Gc(e){if(!e)return[];if(lc(e))return Nc(e)?mr(e):ns(e);if(Tt&&e[Tt])return sr(e[Tt]());var t=Ys(e),n=t==Q?ar:t==oe?cr:zh;return n(e)}function qc(e){if(!e)return 0===e?e:0;if(e=Xc(e),e===k||e===-k){var t=e<0?-1:1;return t*F}return e===e?e:0}function Wc(e){var t=qc(e),n=t%1;return t===t?n?t-n:t:0}function $c(e){return e?fi(Wc(e),0,z):0}function Xc(e){if("number"==typeof e)return e;if(Fc(e))return V;if(_c(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=_c(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(Fe,"");var n=Xe.test(e);return n||Ze.test(e)?rn(e.slice(2),n?2:8):$e.test(e)?V:+e}function Yc(e){return rs(e,wh(e))}function Zc(e){return e?fi(Wc(e),-N,N):0===e?e:0}function Jc(e){return null==e?"":Oo(e)}var Qc=as((function(e,t){if(ha(t)||lc(t))rs(t,bh(t),e);else for(var n in t)ht.call(t,n)&&ai(e,n,t[n])})),Kc=as((function(e,t){rs(t,wh(t),e)})),eh=as((function(e,t,n,r){rs(t,wh(t),e,r)})),th=as((function(e,t,n,r){rs(t,bh(t),e,r)})),nh=Ns(pi);function rh(e,t){var n=_r(e);return null==t?n:ci(n,t)}var ih=xo((function(e,t){e=nt(e);var n=-1,r=t.length,i=r>2?t[2]:o;i&&oa(t[0],t[1],i)&&(r=1);while(++n<r){var s=t[n],a=wh(s),l=-1,u=a.length;while(++l<u){var c=a[l],h=e[c];(h===o||nc(h,lt[c])&&!ht.call(e,c))&&(e[c]=s[c])}}return e})),oh=xo((function(e){return e.push(o,Ls),xn(Eh,o,e)}));function sh(e,t){return kn(e,Bs(t,3),Pi)}function ah(e,t){return kn(e,Bs(t,3),Ri)}function lh(e,t){return null==e?e:Ti(e,Bs(t,3),wh)}function uh(e,t){return null==e?e:Ci(e,Bs(t,3),wh)}function ch(e,t){return e&&Pi(e,Bs(t,3))}function hh(e,t){return e&&Ri(e,Bs(t,3))}function dh(e){return null==e?[]:Li(e,bh(e))}function ph(e){return null==e?[]:Li(e,wh(e))}function fh(e,t,n){var r=null==e?o:Oi(e,t);return r===o?n:r}function mh(e,t){return null!=e&&Qs(e,t,Ni)}function gh(e,t){return null!=e&&Qs(e,t,Fi)}var vh=ys((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=ft.call(t)),e[t]=n}),Sd(Cd)),yh=ys((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=ft.call(t)),ht.call(e,t)?e[t].push(n):e[t]=[n]}),Bs),xh=xo(ji);function bh(e){return lc(e)?ni(e):eo(e)}function wh(e){return lc(e)?ni(e,!0):to(e)}function _h(e,t){var n={};return t=Bs(t,3),Pi(e,(function(e,r,i){di(n,t(e,r,i),e)})),n}function Ah(e,t){var n={};return t=Bs(t,3),Pi(e,(function(e,r,i){di(n,r,t(e,r,i))})),n}var Sh=as((function(e,t,n){so(e,t,n)})),Eh=as((function(e,t,n,r){so(e,t,n,r)})),Mh=Ns((function(e,t){var n={};if(null==e)return n;var r=!1;t=Tn(t,(function(t){return t=Bo(t,e),r||(r=t.length>1),t})),rs(e,Vs(e),n),r&&(n=mi(n,p|f|m,Os));var i=t.length;while(i--)Io(n,t[i]);return n}));function Th(e,t){return Ph(e,zu(Bs(t)))}var Ch=Ns((function(e,t){return null==e?{}:co(e,t)}));function Ph(e,t){if(null==e)return{};var n=Tn(Vs(e),(function(e){return[e]}));return t=Bs(t),ho(e,n,(function(e,n){return t(e,n[0])}))}function Rh(e,t,n){t=Bo(t,e);var r=-1,i=t.length;i||(i=1,e=o);while(++r<i){var s=null==e?o:e[Pa(t[r])];s===o&&(r=i,s=n),e=xc(s)?s.call(e):s}return e}function Lh(e,t,n){return null==e?e:_o(e,t,n)}function Oh(e,t,n,r){return r="function"==typeof r?r:o,null==e?e:_o(e,t,n,r)}var Dh=Cs(bh),Ih=Cs(wh);function kh(e,t,n){var r=sc(e),i=r||hc(e)||Vc(e);if(t=Bs(t,4),null==n){var o=e&&e.constructor;n=i?r?new o:[]:_c(e)&&xc(o)?_r(_t(e)):{}}return(i?wn:Pi)(e,(function(e,r,i){return t(n,e,r,i)})),n}function Nh(e,t){return null==e||Io(e,t)}function Fh(e,t,n){return null==e?e:ko(e,t,jo(n))}function Vh(e,t,n,r){return r="function"==typeof r?r:o,null==e?e:ko(e,t,jo(n),r)}function zh(e){return null==e?[]:Yn(e,bh(e))}function Uh(e){return null==e?[]:Yn(e,wh(e))}function jh(e,t,n){return n===o&&(n=t,t=o),n!==o&&(n=Xc(n),n=n===n?n:0),t!==o&&(t=Xc(t),t=t===t?t:0),fi(Xc(e),t,n)}function Bh(e,t,n){return t=qc(t),n===o?(n=t,t=0):n=qc(n),e=Xc(e),Vi(e,t,n)}function Hh(e,t,n){if(n&&"boolean"!=typeof n&&oa(e,t,n)&&(t=n=o),n===o&&("boolean"==typeof t?(n=t,t=o):"boolean"==typeof e&&(n=e,e=o)),e===o&&t===o?(e=0,t=1):(e=qc(e),t===o?(t=e,e=0):t=qc(t)),e>t){var r=e;e=t,t=r}if(n||e%1||t%1){var i=Wt();return jt(e+i*(t-e+nn("1e-"+((i+"").length-1))),t)}return go(e,t)}var Gh=ds((function(e,t,n){return t=t.toLowerCase(),e+(n?qh(t):t)}));function qh(e){return yd(Jc(e).toLowerCase())}function Wh(e){return e=Jc(e),e&&e.replace(Qe,er).replace(Ht,"")}function $h(e,t,n){e=Jc(e),t=Oo(t);var r=e.length;n=n===o?r:fi(Wc(n),0,r);var i=n;return n-=t.length,n>=0&&e.slice(n,i)==t}function Xh(e){return e=Jc(e),e&&Ce.test(e)?e.replace(Me,tr):e}function Yh(e){return e=Jc(e),e&&Ne.test(e)?e.replace(ke,"\\$&"):e}var Zh=ds((function(e,t,n){return e+(n?"-":"")+t.toLowerCase()})),Jh=ds((function(e,t,n){return e+(n?" ":"")+t.toLowerCase()})),Qh=hs("toLowerCase");function Kh(e,t,n){e=Jc(e),t=Wc(t);var r=t?fr(e):0;if(!t||r>=t)return e;var i=(t-r)/2;return ws(It(i),n)+e+ws(Dt(i),n)}function ed(e,t,n){e=Jc(e),t=Wc(t);var r=t?fr(e):0;return t&&r<t?e+ws(t-r,n):e}function td(e,t,n){e=Jc(e),t=Wc(t);var r=t?fr(e):0;return t&&r<t?ws(t-r,n)+e:e}function nd(e,t,n){return n||null==t?t=0:t&&(t=+t),qt(Jc(e).replace(Ve,""),t||0)}function rd(e,t,n){return t=(n?oa(e,t,n):t===o)?1:Wc(t),yo(Jc(e),t)}function id(){var e=arguments,t=Jc(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var od=ds((function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}));function sd(e,t,n){return n&&"number"!=typeof n&&oa(e,t,n)&&(t=n=o),n=n===o?z:n>>>0,n?(e=Jc(e),e&&("string"==typeof t||null!=t&&!Dc(t))&&(t=Oo(t),!t&&ir(e))?Go(mr(e),0,n):e.split(t,n)):[]}var ad=ds((function(e,t,n){return e+(n?" ":"")+yd(t)}));function ld(e,t,n){return e=Jc(e),n=null==n?0:fi(Wc(n),0,e.length),t=Oo(t),e.slice(n,n+t.length)==t}function ud(e,t,n){var r=br.templateSettings;n&&oa(e,t,n)&&(t=o),e=Jc(e),t=eh({},t,r,Rs);var i,s,a=eh({},t.imports,r.imports,Rs),l=bh(a),u=Yn(a,l),c=0,h=t.interpolate||Ke,d="__p += '",p=rt((t.escape||Ke).source+"|"+h.source+"|"+(h===Le?qe:Ke).source+"|"+(t.evaluate||Ke).source+"|$","g"),f="//# sourceURL="+(ht.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Yt+"]")+"\n";e.replace(p,(function(t,n,r,o,a,l){return r||(r=o),d+=e.slice(c,l).replace(et,nr),n&&(i=!0,d+="' +\n__e("+n+") +\n'"),a&&(s=!0,d+="';\n"+a+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),c=l+t.length,t})),d+="';\n";var m=ht.call(t,"variable")&&t.variable;m||(d="with (obj) {\n"+d+"\n}\n"),d=(s?d.replace(_e,""):d).replace(Ae,"$1").replace(Se,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=bd((function(){return He(l,f+"return "+d).apply(o,u)}));if(g.source=d,vc(g))throw g;return g}function cd(e){return Jc(e).toLowerCase()}function hd(e){return Jc(e).toUpperCase()}function dd(e,t,n){if(e=Jc(e),e&&(n||t===o))return e.replace(Fe,"");if(!e||!(t=Oo(t)))return e;var r=mr(e),i=mr(t),s=Jn(r,i),a=Qn(r,i)+1;return Go(r,s,a).join("")}function pd(e,t,n){if(e=Jc(e),e&&(n||t===o))return e.replace(ze,"");if(!e||!(t=Oo(t)))return e;var r=mr(e),i=Qn(r,mr(t))+1;return Go(r,0,i).join("")}function fd(e,t,n){if(e=Jc(e),e&&(n||t===o))return e.replace(Ve,"");if(!e||!(t=Oo(t)))return e;var r=mr(e),i=Jn(r,mr(t));return Go(r,i).join("")}function md(e,t){var n=C,r=P;if(_c(t)){var i="separator"in t?t.separator:i;n="length"in t?Wc(t.length):n,r="omission"in t?Oo(t.omission):r}e=Jc(e);var s=e.length;if(ir(e)){var a=mr(e);s=a.length}if(n>=s)return e;var l=n-fr(r);if(l<1)return r;var u=a?Go(a,0,l).join(""):e.slice(0,l);if(i===o)return u+r;if(a&&(l+=u.length-l),Dc(i)){if(e.slice(l).search(i)){var c,h=u;i.global||(i=rt(i.source,Jc(We.exec(i))+"g")),i.lastIndex=0;while(c=i.exec(h))var d=c.index;u=u.slice(0,d===o?l:d)}}else if(e.indexOf(Oo(i),l)!=l){var p=u.lastIndexOf(i);p>-1&&(u=u.slice(0,p))}return u+r}function gd(e){return e=Jc(e),e&&Te.test(e)?e.replace(Ee,gr):e}var vd=ds((function(e,t,n){return e+(n?" ":"")+t.toUpperCase()})),yd=hs("toUpperCase");function xd(e,t,n){return e=Jc(e),t=n?o:t,t===o?or(e)?xr(e):In(e):e.match(t)||[]}var bd=xo((function(e,t){try{return xn(e,o,t)}catch(n){return vc(n)?n:new i(n)}})),wd=Ns((function(e,t){return wn(t,(function(t){t=Pa(t),di(e,t,Ru(e[t],e))})),e}));function _d(e){var t=null==e?0:e.length,n=Bs();return e=t?Tn(e,(function(e){if("function"!=typeof e[1])throw new ot(u);return[n(e[0]),e[1]]})):[],xo((function(n){var r=-1;while(++r<t){var i=e[r];if(xn(i[0],this,n))return xn(i[1],this,n)}}))}function Ad(e){return gi(mi(e,p))}function Sd(e){return function(){return e}}function Ed(e,t){return null==e||e!==e?t:e}var Md=gs(),Td=gs(!0);function Cd(e){return e}function Pd(e){return Ki("function"==typeof e?e:mi(e,p))}function Rd(e){return io(mi(e,p))}function Ld(e,t){return oo(e,mi(t,p))}var Od=xo((function(e,t){return function(n){return ji(n,e,t)}})),Dd=xo((function(e,t){return function(n){return ji(e,n,t)}}));function Id(e,t,n){var r=bh(t),i=Li(t,r);null!=n||_c(t)&&(i.length||!r.length)||(n=t,t=e,e=this,i=Li(t,bh(t)));var o=!(_c(n)&&"chain"in n)||!!n.chain,s=xc(e);return wn(i,(function(n){var r=t[n];e[n]=r,s&&(e.prototype[n]=function(){var t=this.__chain__;if(o||t){var n=e(this.__wrapped__),i=n.__actions__=ns(this.__actions__);return i.push({func:r,args:arguments,thisArg:e}),n.__chain__=t,n}return r.apply(e,Cn([this.value()],arguments))})})),e}function kd(){return an._===this&&(an._=gt),this}function Nd(){}function Fd(e){return e=Wc(e),xo((function(t){return lo(t,e)}))}var Vd=bs(Tn),zd=bs(An),Ud=bs(Ln);function jd(e){return sa(e)?jn(Pa(e)):po(e)}function Bd(e){return function(t){return null==e?o:Oi(e,t)}}var Hd=As(),Gd=As(!0);function qd(){return[]}function Wd(){return!1}function $d(){return{}}function Xd(){return""}function Yd(){return!0}function Zd(e,t){if(e=Wc(e),e<1||e>N)return[];var n=z,r=jt(e,z);t=Bs(t),e-=z;var i=Wn(r,t);while(++n<e)t(n);return i}function Jd(e){return sc(e)?Tn(e,Pa):Fc(e)?[e]:ns(Ca(Jc(e)))}function Qd(e){var t=++dt;return Jc(e)+t}var Kd=xs((function(e,t){return e+t}),0),ep=Ms("ceil"),tp=xs((function(e,t){return e/t}),1),np=Ms("floor");function rp(e){return e&&e.length?Ai(e,Cd,ki):o}function ip(e,t){return e&&e.length?Ai(e,Bs(t,2),ki):o}function op(e){return Un(e,Cd)}function sp(e,t){return Un(e,Bs(t,2))}function ap(e){return e&&e.length?Ai(e,Cd,no):o}function lp(e,t){return e&&e.length?Ai(e,Bs(t,2),no):o}var up=xs((function(e,t){return e*t}),1),cp=Ms("round"),hp=xs((function(e,t){return e-t}),0);function dp(e){return e&&e.length?qn(e,Cd):0}function pp(e,t){return e&&e.length?qn(e,Bs(t,2)):0}return br.after=Tu,br.ary=Cu,br.assign=Qc,br.assignIn=Kc,br.assignInWith=eh,br.assignWith=th,br.at=nh,br.before=Pu,br.bind=Ru,br.bindAll=wd,br.bindKey=Lu,br.castArray=Zu,br.chain=Hl,br.chunk=Da,br.compact=Ia,br.concat=ka,br.cond=_d,br.conforms=Ad,br.constant=Sd,br.countBy=eu,br.create=rh,br.curry=Ou,br.curryRight=Du,br.debounce=Iu,br.defaults=ih,br.defaultsDeep=oh,br.defer=ku,br.delay=Nu,br.difference=Na,br.differenceBy=Fa,br.differenceWith=Va,br.drop=za,br.dropRight=Ua,br.dropRightWhile=ja,br.dropWhile=Ba,br.fill=Ha,br.filter=nu,br.flatMap=ou,br.flatMapDeep=su,br.flatMapDepth=au,br.flatten=Wa,br.flattenDeep=$a,br.flattenDepth=Xa,br.flip=Fu,br.flow=Md,br.flowRight=Td,br.fromPairs=Ya,br.functions=dh,br.functionsIn=ph,br.groupBy=cu,br.initial=Qa,br.intersection=Ka,br.intersectionBy=el,br.intersectionWith=tl,br.invert=vh,br.invertBy=yh,br.invokeMap=du,br.iteratee=Pd,br.keyBy=pu,br.keys=bh,br.keysIn=wh,br.map=fu,br.mapKeys=_h,br.mapValues=Ah,br.matches=Rd,br.matchesProperty=Ld,br.memoize=Vu,br.merge=Sh,br.mergeWith=Eh,br.method=Od,br.methodOf=Dd,br.mixin=Id,br.negate=zu,br.nthArg=Fd,br.omit=Mh,br.omitBy=Th,br.once=Uu,br.orderBy=mu,br.over=Vd,br.overArgs=ju,br.overEvery=zd,br.overSome=Ud,br.partial=Bu,br.partialRight=Hu,br.partition=gu,br.pick=Ch,br.pickBy=Ph,br.property=jd,br.propertyOf=Bd,br.pull=sl,br.pullAll=al,br.pullAllBy=ll,br.pullAllWith=ul,br.pullAt=cl,br.range=Hd,br.rangeRight=Gd,br.rearg=Gu,br.reject=xu,br.remove=hl,br.rest=qu,br.reverse=dl,br.sampleSize=wu,br.set=Lh,br.setWith=Oh,br.shuffle=_u,br.slice=pl,br.sortBy=Eu,br.sortedUniq=bl,br.sortedUniqBy=wl,br.split=sd,br.spread=Wu,br.tail=_l,br.take=Al,br.takeRight=Sl,br.takeRightWhile=El,br.takeWhile=Ml,br.tap=Gl,br.throttle=$u,br.thru=ql,br.toArray=Gc,br.toPairs=Dh,br.toPairsIn=Ih,br.toPath=Jd,br.toPlainObject=Yc,br.transform=kh,br.unary=Xu,br.union=Tl,br.unionBy=Cl,br.unionWith=Pl,br.uniq=Rl,br.uniqBy=Ll,br.uniqWith=Ol,br.unset=Nh,br.unzip=Dl,br.unzipWith=Il,br.update=Fh,br.updateWith=Vh,br.values=zh,br.valuesIn=Uh,br.without=kl,br.words=xd,br.wrap=Yu,br.xor=Nl,br.xorBy=Fl,br.xorWith=Vl,br.zip=zl,br.zipObject=Ul,br.zipObjectDeep=jl,br.zipWith=Bl,br.entries=Dh,br.entriesIn=Ih,br.extend=Kc,br.extendWith=eh,Id(br,br),br.add=Kd,br.attempt=bd,br.camelCase=Gh,br.capitalize=qh,br.ceil=ep,br.clamp=jh,br.clone=Ju,br.cloneDeep=Ku,br.cloneDeepWith=ec,br.cloneWith=Qu,br.conformsTo=tc,br.deburr=Wh,br.defaultTo=Ed,br.divide=tp,br.endsWith=$h,br.eq=nc,br.escape=Xh,br.escapeRegExp=Yh,br.every=tu,br.find=ru,br.findIndex=Ga,br.findKey=sh,br.findLast=iu,br.findLastIndex=qa,br.findLastKey=ah,br.floor=np,br.forEach=lu,br.forEachRight=uu,br.forIn=lh,br.forInRight=uh,br.forOwn=ch,br.forOwnRight=hh,br.get=fh,br.gt=rc,br.gte=ic,br.has=mh,br.hasIn=gh,br.head=Za,br.identity=Cd,br.includes=hu,br.indexOf=Ja,br.inRange=Bh,br.invoke=xh,br.isArguments=oc,br.isArray=sc,br.isArrayBuffer=ac,br.isArrayLike=lc,br.isArrayLikeObject=uc,br.isBoolean=cc,br.isBuffer=hc,br.isDate=dc,br.isElement=pc,br.isEmpty=fc,br.isEqual=mc,br.isEqualWith=gc,br.isError=vc,br.isFinite=yc,br.isFunction=xc,br.isInteger=bc,br.isLength=wc,br.isMap=Sc,br.isMatch=Ec,br.isMatchWith=Mc,br.isNaN=Tc,br.isNative=Cc,br.isNil=Rc,br.isNull=Pc,br.isNumber=Lc,br.isObject=_c,br.isObjectLike=Ac,br.isPlainObject=Oc,br.isRegExp=Dc,br.isSafeInteger=Ic,br.isSet=kc,br.isString=Nc,br.isSymbol=Fc,br.isTypedArray=Vc,br.isUndefined=zc,br.isWeakMap=Uc,br.isWeakSet=jc,br.join=nl,br.kebabCase=Zh,br.last=rl,br.lastIndexOf=il,br.lowerCase=Jh,br.lowerFirst=Qh,br.lt=Bc,br.lte=Hc,br.max=rp,br.maxBy=ip,br.mean=op,br.meanBy=sp,br.min=ap,br.minBy=lp,br.stubArray=qd,br.stubFalse=Wd,br.stubObject=$d,br.stubString=Xd,br.stubTrue=Yd,br.multiply=up,br.nth=ol,br.noConflict=kd,br.noop=Nd,br.now=Mu,br.pad=Kh,br.padEnd=ed,br.padStart=td,br.parseInt=nd,br.random=Hh,br.reduce=vu,br.reduceRight=yu,br.repeat=rd,br.replace=id,br.result=Rh,br.round=cp,br.runInContext=e,br.sample=bu,br.size=Au,br.snakeCase=od,br.some=Su,br.sortedIndex=fl,br.sortedIndexBy=ml,br.sortedIndexOf=gl,br.sortedLastIndex=vl,br.sortedLastIndexBy=yl,br.sortedLastIndexOf=xl,br.startCase=ad,br.startsWith=ld,br.subtract=hp,br.sum=dp,br.sumBy=pp,br.template=ud,br.times=Zd,br.toFinite=qc,br.toInteger=Wc,br.toLength=$c,br.toLower=cd,br.toNumber=Xc,br.toSafeInteger=Zc,br.toString=Jc,br.toUpper=hd,br.trim=dd,br.trimEnd=pd,br.trimStart=fd,br.truncate=md,br.unescape=gd,br.uniqueId=Qd,br.upperCase=vd,br.upperFirst=yd,br.each=lu,br.eachRight=uu,br.first=Za,Id(br,function(){var e={};return Pi(br,(function(t,n){ht.call(br.prototype,n)||(e[n]=t)})),e}(),{chain:!1}),br.VERSION=s,wn(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){br[e].placeholder=br})),wn(["drop","take"],(function(e,t){Er.prototype[e]=function(n){n=n===o?1:Ut(Wc(n),0);var r=this.__filtered__&&!t?new Er(this):this.clone();return r.__filtered__?r.__takeCount__=jt(n,r.__takeCount__):r.__views__.push({size:jt(n,z),type:e+(r.__dir__<0?"Right":"")}),r},Er.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),wn(["filter","map","takeWhile"],(function(e,t){var n=t+1,r=n==O||n==I;Er.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:Bs(e,3),type:n}),t.__filtered__=t.__filtered__||r,t}})),wn(["head","last"],(function(e,t){var n="take"+(t?"Right":"");Er.prototype[e]=function(){return this[n](1).value()[0]}})),wn(["initial","tail"],(function(e,t){var n="drop"+(t?"":"Right");Er.prototype[e]=function(){return this.__filtered__?new Er(this):this[n](1)}})),Er.prototype.compact=function(){return this.filter(Cd)},Er.prototype.find=function(e){return this.filter(e).head()},Er.prototype.findLast=function(e){return this.reverse().find(e)},Er.prototype.invokeMap=xo((function(e,t){return"function"==typeof e?new Er(this):this.map((function(n){return ji(n,e,t)}))})),Er.prototype.reject=function(e){return this.filter(zu(Bs(e)))},Er.prototype.slice=function(e,t){e=Wc(e);var n=this;return n.__filtered__&&(e>0||t<0)?new Er(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==o&&(t=Wc(t),n=t<0?n.dropRight(-t):n.take(t-e)),n)},Er.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Er.prototype.toArray=function(){return this.take(z)},Pi(Er.prototype,(function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),r=/^(?:head|last)$/.test(t),i=br[r?"take"+("last"==t?"Right":""):t],s=r||/^find/.test(t);i&&(br.prototype[t]=function(){var t=this.__wrapped__,a=r?[1]:arguments,l=t instanceof Er,u=a[0],c=l||sc(t),h=function(e){var t=i.apply(br,Cn([e],a));return r&&d?t[0]:t};c&&n&&"function"==typeof u&&1!=u.length&&(l=c=!1);var d=this.__chain__,p=!!this.__actions__.length,f=s&&!d,m=l&&!p;if(!s&&c){t=m?t:new Er(this);var g=e.apply(t,a);return g.__actions__.push({func:ql,args:[h],thisArg:o}),new Sr(g,d)}return f&&m?e.apply(this,a):(g=this.thru(h),f?r?g.value()[0]:g.value():g)})})),wn(["pop","push","shift","sort","splice","unshift"],(function(e){var t=st[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);br.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var i=this.value();return t.apply(sc(i)?i:[],e)}return this[n]((function(n){return t.apply(sc(n)?n:[],e)}))}})),Pi(Er.prototype,(function(e,t){var n=br[t];if(n){var r=n.name+"";ht.call(un,r)||(un[r]=[]),un[r].push({name:t,func:n})}})),un[vs(o,x).name]=[{name:"wrapper",func:o}],Er.prototype.clone=Mr,Er.prototype.reverse=Tr,Er.prototype.value=Cr,br.prototype.at=Wl,br.prototype.chain=$l,br.prototype.commit=Xl,br.prototype.next=Yl,br.prototype.plant=Jl,br.prototype.reverse=Ql,br.prototype.toJSON=br.prototype.valueOf=br.prototype.value=Kl,br.prototype.first=br.prototype.head,Tt&&(br.prototype[Tt]=Zl),br},wr=br();an._=wr,i=function(){return wr}.call(t,n,t,r),i===o||(r.exports=i)}).call(this)}).call(this,n("c8ba"),n("62e4")(e))},3280:function(e,t,n){"use strict";var r=n("ebb5"),i=n("e58c"),o=r.aTypedArray,s=r.exportTypedArrayMethod;s("lastIndexOf",(function(e){return i.apply(o(this),arguments)}))},"32ce":function(e,t,n){(function(t){var n=e.exports=function(e,t){this.options=t||{},this.message=e,this.createElement()};n.prototype.createElement=function(){this.element=document.createElement("div"),this.element.className="leapjs-dialog",this.element.style.position="fixed",this.element.style.top="8px",this.element.style.left=0,this.element.style.right=0,this.element.style.textAlign="center",this.element.style.zIndex=1e3;var e=document.createElement("div");this.element.appendChild(e),e.style.className="leapjs-dialog",e.style.display="inline-block",e.style.margin="auto",e.style.padding="8px",e.style.color="#222",e.style.background="#eee",e.style.borderRadius="4px",e.style.border="1px solid #999",e.style.textAlign="left",e.style.cursor="pointer",e.style.whiteSpace="nowrap",e.style.transition="box-shadow 1s linear",e.innerHTML=this.message,this.options.onclick&&e.addEventListener("click",this.options.onclick),this.options.onmouseover&&e.addEventListener("mouseover",this.options.onmouseover),this.options.onmouseout&&e.addEventListener("mouseout",this.options.onmouseout),this.options.onmousemove&&e.addEventListener("mousemove",this.options.onmousemove)},n.prototype.show=function(){return document.body.appendChild(this.element),this},n.prototype.hide=function(){return document.body.removeChild(this.element),this},n.warnOutOfDate=function(e){e||(e={});var t="http://developer.leapmotion.com?";for(var r in e.returnTo=window.location.href,e)t+=r+"="+encodeURIComponent(e[r])+"&";var i,o=function(e){if("leapjs-decline-upgrade"!=e.target.id){var n=window.open(t,"_blank","height=800,width=1000,location=1,menubar=1,resizable=1,status=1,toolbar=1,scrollbars=1");window.focus&&n.focus()}return i.hide(),!0},s="This site requires Leap Motion Tracking V2.<button id='leapjs-accept-upgrade'  style='color: #444; transition: box-shadow 100ms linear; cursor: pointer; vertical-align: baseline; margin-left: 16px;'>Upgrade</button><button id='leapjs-decline-upgrade' style='color: #444; transition: box-shadow 100ms linear; cursor: pointer; vertical-align: baseline; margin-left: 8px; '>Not Now</button>";return i=new n(s,{onclick:o,onmousemove:function(e){e.target==document.getElementById("leapjs-decline-upgrade")?(document.getElementById("leapjs-decline-upgrade").style.color="#000",document.getElementById("leapjs-decline-upgrade").style.boxShadow="0px 0px 2px #5daa00",document.getElementById("leapjs-accept-upgrade").style.color="#444",document.getElementById("leapjs-accept-upgrade").style.boxShadow="none"):(document.getElementById("leapjs-accept-upgrade").style.color="#000",document.getElementById("leapjs-accept-upgrade").style.boxShadow="0px 0px 2px #5daa00",document.getElementById("leapjs-decline-upgrade").style.color="#444",document.getElementById("leapjs-decline-upgrade").style.boxShadow="none")},onmouseout:function(){document.getElementById("leapjs-decline-upgrade").style.color="#444",document.getElementById("leapjs-decline-upgrade").style.boxShadow="none",document.getElementById("leapjs-accept-upgrade").style.color="#444",document.getElementById("leapjs-accept-upgrade").style.boxShadow="none"}}),i.show()},n.hasWarnedBones=!1,n.warnBones=function(){this.hasWarnedBones||(this.hasWarnedBones=!0,console.warn("Your Leap Service is out of date"),"undefined"!==typeof t&&t.versions&&t.versions.node||this.warnOutOfDate({reason:"bones"}))}}).call(this,n("4362"))},"35e8":function(e,t,n){"use strict";e.exports={isString:function(e){return"string"===typeof e},isObject:function(e){return"object"===typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},"38cf":function(e,t,n){var r=n("23e7"),i=n("1148");r({target:"String",proto:!0},{repeat:i})},"3a7b":function(e,t,n){"use strict";var r=n("ebb5"),i=n("b727").findIndex,o=r.aTypedArray,s=r.exportTypedArrayMethod;s("findIndex",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},"3c35":function(e,t){(function(t){e.exports=t}).call(this,{})},"3c5d":function(e,t,n){"use strict";var r=n("ebb5"),i=n("50c4"),o=n("182d"),s=n("7b0b"),a=n("d039"),l=r.aTypedArray,u=r.exportTypedArrayMethod,c=a((function(){new Int8Array(1).set({})}));u("set",(function(e){l(this);var t=o(arguments.length>1?arguments[1]:void 0,1),n=this.length,r=s(e),a=i(r.length),u=0;if(a+t>n)throw RangeError("Wrong length");while(u<a)this[t+u]=r[u++]}),c)},"3ce1":function(e,t,n){e.exports={Controller:n("aaad"),Frame:n("808a"),Gesture:n("a3b3"),Hand:n("16c3"),Pointable:n("1f8f"),Finger:n("5915"),InteractionBox:n("df2a"),CircularBuffer:n("9871"),UI:n("e91a"),JSONProtocol:n("d0ea").JSONProtocol,glMatrix:n("9052"),mat3:n("9052").mat3,vec3:n("9052").vec3,loopController:void 0,version:n("077a"),_:n("17fb"),EventEmitter:n("faa1").EventEmitter,loop:function(e,t){return e&&void 0===t&&"[object Function]"==={}.toString.call(e)&&(t=e,e={}),this.loopController?e&&this.loopController.setupFrameEvents(e):this.loopController=new this.Controller(e),this.loopController.loop(t),this.loopController},plugin:function(e,t){this.Controller.plugin(e,t)}}},"3fcc":function(e,t,n){"use strict";var r=n("ebb5"),i=n("b727").map,o=n("4840"),s=r.aTypedArray,a=r.aTypedArrayConstructor,l=r.exportTypedArrayMethod;l("map",(function(e){return i(s(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(a(o(e,e.constructor)))(t)}))}))},4511:function(e,t,n){var r=n("4f8a"),i=n("956e"),o=n("17fb"),s=e.exports=function(e){i.call(this,e);var t=this;this.on("ready",(function(){t.reportFocus(!0)}))};o.extend(s.prototype,i.prototype),s.__proto__=i,s.prototype.setupSocket=function(){var e=this,t=new r(this.getUrl());return t.on("open",(function(){e.handleOpen()})),t.on("message",(function(t){e.handleData(t)})),t.on("close",(function(t,n){e.handleClose(t,n)})),t.on("error",(function(){e.startReconnection()})),t}},"45fc":function(e,t,n){"use strict";var r=n("23e7"),i=n("b727").some,o=n("a640"),s=n("ae40"),a=o("some"),l=s("some");r({target:"Array",proto:!0,forced:!a||!l},{some:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},"466d":function(e,t,n){"use strict";var r=n("d784"),i=n("825a"),o=n("50c4"),s=n("1d80"),a=n("8aa5"),l=n("14c3");r("match",1,(function(e,t,n){return[function(t){var n=s(this),r=void 0==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;var s=i(e),u=String(this);if(!s.global)return l(s,u);var c=s.unicode;s.lastIndex=0;var h,d=[],p=0;while(null!==(h=l(s,u))){var f=String(h[0]);d[p]=f,""===f&&(s.lastIndex=a(u,o(s.lastIndex),c)),p++}return 0===p?null:d}]}))},"46c0":function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#","description":"Meta-schema for $data reference (JSON Schema extension proposal)","type":"object","required":["$data"],"properties":{"$data":{"type":"string","anyOf":[{"format":"relative-json-pointer"},{"format":"json-pointer"}]}},"additionalProperties":false}')},"47bb":function(e,t,n){
/*!
  * domready (c) Dustin Diaz 2014 - License MIT
  */
!function(t,n){e.exports=n()}(0,(function(){var e,t=[],n=document,r=n.documentElement.doScroll,i="DOMContentLoaded",o=(r?/^loaded|^c/:/^loaded|^i|^c/).test(n.readyState);return o||n.addEventListener(i,e=function(){n.removeEventListener(i,e),o=1;while(e=t.shift())e()}),function(e){o?setTimeout(e,0):t.push(e)}}))},4939:function(e,t,n){},"4a75":function(e,t,n){var r=n("faa1").EventEmitter,i=n("17fb"),o=e.exports=function(e,t){this.start=new Vector(e),this.end=new Vector(t),this.enteredFrame=null};o.prototype.hasPointables=function(e){for(var t=0;t!=e.pointables.length;t++){var n=e.pointables[t].tipPosition;if(n.x>=this.start.x&&n.x<=this.end.x&&n.y>=this.start.y&&n.y<=this.end.y&&n.z>=this.start.z&&n.z<=this.end.z)return!0}return!1},o.prototype.listener=function(e){var t=this;return e&&e.nearThreshold&&this.setupNearRegion(e.nearThreshold),function(e){return t.updatePosition(e)}},o.prototype.clipper=function(){var e=this;return function(t){return e.updatePosition(t),e.enteredFrame?t:null}},o.prototype.setupNearRegion=function(e){var t=this.nearRegion=new o([this.start.x-e,this.start.y-e,this.start.z-e],[this.end.x+e,this.end.y+e,this.end.z+e]),n=this;t.on("enter",(function(e){n.emit("near",e)})),t.on("exit",(function(e){n.emit("far",e)})),n.on("exit",(function(e){n.emit("near",e)}))},o.prototype.updatePosition=function(e){return this.nearRegion&&this.nearRegion.updatePosition(e),this.hasPointables(e)&&null==this.enteredFrame?(this.enteredFrame=e,this.emit("enter",this.enteredFrame)):this.hasPointables(e)||null==this.enteredFrame||(this.enteredFrame=null,this.emit("exit",this.enteredFrame)),e},o.prototype.normalize=function(e){return new Vector([(e.x-this.start.x)/(this.end.x-this.start.x),(e.y-this.start.y)/(this.end.y-this.start.y),(e.z-this.start.z)/(this.end.z-this.start.z)])},o.prototype.mapToXY=function(e,t,n){var r=this.normalize(e),i=r.x,o=r.y;return i>1?i=1:i<-1&&(i=-1),o>1?o=1:o<-1&&(o=-1),[(i+1)/2*t,(1-o)/2*n,r.z]},i.extend(o.prototype,r.prototype)},"4d63":function(e,t,n){var r=n("83ab"),i=n("da84"),o=n("94ca"),s=n("7156"),a=n("9bf2").f,l=n("241c").f,u=n("44e7"),c=n("ad6d"),h=n("9f7f"),d=n("6eeb"),p=n("d039"),f=n("69f3").set,m=n("2626"),g=n("b622"),v=g("match"),y=i.RegExp,x=y.prototype,b=/a/g,w=/a/g,_=new y(b)!==b,A=h.UNSUPPORTED_Y,S=r&&o("RegExp",!_||A||p((function(){return w[v]=!1,y(b)!=b||y(w)==w||"/a/i"!=y(b,"i")})));if(S){var E=function(e,t){var n,r=this instanceof E,i=u(e),o=void 0===t;if(!r&&i&&e.constructor===E&&o)return e;_?i&&!o&&(e=e.source):e instanceof E&&(o&&(t=c.call(e)),e=e.source),A&&(n=!!t&&t.indexOf("y")>-1,n&&(t=t.replace(/y/g,"")));var a=s(_?new y(e,t):y(e,t),r?this:x,E);return A&&n&&f(a,{sticky:n}),a},M=function(e){e in E||a(E,e,{configurable:!0,get:function(){return y[e]},set:function(t){y[e]=t}})},T=l(y),C=0;while(T.length>C)M(T[C++]);x.constructor=E,E.prototype=x,d(i,"RegExp",E)}m("RegExp")},"4db1":function(e,t,n){"use strict";e.exports=function(e,t,n){var r=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d="errs__"+i,p=e.util.copy(e),f="";p.level++;var m="valid"+p.level,g=p.baseId,v="prevValid"+i,y="passingSchemas"+i;r+="var "+d+" = errors , "+v+" = false , "+h+" = false , "+y+" = null; ";var x=e.compositeRule;e.compositeRule=p.compositeRule=!0;var b=s;if(b){var w,_=-1,A=b.length-1;while(_<A)w=b[_+=1],(e.opts.strictKeywords?"object"==typeof w&&Object.keys(w).length>0:e.util.schemaHasRules(w,e.RULES.all))?(p.schema=w,p.schemaPath=a+"["+_+"]",p.errSchemaPath=l+"/"+_,r+="  "+e.validate(p)+" ",p.baseId=g):r+=" var "+m+" = true; ",_&&(r+=" if ("+m+" && "+v+") { "+h+" = false; "+y+" = ["+y+", "+_+"]; } else { ",f+="}"),r+=" if ("+m+") { "+h+" = "+v+" = true; "+y+" = "+_+"; }"}return e.compositeRule=p.compositeRule=x,r+=f+"if (!"+h+") {   var err =   ",!1!==e.createErrors?(r+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { passingSchemas: "+y+" } ",!1!==e.opts.messages&&(r+=" , message: 'should match exactly one schema in oneOf' "),e.opts.verbose&&(r+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(e.async?r+=" throw new ValidationError(vErrors); ":r+=" validate.errors = vErrors; return false; "),r+="} else {  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; }",e.opts.allErrors&&(r+=" } "),r}},"4de4":function(e,t,n){"use strict";var r=n("23e7"),i=n("b727").filter,o=n("1dde"),s=n("ae40"),a=o("filter"),l=s("filter");r({target:"Array",proto:!0,forced:!a||!l},{filter:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},"4e14":function(e,t,n){
/** @license URI.js v4.2.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js */
(function(e,n){n(t)})(0,(function(e){"use strict";function t(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t.length>1){t[0]=t[0].slice(0,-1);for(var r=t.length-1,i=1;i<r;++i)t[i]=t[i].slice(1,-1);return t[r]=t[r].slice(1),t.join("")}return t[0]}function n(e){return"(?:"+e+")"}function r(e){return void 0===e?"undefined":null===e?"null":Object.prototype.toString.call(e).split(" ").pop().split("]").shift().toLowerCase()}function i(e){return e.toUpperCase()}function o(e){return void 0!==e&&null!==e?e instanceof Array?e:"number"!==typeof e.length||e.split||e.setInterval||e.call?[e]:Array.prototype.slice.call(e):[]}function s(e,t){var n=e;if(t)for(var r in t)n[r]=t[r];return n}function a(e){var r="[A-Za-z]",i="[0-9]",o=t(i,"[A-Fa-f]"),s=n(n("%[EFef]"+o+"%"+o+o+"%"+o+o)+"|"+n("%[89A-Fa-f]"+o+"%"+o+o)+"|"+n("%"+o+o)),a="[\\:\\/\\?\\#\\[\\]\\@]",l="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",u=t(a,l),c=e?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",h=e?"[\\uE000-\\uF8FF]":"[]",d=t(r,i,"[\\-\\.\\_\\~]",c),p=n(r+t(r,i,"[\\+\\-\\.]")+"*"),f=n(n(s+"|"+t(d,l,"[\\:]"))+"*"),m=(n(n("25[0-5]")+"|"+n("2[0-4]"+i)+"|"+n("1"+i+i)+"|"+n("[1-9]"+i)+"|"+i),n(n("25[0-5]")+"|"+n("2[0-4]"+i)+"|"+n("1"+i+i)+"|"+n("0?[1-9]"+i)+"|0?0?"+i)),g=n(m+"\\."+m+"\\."+m+"\\."+m),v=n(o+"{1,4}"),y=n(n(v+"\\:"+v)+"|"+g),x=n(n(v+"\\:")+"{6}"+y),b=n("\\:\\:"+n(v+"\\:")+"{5}"+y),w=n(n(v)+"?\\:\\:"+n(v+"\\:")+"{4}"+y),_=n(n(n(v+"\\:")+"{0,1}"+v)+"?\\:\\:"+n(v+"\\:")+"{3}"+y),A=n(n(n(v+"\\:")+"{0,2}"+v)+"?\\:\\:"+n(v+"\\:")+"{2}"+y),S=n(n(n(v+"\\:")+"{0,3}"+v)+"?\\:\\:"+v+"\\:"+y),E=n(n(n(v+"\\:")+"{0,4}"+v)+"?\\:\\:"+y),M=n(n(n(v+"\\:")+"{0,5}"+v)+"?\\:\\:"+v),T=n(n(n(v+"\\:")+"{0,6}"+v)+"?\\:\\:"),C=n([x,b,w,_,A,S,E,M,T].join("|")),P=n(n(d+"|"+s)+"+"),R=(n(C+"\\%25"+P),n(C+n("\\%25|\\%(?!"+o+"{2})")+P)),L=n("[vV]"+o+"+\\."+t(d,l,"[\\:]")+"+"),O=n("\\["+n(R+"|"+C+"|"+L)+"\\]"),D=n(n(s+"|"+t(d,l))+"*"),I=n(O+"|"+g+"(?!"+D+")|"+D),k=n(i+"*"),N=n(n(f+"@")+"?"+I+n("\\:"+k)+"?"),F=n(s+"|"+t(d,l,"[\\:\\@]")),V=n(F+"*"),z=n(F+"+"),U=n(n(s+"|"+t(d,l,"[\\@]"))+"+"),j=n(n("\\/"+V)+"*"),B=n("\\/"+n(z+j)+"?"),H=n(U+j),G=n(z+j),q="(?!"+F+")",W=(n(j+"|"+B+"|"+H+"|"+G+"|"+q),n(n(F+"|"+t("[\\/\\?]",h))+"*")),$=n(n(F+"|[\\/\\?]")+"*"),X=n(n("\\/\\/"+N+j)+"|"+B+"|"+G+"|"+q),Y=n(p+"\\:"+X+n("\\?"+W)+"?"+n("\\#"+$)+"?"),Z=n(n("\\/\\/"+N+j)+"|"+B+"|"+H+"|"+q),J=n(Z+n("\\?"+W)+"?"+n("\\#"+$)+"?");n(Y+"|"+J),n(p+"\\:"+X+n("\\?"+W)+"?"),n(n("\\/\\/("+n("("+f+")@")+"?("+I+")"+n("\\:("+k+")")+"?)")+"?("+j+"|"+B+"|"+G+"|"+q+")"),n("\\?("+W+")"),n("\\#("+$+")"),n(n("\\/\\/("+n("("+f+")@")+"?("+I+")"+n("\\:("+k+")")+"?)")+"?("+j+"|"+B+"|"+H+"|"+q+")"),n("\\?("+W+")"),n("\\#("+$+")"),n(n("\\/\\/("+n("("+f+")@")+"?("+I+")"+n("\\:("+k+")")+"?)")+"?("+j+"|"+B+"|"+G+"|"+q+")"),n("\\?("+W+")"),n("\\#("+$+")"),n("("+f+")@"),n("\\:("+k+")");return{NOT_SCHEME:new RegExp(t("[^]",r,i,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(t("[^\\%\\:]",d,l),"g"),NOT_HOST:new RegExp(t("[^\\%\\[\\]\\:]",d,l),"g"),NOT_PATH:new RegExp(t("[^\\%\\/\\:\\@]",d,l),"g"),NOT_PATH_NOSCHEME:new RegExp(t("[^\\%\\/\\@]",d,l),"g"),NOT_QUERY:new RegExp(t("[^\\%]",d,l,"[\\:\\@\\/\\?]",h),"g"),NOT_FRAGMENT:new RegExp(t("[^\\%]",d,l,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(t("[^]",d,l),"g"),UNRESERVED:new RegExp(d,"g"),OTHER_CHARS:new RegExp(t("[^\\%]",d,u),"g"),PCT_ENCODED:new RegExp(s,"g"),IPV4ADDRESS:new RegExp("^("+g+")$"),IPV6ADDRESS:new RegExp("^\\[?("+C+")"+n(n("\\%25|\\%(?!"+o+"{2})")+"("+P+")")+"?\\]?$")}}var l=a(!1),u=a(!0),c=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done);r=!0)if(n.push(s.value),t&&n.length===t)break}catch(l){i=!0,o=l}finally{try{!r&&a["return"]&&a["return"]()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},d=2147483647,p=36,f=1,m=26,g=38,v=700,y=72,x=128,b="-",w=/^xn--/,_=/[^\0-\x7E]/,A=/[\x2E\u3002\uFF0E\uFF61]/g,S={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},E=p-f,M=Math.floor,T=String.fromCharCode;function C(e){throw new RangeError(S[e])}function P(e,t){var n=[],r=e.length;while(r--)n[r]=t(e[r]);return n}function R(e,t){var n=e.split("@"),r="";n.length>1&&(r=n[0]+"@",e=n[1]),e=e.replace(A,".");var i=e.split("."),o=P(i,t).join(".");return r+o}function L(e){var t=[],n=0,r=e.length;while(n<r){var i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var o=e.charCodeAt(n++);56320==(64512&o)?t.push(((1023&i)<<10)+(1023&o)+65536):(t.push(i),n--)}else t.push(i)}return t}var O=function(e){return String.fromCodePoint.apply(String,h(e))},D=function(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:p},I=function(e,t){return e+22+75*(e<26)-((0!=t)<<5)},k=function(e,t,n){var r=0;for(e=n?M(e/v):e>>1,e+=M(e/t);e>E*m>>1;r+=p)e=M(e/E);return M(r+(E+1)*e/(e+g))},N=function(e){var t=[],n=e.length,r=0,i=x,o=y,s=e.lastIndexOf(b);s<0&&(s=0);for(var a=0;a<s;++a)e.charCodeAt(a)>=128&&C("not-basic"),t.push(e.charCodeAt(a));for(var l=s>0?s+1:0;l<n;){for(var u=r,c=1,h=p;;h+=p){l>=n&&C("invalid-input");var g=D(e.charCodeAt(l++));(g>=p||g>M((d-r)/c))&&C("overflow"),r+=g*c;var v=h<=o?f:h>=o+m?m:h-o;if(g<v)break;var w=p-v;c>M(d/w)&&C("overflow"),c*=w}var _=t.length+1;o=k(r-u,_,0==u),M(r/_)>d-i&&C("overflow"),i+=M(r/_),r%=_,t.splice(r++,0,i)}return String.fromCodePoint.apply(String,t)},F=function(e){var t=[];e=L(e);var n=e.length,r=x,i=0,o=y,s=!0,a=!1,l=void 0;try{for(var u,c=e[Symbol.iterator]();!(s=(u=c.next()).done);s=!0){var h=u.value;h<128&&t.push(T(h))}}catch(W){a=!0,l=W}finally{try{!s&&c.return&&c.return()}finally{if(a)throw l}}var g=t.length,v=g;g&&t.push(b);while(v<n){var w=d,_=!0,A=!1,S=void 0;try{for(var E,P=e[Symbol.iterator]();!(_=(E=P.next()).done);_=!0){var R=E.value;R>=r&&R<w&&(w=R)}}catch(W){A=!0,S=W}finally{try{!_&&P.return&&P.return()}finally{if(A)throw S}}var O=v+1;w-r>M((d-i)/O)&&C("overflow"),i+=(w-r)*O,r=w;var D=!0,N=!1,F=void 0;try{for(var V,z=e[Symbol.iterator]();!(D=(V=z.next()).done);D=!0){var U=V.value;if(U<r&&++i>d&&C("overflow"),U==r){for(var j=i,B=p;;B+=p){var H=B<=o?f:B>=o+m?m:B-o;if(j<H)break;var G=j-H,q=p-H;t.push(T(I(H+G%q,0))),j=M(G/q)}t.push(T(I(j,0))),o=k(i,O,v==g),i=0,++v}}}catch(W){N=!0,F=W}finally{try{!D&&z.return&&z.return()}finally{if(N)throw F}}++i,++r}return t.join("")},V=function(e){return R(e,(function(e){return w.test(e)?N(e.slice(4).toLowerCase()):e}))},z=function(e){return R(e,(function(e){return _.test(e)?"xn--"+F(e):e}))},U={version:"2.1.0",ucs2:{decode:L,encode:O},decode:N,encode:F,toASCII:z,toUnicode:V},j={};function B(e){var t=e.charCodeAt(0),n=void 0;return n=t<16?"%0"+t.toString(16).toUpperCase():t<128?"%"+t.toString(16).toUpperCase():t<2048?"%"+(t>>6|192).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase():"%"+(t>>12|224).toString(16).toUpperCase()+"%"+(t>>6&63|128).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase(),n}function H(e){var t="",n=0,r=e.length;while(n<r){var i=parseInt(e.substr(n+1,2),16);if(i<128)t+=String.fromCharCode(i),n+=3;else if(i>=194&&i<224){if(r-n>=6){var o=parseInt(e.substr(n+4,2),16);t+=String.fromCharCode((31&i)<<6|63&o)}else t+=e.substr(n,6);n+=6}else if(i>=224){if(r-n>=9){var s=parseInt(e.substr(n+4,2),16),a=parseInt(e.substr(n+7,2),16);t+=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}else t+=e.substr(n,9);n+=9}else t+=e.substr(n,3),n+=3}return t}function G(e,t){function n(e){var n=H(e);return n.match(t.UNRESERVED)?n:e}return e.scheme&&(e.scheme=String(e.scheme).replace(t.PCT_ENCODED,n).toLowerCase().replace(t.NOT_SCHEME,"")),void 0!==e.userinfo&&(e.userinfo=String(e.userinfo).replace(t.PCT_ENCODED,n).replace(t.NOT_USERINFO,B).replace(t.PCT_ENCODED,i)),void 0!==e.host&&(e.host=String(e.host).replace(t.PCT_ENCODED,n).toLowerCase().replace(t.NOT_HOST,B).replace(t.PCT_ENCODED,i)),void 0!==e.path&&(e.path=String(e.path).replace(t.PCT_ENCODED,n).replace(e.scheme?t.NOT_PATH:t.NOT_PATH_NOSCHEME,B).replace(t.PCT_ENCODED,i)),void 0!==e.query&&(e.query=String(e.query).replace(t.PCT_ENCODED,n).replace(t.NOT_QUERY,B).replace(t.PCT_ENCODED,i)),void 0!==e.fragment&&(e.fragment=String(e.fragment).replace(t.PCT_ENCODED,n).replace(t.NOT_FRAGMENT,B).replace(t.PCT_ENCODED,i)),e}function q(e){return e.replace(/^0*(.*)/,"$1")||"0"}function W(e,t){var n=e.match(t.IPV4ADDRESS)||[],r=c(n,2),i=r[1];return i?i.split(".").map(q).join("."):e}function $(e,t){var n=e.match(t.IPV6ADDRESS)||[],r=c(n,3),i=r[1],o=r[2];if(i){for(var s=i.toLowerCase().split("::").reverse(),a=c(s,2),l=a[0],u=a[1],h=u?u.split(":").map(q):[],d=l.split(":").map(q),p=t.IPV4ADDRESS.test(d[d.length-1]),f=p?7:8,m=d.length-f,g=Array(f),v=0;v<f;++v)g[v]=h[v]||d[m+v]||"";p&&(g[f-1]=W(g[f-1],t));var y=g.reduce((function(e,t,n){if(!t||"0"===t){var r=e[e.length-1];r&&r.index+r.length===n?r.length++:e.push({index:n,length:1})}return e}),[]),x=y.sort((function(e,t){return t.length-e.length}))[0],b=void 0;if(x&&x.length>1){var w=g.slice(0,x.index),_=g.slice(x.index+x.length);b=w.join(":")+"::"+_.join(":")}else b=g.join(":");return o&&(b+="%"+o),b}return e}var X=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,Y=void 0==="".match(/(){0}/)[1];function Z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={},r=!1!==t.iri?u:l;"suffix"===t.reference&&(e=(t.scheme?t.scheme+":":"")+"//"+e);var i=e.match(X);if(i){Y?(n.scheme=i[1],n.userinfo=i[3],n.host=i[4],n.port=parseInt(i[5],10),n.path=i[6]||"",n.query=i[7],n.fragment=i[8],isNaN(n.port)&&(n.port=i[5])):(n.scheme=i[1]||void 0,n.userinfo=-1!==e.indexOf("@")?i[3]:void 0,n.host=-1!==e.indexOf("//")?i[4]:void 0,n.port=parseInt(i[5],10),n.path=i[6]||"",n.query=-1!==e.indexOf("?")?i[7]:void 0,n.fragment=-1!==e.indexOf("#")?i[8]:void 0,isNaN(n.port)&&(n.port=e.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?i[4]:void 0)),n.host&&(n.host=$(W(n.host,r),r)),void 0!==n.scheme||void 0!==n.userinfo||void 0!==n.host||void 0!==n.port||n.path||void 0!==n.query?void 0===n.scheme?n.reference="relative":void 0===n.fragment?n.reference="absolute":n.reference="uri":n.reference="same-document",t.reference&&"suffix"!==t.reference&&t.reference!==n.reference&&(n.error=n.error||"URI is not a "+t.reference+" reference.");var o=j[(t.scheme||n.scheme||"").toLowerCase()];if(t.unicodeSupport||o&&o.unicodeSupport)G(n,r);else{if(n.host&&(t.domainHost||o&&o.domainHost))try{n.host=U.toASCII(n.host.replace(r.PCT_ENCODED,H).toLowerCase())}catch(s){n.error=n.error||"Host's domain name can not be converted to ASCII via punycode: "+s}G(n,l)}o&&o.parse&&o.parse(n,t)}else n.error=n.error||"URI can not be parsed.";return n}function J(e,t){var n=!1!==t.iri?u:l,r=[];return void 0!==e.userinfo&&(r.push(e.userinfo),r.push("@")),void 0!==e.host&&r.push($(W(String(e.host),n),n).replace(n.IPV6ADDRESS,(function(e,t,n){return"["+t+(n?"%25"+n:"")+"]"}))),"number"===typeof e.port&&(r.push(":"),r.push(e.port.toString(10))),r.length?r.join(""):void 0}var Q=/^\.\.?\//,K=/^\/\.(\/|$)/,ee=/^\/\.\.(\/|$)/,te=/^\/?(?:.|\n)*?(?=\/|$)/;function ne(e){var t=[];while(e.length)if(e.match(Q))e=e.replace(Q,"");else if(e.match(K))e=e.replace(K,"/");else if(e.match(ee))e=e.replace(ee,"/"),t.pop();else if("."===e||".."===e)e="";else{var n=e.match(te);if(!n)throw new Error("Unexpected dot segment condition");var r=n[0];e=e.slice(r.length),t.push(r)}return t.join("")}function re(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.iri?u:l,r=[],i=j[(t.scheme||e.scheme||"").toLowerCase()];if(i&&i.serialize&&i.serialize(e,t),e.host)if(n.IPV6ADDRESS.test(e.host));else if(t.domainHost||i&&i.domainHost)try{e.host=t.iri?U.toUnicode(e.host):U.toASCII(e.host.replace(n.PCT_ENCODED,H).toLowerCase())}catch(a){e.error=e.error||"Host's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+a}G(e,n),"suffix"!==t.reference&&e.scheme&&(r.push(e.scheme),r.push(":"));var o=J(e,t);if(void 0!==o&&("suffix"!==t.reference&&r.push("//"),r.push(o),e.path&&"/"!==e.path.charAt(0)&&r.push("/")),void 0!==e.path){var s=e.path;t.absolutePath||i&&i.absolutePath||(s=ne(s)),void 0===o&&(s=s.replace(/^\/\//,"/%2F")),r.push(s)}return void 0!==e.query&&(r.push("?"),r.push(e.query)),void 0!==e.fragment&&(r.push("#"),r.push(e.fragment)),r.join("")}function ie(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments[3],i={};return r||(e=Z(re(e,n),n),t=Z(re(t,n),n)),n=n||{},!n.tolerant&&t.scheme?(i.scheme=t.scheme,i.userinfo=t.userinfo,i.host=t.host,i.port=t.port,i.path=ne(t.path||""),i.query=t.query):(void 0!==t.userinfo||void 0!==t.host||void 0!==t.port?(i.userinfo=t.userinfo,i.host=t.host,i.port=t.port,i.path=ne(t.path||""),i.query=t.query):(t.path?("/"===t.path.charAt(0)?i.path=ne(t.path):(void 0===e.userinfo&&void 0===e.host&&void 0===e.port||e.path?e.path?i.path=e.path.slice(0,e.path.lastIndexOf("/")+1)+t.path:i.path=t.path:i.path="/"+t.path,i.path=ne(i.path)),i.query=t.query):(i.path=e.path,void 0!==t.query?i.query=t.query:i.query=e.query),i.userinfo=e.userinfo,i.host=e.host,i.port=e.port),i.scheme=e.scheme),i.fragment=t.fragment,i}function oe(e,t,n){var r=s({scheme:"null"},n);return re(ie(Z(e,r),Z(t,r),r,!0),r)}function se(e,t){return"string"===typeof e?e=re(Z(e,t),t):"object"===r(e)&&(e=Z(re(e,t),t)),e}function ae(e,t,n){return"string"===typeof e?e=re(Z(e,n),n):"object"===r(e)&&(e=re(e,n)),"string"===typeof t?t=re(Z(t,n),n):"object"===r(t)&&(t=re(t,n)),e===t}function le(e,t){return e&&e.toString().replace(t&&t.iri?u.ESCAPE:l.ESCAPE,B)}function ue(e,t){return e&&e.toString().replace(t&&t.iri?u.PCT_ENCODED:l.PCT_ENCODED,H)}var ce={scheme:"http",domainHost:!0,parse:function(e,t){return e.host||(e.error=e.error||"HTTP URIs must have a host."),e},serialize:function(e,t){return e.port!==("https"!==String(e.scheme).toLowerCase()?80:443)&&""!==e.port||(e.port=void 0),e.path||(e.path="/"),e}},he={scheme:"https",domainHost:ce.domainHost,parse:ce.parse,serialize:ce.serialize},de={},pe=!0,fe="[A-Za-z0-9\\-\\.\\_\\~"+(pe?"\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF":"")+"]",me="[0-9A-Fa-f]",ge=n(n("%[EFef]"+me+"%"+me+me+"%"+me+me)+"|"+n("%[89A-Fa-f]"+me+"%"+me+me)+"|"+n("%"+me+me)),ve="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",ye="[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",xe=t(ye,'[\\"\\\\]'),be="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",we=new RegExp(fe,"g"),_e=new RegExp(ge,"g"),Ae=new RegExp(t("[^]",ve,"[\\.]",'[\\"]',xe),"g"),Se=new RegExp(t("[^]",fe,be),"g"),Ee=Se;function Me(e){var t=H(e);return t.match(we)?t:e}var Te={scheme:"mailto",parse:function(e,t){var n=e,r=n.to=n.path?n.path.split(","):[];if(n.path=void 0,n.query){for(var i=!1,o={},s=n.query.split("&"),a=0,l=s.length;a<l;++a){var u=s[a].split("=");switch(u[0]){case"to":for(var c=u[1].split(","),h=0,d=c.length;h<d;++h)r.push(c[h]);break;case"subject":n.subject=ue(u[1],t);break;case"body":n.body=ue(u[1],t);break;default:i=!0,o[ue(u[0],t)]=ue(u[1],t);break}}i&&(n.headers=o)}n.query=void 0;for(var p=0,f=r.length;p<f;++p){var m=r[p].split("@");if(m[0]=ue(m[0]),t.unicodeSupport)m[1]=ue(m[1],t).toLowerCase();else try{m[1]=U.toASCII(ue(m[1],t).toLowerCase())}catch(g){n.error=n.error||"Email address's domain name can not be converted to ASCII via punycode: "+g}r[p]=m.join("@")}return n},serialize:function(e,t){var n=e,r=o(e.to);if(r){for(var s=0,a=r.length;s<a;++s){var l=String(r[s]),u=l.lastIndexOf("@"),c=l.slice(0,u).replace(_e,Me).replace(_e,i).replace(Ae,B),h=l.slice(u+1);try{h=t.iri?U.toUnicode(h):U.toASCII(ue(h,t).toLowerCase())}catch(m){n.error=n.error||"Email address's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+m}r[s]=c+"@"+h}n.path=r.join(",")}var d=e.headers=e.headers||{};e.subject&&(d["subject"]=e.subject),e.body&&(d["body"]=e.body);var p=[];for(var f in d)d[f]!==de[f]&&p.push(f.replace(_e,Me).replace(_e,i).replace(Se,B)+"="+d[f].replace(_e,Me).replace(_e,i).replace(Ee,B));return p.length&&(n.query=p.join("&")),n}},Ce=/^([^\:]+)\:(.*)/,Pe={scheme:"urn",parse:function(e,t){var n=e.path&&e.path.match(Ce),r=e;if(n){var i=t.scheme||r.scheme||"urn",o=n[1].toLowerCase(),s=n[2],a=i+":"+(t.nid||o),l=j[a];r.nid=o,r.nss=s,r.path=void 0,l&&(r=l.parse(r,t))}else r.error=r.error||"URN can not be parsed.";return r},serialize:function(e,t){var n=t.scheme||e.scheme||"urn",r=e.nid,i=n+":"+(t.nid||r),o=j[i];o&&(e=o.serialize(e,t));var s=e,a=e.nss;return s.path=(r||t.nid)+":"+a,s}},Re=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,Le={scheme:"urn:uuid",parse:function(e,t){var n=e;return n.uuid=n.nss,n.nss=void 0,t.tolerant||n.uuid&&n.uuid.match(Re)||(n.error=n.error||"UUID is not valid."),n},serialize:function(e,t){var n=e;return n.nss=(e.uuid||"").toLowerCase(),n}};j[ce.scheme]=ce,j[he.scheme]=he,j[Te.scheme]=Te,j[Pe.scheme]=Pe,j[Le.scheme]=Le,e.SCHEMES=j,e.pctEncChar=B,e.pctDecChars=H,e.parse=Z,e.removeDotSegments=ne,e.serialize=re,e.resolveComponents=ie,e.resolve=oe,e.normalize=se,e.equal=ae,e.escapeComponent=le,e.unescapeComponent=ue,Object.defineProperty(e,"__esModule",{value:!0})}))},"4f8a":function(e,t,n){(function(t){e.exports=function(){return t.WebSocket||t.MozWebSocket}}).call(this,n("c8ba"))},5377:function(e,t,n){var r=n("83ab"),i=n("9bf2"),o=n("ad6d"),s=n("9f7f").UNSUPPORTED_Y;r&&("g"!=/./g.flags||s)&&i.f(RegExp.prototype,"flags",{configurable:!0,get:o})},5698:function(e,t,n){var r=this,i=["document","window","navigator","CSSStyleDeclaration","d3","Sizzle"],o={};i.forEach((function(e){e in r&&(o[e]=r[e])})),navigator=window.navigator,CSSStyleDeclaration=window.CSSStyleDeclaration,Sizzle=n("9091"),n("e735"),e.exports=d3,i.forEach((function(e){e in o?r[e]=o[e]:delete r[e]}))},5915:function(e,t,n){var r=n("1f8f"),i=n("74d0"),o=n("32ce"),s=n("17fb"),a=e.exports=function(e){r.call(this,e),this.dipPosition=e.dipPosition,this.pipPosition=e.pipPosition,this.mcpPosition=e.mcpPosition,this.carpPosition=e.carpPosition,this.extended=e.extended,this.type=e.type,this.finger=!0,this.positions=[this.carpPosition,this.mcpPosition,this.pipPosition,this.dipPosition,this.tipPosition],e.bases?this.addBones(e):o.warnBones()};s.extend(a.prototype,r.prototype),a.prototype.addBones=function(e){this.metacarpal=new i(this,{type:0,width:this.width,prevJoint:this.carpPosition,nextJoint:this.mcpPosition,basis:e.bases[0]}),this.proximal=new i(this,{type:1,width:this.width,prevJoint:this.mcpPosition,nextJoint:this.pipPosition,basis:e.bases[1]}),this.medial=new i(this,{type:2,width:this.width,prevJoint:this.pipPosition,nextJoint:this.dipPosition,basis:e.bases[2]}),this.distal=new i(this,{type:3,width:this.width,prevJoint:this.dipPosition,nextJoint:e.btipPosition,basis:e.bases[3]}),this.bones=[this.metacarpal,this.proximal,this.medial,this.distal]},a.prototype.toString=function(){return"Finger [ id:"+this.id+" "+this.length+"mmx | width:"+this.width+"mm | direction:"+this.direction+" ]"},a.Invalid={valid:!1}},"5a43":function(e,t){function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}e.exports=n},"5c3d":function(e,t,n){"use strict";e.exports=function(e,t,n){var r=" ",i=e.schema[t],o=e.errSchemaPath+"/"+t,s=(e.opts.allErrors,e.util.toQuotedString(i));return!0===e.opts.$comment?r+=" console.log("+s+");":"function"==typeof e.opts.$comment&&(r+=" self._opts.$comment("+s+", "+e.util.toQuotedString(o)+", validate.root.schema);"),r}},"5c62":function(e,t,n){"use strict";n.r(t),n.d(t,"initEmbedJolecule",(function(){return Up})),n.d(t,"initFullPageJolecule",(function(){return jp})),n.d(t,"makePdbDataServer",(function(){return Hp})),n.d(t,"makeDataServer",(function(){return Gp})),n.d(t,"AquariaAlignment",(function(){return zp}));var r=n("1157"),i=n.n(r),o=n("2ef0"),s=n.n(o);function a(){}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"===typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype===!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&function(){Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}}(),Object.assign(a.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners,r=n[e];if(void 0!==r){var i=r.indexOf(t);-1!==i&&r.splice(i,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners,n=t[e.type];if(void 0!==n){e.target=this;for(var r=n.slice(0),i=0,o=r.length;i<o;i++)r[i].call(this,e)}}}});var l="92",u=0,c=1,h=2,d=1,p=2,f=0,m=1,g=2,v=1,y=0,x=1,b=2,w=0,_=1,A=2,S=3,E=4,M=5,T=100,C=101,P=102,R=103,L=104,O=200,D=201,I=202,k=203,N=204,F=205,V=206,z=207,U=208,j=209,B=210,H=0,G=1,q=2,W=3,$=4,X=5,Y=6,Z=7,J=0,Q=1,K=2,ee=0,te=1,ne=2,re=3,ie=4,oe=300,se=301,ae=302,le=303,ue=304,ce=305,he=306,de=307,pe=1e3,fe=1001,me=1002,ge=1003,ve=1004,ye=1005,xe=1006,be=1007,we=1008,_e=1009,Ae=1010,Se=1011,Ee=1012,Me=1013,Te=1014,Ce=1015,Pe=1016,Re=1017,Le=1018,Oe=1019,De=1020,Ie=1021,ke=1022,Ne=1023,Fe=1024,Ve=1025,ze=1026,Ue=1027,je=33776,Be=33777,He=33778,Ge=33779,qe=35840,We=35841,$e=35842,Xe=35843,Ye=36196,Ze=37808,Je=37809,Qe=37810,Ke=37811,et=37812,tt=37813,nt=37814,rt=37815,it=37816,ot=37817,st=37818,at=37819,lt=37820,ut=37821,ct=2200,ht=2201,dt=2202,pt=2300,ft=2301,mt=2302,gt=2400,vt=2401,yt=2402,xt=0,bt=1,wt=2,_t=3e3,At=3001,St=3007,Et=3002,Mt=3004,Tt=3005,Ct=3006,Pt=3200,Rt=3201,Lt={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0,o=e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&i]+e[i>>8&255]+e[i>>16&255]+e[i>>24&255];return o.toUpperCase()}}(),clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*(3-2*e))},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*e*(e*(6*e-15)+10))},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Lt.DEG2RAD},radToDeg:function(e){return e*Lt.RAD2DEG},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function Ot(e,t){this.x=e||0,this.y=t||0}function Dt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function It(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==r?r:1}function kt(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}function Nt(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(Ot.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Ot.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(){var e=new Ot,t=new Ot;return function(n,r){return e.set(n,n),t.set(r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*n-o*r+e.x,this.y=i*r+o*n+e.y,this}}),Object.assign(Dt.prototype,{isMatrix4:!0,set:function(e,t,n,r,i,o,s,a,l,u,c,h,d,p,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Dt).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(){var e=new kt;return function(t){var n=this.elements,r=t.elements,i=1/e.setFromMatrixColumn(t,0).length(),o=1/e.setFromMatrixColumn(t,1).length(),s=1/e.setFromMatrixColumn(t,2).length();return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[4]=r[4]*o,n[5]=r[5]*o,n[6]=r[6]*o,n[8]=r[8]*s,n[9]=r[9]*s,n[10]=r[10]*s,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,r=e.y,i=e.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(r),l=Math.sin(r),u=Math.cos(i),c=Math.sin(i);if("XYZ"===e.order){var h=o*u,d=o*c,p=s*u,f=s*c;t[0]=a*u,t[4]=-a*c,t[8]=l,t[1]=d+p*l,t[5]=h-f*l,t[9]=-s*a,t[2]=f-h*l,t[6]=p+d*l,t[10]=o*a}else if("YXZ"===e.order){var m=a*u,g=a*c,v=l*u,y=l*c;t[0]=m+y*s,t[4]=v*s-g,t[8]=o*l,t[1]=o*c,t[5]=o*u,t[9]=-s,t[2]=g*s-v,t[6]=y+m*s,t[10]=o*a}else if("ZXY"===e.order){m=a*u,g=a*c,v=l*u,y=l*c;t[0]=m-y*s,t[4]=-o*c,t[8]=v+g*s,t[1]=g+v*s,t[5]=o*u,t[9]=y-m*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){h=o*u,d=o*c,p=s*u,f=s*c;t[0]=a*u,t[4]=p*l-d,t[8]=h*l+f,t[1]=a*c,t[5]=f*l+h,t[9]=d*l-p,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){var x=o*a,b=o*l,w=s*a,_=s*l;t[0]=a*u,t[4]=_-x*c,t[8]=w*c+b,t[1]=c,t[5]=o*u,t[9]=-s*u,t[2]=-l*u,t[6]=b*c+w,t[10]=x-_*c}else if("XZY"===e.order){x=o*a,b=o*l,w=s*a,_=s*l;t[0]=a*u,t[4]=-c,t[8]=l*u,t[1]=x*c+_,t[5]=o*u,t[9]=b*c-w,t[2]=w*c-b,t[6]=s*u,t[10]=_*c+x}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,n=e._x,r=e._y,i=e._z,o=e._w,s=n+n,a=r+r,l=i+i,u=n*s,c=n*a,h=n*l,d=r*a,p=r*l,f=i*l,m=o*s,g=o*a,v=o*l;return t[0]=1-(d+f),t[4]=c-v,t[8]=h+g,t[1]=c+v,t[5]=1-(u+f),t[9]=p-m,t[2]=h-g,t[6]=p+m,t[10]=1-(u+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new kt,t=new kt,n=new kt;return function(r,i,o){var s=this.elements;return n.subVectors(r,i),0===n.lengthSq()&&(n.z=1),n.normalize(),e.crossVectors(o,n),0===e.lengthSq()&&(1===Math.abs(o.z)?n.x+=1e-4:n.z+=1e-4,n.normalize(),e.crossVectors(o,n)),e.normalize(),t.crossVectors(n,e),s[0]=e.x,s[4]=t.x,s[8]=n.x,s[1]=e.y,s[5]=t.y,s[9]=n.y,s[2]=e.z,s[6]=t.z,s[10]=n.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,o=n[0],s=n[4],a=n[8],l=n[12],u=n[1],c=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],x=n[11],b=n[15],w=r[0],_=r[4],A=r[8],S=r[12],E=r[1],M=r[5],T=r[9],C=r[13],P=r[2],R=r[6],L=r[10],O=r[14],D=r[3],I=r[7],k=r[11],N=r[15];return i[0]=o*w+s*E+a*P+l*D,i[4]=o*_+s*M+a*R+l*I,i[8]=o*A+s*T+a*L+l*k,i[12]=o*S+s*C+a*O+l*N,i[1]=u*w+c*E+h*P+d*D,i[5]=u*_+c*M+h*R+d*I,i[9]=u*A+c*T+h*L+d*k,i[13]=u*S+c*C+h*O+d*N,i[2]=p*w+f*E+m*P+g*D,i[6]=p*_+f*M+m*R+g*I,i[10]=p*A+f*T+m*L+g*k,i[14]=p*S+f*C+m*O+g*N,i[3]=v*w+y*E+x*P+b*D,i[7]=v*_+y*M+x*R+b*I,i[11]=v*A+y*T+x*L+b*k,i[15]=v*S+y*C+x*O+b*N,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new kt;return function(t){for(var n=0,r=t.count;n<r;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.applyMatrix4(this),t.setXYZ(n,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],s=e[5],a=e[9],l=e[13],u=e[2],c=e[6],h=e[10],d=e[14],p=e[3],f=e[7],m=e[11],g=e[15];return p*(+i*a*c-r*l*c-i*s*h+n*l*h+r*s*d-n*a*d)+f*(+t*a*d-t*l*h+i*o*h-r*o*d+r*l*u-i*a*u)+m*(+t*l*c-t*s*d-i*o*c+n*o*d+i*s*u-n*l*u)+g*(-r*s*u-t*a*c+t*s*h+r*o*c-n*o*h+n*a*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,r=e.elements,i=r[0],o=r[1],s=r[2],a=r[3],l=r[4],u=r[5],c=r[6],h=r[7],d=r[8],p=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],x=r[15],b=p*y*h-v*f*h+v*c*m-u*y*m-p*c*x+u*f*x,w=g*f*h-d*y*h-g*c*m+l*y*m+d*c*x-l*f*x,_=d*v*h-g*p*h+g*u*m-l*v*m-d*u*x+l*p*x,A=g*p*c-d*v*c-g*u*f+l*v*f+d*u*y-l*p*y,S=i*b+o*w+s*_+a*A;if(0===S){var E="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(E);return console.warn(E),this.identity()}var M=1/S;return n[0]=b*M,n[1]=(v*f*a-p*y*a-v*s*m+o*y*m+p*s*x-o*f*x)*M,n[2]=(u*y*a-v*c*a+v*s*h-o*y*h-u*s*x+o*c*x)*M,n[3]=(p*c*a-u*f*a-p*s*h+o*f*h+u*s*m-o*c*m)*M,n[4]=w*M,n[5]=(d*y*a-g*f*a+g*s*m-i*y*m-d*s*x+i*f*x)*M,n[6]=(g*c*a-l*y*a-g*s*h+i*y*h+l*s*x-i*c*x)*M,n[7]=(l*f*a-d*c*a+d*s*h-i*f*h-l*s*m+i*c*m)*M,n[8]=_*M,n[9]=(g*p*a-d*v*a-g*o*m+i*v*m+d*o*x-i*p*x)*M,n[10]=(l*v*a-g*u*a+g*o*h-i*v*h-l*o*x+i*u*x)*M,n[11]=(d*u*a-l*p*a-d*o*h+i*p*h+l*o*m-i*u*m)*M,n[12]=A*M,n[13]=(d*v*s-g*p*s+g*o*f-i*v*f-d*o*y+i*p*y)*M,n[14]=(g*u*s-l*v*s-g*o*c+i*v*c+l*o*y-i*u*y)*M,n[15]=(l*p*s-d*u*s+d*o*c-i*p*c-l*o*f+i*u*f)*M,this},scale:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,o=e.x,s=e.y,a=e.z,l=i*o,u=i*s;return this.set(l*o+n,l*s-r*a,l*a+r*s,0,l*s+r*a,u*s+n,u*a-r*o,0,l*a-r*s,u*a+r*o,i*a*a+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){return this.makeRotationFromQuaternion(t),this.scale(n),this.setPosition(e),this},decompose:function(){var e=new kt,t=new Dt;return function(n,r,i){var o=this.elements,s=e.set(o[0],o[1],o[2]).length(),a=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length(),u=this.determinant();u<0&&(s=-s),n.x=o[12],n.y=o[13],n.z=o[14],t.copy(this);var c=1/s,h=1/a,d=1/l;return t.elements[0]*=c,t.elements[1]*=c,t.elements[2]*=c,t.elements[4]*=h,t.elements[5]*=h,t.elements[6]*=h,t.elements[8]*=d,t.elements[9]*=d,t.elements[10]*=d,r.setFromRotationMatrix(t),i.x=s,i.y=a,i.z=l,this}}(),makePerspective:function(e,t,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var s=this.elements,a=2*i/(t-e),l=2*i/(n-r),u=(t+e)/(t-e),c=(n+r)/(n-r),h=-(o+i)/(o-i),d=-2*o*i/(o-i);return s[0]=a,s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=l,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=h,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(e,t,n,r,i,o){var s=this.elements,a=1/(t-e),l=1/(n-r),u=1/(o-i),c=(t+e)*a,h=(n+r)*l,d=(o+i)*u;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-c,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-h,s[2]=0,s[6]=0,s[10]=-2*u,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(e){for(var t=this.elements,n=e.elements,r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}),Object.assign(It,{slerp:function(e,t,n,r){return n.copy(e).slerp(t,r)},slerpFlat:function(e,t,n,r,i,o,s){var a=n[r+0],l=n[r+1],u=n[r+2],c=n[r+3],h=i[o+0],d=i[o+1],p=i[o+2],f=i[o+3];if(c!==f||a!==h||l!==d||u!==p){var m=1-s,g=a*h+l*d+u*p+c*f,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var x=Math.sqrt(y),b=Math.atan2(x,g*v);m=Math.sin(m*b)/x,s=Math.sin(s*b)/x}var w=s*v;if(a=a*m+h*w,l=l*m+d*w,u=u*m+p*w,c=c*m+f*w,m===1-s){var _=1/Math.sqrt(a*a+l*l+u*u+c*c);a*=_,l*=_,u*=_,c*=_}}e[t]=a,e[t+1]=l,e[t+2]=u,e[t+3]=c}}),Object.defineProperties(It.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(It.prototype,{set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,r=e._y,i=e._z,o=e.order,s=Math.cos,a=Math.sin,l=s(n/2),u=s(r/2),c=s(i/2),h=a(n/2),d=a(r/2),p=a(i/2);return"XYZ"===o?(this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p):"YXZ"===o?(this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p):"ZXY"===o?(this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p):"ZYX"===o?(this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p):"YZX"===o?(this._x=h*u*c+l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c-h*d*p):"XZY"===o&&(this._x=h*u*c-l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c+h*d*p),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,n=e.elements,r=n[0],i=n[4],o=n[8],s=n[1],a=n[5],l=n[9],u=n[2],c=n[6],h=n[10],d=r+a+h;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(c-l)*t,this._y=(o-u)*t,this._z=(s-i)*t):r>a&&r>h?(t=2*Math.sqrt(1+r-a-h),this._w=(c-l)/t,this._x=.25*t,this._y=(i+s)/t,this._z=(o+u)/t):a>h?(t=2*Math.sqrt(1+a-r-h),this._w=(o-u)/t,this._x=(i+s)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+h-r-a),this._w=(s-i)/t,this._x=(o+u)/t,this._y=(l+c)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t=new kt,n=1e-6;return function(r,i){return void 0===t&&(t=new kt),e=r.dot(i)+1,e<n?(e=0,Math.abs(r.x)>Math.abs(r.z)?t.set(-r.y,r.x,0):t.set(0,-r.z,r.y)):t.crossVectors(r,i),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var n=e._x,r=e._y,i=e._z,o=e._w,s=t._x,a=t._y,l=t._z,u=t._w;return this._x=n*u+o*s+r*l-i*a,this._y=r*u+o*a+i*s-n*l,this._z=i*u+o*l+n*a-r*s,this._w=o*u-n*s-r*a-i*l,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,i=this._z,o=this._w,s=o*e._w+n*e._x+r*e._y+i*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;var a=Math.sqrt(1-s*s);if(Math.abs(a)<.001)return this._w=.5*(o+this._w),this._x=.5*(n+this._x),this._y=.5*(r+this._y),this._z=.5*(i+this._z),this;var l=Math.atan2(a,s),u=Math.sin((1-t)*l)/a,c=Math.sin(t*l)/a;return this._w=o*u+this._w*c,this._x=n*u+this._x*c,this._y=r*u+this._y*c,this._z=i*u+this._z*c,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(kt.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e=new It;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}}(),applyAxisAngle:function(){var e=new It;return function(t,n){return this.applyQuaternion(e.setFromAxisAngle(t,n))}}(),applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,o=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*o,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*r-s*n,u=a*n+s*t-i*r,c=a*r+i*n-o*t,h=-i*t-o*n-s*r;return this.x=l*a+h*-i+u*-s-c*-o,this.y=u*a+h*-o+c*-i-l*-s,this.z=c*a+h*-s+l*-o-u*-i,this},project:function(){var e=new Dt;return function(t){return e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyMatrix4(e)}}(),unproject:function(){var e=new Dt;return function(t){return e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyMatrix4(e)}}(),transformDirection:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e=new kt,t=new kt;return function(n,r){return e.set(n,n,n),t.set(r,r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var n=e.x,r=e.y,i=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-i*s,this.y=i*o-n*a,this.z=n*s-r*o,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new kt;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new kt;return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(Lt.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this},setFromCylindrical:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(Nt.prototype,{isMatrix3:!0,set:function(e,t,n,r,i,o,s,a,l){var u=this.elements;return u[0]=e,u[1]=r,u[2]=s,u[3]=t,u[4]=i,u[5]=a,u[6]=n,u[7]=o,u[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var e=new kt;return function(t){for(var n=0,r=t.count;n<r;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.applyMatrix3(this),t.setXYZ(n,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,o=n[0],s=n[3],a=n[6],l=n[1],u=n[4],c=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],x=r[7],b=r[2],w=r[5],_=r[8];return i[0]=o*f+s*v+a*b,i[3]=o*m+s*y+a*w,i[6]=o*g+s*x+a*_,i[1]=l*f+u*v+c*b,i[4]=l*m+u*y+c*w,i[7]=l*g+u*x+c*_,i[2]=h*f+d*v+p*b,i[5]=h*m+d*y+p*w,i[8]=h*g+d*x+p*_,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],u=e[8];return t*o*u-t*s*l-n*i*u+n*s*a+r*i*l-r*o*a},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=e.elements,r=this.elements,i=n[0],o=n[1],s=n[2],a=n[3],l=n[4],u=n[5],c=n[6],h=n[7],d=n[8],p=d*l-u*h,f=u*c-d*a,m=h*a-l*c,g=i*p+o*f+s*m;if(0===g){var v="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(v);return console.warn(v),this.identity()}var y=1/g;return r[0]=p*y,r[1]=(s*h-d*o)*y,r[2]=(u*o-s*l)*y,r[3]=f*y,r[4]=(d*i-s*c)*y,r[5]=(s*a-u*i)*y,r[6]=m*y,r[7]=(o*c-h*i)*y,r[8]=(l*i-o*a)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,n,r,i,o,s){var a=Math.cos(i),l=Math.sin(i);this.set(n*a,n*l,-n*(a*o+l*s)+o+e,-r*l,r*a,-r*(-l*o+a*s)+s+t,0,0,1)},scale:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],o=r[3],s=r[6],a=r[1],l=r[4],u=r[7];return r[0]=t*i+n*a,r[3]=t*o+n*l,r[6]=t*s+n*u,r[1]=-n*i+t*a,r[4]=-n*o+t*l,r[7]=-n*s+t*u,this},translate:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this},equals:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<9;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}});var Ft=0;function Vt(e,t,n,r,i,o,s,a,l,u){Object.defineProperty(this,"id",{value:Ft++}),this.uuid=Lt.generateUUID(),this.name="",this.image=void 0!==e?e:Vt.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Vt.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:fe,this.wrapT=void 0!==r?r:fe,this.magFilter=void 0!==i?i:xe,this.minFilter=void 0!==o?o:we,this.anisotropy=void 0!==l?l:1,this.format=void 0!==s?s:Ne,this.type=void 0!==a?a:_e,this.offset=new Ot(0,0),this.repeat=new Ot(1,1),this.center=new Ot(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Nt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==u?u:_t,this.version=0,this.onUpdate=null}function zt(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1}function Ut(e,t,n){this.width=e,this.height=t,this.scissor=new zt(0,0,e,t),this.scissorTest=!1,this.viewport=new zt(0,0,e,t),n=n||{},void 0===n.minFilter&&(n.minFilter=xe),this.texture=new Vt(void 0,void 0,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function jt(e,t,n){Ut.call(this,e,t,n),this.activeCubeFace=0,this.activeMipMapLevel=0}function Bt(e,t,n,r,i,o,s,a,l,u,c,h){Vt.call(this,null,o,s,a,l,u,r,i,c,h),this.image={data:e,width:t,height:n},this.magFilter=void 0!==l?l:ge,this.minFilter=void 0!==u?u:ge,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function Ht(e,t){this.min=void 0!==e?e:new kt(1/0,1/0,1/0),this.max=void 0!==t?t:new kt(-1/0,-1/0,-1/0)}function Gt(e,t){this.center=void 0!==e?e:new kt,this.radius=void 0!==t?t:0}function qt(e,t){this.normal=void 0!==e?e:new kt(1,0,0),this.constant=void 0!==t?t:0}function Wt(e,t,n,r,i,o){this.planes=[void 0!==e?e:new qt,void 0!==t?t:new qt,void 0!==n?n:new qt,void 0!==r?r:new qt,void 0!==i?i:new qt,void 0!==o?o:new qt]}Vt.DEFAULT_IMAGE=void 0,Vt.DEFAULT_MAPPING=oe,Vt.prototype=Object.assign(Object.create(a.prototype),{constructor:Vt,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];function n(e){var t;if(e instanceof HTMLCanvasElement)t=e;else{t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),t.width=e.width,t.height=e.height;var n=t.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height)}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var i=this.image;void 0===i.uuid&&(i.uuid=Lt.generateUUID()),t||void 0!==e.images[i.uuid]||(e.images[i.uuid]={uuid:i.uuid,url:n(i)}),r.image=i.uuid}return t||(e.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping===oe){if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case pe:e.x=e.x-Math.floor(e.x);break;case fe:e.x=e.x<0?0:1;break;case me:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case pe:e.y=e.y-Math.floor(e.y);break;case fe:e.y=e.y<0?0:1;break;case me:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}this.flipY&&(e.y=1-e.y)}}}),Object.defineProperty(Vt.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(zt.prototype,{isVector4:!0,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,r,i,o=.01,s=.1,a=e.elements,l=a[0],u=a[4],c=a[8],h=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(u-h)<o&&Math.abs(c-f)<o&&Math.abs(p-m)<o){if(Math.abs(u+h)<s&&Math.abs(c+f)<s&&Math.abs(p+m)<s&&Math.abs(l+d+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;var v=(l+1)/2,y=(d+1)/2,x=(g+1)/2,b=(u+h)/4,w=(c+f)/4,_=(p+m)/4;return v>y&&v>x?v<o?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(v),r=b/n,i=w/n):y>x?y<o?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(y),n=b/r,i=_/r):x<o?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(x),n=w/i,r=_/i),this.set(n,r,i,t),this}var A=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(h-u)*(h-u));return Math.abs(A)<.001&&(A=1),this.x=(m-p)/A,this.y=(c-f)/A,this.z=(h-u)/A,this.w=Math.acos((l+d+g-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(n,r){return void 0===e&&(e=new zt,t=new zt),e.set(n,n,n,n),t.set(r,r,r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Ut.prototype=Object.assign(Object.create(a.prototype),{constructor:Ut,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),jt.prototype=Object.create(Ut.prototype),jt.prototype.constructor=jt,jt.prototype.isWebGLRenderTargetCube=!0,Bt.prototype=Object.create(Vt.prototype),Bt.prototype.constructor=Bt,Bt.prototype.isDataTexture=!0,Object.assign(Ht.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,s=-1/0,a=0,l=e.length;a<l;a+=3){var u=e[a],c=e[a+1],h=e[a+2];u<t&&(t=u),c<n&&(n=c),h<r&&(r=h),u>i&&(i=u),c>o&&(o=c),h>s&&(s=h)}return this.min.set(t,n,r),this.max.set(i,o,s),this},setFromBufferAttribute:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,s=-1/0,a=0,l=e.count;a<l;a++){var u=e.getX(a),c=e.getY(a),h=e.getZ(a);u<t&&(t=u),c<n&&(n=c),h<r&&(r=h),u>i&&(i=u),c>o&&(o=c),h>s&&(s=h)}return this.min.set(t,n,r),this.max.set(i,o,s),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new kt;return function(t,n){var r=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new kt),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new kt),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){var e,t,n,r=new kt;function i(i){var o=i.geometry;if(void 0!==o)if(o.isGeometry){var s=o.vertices;for(t=0,n=s.length;t<n;t++)r.copy(s[t]),r.applyMatrix4(i.matrixWorld),e.expandByPoint(r)}else if(o.isBufferGeometry){var a=o.attributes.position;if(void 0!==a)for(t=0,n=a.count;t<n;t++)r.fromBufferAttribute(a,t).applyMatrix4(i.matrixWorld),e.expandByPoint(r)}}return function(t){return e=this,t.updateMatrixWorld(!0),t.traverse(i),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new kt),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(){var e=new kt;return function(t){return this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=e.constant&&n>=e.constant},intersectsTriangle:function(){var e=new kt,t=new kt,n=new kt,r=new kt,i=new kt,o=new kt,s=new kt,a=new kt,l=new kt,u=new kt;function c(r){var i,o;for(i=0,o=r.length-3;i<=o;i+=3){s.fromArray(r,i);var a=l.x*Math.abs(s.x)+l.y*Math.abs(s.y)+l.z*Math.abs(s.z),u=e.dot(s),c=t.dot(s),h=n.dot(s);if(Math.max(-Math.max(u,c,h),Math.min(u,c,h))>a)return!1}return!0}return function(s){if(this.isEmpty())return!1;this.getCenter(a),l.subVectors(this.max,a),e.subVectors(s.a,a),t.subVectors(s.b,a),n.subVectors(s.c,a),r.subVectors(t,e),i.subVectors(n,t),o.subVectors(e,n);var h=[0,-r.z,r.y,0,-i.z,i.y,0,-o.z,o.y,r.z,0,-r.x,i.z,0,-i.x,o.z,0,-o.x,-r.y,r.x,0,-i.y,i.x,0,-o.y,o.x,0];return!!c(h)&&(h=[1,0,0,0,1,0,0,0,1],!!c(h)&&(u.crossVectors(r,i),h=[u.x,u.y,u.z],c(h)))}}(),clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new kt),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new kt;return function(t){var n=e.copy(t).clamp(this.min,this.max);return n.sub(t).length()}}(),getBoundingSphere:function(){var e=new kt;return function(t){return void 0===t&&(console.warn("THREE.Box3: .getBoundingSphere() target is now required"),t=new Gt),this.getCenter(t.center),t.radius=.5*this.getSize(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new kt,new kt,new kt,new kt,new kt,new kt,new kt,new kt];return function(t){return this.isEmpty()||(e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(e)),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(Gt.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new Ht;return function(t,n){var r=this.center;void 0!==n?r.copy(n):e.setFromPoints(t).getCenter(r);for(var i=0,o=0,s=t.length;o<s;o++)i=Math.max(i,r.distanceToSquared(t[o]));return this.radius=Math.sqrt(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new kt),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Ht),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(qt.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new kt,t=new kt;return function(n,r,i){var o=e.subVectors(i,r).cross(t.subVectors(n,r)).normalize();return this.setFromNormalAndCoplanarPoint(o,n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new kt),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new kt;return function(t,n){void 0===n&&(console.warn("THREE.Plane: .intersectLine() target is now required"),n=new kt);var r=t.delta(e),i=this.normal.dot(r);if(0===i)return 0===this.distanceToPoint(t.start)?n.copy(t.start):void 0;var o=-(t.start.dot(this.normal)+this.constant)/i;return o<0||o>1?void 0:n.copy(r).multiplyScalar(o).add(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new kt),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new kt,t=new Nt;return function(n,r){var i=r||t.getNormalMatrix(n),o=this.coplanarPoint(e).applyMatrix4(n),s=this.normal.applyMatrix3(i).normalize();return this.constant=-o.dot(s),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(Wt.prototype,{set:function(e,t,n,r,i,o){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(r),s[4].copy(i),s[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],l=n[5],u=n[6],c=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return t[0].setComponents(s-r,c-a,f-h,y-m).normalize(),t[1].setComponents(s+r,c+a,f+h,y+m).normalize(),t[2].setComponents(s+i,c+l,f+d,y+g).normalize(),t[3].setComponents(s-i,c-l,f-d,y-g).normalize(),t[4].setComponents(s-o,c-u,f-p,y-v).normalize(),t[5].setComponents(s+o,c+u,f+p,y+v).normalize(),this},intersectsObject:function(){var e=new Gt;return function(t){var n=t.geometry;return null===n.boundingSphere&&n.computeBoundingSphere(),e.copy(n.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new Gt;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,n=e.center,r=-e.radius,i=0;i<6;i++){var o=t[i].distanceToPoint(n);if(o<r)return!1}return!0},intersectsBox:function(){var e=new kt,t=new kt;return function(n){for(var r=this.planes,i=0;i<6;i++){var o=r[i];e.x=o.normal.x>0?n.min.x:n.max.x,t.x=o.normal.x>0?n.max.x:n.min.x,e.y=o.normal.y>0?n.min.y:n.max.y,t.y=o.normal.y>0?n.max.y:n.min.y,e.z=o.normal.z>0?n.min.z:n.max.z,t.z=o.normal.z>0?n.max.z:n.min.z;var s=o.distanceToPoint(e),a=o.distanceToPoint(t);if(s<0&&a<0)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}});var $t="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",Xt="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",Yt="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",Zt="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",Jt="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",Qt="\nvec3 transformed = vec3( position );\n",Kt="\nvec3 objectNormal = vec3( normal );\n",en="float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",tn="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",nn="#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif\n",rn="#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",on="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",sn="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",an="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",ln="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",un="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",cn="#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",hn="#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n",dn="#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",pn="vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",fn="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",mn="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",gn="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",vn="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",yn="  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",xn="\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",bn="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",wn="#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",_n="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",An="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",Sn="\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",En="#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",Mn="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",Tn="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",Cn="#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",Pn="#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",Rn="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",Ln="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",On="uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n",Dn="#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",In="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",kn="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",Nn="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",Fn="struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",Vn="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n",zn="#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), maxMipLevel );\n\t#ifndef STANDARD\n\t\tclearCoatRadiance += getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), maxMipLevel );\n\t#endif\n#endif\n",Un="#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",jn="#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",Bn="#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",Hn="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",Gn="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n",qn="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",Wn="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",$n="#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",Xn="#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n",Yn="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",Zn="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",Jn="#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",Qn="#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",Kn="#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",er="#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n",tr="#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",nr="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\t\tscale *= float( gl_FrontFacing ) * 2.0 - 1.0;\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",rr="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",ir="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",or="vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",sr="#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",ar="#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",lr="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",ur="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",cr="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",hr="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",dr="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",pr="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",fr="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",mr="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",gr="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",vr="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",yr="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",xr="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",br="#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",wr="#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",_r="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",Ar="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n",Sr="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",Er="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",Mr="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",Tr="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",Cr="#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",Pr="uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",Rr="varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n",Lr="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",Or="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",Dr="#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",Ir="#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",kr="uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",Nr="varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",Fr="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",Vr="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",zr="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",Ur="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",jr="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",Br="#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",Hr="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",Gr="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",qr="#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars_begin>\n#include <lights_pars_maps>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",Wr="#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",$r="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",Xr="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",Yr="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",Zr="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",Jr="uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n",Qr="#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",Kr={alphamap_fragment:$t,alphamap_pars_fragment:Xt,alphatest_fragment:Yt,aomap_fragment:Zt,aomap_pars_fragment:Jt,begin_vertex:Qt,beginnormal_vertex:Kt,bsdfs:en,bumpmap_pars_fragment:tn,clipping_planes_fragment:nn,clipping_planes_pars_fragment:rn,clipping_planes_pars_vertex:on,clipping_planes_vertex:sn,color_fragment:an,color_pars_fragment:ln,color_pars_vertex:un,color_vertex:cn,common:hn,cube_uv_reflection_fragment:dn,defaultnormal_vertex:pn,displacementmap_pars_vertex:fn,displacementmap_vertex:mn,emissivemap_fragment:gn,emissivemap_pars_fragment:vn,encodings_fragment:yn,encodings_pars_fragment:xn,envmap_fragment:bn,envmap_pars_fragment:wn,envmap_pars_vertex:_n,envmap_vertex:An,fog_vertex:Sn,fog_pars_vertex:En,fog_fragment:Mn,fog_pars_fragment:Tn,gradientmap_pars_fragment:Cn,lightmap_fragment:Pn,lightmap_pars_fragment:Rn,lights_lambert_vertex:Ln,lights_pars_begin:On,lights_pars_maps:Dn,lights_phong_fragment:In,lights_phong_pars_fragment:kn,lights_physical_fragment:Nn,lights_physical_pars_fragment:Fn,lights_fragment_begin:Vn,lights_fragment_maps:zn,lights_fragment_end:Un,logdepthbuf_fragment:jn,logdepthbuf_pars_fragment:Bn,logdepthbuf_pars_vertex:Hn,logdepthbuf_vertex:Gn,map_fragment:qn,map_pars_fragment:Wn,map_particle_fragment:$n,map_particle_pars_fragment:Xn,metalnessmap_fragment:Yn,metalnessmap_pars_fragment:Zn,morphnormal_vertex:Jn,morphtarget_pars_vertex:Qn,morphtarget_vertex:Kn,normal_fragment_begin:er,normal_fragment_maps:tr,normalmap_pars_fragment:nr,packing:rr,premultiplied_alpha_fragment:ir,project_vertex:or,dithering_fragment:sr,dithering_pars_fragment:ar,roughnessmap_fragment:lr,roughnessmap_pars_fragment:ur,shadowmap_pars_fragment:cr,shadowmap_pars_vertex:hr,shadowmap_vertex:dr,shadowmask_pars_fragment:pr,skinbase_vertex:fr,skinning_pars_vertex:mr,skinning_vertex:gr,skinnormal_vertex:vr,specularmap_fragment:yr,specularmap_pars_fragment:xr,tonemapping_fragment:br,tonemapping_pars_fragment:wr,uv_pars_fragment:_r,uv_pars_vertex:Ar,uv_vertex:Sr,uv2_pars_fragment:Er,uv2_pars_vertex:Mr,uv2_vertex:Tr,worldpos_vertex:Cr,cube_frag:Pr,cube_vert:Rr,depth_frag:Lr,depth_vert:Or,distanceRGBA_frag:Dr,distanceRGBA_vert:Ir,equirect_frag:kr,equirect_vert:Nr,linedashed_frag:Fr,linedashed_vert:Vr,meshbasic_frag:zr,meshbasic_vert:Ur,meshlambert_frag:jr,meshlambert_vert:Br,meshphong_frag:Hr,meshphong_vert:Gr,meshphysical_frag:qr,meshphysical_vert:Wr,normal_frag:$r,normal_vert:Xr,points_frag:Yr,points_vert:Zr,shadow_frag:Jr,shadow_vert:Qr},ei={merge:function(e){for(var t={},n=0;n<e.length;n++){var r=this.clone(e[n]);for(var i in r)t[i]=r[i]}return t},clone:function(e){var t={};for(var n in e)for(var r in t[n]={},e[n]){var i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}return t}},ti={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function ni(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}Object.assign(ni.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(){function e(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}return function(t,n,r){if(t=Lt.euclideanModulo(t,1),n=Lt.clamp(n,0,1),r=Lt.clamp(r,0,1),0===n)this.r=this.g=this.b=r;else{var i=r<=.5?r*(1+n):r+n-r*n,o=2*r-i;this.r=e(o,i,t+1/3),this.g=e(o,i,t),this.b=e(o,i,t-1/3)}return this}}(),setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var r,i=n[1],o=n[2];switch(i){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var s=parseFloat(r[1])/360,a=parseInt(r[2],10)/100,l=parseInt(r[3],10)/100;return t(r[5]),this.setHSL(s,a,l)}break}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(e)){var u=n[1],c=u.length;if(3===c)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}if(e&&e.length>0){u=ti[e];void 0!==u?this.setHex(u):console.warn("THREE.Color: Unknown color "+e)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;return this.r=e*e,this.g=t*t,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,n,r=this.r,i=this.g,o=this.b,s=Math.max(r,i,o),a=Math.min(r,i,o),l=(a+s)/2;if(a===s)t=0,n=0;else{var u=s-a;switch(n=l<=.5?u/(s+a):u/(2-s-a),s){case r:t=(i-o)/u+(i<o?6:0);break;case i:t=(o-r)/u+2;break;case o:t=(r-i)/u+4;break}t/=6}return e.h=t,e.s=n,e.l=l,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(){var e={};return function(t,n,r){return this.getHSL(e),e.h+=t,e.s+=n,e.l+=r,this.setHSL(e.h,e.s,e.l),this}}(),add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}});var ri={common:{diffuse:{value:new ni(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Nt},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ot(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ni(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new ni(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Nt}}},ii={basic:{uniforms:ei.merge([ri.common,ri.specularmap,ri.envmap,ri.aomap,ri.lightmap,ri.fog]),vertexShader:Kr.meshbasic_vert,fragmentShader:Kr.meshbasic_frag},lambert:{uniforms:ei.merge([ri.common,ri.specularmap,ri.envmap,ri.aomap,ri.lightmap,ri.emissivemap,ri.fog,ri.lights,{emissive:{value:new ni(0)}}]),vertexShader:Kr.meshlambert_vert,fragmentShader:Kr.meshlambert_frag},phong:{uniforms:ei.merge([ri.common,ri.specularmap,ri.envmap,ri.aomap,ri.lightmap,ri.emissivemap,ri.bumpmap,ri.normalmap,ri.displacementmap,ri.gradientmap,ri.fog,ri.lights,{emissive:{value:new ni(0)},specular:{value:new ni(1118481)},shininess:{value:30}}]),vertexShader:Kr.meshphong_vert,fragmentShader:Kr.meshphong_frag},standard:{uniforms:ei.merge([ri.common,ri.envmap,ri.aomap,ri.lightmap,ri.emissivemap,ri.bumpmap,ri.normalmap,ri.displacementmap,ri.roughnessmap,ri.metalnessmap,ri.fog,ri.lights,{emissive:{value:new ni(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Kr.meshphysical_vert,fragmentShader:Kr.meshphysical_frag},points:{uniforms:ei.merge([ri.points,ri.fog]),vertexShader:Kr.points_vert,fragmentShader:Kr.points_frag},dashed:{uniforms:ei.merge([ri.common,ri.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Kr.linedashed_vert,fragmentShader:Kr.linedashed_frag},depth:{uniforms:ei.merge([ri.common,ri.displacementmap]),vertexShader:Kr.depth_vert,fragmentShader:Kr.depth_frag},normal:{uniforms:ei.merge([ri.common,ri.bumpmap,ri.normalmap,ri.displacementmap,{opacity:{value:1}}]),vertexShader:Kr.normal_vert,fragmentShader:Kr.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Kr.cube_vert,fragmentShader:Kr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Kr.equirect_vert,fragmentShader:Kr.equirect_frag},distanceRGBA:{uniforms:ei.merge([ri.common,ri.displacementmap,{referencePosition:{value:new kt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Kr.distanceRGBA_vert,fragmentShader:Kr.distanceRGBA_frag},shadow:{uniforms:ei.merge([ri.lights,ri.fog,{color:{value:new ni(0)},opacity:{value:1}}]),vertexShader:Kr.shadow_vert,fragmentShader:Kr.shadow_frag}};function oi(e){var t=new WeakMap;function n(t,n){var r=t.array,i=t.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW,o=e.createBuffer();e.bindBuffer(n,o),e.bufferData(n,r,i),t.onUploadCallback();var s=e.FLOAT;return r instanceof Float32Array?s=e.FLOAT:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?s=e.UNSIGNED_SHORT:r instanceof Int16Array?s=e.SHORT:r instanceof Uint32Array?s=e.UNSIGNED_INT:r instanceof Int32Array?s=e.INT:r instanceof Int8Array?s=e.BYTE:r instanceof Uint8Array&&(s=e.UNSIGNED_BYTE),{buffer:o,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}function r(t,n,r){var i=n.array,o=n.updateRange;e.bindBuffer(r,t),!1===n.dynamic?e.bufferData(r,i,e.STATIC_DRAW):-1===o.count?e.bufferSubData(r,0,i):0===o.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(r,o.offset*i.BYTES_PER_ELEMENT,i.subarray(o.offset,o.offset+o.count)),o.count=-1)}function i(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)}function o(n){n.isInterleavedBufferAttribute&&(n=n.data);var r=t.get(n);r&&(e.deleteBuffer(r.buffer),t.delete(n))}function s(e,i){e.isInterleavedBufferAttribute&&(e=e.data);var o=t.get(e);void 0===o?t.set(e,n(e,i)):o.version<e.version&&(r(o.buffer,e,i),o.version=e.version)}return{get:i,remove:o,update:s}}function si(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._order=r||si.DefaultOrder}function ai(){this.mask=1}ii.physical={uniforms:ei.merge([ii.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Kr.meshphysical_vert,fragmentShader:Kr.meshphysical_frag},si.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],si.DefaultOrder="XYZ",Object.defineProperties(si.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(si.prototype,{isEuler:!0,set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var r=Lt.clamp,i=e.elements,o=i[0],s=i[4],a=i[8],l=i[1],u=i[5],c=i[9],h=i[2],d=i[6],p=i[10];return t=t||this._order,"XYZ"===t?(this._y=Math.asin(r(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-c,p),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(d,u),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-h,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-s,u)):(this._y=0,this._z=Math.atan2(l,o))):"ZYX"===t?(this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-s,u))):"YZX"===t?(this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.99999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(a,p))):"XZY"===t?(this._z=Math.asin(-r(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(d,u),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-c,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==n&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new Dt;return function(t,n,r){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,n,r)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new It;return function(t){return e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new kt(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(ai.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!==(this.mask&e.mask)}});var li=0;function ui(){Object.defineProperty(this,"id",{value:li++}),this.uuid=Lt.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ui.DefaultUp.clone();var e=new kt,t=new si,n=new It,r=new kt(1,1,1);function i(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t.onChange(i),n.onChange(o),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:n},scale:{enumerable:!0,value:r},modelViewMatrix:{value:new Dt},normalMatrix:{value:new Nt}}),this.matrix=new Dt,this.matrixWorld=new Dt,this.matrixAutoUpdate=ui.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new ai,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function ci(){ui.call(this),this.type="Camera",this.matrixWorldInverse=new Dt,this.projectionMatrix=new Dt}function hi(e,t,n,r,i,o){ci.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=void 0!==i?i:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function di(e,t,n,r,i,o){this.a=e,this.b=t,this.c=n,this.normal=r&&r.isVector3?r:new kt,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new ni,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==o?o:0}ui.DefaultUp=new kt(0,1,0),ui.DefaultMatrixAutoUpdate=!0,ui.prototype=Object.assign(Object.create(a.prototype),{constructor:ui,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new It;return function(t,n){return e.setFromAxisAngle(t,n),this.quaternion.multiply(e),this}}(),rotateOnWorldAxis:function(){var e=new It;return function(t,n){return e.setFromAxisAngle(t,n),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new kt(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new kt(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new kt(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new kt;return function(t,n){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(n)),this}}(),translateX:function(){var e=new kt(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new kt(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new kt(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new Dt;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new Dt,t=new kt;return function(n,r,i){n.isVector3?t.copy(n):t.set(n,r,i),this.isCamera?e.lookAt(this.position,t,this.up):e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(n,1)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n],o=i.getObjectByProperty(e,t);if(void 0!==o)return o}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new kt),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new kt,t=new kt;return function(n){return void 0===n&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),n=new It),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,n,t),n}}(),getWorldScale:function(){var e=new kt,t=new It;return function(n){return void 0===n&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),n=new kt),this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,n),n}}(),getWorldDirection:function(){var e=new It;return function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new kt),this.getWorldQuaternion(e),t.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)},toJSON:function(e){var t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),void 0!==this.geometry){r.geometry=i(e.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var s=o.shapes;if(Array.isArray(s))for(var a=0,l=s.length;a<l;a++){var u=s[a];i(e.shapes,u)}else i(e.shapes,s)}}if(void 0!==this.material)if(Array.isArray(this.material)){var c=[];for(a=0,l=this.material.length;a<l;a++)c.push(i(e.materials,this.material[a]));r.material=c}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(t){var h=m(e.geometries),d=m(e.materials),p=m(e.textures),f=m(e.images);s=m(e.shapes);h.length>0&&(n.geometries=h),d.length>0&&(n.materials=d),p.length>0&&(n.textures=p),f.length>0&&(n.images=f),s.length>0&&(n.shapes=s)}return n.object=r,n;function m(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var r=e.children[n];this.add(r.clone())}return this}}),ci.prototype=Object.assign(Object.create(ui.prototype),{constructor:ci,isCamera:!0,copy:function(e,t){return ui.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},getWorldDirection:function(){var e=new It;return function(t){return void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new kt),this.getWorldQuaternion(e),t.set(0,0,-1).applyQuaternion(e)}}(),updateMatrixWorld:function(e){ui.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),hi.prototype=Object.assign(Object.create(ci.prototype),{constructor:hi,isOrthographicCamera:!0,copy:function(e,t){return ci.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-e,o=n+e,s=r+t,a=r-t;if(null!==this.view&&this.view.enabled){var l=this.zoom/(this.view.width/this.view.fullWidth),u=this.zoom/(this.view.height/this.view.fullHeight),c=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;i+=c*(this.view.offsetX/l),o=i+c*(this.view.width/l),s-=h*(this.view.offsetY/u),a=s-h*(this.view.height/u)}this.projectionMatrix.makeOrthographic(i,o,s,a,this.near,this.far)},toJSON:function(e){var t=ui.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),Object.assign(di.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var pi=0;function fi(){Object.defineProperty(this,"id",{value:pi+=2}),this.uuid=Lt.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function mi(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function gi(e,t,n){mi.call(this,new Int8Array(e),t,n)}function vi(e,t,n){mi.call(this,new Uint8Array(e),t,n)}function yi(e,t,n){mi.call(this,new Uint8ClampedArray(e),t,n)}function xi(e,t,n){mi.call(this,new Int16Array(e),t,n)}function bi(e,t,n){mi.call(this,new Uint16Array(e),t,n)}function wi(e,t,n){mi.call(this,new Int32Array(e),t,n)}function _i(e,t,n){mi.call(this,new Uint32Array(e),t,n)}function Ai(e,t,n){mi.call(this,new Float32Array(e),t,n)}function Si(e,t,n){mi.call(this,new Float64Array(e),t,n)}function Ei(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Mi(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}fi.prototype=Object.assign(Object.create(a.prototype),{constructor:fi,isGeometry:!0,applyMatrix:function(e){for(var t=(new Nt).getNormalMatrix(e),n=0,r=this.vertices.length;n<r;n++){var i=this.vertices[n];i.applyMatrix4(e)}for(n=0,r=this.faces.length;n<r;n++){var o=this.faces[n];o.normal.applyMatrix3(t).normalize();for(var s=0,a=o.vertexNormals.length;s<a;s++)o.vertexNormals[s].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e=new Dt;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new Dt;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new Dt;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new Dt;return function(t,n,r){return e.makeTranslation(t,n,r),this.applyMatrix(e),this}}(),scale:function(){var e=new Dt;return function(t,n,r){return e.makeScale(t,n,r),this.applyMatrix(e),this}}(),lookAt:function(){var e=new ui;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){var t=this,n=null!==e.index?e.index.array:void 0,r=e.attributes,i=r.position.array,o=void 0!==r.normal?r.normal.array:void 0,s=void 0!==r.color?r.color.array:void 0,a=void 0!==r.uv?r.uv.array:void 0,l=void 0!==r.uv2?r.uv2.array:void 0;void 0!==l&&(this.faceVertexUvs[1]=[]);for(var u=[],c=[],h=[],d=0,p=0;d<i.length;d+=3,p+=2)t.vertices.push(new kt(i[d],i[d+1],i[d+2])),void 0!==o&&u.push(new kt(o[d],o[d+1],o[d+2])),void 0!==s&&t.colors.push(new ni(s[d],s[d+1],s[d+2])),void 0!==a&&c.push(new Ot(a[p],a[p+1])),void 0!==l&&h.push(new Ot(l[p],l[p+1]));function f(e,n,r,i){var d=void 0!==o?[u[e].clone(),u[n].clone(),u[r].clone()]:[],p=void 0!==s?[t.colors[e].clone(),t.colors[n].clone(),t.colors[r].clone()]:[],f=new di(e,n,r,d,p,i);t.faces.push(f),void 0!==a&&t.faceVertexUvs[0].push([c[e].clone(),c[n].clone(),c[r].clone()]),void 0!==l&&t.faceVertexUvs[1].push([h[e].clone(),h[n].clone(),h[r].clone()])}var m=e.groups;if(m.length>0)for(d=0;d<m.length;d++)for(var g=m[d],v=g.start,y=g.count,x=(p=v,v+y);p<x;p+=3)void 0!==n?f(n[p],n[p+1],n[p+2],g.materialIndex):f(p,p+1,p+2,g.materialIndex);else if(void 0!==n)for(d=0;d<n.length;d+=3)f(n[d],n[d+1],n[d+2]);else for(d=0;d<i.length/3;d+=3)f(d,d+1,d+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){var e=new kt;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,r=new Dt;return r.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var e=new kt,t=new kt,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],o=this.vertices[i.a],s=this.vertices[i.b],a=this.vertices[i.c];e.subVectors(a,s),t.subVectors(o,s),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,n,r,i,o,s;for(void 0===e&&(e=!0),s=new Array(this.vertices.length),t=0,n=this.vertices.length;t<n;t++)s[t]=new kt;if(e){var a,l,u,c=new kt,h=new kt;for(r=0,i=this.faces.length;r<i;r++)o=this.faces[r],a=this.vertices[o.a],l=this.vertices[o.b],u=this.vertices[o.c],c.subVectors(u,l),h.subVectors(a,l),c.cross(h),s[o.a].add(c),s[o.b].add(c),s[o.c].add(c)}else for(this.computeFaceNormals(),r=0,i=this.faces.length;r<i;r++)o=this.faces[r],s[o.a].add(o.normal),s[o.b].add(o.normal),s[o.c].add(o.normal);for(t=0,n=this.vertices.length;t<n;t++)s[t].normalize();for(r=0,i=this.faces.length;r<i;r++){o=this.faces[r];var d=o.vertexNormals;3===d.length?(d[0].copy(s[o.a]),d[1].copy(s[o.b]),d[2].copy(s[o.c])):(d[0]=s[o.a].clone(),d[1]=s[o.b].clone(),d[2]=s[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,n;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){n=this.faces[e];var r=n.vertexNormals;3===r.length?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,n,r,i;for(n=0,r=this.faces.length;n<r;n++)for(i=this.faces[n],i.__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var o=new fi;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var s=this.morphNormals[e].faceNormals,a=this.morphNormals[e].vertexNormals;for(n=0,r=this.faces.length;n<r;n++)l=new kt,u={a:new kt,b:new kt,c:new kt},s.push(l),a.push(u)}var l,u,c=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),n=0,r=this.faces.length;n<r;n++)i=this.faces[n],l=c.faceNormals[n],u=c.vertexNormals[n],l.copy(i.normal),u.a.copy(i.vertexNormals[0]),u.b.copy(i.vertexNormals[1]),u.c.copy(i.vertexNormals[2])}for(n=0,r=this.faces.length;n<r;n++)i=this.faces[n],i.normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ht),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Gt),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e&&e.isGeometry){var r,i=this.vertices.length,o=this.vertices,s=e.vertices,a=this.faces,l=e.faces,u=this.faceVertexUvs[0],c=e.faceVertexUvs[0],h=this.colors,d=e.colors;void 0===n&&(n=0),void 0!==t&&(r=(new Nt).getNormalMatrix(t));for(var p=0,f=s.length;p<f;p++){var m=s[p],g=m.clone();void 0!==t&&g.applyMatrix4(t),o.push(g)}for(p=0,f=d.length;p<f;p++)h.push(d[p].clone());for(p=0,f=l.length;p<f;p++){var v,y,x,b=l[p],w=b.vertexNormals,_=b.vertexColors;v=new di(b.a+i,b.b+i,b.c+i),v.normal.copy(b.normal),void 0!==r&&v.normal.applyMatrix3(r).normalize();for(var A=0,S=w.length;A<S;A++)y=w[A].clone(),void 0!==r&&y.applyMatrix3(r).normalize(),v.vertexNormals.push(y);v.color.copy(b.color);for(A=0,S=_.length;A<S;A++)x=_[A],v.vertexColors.push(x.clone());v.materialIndex=b.materialIndex+n,a.push(v)}for(p=0,f=c.length;p<f;p++){var E=c[p],M=[];if(void 0!==E){for(A=0,S=E.length;A<S;A++)M.push(E[A].clone());u.push(M)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,n,r,i,o,s,a,l={},u=[],c=[],h=4,d=Math.pow(10,h);for(n=0,r=this.vertices.length;n<r;n++)e=this.vertices[n],t=Math.round(e.x*d)+"_"+Math.round(e.y*d)+"_"+Math.round(e.z*d),void 0===l[t]?(l[t]=n,u.push(this.vertices[n]),c[n]=u.length-1):c[n]=c[l[t]];var p=[];for(n=0,r=this.faces.length;n<r;n++){i=this.faces[n],i.a=c[i.a],i.b=c[i.b],i.c=c[i.c],o=[i.a,i.b,i.c];for(var f=0;f<3;f++)if(o[f]===o[(f+1)%3]){p.push(n);break}}for(n=p.length-1;n>=0;n--){var m=p[n];for(this.faces.splice(m,1),s=0,a=this.faceVertexUvs.length;s<a;s++)this.faceVertexUvs[s].splice(m,1)}var g=this.vertices.length-u.length;return this.vertices=u,g},setFromPoints:function(e){this.vertices=[];for(var t=0,n=e.length;t<n;t++){var r=e[t];this.vertices.push(new kt(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,n=0;n<t;n++)e[n]._id=n;function r(e,t){return e.materialIndex-t.materialIndex}e.sort(r);var i,o,s=this.faceVertexUvs[0],a=this.faceVertexUvs[1];s&&s.length===t&&(i=[]),a&&a.length===t&&(o=[]);for(n=0;n<t;n++){var l=e[n]._id;i&&i.push(s[l]),o&&o.push(a[l])}i&&(this.faceVertexUvs[0]=i),o&&(this.faceVertexUvs[1]=o)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}for(var r=[],i=0;i<this.vertices.length;i++){var o=this.vertices[i];r.push(o.x,o.y,o.z)}var s=[],a=[],l={},u=[],c={},h=[],d={};for(i=0;i<this.faces.length;i++){var p=this.faces[i],f=!0,m=!1,g=void 0!==this.faceVertexUvs[0][i],v=p.normal.length()>0,y=p.vertexNormals.length>0,x=1!==p.color.r||1!==p.color.g||1!==p.color.b,b=p.vertexColors.length>0,w=0;if(w=E(w,0,0),w=E(w,1,f),w=E(w,2,m),w=E(w,3,g),w=E(w,4,v),w=E(w,5,y),w=E(w,6,x),w=E(w,7,b),s.push(w),s.push(p.a,p.b,p.c),s.push(p.materialIndex),g){var _=this.faceVertexUvs[0][i];s.push(C(_[0]),C(_[1]),C(_[2]))}if(v&&s.push(M(p.normal)),y){var A=p.vertexNormals;s.push(M(A[0]),M(A[1]),M(A[2]))}if(x&&s.push(T(p.color)),b){var S=p.vertexColors;s.push(T(S[0]),T(S[1]),T(S[2]))}}function E(e,t,n){return n?e|1<<t:e&~(1<<t)}function M(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==l[t]||(l[t]=a.length/3,a.push(e.x,e.y,e.z)),l[t]}function T(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==c[t]||(c[t]=u.length,u.push(e.getHex())),c[t]}function C(e){var t=e.x.toString()+e.y.toString();return void 0!==d[t]||(d[t]=h.length/2,h.push(e.x,e.y)),d[t]}return e.data={},e.data.vertices=r,e.data.normals=a,u.length>0&&(e.data.colors=u),h.length>0&&(e.data.uvs=[h]),e.data.faces=s,e},clone:function(){return(new fi).copy(this)},copy:function(e){var t,n,r,i,o,s;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var a=e.vertices;for(t=0,n=a.length;t<n;t++)this.vertices.push(a[t].clone());var l=e.colors;for(t=0,n=l.length;t<n;t++)this.colors.push(l[t].clone());var u=e.faces;for(t=0,n=u.length;t<n;t++)this.faces.push(u[t].clone());for(t=0,n=e.faceVertexUvs.length;t<n;t++){var c=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),r=0,i=c.length;r<i;r++){var h=c[r],d=[];for(o=0,s=h.length;o<s;o++){var p=h[o];d.push(p.clone())}this.faceVertexUvs[t].push(d)}}var f=e.morphTargets;for(t=0,n=f.length;t<n;t++){var m={};if(m.name=f[t].name,void 0!==f[t].vertices)for(m.vertices=[],r=0,i=f[t].vertices.length;r<i;r++)m.vertices.push(f[t].vertices[r].clone());if(void 0!==f[t].normals)for(m.normals=[],r=0,i=f[t].normals.length;r<i;r++)m.normals.push(f[t].normals[r].clone());this.morphTargets.push(m)}var g=e.morphNormals;for(t=0,n=g.length;t<n;t++){var v={};if(void 0!==g[t].vertexNormals)for(v.vertexNormals=[],r=0,i=g[t].vertexNormals.length;r<i;r++){var y=g[t].vertexNormals[r],x={};x.a=y.a.clone(),x.b=y.b.clone(),x.c=y.c.clone(),v.vertexNormals.push(x)}if(void 0!==g[t].faceNormals)for(v.faceNormals=[],r=0,i=g[t].faceNormals.length;r<i;r++)v.faceNormals.push(g[t].faceNormals[r].clone());this.morphNormals.push(v)}var b=e.skinWeights;for(t=0,n=b.length;t<n;t++)this.skinWeights.push(b[t].clone());var w=e.skinIndices;for(t=0,n=w.length;t<n;t++)this.skinIndices.push(w[t].clone());var _=e.lineDistances;for(t=0,n=_.length;t<n;t++)this.lineDistances.push(_[t]);var A=e.boundingBox;null!==A&&(this.boundingBox=A.clone());var S=e.boundingSphere;return null!==S&&(this.boundingSphere=S.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(mi.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(mi.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.itemSize:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),o=new ni),t[n++]=o.r,t[n++]=o.g,t[n++]=o.b}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new Ot),t[n++]=o.x,t[n++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new kt),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new zt),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z,t[n++]=o.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),gi.prototype=Object.create(mi.prototype),gi.prototype.constructor=gi,vi.prototype=Object.create(mi.prototype),vi.prototype.constructor=vi,yi.prototype=Object.create(mi.prototype),yi.prototype.constructor=yi,xi.prototype=Object.create(mi.prototype),xi.prototype.constructor=xi,bi.prototype=Object.create(mi.prototype),bi.prototype.constructor=bi,wi.prototype=Object.create(mi.prototype),wi.prototype.constructor=wi,_i.prototype=Object.create(mi.prototype),_i.prototype.constructor=_i,Ai.prototype=Object.create(mi.prototype),Ai.prototype.constructor=Ai,Si.prototype=Object.create(mi.prototype),Si.prototype.constructor=Si,Object.assign(Ei.prototype,{computeGroups:function(e){for(var t,n=[],r=void 0,i=e.faces,o=0;o<i.length;o++){var s=i[o];s.materialIndex!==r&&(r=s.materialIndex,void 0!==t&&(t.count=3*o-t.start,n.push(t)),t={start:3*o,materialIndex:r})}void 0!==t&&(t.count=3*o-t.start,n.push(t)),this.groups=n},fromGeometry:function(e){var t,n=e.faces,r=e.vertices,i=e.faceVertexUvs,o=i[0]&&i[0].length>0,s=i[1]&&i[1].length>0,a=e.morphTargets,l=a.length;if(l>0){t=[];for(var u=0;u<l;u++)t[u]=[];this.morphTargets.position=t}var c,h=e.morphNormals,d=h.length;if(d>0){c=[];for(u=0;u<d;u++)c[u]=[];this.morphTargets.normal=c}var p=e.skinIndices,f=e.skinWeights,m=p.length===r.length,g=f.length===r.length;for(u=0;u<n.length;u++){var v=n[u];this.vertices.push(r[v.a],r[v.b],r[v.c]);var y=v.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var x=v.normal;this.normals.push(x,x,x)}var b=v.vertexColors;if(3===b.length)this.colors.push(b[0],b[1],b[2]);else{var w=v.color;this.colors.push(w,w,w)}if(!0===o){var _=i[0][u];void 0!==_?this.uvs.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",u),this.uvs.push(new Ot,new Ot,new Ot))}if(!0===s){_=i[1][u];void 0!==_?this.uvs2.push(_[0],_[1],_[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",u),this.uvs2.push(new Ot,new Ot,new Ot))}for(var A=0;A<l;A++){var S=a[A].vertices;t[A].push(S[v.a],S[v.b],S[v.c])}for(A=0;A<d;A++){var E=h[A].vertexNormals[u];c[A].push(E.a,E.b,E.c)}m&&this.skinIndices.push(p[v.a],p[v.b],p[v.c]),g&&this.skinWeights.push(f[v.a],f[v.b],f[v.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});var Ti=1;function Ci(){Object.defineProperty(this,"id",{value:Ti+=2}),this.uuid=Lt.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function Pi(e,t,n,r,i,o){fi.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o},this.fromBufferGeometry(new Ri(e,t,n,r,i,o)),this.mergeVertices()}function Ri(e,t,n,r,i,o){Ci.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};var s=this;e=e||1,t=t||1,n=n||1,r=Math.floor(r)||1,i=Math.floor(i)||1,o=Math.floor(o)||1;var a=[],l=[],u=[],c=[],h=0,d=0;function p(e,t,n,r,i,o,p,f,m,g,v){var y,x,b=o/m,w=p/g,_=o/2,A=p/2,S=f/2,E=m+1,M=g+1,T=0,C=0,P=new kt;for(x=0;x<M;x++){var R=x*w-A;for(y=0;y<E;y++){var L=y*b-_;P[e]=L*r,P[t]=R*i,P[n]=S,l.push(P.x,P.y,P.z),P[e]=0,P[t]=0,P[n]=f>0?1:-1,u.push(P.x,P.y,P.z),c.push(y/m),c.push(1-x/g),T+=1}}for(x=0;x<g;x++)for(y=0;y<m;y++){var O=h+y+E*x,D=h+y+E*(x+1),I=h+(y+1)+E*(x+1),k=h+(y+1)+E*x;a.push(O,D,k),a.push(D,I,k),C+=6}s.addGroup(d,C,v),d+=C,h+=T}p("z","y","x",-1,-1,n,t,e,o,i,0),p("z","y","x",1,-1,n,t,-e,o,i,1),p("x","z","y",1,1,e,n,t,r,o,2),p("x","z","y",1,-1,e,n,-t,r,o,3),p("x","y","z",1,-1,e,t,n,r,i,4),p("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(a),this.addAttribute("position",new Ai(l,3)),this.addAttribute("normal",new Ai(u,3)),this.addAttribute("uv",new Ai(c,2))}function Li(e,t,n,r){fi.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new Oi(e,t,n,r)),this.mergeVertices()}function Oi(e,t,n,r){Ci.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r},e=e||1,t=t||1;var i,o,s=e/2,a=t/2,l=Math.floor(n)||1,u=Math.floor(r)||1,c=l+1,h=u+1,d=e/l,p=t/u,f=[],m=[],g=[],v=[];for(o=0;o<h;o++){var y=o*p-a;for(i=0;i<c;i++){var x=i*d-s;m.push(x,-y,0),g.push(0,0,1),v.push(i/l),v.push(1-o/u)}}for(o=0;o<u;o++)for(i=0;i<l;i++){var b=i+c*o,w=i+c*(o+1),_=i+1+c*(o+1),A=i+1+c*o;f.push(b,w,A),f.push(w,_,A)}this.setIndex(f),this.addAttribute("position",new Ai(m,3)),this.addAttribute("normal",new Ai(g,3)),this.addAttribute("uv",new Ai(v,2))}Ci.prototype=Object.assign(Object.create(a.prototype),{constructor:Ci,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(Mi(e)>65535?_i:bi)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(t)):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(e,new mi(arguments[1],arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new Nt).getNormalMatrix(e);r.applyToBufferAttribute(n),n.needsUpdate=!0}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new Dt;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new Dt;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new Dt;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new Dt;return function(t,n,r){return e.makeTranslation(t,n,r),this.applyMatrix(e),this}}(),scale:function(){var e=new Dt;return function(t,n,r){return e.makeScale(t,n,r),this.applyMatrix(e),this}}(),lookAt:function(){var e=new ui;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){var e=new kt;return function(){return this.computeBoundingBox(),this.boundingBox.getCenter(e).negate(),this.translate(e.x,e.y,e.z),this}}(),setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var n=new Ai(3*t.vertices.length,3),r=new Ai(3*t.colors.length,3);if(this.addAttribute("position",n.copyVector3sArray(t.vertices)),this.addAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var i=new Ai(t.lineDistances.length,1);this.addAttribute("lineDistance",i.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];t.push(i.x,i.y,i.z||0)}return this.addAttribute("position",new Ai(t,3)),this},updateFromObject:function(e){var t,n=e.geometry;if(e.isMesh){var r=n.__directGeometry;if(!0===n.elementsNeedUpdate&&(r=void 0,n.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(n);r.verticesNeedUpdate=n.verticesNeedUpdate,r.normalsNeedUpdate=n.normalsNeedUpdate,r.colorsNeedUpdate=n.colorsNeedUpdate,r.uvsNeedUpdate=n.uvsNeedUpdate,r.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=r}return!0===n.verticesNeedUpdate&&(t=this.attributes.position,void 0!==t&&(t.copyVector3sArray(n.vertices),t.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(t=this.attributes.normal,void 0!==t&&(t.copyVector3sArray(n.normals),t.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(t=this.attributes.color,void 0!==t&&(t.copyColorsArray(n.colors),t.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(t=this.attributes.uv,void 0!==t&&(t.copyVector2sArray(n.uvs),t.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(t=this.attributes.lineDistance,void 0!==t&&(t.copyArray(n.lineDistances),t.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(e.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new Ei).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new mi(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var n=new Float32Array(3*e.normals.length);this.addAttribute("normal",new mi(n,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var r=new Float32Array(3*e.colors.length);this.addAttribute("color",new mi(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var i=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new mi(i,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new mi(o,2).copyVector2sArray(e.uvs2))}for(var s in this.groups=e.groups,e.morphTargets){for(var a=[],l=e.morphTargets[s],u=0,c=l.length;u<c;u++){var h=l[u],d=new Ai(3*h.length,3);a.push(d.copyVector3sArray(h))}this.morphAttributes[s]=a}if(e.skinIndices.length>0){var p=new Ai(4*e.skinIndices.length,4);this.addAttribute("skinIndex",p.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var f=new Ai(4*e.skinWeights.length,4);this.addAttribute("skinWeight",f.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ht);var e=this.attributes.position;void 0!==e?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new Ht,t=new kt;return function(){null===this.boundingSphere&&(this.boundingSphere=new Gt);var n=this.attributes.position;if(n){var r=this.boundingSphere.center;e.setFromBufferAttribute(n),e.getCenter(r);for(var i=0,o=0,s=n.count;o<s;o++)t.x=n.getX(o),t.y=n.getY(o),t.z=n.getZ(o),i=Math.max(i,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes,n=this.groups;if(t.position){var r=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new mi(new Float32Array(r.length),3));else for(var i=t.normal.array,o=0,s=i.length;o<s;o++)i[o]=0;var a,l,u,c=t.normal.array,h=new kt,d=new kt,p=new kt,f=new kt,m=new kt;if(e){var g=e.array;0===n.length&&this.addGroup(0,g.length);for(var v=0,y=n.length;v<y;++v){var x=n[v],b=x.start,w=x.count;for(o=b,s=b+w;o<s;o+=3)a=3*g[o+0],l=3*g[o+1],u=3*g[o+2],h.fromArray(r,a),d.fromArray(r,l),p.fromArray(r,u),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),c[a]+=f.x,c[a+1]+=f.y,c[a+2]+=f.z,c[l]+=f.x,c[l+1]+=f.y,c[l+2]+=f.z,c[u]+=f.x,c[u+1]+=f.y,c[u+2]+=f.z}}else for(o=0,s=r.length;o<s;o+=9)h.fromArray(r,o),d.fromArray(r,o+3),p.fromArray(r,o+6),f.subVectors(p,d),m.subVectors(h,d),f.cross(m),c[o]=f.x,c[o+1]=f.y,c[o+2]=f.z,c[o+3]=f.x,c[o+4]=f.y,c[o+5]=f.z,c[o+6]=f.x,c[o+7]=f.y,c[o+8]=f.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(void 0!==e.attributes[r])for(var i=n[r],o=i.array,s=e.attributes[r],a=s.array,l=s.itemSize,u=0,c=l*t;u<a.length;u++,c++)o[c]=a[u];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){var e=new kt;return function(){for(var t=this.attributes.normal,n=0,r=t.count;n<r;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.normalize(),t.setXYZ(n,e.x,e.y,e.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new Ci,t=this.index.array,n=this.attributes;for(var r in n){for(var i=n[r],o=i.array,s=i.itemSize,a=new o.constructor(t.length*s),l=0,u=0,c=0,h=t.length;c<h;c++){l=t[c]*s;for(var d=0;d<s;d++)a[u++]=o[l++]}e.addAttribute(r,new mi(a,s))}var p=this.groups;for(c=0,h=p.length;c<h;c++){var f=p[c];e.addGroup(f.start,f.count,f.materialIndex)}return e},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var r=this.index;if(null!==r){var i=Array.prototype.slice.call(r.array);e.data.index={type:r.array.constructor.name,array:i}}var o=this.attributes;for(var n in o){var s=o[n];i=Array.prototype.slice.call(s.array);e.data.attributes[n]={itemSize:s.itemSize,type:s.array.constructor.name,array:i,normalized:s.normalized}}var a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));var l=this.boundingSphere;return null!==l&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e},clone:function(){return(new Ci).copy(this)},copy:function(e){var t,n,r;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var i=e.index;null!==i&&this.setIndex(i.clone());var o=e.attributes;for(t in o){var s=o[t];this.addAttribute(t,s.clone())}var a=e.morphAttributes;for(t in a){var l=[],u=a[t];for(n=0,r=u.length;n<r;n++)l.push(u[n].clone());this.morphAttributes[t]=l}var c=e.groups;for(n=0,r=c.length;n<r;n++){var h=c[n];this.addGroup(h.start,h.count,h.materialIndex)}var d=e.boundingBox;null!==d&&(this.boundingBox=d.clone());var p=e.boundingSphere;return null!==p&&(this.boundingSphere=p.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Pi.prototype=Object.create(fi.prototype),Pi.prototype.constructor=Pi,Ri.prototype=Object.create(Ci.prototype),Ri.prototype.constructor=Ri,Li.prototype=Object.create(fi.prototype),Li.prototype.constructor=Li,Oi.prototype=Object.create(Ci.prototype),Oi.prototype.constructor=Oi;var Di=0;function Ii(){Object.defineProperty(this,"id",{value:Di++}),this.uuid=Lt.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=_,this.side=f,this.flatShading=!1,this.vertexColors=y,this.opacity=1,this.transparent=!1,this.blendSrc=N,this.blendDst=F,this.blendEquation=T,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=W,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}function ki(e){Ii.call(this),this.type="MeshBasicMaterial",this.color=new ni(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=J,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function Ni(e){Ii.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function Fi(e,t){this.origin=void 0!==e?e:new kt,this.direction=void 0!==t?t:new kt}function Vi(e,t){this.start=void 0!==e?e:new kt,this.end=void 0!==t?t:new kt}function zi(e,t,n){this.a=void 0!==e?e:new kt,this.b=void 0!==t?t:new kt,this.c=void 0!==n?n:new kt}function Ui(e,t){ui.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Ci,this.material=void 0!==t?t:new ki({color:16777215*Math.random()}),this.drawMode=xt,this.updateMorphTargets()}function ji(e,t,n,r){var i,o,s,a=new ni(0),l=0;function u(t,r,u,h){var d=r.background;null===d?c(a,l):d&&d.isColor&&(c(d,1),h=!0),(e.autoClear||h)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),d&&d.isCubeTexture?(void 0===s&&(s=new Ui(new Ri(1,1,1),new Ni({uniforms:ii.cube.uniforms,vertexShader:ii.cube.vertexShader,fragmentShader:ii.cube.fragmentShader,side:m,depthTest:!0,depthWrite:!1,fog:!1})),s.geometry.removeAttribute("normal"),s.geometry.removeAttribute("uv"),s.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},n.update(s.geometry)),s.material.uniforms.tCube.value=d,t.push(s,s.geometry,s.material,0,null)):d&&d.isTexture&&(void 0===i&&(i=new hi(-1,1,1,-1,0,1),o=new Ui(new Oi(2,2),new ki({depthTest:!1,depthWrite:!1,fog:!1})),n.update(o.geometry)),o.material.map=d,e.renderBufferDirect(i,null,o.geometry,o.material,o,null))}function c(e,n){t.buffers.color.setClear(e.r,e.g,e.b,n,r)}return{getClearColor:function(){return a},setClearColor:function(e,t){a.set(e),l=void 0!==t?t:1,c(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,c(a,l)},render:u}}function Bi(e,t,n){var r;function i(e){r=e}function o(t,i){e.drawArrays(r,t,i),n.update(i,r)}function s(e,i,o){var s=t.get("ANGLE_instanced_arrays");if(null!==s){var a=e.attributes.position;a.isInterleavedBufferAttribute?(o=a.data.count,s.drawArraysInstancedANGLE(r,0,o,e.maxInstancedCount)):s.drawArraysInstancedANGLE(r,i,o,e.maxInstancedCount),n.update(o,r,e.maxInstancedCount)}else console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}this.setMode=i,this.render=o,this.renderInstances=s}function Hi(e,t,n){var r;function i(){if(void 0!==r)return r;var n=t.get("EXT_texture_filter_anisotropic");return r=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,r}function o(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var s=void 0!==n.precision?n.precision:"highp",a=o(s);a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a);var l=!0===n.logarithmicDepthBuffer,u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),c=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_TEXTURE_SIZE),d=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),p=e.getParameter(e.MAX_VERTEX_ATTRIBS),f=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),m=e.getParameter(e.MAX_VARYING_VECTORS),g=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),v=c>0,y=!!t.get("OES_texture_float"),x=v&&y;return{getMaxAnisotropy:i,getMaxPrecision:o,precision:s,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:x}}function Gi(){var e=this,t=null,n=0,r=!1,i=!1,o=new qt,s=new Nt,a={value:null,needsUpdate:!1};function l(){a.value!==t&&(a.value=t,a.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(t,n,r,i){var l=null!==t?t.length:0,u=null;if(0!==l){if(u=a.value,!0!==i||null===u){var c=r+4*l,h=n.matrixWorldInverse;s.getNormalMatrix(h),(null===u||u.length<c)&&(u=new Float32Array(c));for(var d=0,p=r;d!==l;++d,p+=4)o.copy(t[d]).applyMatrix4(h,s),o.normal.toArray(u,p),u[p+3]=o.constant}a.value=u,a.needsUpdate=!0}return e.numPlanes=l,u}this.uniform=a,this.numPlanes=0,this.numIntersection=0,this.init=function(e,i,o){var s=0!==e.length||i||0!==n||r;return r=i,t=u(e,o,0),n=e.length,s},this.beginShadows=function(){i=!0,u(null)},this.endShadows=function(){i=!1,l()},this.setState=function(e,o,s,c,h,d){if(!r||null===e||0===e.length||i&&!s)i?u(null):l();else{var p=i?0:n,f=4*p,m=h.clippingState||null;a.value=m,m=u(e,c,f,d);for(var g=0;g!==f;++g)m[g]=t[g];h.clippingState=m,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=p}}}function qi(e){var t={};return{get:function(n){if(void 0!==t[n])return t[n];var r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return null===r&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),t[n]=r,r}}}function Wi(e,t,n){var r={},i={};function o(e){var s=e.target,a=r[s.id];for(var l in null!==a.index&&t.remove(a.index),a.attributes)t.remove(a.attributes[l]);s.removeEventListener("dispose",o),delete r[s.id];var u=i[s.id];u&&(t.remove(u),delete i[s.id]),u=i[a.id],u&&(t.remove(u),delete i[a.id]),n.memory.geometries--}function s(e,t){var i=r[t.id];return i||(t.addEventListener("dispose",o),t.isBufferGeometry?i=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new Ci).setFromObject(e)),i=t._bufferGeometry),r[t.id]=i,n.memory.geometries++,i)}function a(n){var r=n.index,i=n.attributes;for(var o in null!==r&&t.update(r,e.ELEMENT_ARRAY_BUFFER),i)t.update(i[o],e.ARRAY_BUFFER);var s=n.morphAttributes;for(var o in s)for(var a=s[o],l=0,u=a.length;l<u;l++)t.update(a[l],e.ARRAY_BUFFER)}function l(n){var r=i[n.id];if(r)return r;var o=[],s=n.index,a=n.attributes;if(null!==s)for(var l=s.array,u=0,c=l.length;u<c;u+=3){var h=l[u+0],d=l[u+1],p=l[u+2];o.push(h,d,d,p,p,h)}else for(l=a.position.array,u=0,c=l.length/3-1;u<c;u+=3){h=u+0,d=u+1,p=u+2;o.push(h,d,d,p,p,h)}return r=new(Mi(o)>65535?_i:bi)(o,1),t.update(r,e.ELEMENT_ARRAY_BUFFER),i[n.id]=r,r}return{get:s,update:a,getWireframeAttribute:l}}function $i(e,t,n){var r,i,o;function s(e){r=e}function a(e){i=e.type,o=e.bytesPerElement}function l(t,s){e.drawElements(r,s,i,t*o),n.update(s,r)}function u(e,s,a){var l=t.get("ANGLE_instanced_arrays");null!==l?(l.drawElementsInstancedANGLE(r,a,i,s*o,e.maxInstancedCount),n.update(a,r,e.maxInstancedCount)):console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}this.setMode=s,this.setIndex=a,this.render=l,this.renderInstances=u}function Xi(e){var t={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function r(t,r,i){switch(i=i||1,n.calls++,r){case e.TRIANGLES:n.triangles+=i*(t/3);break;case e.TRIANGLE_STRIP:case e.TRIANGLE_FAN:n.triangles+=i*(t-2);break;case e.LINES:n.lines+=i*(t/2);break;case e.LINE_STRIP:n.lines+=i*(t-1);break;case e.LINE_LOOP:n.lines+=i*t;break;case e.POINTS:n.points+=i*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r);break}}function i(){n.frame++,n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:t,render:n,programs:null,autoReset:!0,reset:i,update:r}}function Yi(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Zi(e){var t={},n=new Float32Array(8);function r(r,i,o,s){var a=r.morphTargetInfluences,l=a.length,u=t[i.id];if(void 0===u){u=[];for(var c=0;c<l;c++)u[c]=[c,0];t[i.id]=u}var h=o.morphTargets&&i.morphAttributes.position,d=o.morphNormals&&i.morphAttributes.normal;for(c=0;c<l;c++){var p=u[c];0!==p[1]&&(h&&i.removeAttribute("morphTarget"+c),d&&i.removeAttribute("morphNormal"+c))}for(c=0;c<l;c++){p=u[c];p[0]=c,p[1]=a[c]}u.sort(Yi);for(c=0;c<8;c++){p=u[c];if(p){var f=p[0],m=p[1];if(m){h&&i.addAttribute("morphTarget"+c,h[f]),d&&i.addAttribute("morphNormal"+c,d[f]),n[c]=m;continue}}n[c]=0}s.getUniforms().setValue(e,"morphTargetInfluences",n)}return{update:r}}function Ji(e,t){var n={};function r(r){var i=t.render.frame,o=r.geometry,s=e.get(r,o);return n[s.id]!==i&&(o.isGeometry&&s.updateFromObject(r),e.update(s),n[s.id]=i),s}function i(){n={}}return{update:r,dispose:i}}function Qi(e,t,n,r,i,o,s,a,l,u){e=void 0!==e?e:[],t=void 0!==t?t:se,Vt.call(this,e,t,n,r,i,o,s,a,l,u),this.flipY=!1}Ii.prototype=Object.assign(Object.create(a.prototype),{constructor:Ii,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]="overdraw"===t?Number(n):n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===v;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearCoat&&(n.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(n.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==_&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==f&&(n.side=this.side),this.vertexColors!==y&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,0!==this.rotation&&(n.rotation=this.rotation),1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var i=r(e.textures),o=r(e.images);i.length>0&&(n.textures=i),o.length>0&&(n.images=o)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.overdraw=e.overdraw,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,n=null;if(null!==t){var r=t.length;n=new Array(r);for(var i=0;i!==r;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.shadowSide=e.shadowSide,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),ki.prototype=Object.create(Ii.prototype),ki.prototype.constructor=ki,ki.prototype.isMeshBasicMaterial=!0,ki.prototype.copy=function(e){return Ii.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Ni.prototype=Object.create(Ii.prototype),Ni.prototype.constructor=Ni,Ni.prototype.isShaderMaterial=!0,Ni.prototype.copy=function(e){return Ii.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=ei.clone(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},Ni.prototype.toJSON=function(e){var t=Ii.prototype.toJSON.call(this,e);return t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},Object.assign(Fi.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new kt),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new kt;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new kt),t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new kt;return function(t){var n=e.subVectors(t,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(n).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new kt,t=new kt,n=new kt;return function(r,i,o,s){e.copy(r).add(i).multiplyScalar(.5),t.copy(i).sub(r).normalize(),n.copy(this.origin).sub(e);var a,l,u,c,h=.5*r.distanceTo(i),d=-this.direction.dot(t),p=n.dot(this.direction),f=-n.dot(t),m=n.lengthSq(),g=Math.abs(1-d*d);if(g>0)if(a=d*f-p,l=d*p-f,c=h*g,a>=0)if(l>=-c)if(l<=c){var v=1/g;a*=v,l*=v,u=a*(a+d*l+2*p)+l*(d*a+l+2*f)+m}else l=h,a=Math.max(0,-(d*l+p)),u=-a*a+l*(l+2*f)+m;else l=-h,a=Math.max(0,-(d*l+p)),u=-a*a+l*(l+2*f)+m;else l<=-c?(a=Math.max(0,-(-d*h+p)),l=a>0?-h:Math.min(Math.max(-h,-f),h),u=-a*a+l*(l+2*f)+m):l<=c?(a=0,l=Math.min(Math.max(-h,-f),h),u=l*(l+2*f)+m):(a=Math.max(0,-(d*h+p)),l=a>0?h:Math.min(Math.max(-h,-f),h),u=-a*a+l*(l+2*f)+m);else l=d>0?-h:h,a=Math.max(0,-(d*l+p)),u=-a*a+l*(l+2*f)+m;return o&&o.copy(this.direction).multiplyScalar(a).add(this.origin),s&&s.copy(t).multiplyScalar(l).add(e),u}}(),intersectSphere:function(){var e=new kt;return function(t,n){e.subVectors(t.center,this.origin);var r=e.dot(this.direction),i=e.dot(e)-r*r,o=t.radius*t.radius;if(i>o)return null;var s=Math.sqrt(o-i),a=r-s,l=r+s;return a<0&&l<0?null:a<0?this.at(l,n):this.at(a,n)}}(),intersectsSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;var n=e.normal.dot(this.direction);return n*t<0},intersectBox:function(e,t){var n,r,i,o,s,a,l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),u>=0?(i=(e.min.y-h.y)*u,o=(e.max.y-h.y)*u):(i=(e.max.y-h.y)*u,o=(e.min.y-h.y)*u),n>o||i>r?null:((i>n||n!==n)&&(n=i),(o<r||r!==r)&&(r=o),c>=0?(s=(e.min.z-h.z)*c,a=(e.max.z-h.z)*c):(s=(e.max.z-h.z)*c,a=(e.min.z-h.z)*c),n>a||s>r?null:((s>n||n!==n)&&(n=s),(a<r||r!==r)&&(r=a),r<0?null:this.at(n>=0?n:r,t)))},intersectsBox:function(){var e=new kt;return function(t){return null!==this.intersectBox(t,e)}}(),intersectTriangle:function(){var e=new kt,t=new kt,n=new kt,r=new kt;return function(i,o,s,a,l){t.subVectors(o,i),n.subVectors(s,i),r.crossVectors(t,n);var u,c=this.direction.dot(r);if(c>0){if(a)return null;u=1}else{if(!(c<0))return null;u=-1,c=-c}e.subVectors(this.origin,i);var h=u*this.direction.dot(n.crossVectors(e,n));if(h<0)return null;var d=u*this.direction.dot(t.cross(e));if(d<0)return null;if(h+d>c)return null;var p=-u*e.dot(r);return p<0?null:this.at(p/c,l)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(Vi.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new kt),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new kt),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new kt),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new kt,t=new kt;return function(n,r){e.subVectors(n,this.start),t.subVectors(this.end,this.start);var i=t.dot(t),o=t.dot(e),s=o/i;return r&&(s=Lt.clamp(s,0,1)),s}}(),closestPointToPoint:function(e,t,n){var r=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new kt),this.delta(n).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),Object.assign(zi,{getNormal:function(){var e=new kt;return function(t,n,r,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new kt),i.subVectors(r,n),e.subVectors(t,n),i.cross(e);var o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}}(),getBarycoord:function(){var e=new kt,t=new kt,n=new kt;return function(r,i,o,s,a){e.subVectors(s,i),t.subVectors(o,i),n.subVectors(r,i);var l=e.dot(e),u=e.dot(t),c=e.dot(n),h=t.dot(t),d=t.dot(n),p=l*h-u*u;if(void 0===a&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),a=new kt),0===p)return a.set(-2,-1,-1);var f=1/p,m=(h*c-u*d)*f,g=(l*d-u*c)*f;return a.set(1-m-g,g,m)}}(),containsPoint:function(){var e=new kt;return function(t,n,r,i){return zi.getBarycoord(t,n,r,i,e),e.x>=0&&e.y>=0&&e.x+e.y<=1}}()}),Object.assign(zi.prototype,{set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){var e=new kt,t=new kt;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new kt),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return zi.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new kt),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return zi.getBarycoord(e,this.a,this.b,this.c,t)},containsPoint:function(e){return zi.containsPoint(e,this.a,this.b,this.c)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(){var e=new qt,t=[new Vi,new Vi,new Vi],n=new kt,r=new kt;return function(i,o){void 0===o&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),o=new kt);var s=1/0;if(e.setFromCoplanarPoints(this.a,this.b,this.c),e.projectPoint(i,n),!0===this.containsPoint(n))o.copy(n);else{t[0].set(this.a,this.b),t[1].set(this.b,this.c),t[2].set(this.c,this.a);for(var a=0;a<t.length;a++){t[a].closestPointToPoint(n,!0,r);var l=n.distanceToSquared(r);l<s&&(s=l,o.copy(r))}}return o}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),Ui.prototype=Object.assign(Object.create(ui.prototype),{constructor:Ui,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return ui.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,n,r=this.geometry;if(r.isBufferGeometry){var i=r.morphAttributes,o=Object.keys(i);if(o.length>0){var s=i[o[0]];if(void 0!==s)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=s.length;e<t;e++)n=s[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var a=r.morphTargets;if(void 0!==a&&a.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)n=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}},raycast:function(){var e=new Dt,t=new Fi,n=new Gt,r=new kt,i=new kt,o=new kt,s=new kt,a=new kt,l=new kt,u=new Ot,c=new Ot,h=new Ot,d=new kt,p=new kt,f=new kt;function v(e,t,n,r,i,o,s){return zi.getBarycoord(e,t,n,r,d),i.multiplyScalar(d.x),o.multiplyScalar(d.y),s.multiplyScalar(d.z),i.add(o).add(s),i.clone()}function y(e,t,n,r,i,o,s,a){var l;if(l=t.side===m?r.intersectTriangle(s,o,i,!0,a):r.intersectTriangle(i,o,s,t.side!==g,a),null===l)return null;f.copy(a),f.applyMatrix4(e.matrixWorld);var u=n.ray.origin.distanceTo(f);return u<n.near||u>n.far?null:{distance:u,point:f.clone(),object:e}}function x(e,t,n,s,a,l,d,f){r.fromBufferAttribute(s,l),i.fromBufferAttribute(s,d),o.fromBufferAttribute(s,f);var m=y(e,e.material,t,n,r,i,o,p);if(m){a&&(u.fromBufferAttribute(a,l),c.fromBufferAttribute(a,d),h.fromBufferAttribute(a,f),m.uv=v(p,r,i,o,u,c,h));var g=new di(l,d,f);zi.getNormal(r,i,o,g.normal),m.face=g,m.faceIndex=l}return m}return function(d,f){var m,g=this.geometry,b=this.material,w=this.matrixWorld;if(void 0!==b&&(null===g.boundingSphere&&g.computeBoundingSphere(),n.copy(g.boundingSphere),n.applyMatrix4(w),!1!==d.ray.intersectsSphere(n)&&(e.getInverse(w),t.copy(d.ray).applyMatrix4(e),null===g.boundingBox||!1!==t.intersectsBox(g.boundingBox))))if(g.isBufferGeometry){var _,A,S,E,M,T=g.index,C=g.attributes.position,P=g.attributes.uv;if(null!==T)for(E=0,M=T.count;E<M;E+=3)_=T.getX(E),A=T.getX(E+1),S=T.getX(E+2),m=x(this,d,t,C,P,_,A,S),m&&(m.faceIndex=Math.floor(E/3),f.push(m));else if(void 0!==C)for(E=0,M=C.count;E<M;E+=3)_=E,A=E+1,S=E+2,m=x(this,d,t,C,P,_,A,S),m&&f.push(m)}else if(g.isGeometry){var R,L,O,D,I=Array.isArray(b),k=g.vertices,N=g.faces,F=g.faceVertexUvs[0];F.length>0&&(D=F);for(var V=0,z=N.length;V<z;V++){var U=N[V],j=I?b[U.materialIndex]:b;if(void 0!==j){if(R=k[U.a],L=k[U.b],O=k[U.c],!0===j.morphTargets){var B=g.morphTargets,H=this.morphTargetInfluences;r.set(0,0,0),i.set(0,0,0),o.set(0,0,0);for(var G=0,q=B.length;G<q;G++){var W=H[G];if(0!==W){var $=B[G].vertices;r.addScaledVector(s.subVectors($[U.a],R),W),i.addScaledVector(a.subVectors($[U.b],L),W),o.addScaledVector(l.subVectors($[U.c],O),W)}}r.add(R),i.add(L),o.add(O),R=r,L=i,O=o}if(m=y(this,j,d,t,R,L,O,p),m){if(D&&D[V]){var X=D[V];u.copy(X[0]),c.copy(X[1]),h.copy(X[2]),m.uv=v(p,R,L,O,u,c,h)}m.face=U,m.faceIndex=V,f.push(m)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Qi.prototype=Object.create(Vt.prototype),Qi.prototype.constructor=Qi,Qi.prototype.isCubeTexture=!0,Object.defineProperty(Qi.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});var Ki=new Vt,eo=new Qi;function to(){this.seq=[],this.map={}}var no=[],ro=[],io=new Float32Array(16),oo=new Float32Array(9);function so(e,t,n){var r=e[0];if(r<=0||r>0)return e;var i=t*n,o=no[i];if(void 0===o&&(o=new Float32Array(i),no[i]=o),0!==t){r.toArray(o,0);for(var s=1,a=0;s!==t;++s)a+=n,e[s].toArray(o,a)}return o}function ao(e,t){var n=ro[t];void 0===n&&(n=new Int32Array(t),ro[t]=n);for(var r=0;r!==t;++r)n[r]=e.allocTextureUnit();return n}function lo(e,t){e.uniform1f(this.addr,t)}function uo(e,t){e.uniform1i(this.addr,t)}function co(e,t){void 0===t.x?e.uniform2fv(this.addr,t):e.uniform2f(this.addr,t.x,t.y)}function ho(e,t){void 0!==t.x?e.uniform3f(this.addr,t.x,t.y,t.z):void 0!==t.r?e.uniform3f(this.addr,t.r,t.g,t.b):e.uniform3fv(this.addr,t)}function po(e,t){void 0===t.x?e.uniform4fv(this.addr,t):e.uniform4f(this.addr,t.x,t.y,t.z,t.w)}function fo(e,t){e.uniformMatrix2fv(this.addr,!1,t.elements||t)}function mo(e,t){void 0===t.elements?e.uniformMatrix3fv(this.addr,!1,t):(oo.set(t.elements),e.uniformMatrix3fv(this.addr,!1,oo))}function go(e,t){void 0===t.elements?e.uniformMatrix4fv(this.addr,!1,t):(io.set(t.elements),e.uniformMatrix4fv(this.addr,!1,io))}function vo(e,t,n){var r=n.allocTextureUnit();e.uniform1i(this.addr,r),n.setTexture2D(t||Ki,r)}function yo(e,t,n){var r=n.allocTextureUnit();e.uniform1i(this.addr,r),n.setTextureCube(t||eo,r)}function xo(e,t){e.uniform2iv(this.addr,t)}function bo(e,t){e.uniform3iv(this.addr,t)}function wo(e,t){e.uniform4iv(this.addr,t)}function _o(e){switch(e){case 5126:return lo;case 35664:return co;case 35665:return ho;case 35666:return po;case 35674:return fo;case 35675:return mo;case 35676:return go;case 35678:case 36198:return vo;case 35680:return yo;case 5124:case 35670:return uo;case 35667:case 35671:return xo;case 35668:case 35672:return bo;case 35669:case 35673:return wo}}function Ao(e,t){e.uniform1fv(this.addr,t)}function So(e,t){e.uniform1iv(this.addr,t)}function Eo(e,t){e.uniform2fv(this.addr,so(t,this.size,2))}function Mo(e,t){e.uniform3fv(this.addr,so(t,this.size,3))}function To(e,t){e.uniform4fv(this.addr,so(t,this.size,4))}function Co(e,t){e.uniformMatrix2fv(this.addr,!1,so(t,this.size,4))}function Po(e,t){e.uniformMatrix3fv(this.addr,!1,so(t,this.size,9))}function Ro(e,t){e.uniformMatrix4fv(this.addr,!1,so(t,this.size,16))}function Lo(e,t,n){var r=t.length,i=ao(n,r);e.uniform1iv(this.addr,i);for(var o=0;o!==r;++o)n.setTexture2D(t[o]||Ki,i[o])}function Oo(e,t,n){var r=t.length,i=ao(n,r);e.uniform1iv(this.addr,i);for(var o=0;o!==r;++o)n.setTextureCube(t[o]||eo,i[o])}function Do(e){switch(e){case 5126:return Ao;case 35664:return Eo;case 35665:return Mo;case 35666:return To;case 35674:return Co;case 35675:return Po;case 35676:return Ro;case 35678:return Lo;case 35680:return Oo;case 5124:case 35670:return So;case 35667:case 35671:return xo;case 35668:case 35672:return bo;case 35669:case 35673:return wo}}function Io(e,t,n){this.id=e,this.addr=n,this.setValue=_o(t.type)}function ko(e,t,n){this.id=e,this.addr=n,this.size=t.size,this.setValue=Do(t.type)}function No(e){this.id=e,to.call(this)}No.prototype.setValue=function(e,t){for(var n=this.seq,r=0,i=n.length;r!==i;++r){var o=n[r];o.setValue(e,t[o.id])}};var Fo=/([\w\d_]+)(\])?(\[|\.)?/g;function Vo(e,t){e.seq.push(t),e.map[t.id]=t}function zo(e,t,n){var r=e.name,i=r.length;for(Fo.lastIndex=0;;){var o=Fo.exec(r),s=Fo.lastIndex,a=o[1],l="]"===o[2],u=o[3];if(l&&(a|=0),void 0===u||"["===u&&s+2===i){Vo(n,void 0===u?new Io(a,e,t):new ko(a,e,t));break}var c=n.map,h=c[a];void 0===h&&(h=new No(a),Vo(n,h)),n=h}}function Uo(e,t,n){to.call(this),this.renderer=n;for(var r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),i=0;i<r;++i){var o=e.getActiveUniform(t,i),s=e.getUniformLocation(t,o.name);zo(o,s,this)}}function jo(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}function Bo(e,t,n){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),!1===e.getShaderParameter(r,e.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(r)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t===e.VERTEX_SHADER?"vertex":"fragment",e.getShaderInfoLog(r),jo(n)),r}Uo.prototype.setValue=function(e,t,n){var r=this.map[t];void 0!==r&&r.setValue(e,n,this.renderer)},Uo.prototype.setOptional=function(e,t,n){var r=t[n];void 0!==r&&this.setValue(e,n,r)},Uo.upload=function(e,t,n,r){for(var i=0,o=t.length;i!==o;++i){var s=t[i],a=n[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,r)}},Uo.seqWithValue=function(e,t){for(var n=[],r=0,i=e.length;r!==i;++r){var o=e[r];o.id in t&&n.push(o)}return n};var Ho=0;function Go(e){switch(e){case _t:return["Linear","( value )"];case At:return["sRGB","( value )"];case Et:return["RGBE","( value )"];case Mt:return["RGBM","( value, 7.0 )"];case Tt:return["RGBM","( value, 16.0 )"];case Ct:return["RGBD","( value, 256.0 )"];case St:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function qo(e,t){var n=Go(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Wo(e,t){var n=Go(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function $o(e,t){var n;switch(t){case te:n="Linear";break;case ne:n="Reinhard";break;case re:n="Uncharted2";break;case ie:n="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Xo(e,t,n){e=e||{};var r=[e.derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&n.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&n.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&n.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""];return r.filter(Jo).join("\n")}function Yo(e){var t=[];for(var n in e){var r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}function Zo(e,t){for(var n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=0;i<r;i++){var o=e.getActiveAttrib(t,i),s=o.name;n[s]=e.getAttribLocation(t,s)}return n}function Jo(e){return""!==e}function Qo(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function Ko(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}function es(e){var t=/^[ \t]*#include +<([\w\d.]+)>/gm;function n(e,t){var n=Kr[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return es(n)}return e.replace(t,n)}function ts(e){var t=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function n(e,t,n,r){for(var i="",o=parseInt(t);o<parseInt(n);o++)i+=r.replace(/\[ i \]/g,"[ "+o+" ]");return i}return e.replace(t,n)}function ns(e,t,n,r,i,o){var s=e.context,a=r.defines,l=i.vertexShader,u=i.fragmentShader,c="SHADOWMAP_TYPE_BASIC";o.shadowMapType===d?c="SHADOWMAP_TYPE_PCF":o.shadowMapType===p&&(c="SHADOWMAP_TYPE_PCF_SOFT");var h="ENVMAP_TYPE_CUBE",f="ENVMAP_MODE_REFLECTION",m="ENVMAP_BLENDING_MULTIPLY";if(o.envMap){switch(r.envMap.mapping){case se:case ae:h="ENVMAP_TYPE_CUBE";break;case he:case de:h="ENVMAP_TYPE_CUBE_UV";break;case le:case ue:h="ENVMAP_TYPE_EQUIREC";break;case ce:h="ENVMAP_TYPE_SPHERE";break}switch(r.envMap.mapping){case ae:case ue:f="ENVMAP_MODE_REFRACTION";break}switch(r.combine){case J:m="ENVMAP_BLENDING_MULTIPLY";break;case Q:m="ENVMAP_BLENDING_MIX";break;case K:m="ENVMAP_BLENDING_ADD";break}}var g,v,y=e.gammaFactor>0?e.gammaFactor:1,x=Xo(r.extensions,o,t),b=Yo(a),w=s.createProgram();r.isRawShaderMaterial?(g=[b].filter(Jo).join("\n"),g.length>0&&(g+="\n"),v=[x,b].filter(Jo).join("\n"),v.length>0&&(v+="\n")):(g=["precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+i.name,b,o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+y,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+f:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&!1===o.flatShading?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+c:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&t.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Jo).join("\n"),v=[x,"precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+i.name,b,o.alphaTest?"#define ALPHATEST "+o.alphaTest:"","#define GAMMA_FACTOR "+y,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+h:"",o.envMap?"#define "+f:"",o.envMap?"#define "+m:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"",o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+c:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&t.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",o.envMap&&t.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",o.toneMapping!==ee?"#define TONE_MAPPING":"",o.toneMapping!==ee?Kr["tonemapping_pars_fragment"]:"",o.toneMapping!==ee?$o("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",o.outputEncoding||o.mapEncoding||o.envMapEncoding||o.emissiveMapEncoding?Kr["encodings_pars_fragment"]:"",o.mapEncoding?qo("mapTexelToLinear",o.mapEncoding):"",o.envMapEncoding?qo("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMapEncoding?qo("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.outputEncoding?Wo("linearToOutputTexel",o.outputEncoding):"",o.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(Jo).join("\n")),l=es(l),l=Qo(l,o),l=Ko(l,o),u=es(u),u=Qo(u,o),u=Ko(u,o),l=ts(l),u=ts(u);var _=g+l,A=v+u,S=Bo(s,s.VERTEX_SHADER,_),E=Bo(s,s.FRAGMENT_SHADER,A);s.attachShader(w,S),s.attachShader(w,E),void 0!==r.index0AttributeName?s.bindAttribLocation(w,0,r.index0AttributeName):!0===o.morphTargets&&s.bindAttribLocation(w,0,"position"),s.linkProgram(w);var M,T,C=s.getProgramInfoLog(w).trim(),P=s.getShaderInfoLog(S).trim(),R=s.getShaderInfoLog(E).trim(),L=!0,O=!0;return!1===s.getProgramParameter(w,s.LINK_STATUS)?(L=!1,console.error("THREE.WebGLProgram: shader error: ",s.getError(),"gl.VALIDATE_STATUS",s.getProgramParameter(w,s.VALIDATE_STATUS),"gl.getProgramInfoLog",C,P,R)):""!==C?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",C):""!==P&&""!==R||(O=!1),O&&(this.diagnostics={runnable:L,material:r,programLog:C,vertexShader:{log:P,prefix:g},fragmentShader:{log:R,prefix:v}}),s.deleteShader(S),s.deleteShader(E),this.getUniforms=function(){return void 0===M&&(M=new Uo(s,w,e)),M},this.getAttributes=function(){return void 0===T&&(T=Zo(s,w)),T},this.destroy=function(){s.deleteProgram(w),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.name=i.name,this.id=Ho++,this.code=n,this.usedTimes=1,this.program=w,this.vertexShader=S,this.fragmentShader=E,this}function rs(e,t,n){var r=[],i={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow"},o=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function s(e){var t=e.skeleton,r=t.bones;if(n.floatVertexTextures)return 1024;var i=n.maxVertexUniforms,o=Math.floor((i-20)/4),s=Math.min(o,r.length);return s<r.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+r.length+" bones. This GPU supports "+s+"."),0):s}function a(e,t){var n;return e?e.isTexture?n=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),n=e.texture.encoding):n=_t,n===_t&&t&&(n=St),n}this.getParameters=function(t,r,o,l,u,c,h){var d=i[t.type],p=h.isSkinnedMesh?s(h):0,f=n.precision;null!==t.precision&&(f=n.getMaxPrecision(t.precision),f!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",f,"instead."));var v=e.getRenderTarget(),y={shaderID:d,precision:f,supportsVertexTextures:n.vertexTextures,outputEncoding:a(v?v.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:a(t.map,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:a(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===he||t.envMap.mapping===de),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:a(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!l,useFog:t.fog,fogExp:l&&l.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:n.logarithmicDepthBuffer,skinning:t.skinning&&p>0,maxBones:p,useVertexTexture:n.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numClippingPlanes:u,numClipIntersection:c,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&h.receiveShadow&&o.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:t.side===g,flipSided:t.side===m,depthPacking:void 0!==t.depthPacking&&t.depthPacking};return y},this.getProgramCode=function(t,n){var r=[];if(n.shaderID?r.push(n.shaderID):(r.push(t.fragmentShader),r.push(t.vertexShader)),void 0!==t.defines)for(var i in t.defines)r.push(i),r.push(t.defines[i]);for(var s=0;s<o.length;s++)r.push(n[o[s]]);return r.push(t.onBeforeCompile.toString()),r.push(e.gammaOutput),r.join()},this.acquireProgram=function(n,i,o,s){for(var a,l=0,u=r.length;l<u;l++){var c=r[l];if(c.code===s){a=c,++a.usedTimes;break}}return void 0===a&&(a=new ns(e,t,s,n,i,o),r.push(a)),a},this.releaseProgram=function(e){if(0===--e.usedTimes){var t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),e.destroy()}},this.programs=r}function is(){var e=new WeakMap;function t(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n}function n(t){e.delete(t)}function r(t,n,r){e.get(t)[n]=r}function i(){e=new WeakMap}return{get:t,remove:n,update:r,dispose:i}}function os(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function ss(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function as(){var e=[],t=0,n=[],r=[];function i(){t=0,n.length=0,r.length=0}function o(i,o,s,a,l){var u=e[t];void 0===u?(u={id:i.id,object:i,geometry:o,material:s,program:s.program,renderOrder:i.renderOrder,z:a,group:l},e[t]=u):(u.id=i.id,u.object=i,u.geometry=o,u.material=s,u.program=s.program,u.renderOrder=i.renderOrder,u.z=a,u.group=l),(!0===s.transparent?r:n).push(u),t++}function s(){n.length>1&&n.sort(os),r.length>1&&r.sort(ss)}return{opaque:n,transparent:r,init:i,push:o,sort:s}}function ls(){var e={};function t(t,n){var r=t.id+","+n.id,i=e[r];return void 0===i&&(i=new as,e[r]=i),i}function n(){e={}}return{get:t,dispose:n}}function us(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new kt,color:new ni,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Ot};break;case"SpotLight":n={position:new kt,direction:new kt,color:new ni,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Ot};break;case"PointLight":n={position:new kt,color:new ni,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Ot,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":n={direction:new kt,skyColor:new ni,groundColor:new ni};break;case"RectAreaLight":n={color:new ni,position:new kt,halfWidth:new kt,halfHeight:new kt};break}return e[t.id]=n,n}}}var cs=0;function hs(){var e=new us,t={id:cs++,hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},n=new kt,r=new Dt,i=new Dt;function o(o,s,a){for(var l=0,u=0,c=0,h=0,d=0,p=0,f=0,m=0,g=a.matrixWorldInverse,v=0,y=o.length;v<y;v++){var x=o[v],b=x.color,w=x.intensity,_=x.distance,A=x.shadow&&x.shadow.map?x.shadow.map.texture:null;if(x.isAmbientLight)l+=b.r*w,u+=b.g*w,c+=b.b*w;else if(x.isDirectionalLight){var S=e.get(x);if(S.color.copy(x.color).multiplyScalar(x.intensity),S.direction.setFromMatrixPosition(x.matrixWorld),n.setFromMatrixPosition(x.target.matrixWorld),S.direction.sub(n),S.direction.transformDirection(g),S.shadow=x.castShadow,x.castShadow){var E=x.shadow;S.shadowBias=E.bias,S.shadowRadius=E.radius,S.shadowMapSize=E.mapSize}t.directionalShadowMap[h]=A,t.directionalShadowMatrix[h]=x.shadow.matrix,t.directional[h]=S,h++}else if(x.isSpotLight){S=e.get(x);if(S.position.setFromMatrixPosition(x.matrixWorld),S.position.applyMatrix4(g),S.color.copy(b).multiplyScalar(w),S.distance=_,S.direction.setFromMatrixPosition(x.matrixWorld),n.setFromMatrixPosition(x.target.matrixWorld),S.direction.sub(n),S.direction.transformDirection(g),S.coneCos=Math.cos(x.angle),S.penumbraCos=Math.cos(x.angle*(1-x.penumbra)),S.decay=0===x.distance?0:x.decay,S.shadow=x.castShadow,x.castShadow){E=x.shadow;S.shadowBias=E.bias,S.shadowRadius=E.radius,S.shadowMapSize=E.mapSize}t.spotShadowMap[p]=A,t.spotShadowMatrix[p]=x.shadow.matrix,t.spot[p]=S,p++}else if(x.isRectAreaLight){S=e.get(x);S.color.copy(b).multiplyScalar(w),S.position.setFromMatrixPosition(x.matrixWorld),S.position.applyMatrix4(g),i.identity(),r.copy(x.matrixWorld),r.premultiply(g),i.extractRotation(r),S.halfWidth.set(.5*x.width,0,0),S.halfHeight.set(0,.5*x.height,0),S.halfWidth.applyMatrix4(i),S.halfHeight.applyMatrix4(i),t.rectArea[f]=S,f++}else if(x.isPointLight){S=e.get(x);if(S.position.setFromMatrixPosition(x.matrixWorld),S.position.applyMatrix4(g),S.color.copy(x.color).multiplyScalar(x.intensity),S.distance=x.distance,S.decay=0===x.distance?0:x.decay,S.shadow=x.castShadow,x.castShadow){E=x.shadow;S.shadowBias=E.bias,S.shadowRadius=E.radius,S.shadowMapSize=E.mapSize,S.shadowCameraNear=E.camera.near,S.shadowCameraFar=E.camera.far}t.pointShadowMap[d]=A,t.pointShadowMatrix[d]=x.shadow.matrix,t.point[d]=S,d++}else if(x.isHemisphereLight){S=e.get(x);S.direction.setFromMatrixPosition(x.matrixWorld),S.direction.transformDirection(g),S.direction.normalize(),S.skyColor.copy(x.color).multiplyScalar(w),S.groundColor.copy(x.groundColor).multiplyScalar(w),t.hemi[m]=S,m++}}t.ambient[0]=l,t.ambient[1]=u,t.ambient[2]=c,t.directional.length=h,t.spot.length=p,t.rectArea.length=f,t.point.length=d,t.hemi.length=m,t.hash=t.id+","+h+","+d+","+p+","+f+","+m+","+s.length}return{setup:o,state:t}}function ds(){var e=new hs,t=[],n=[],r=[];function i(){t.length=0,n.length=0,r.length=0}function o(e){t.push(e)}function s(e){n.push(e)}function a(e){r.push(e)}function l(r){e.setup(t,n,r)}var u={lightsArray:t,shadowsArray:n,spritesArray:r,lights:e};return{init:i,state:u,setupLights:l,pushLight:o,pushShadow:s,pushSprite:a}}function ps(){var e={};function t(t,n){var r=t.id+","+n.id,i=e[r];return void 0===i&&(i=new ds,e[r]=i),i}function n(){e={}}return{get:t,dispose:n}}function fs(e){Ii.call(this),this.type="MeshDepthMaterial",this.depthPacking=Pt,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function ms(e){Ii.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new kt,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}function gs(e,t,n){for(var r=new Wt,i=new Dt,o=new Ot,s=new Ot(n,n),a=new kt,l=new kt,u=1,c=2,h=1+(u|c),p=new Array(h),v=new Array(h),y={},x={0:m,1:f,2:g},b=[new kt(1,0,0),new kt(-1,0,0),new kt(0,0,1),new kt(0,0,-1),new kt(0,1,0),new kt(0,-1,0)],w=[new kt(0,1,0),new kt(0,1,0),new kt(0,1,0),new kt(0,1,0),new kt(0,0,1),new kt(0,0,-1)],_=[new zt,new zt,new zt,new zt,new zt,new zt],A=0;A!==h;++A){var S=0!==(A&u),E=0!==(A&c),M=new fs({depthPacking:Rt,morphTargets:S,skinning:E});p[A]=M;var T=new ms({morphTargets:S,skinning:E});v[A]=T}var C=this;function P(t,n,r,i,o,s){var a=t.geometry,l=null,h=p,d=t.customDepthMaterial;if(r&&(h=v,d=t.customDistanceMaterial),d)l=d;else{var f=!1;n.morphTargets&&(a&&a.isBufferGeometry?f=a.morphAttributes&&a.morphAttributes.position&&a.morphAttributes.position.length>0:a&&a.isGeometry&&(f=a.morphTargets&&a.morphTargets.length>0)),t.isSkinnedMesh&&!1===n.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t);var m=t.isSkinnedMesh&&n.skinning,g=0;f&&(g|=u),m&&(g|=c),l=h[g]}if(e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){var b=l.uuid,w=n.uuid,_=y[b];void 0===_&&(_={},y[b]=_);var A=_[w];void 0===A&&(A=l.clone(),_[w]=A),l=A}return l.visible=n.visible,l.wireframe=n.wireframe,l.side=null!=n.shadowSide?n.shadowSide:x[n.side],l.clipShadows=n.clipShadows,l.clippingPlanes=n.clippingPlanes,l.clipIntersection=n.clipIntersection,l.wireframeLinewidth=n.wireframeLinewidth,l.linewidth=n.linewidth,r&&l.isMeshDistanceMaterial&&(l.referencePosition.copy(i),l.nearDistance=o,l.farDistance=s),l}function R(n,i,o,s){if(!1!==n.visible){var a=n.layers.test(i.layers);if(a&&(n.isMesh||n.isLine||n.isPoints)&&n.castShadow&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);var u=t.update(n),c=n.material;if(Array.isArray(c))for(var h=u.groups,d=0,p=h.length;d<p;d++){var f=h[d],m=c[f.materialIndex];if(m&&m.visible){var g=P(n,m,s,l,o.near,o.far);e.renderBufferDirect(o,null,u,g,n,f)}}else if(c.visible){g=P(n,c,s,l,o.near,o.far);e.renderBufferDirect(o,null,u,g,n,null)}}for(var v=n.children,y=0,x=v.length;y<x;y++)R(v[y],i,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=d,this.render=function(t,n,u){if(!1!==C.enabled&&(!1!==C.autoUpdate||!1!==C.needsUpdate)&&0!==t.length){var c,h=e.context,d=e.state;d.disable(h.BLEND),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var p=0,f=t.length;p<f;p++){var m=t[p],g=m.shadow,v=m&&m.isPointLight;if(void 0!==g){var y=g.camera;if(o.copy(g.mapSize),o.min(s),v){var x=o.x,A=o.y;_[0].set(2*x,A,x,A),_[1].set(0,A,x,A),_[2].set(3*x,A,x,A),_[3].set(x,A,x,A),_[4].set(3*x,0,x,A),_[5].set(x,0,x,A),o.x*=4,o.y*=2}if(null===g.map){var S={minFilter:ge,magFilter:ge,format:Ne};g.map=new Ut(o.x,o.y,S),g.map.texture.name=m.name+".shadowMap",y.updateProjectionMatrix()}g.isSpotLightShadow&&g.update(m);var E=g.map,M=g.matrix;l.setFromMatrixPosition(m.matrixWorld),y.position.copy(l),v?(c=6,M.makeTranslation(-l.x,-l.y,-l.z)):(c=1,a.setFromMatrixPosition(m.target.matrixWorld),y.lookAt(a),y.updateMatrixWorld(),M.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),M.multiply(y.projectionMatrix),M.multiply(y.matrixWorldInverse)),e.setRenderTarget(E),e.clear();for(var T=0;T<c;T++){if(v){a.copy(y.position),a.add(b[T]),y.up.copy(w[T]),y.lookAt(a),y.updateMatrixWorld();var P=_[T];d.viewport(P)}i.multiplyMatrices(y.projectionMatrix,y.matrixWorldInverse),r.setFromMatrix(i),R(n,u,y,v)}}else console.warn("THREE.WebGLShadowMap:",m,"has no shadow.")}C.needsUpdate=!1}}}function vs(e,t,n,r,i,o,s,a,l){Vt.call(this,e,t,n,r,i,o,s,a,l),this.needsUpdate=!0}function ys(e,t,n,r,i){var o,s,a,l,u,c,h=new kt,d=new It,p=new kt;function f(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),n=new Uint16Array([0,1,2,0,2,3]);o=t.createBuffer(),s=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW),a=m(),l={position:t.getAttribLocation(a,"position"),uv:t.getAttribLocation(a,"uv")},u={uvOffset:t.getUniformLocation(a,"uvOffset"),uvScale:t.getUniformLocation(a,"uvScale"),rotation:t.getUniformLocation(a,"rotation"),center:t.getUniformLocation(a,"center"),scale:t.getUniformLocation(a,"scale"),color:t.getUniformLocation(a,"color"),map:t.getUniformLocation(a,"map"),opacity:t.getUniformLocation(a,"opacity"),modelViewMatrix:t.getUniformLocation(a,"modelViewMatrix"),projectionMatrix:t.getUniformLocation(a,"projectionMatrix"),fogType:t.getUniformLocation(a,"fogType"),fogDensity:t.getUniformLocation(a,"fogDensity"),fogNear:t.getUniformLocation(a,"fogNear"),fogFar:t.getUniformLocation(a,"fogFar"),fogColor:t.getUniformLocation(a,"fogColor"),fogDepth:t.getUniformLocation(a,"fogDepth"),alphaTest:t.getUniformLocation(a,"alphaTest")};var r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");r.width=8,r.height=8;var i=r.getContext("2d");i.fillStyle="white",i.fillRect(0,0,8,8),c=new vs(r)}function m(){var e=t.createProgram(),n=t.createShader(t.VERTEX_SHADER),r=t.createShader(t.FRAGMENT_SHADER);return t.shaderSource(n,["precision "+i.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 center;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvUV = uvOffset + uv * uvScale;","\tvec2 alignedPosition = ( position - center ) * scale;","\tvec2 rotatedPosition;","\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","\tvec4 mvPosition;","\tmvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","\tmvPosition.xy += rotatedPosition;","\tgl_Position = projectionMatrix * mvPosition;","\tfogDepth = - mvPosition.z;","}"].join("\n")),t.shaderSource(r,["precision "+i.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvec4 texture = texture2D( map, vUV );","\tgl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","\tif ( gl_FragColor.a < alphaTest ) discard;","\tif ( fogType > 0 ) {","\t\tfloat fogFactor = 0.0;","\t\tif ( fogType == 1 ) {","\t\t\tfogFactor = smoothstep( fogNear, fogFar, fogDepth );","\t\t} else {","\t\t\tconst float LOG2 = 1.442695;","\t\t\tfogFactor = exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 );","\t\t\tfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","\t\t}","\t\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );","\t}","}"].join("\n")),t.compileShader(n),t.compileShader(r),t.attachShader(e,n),t.attachShader(e,r),t.linkProgram(e),e}function g(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:t.id-e.id}this.render=function(i,m,v){if(0!==i.length){void 0===a&&f(),n.useProgram(a),n.initAttributes(),n.enableAttribute(l.position),n.enableAttribute(l.uv),n.disableUnusedAttributes(),n.disable(t.CULL_FACE),n.enable(t.BLEND),t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(l.position,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(l.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),t.uniformMatrix4fv(u.projectionMatrix,!1,v.projectionMatrix.elements),n.activeTexture(t.TEXTURE0),t.uniform1i(u.map,0);var y=0,x=0,b=m.fog;b?(t.uniform3f(u.fogColor,b.color.r,b.color.g,b.color.b),b.isFog?(t.uniform1f(u.fogNear,b.near),t.uniform1f(u.fogFar,b.far),t.uniform1i(u.fogType,1),y=1,x=1):b.isFogExp2&&(t.uniform1f(u.fogDensity,b.density),t.uniform1i(u.fogType,2),y=2,x=2)):(t.uniform1i(u.fogType,0),y=0,x=0);for(var w=0,_=i.length;w<_;w++){var A=i[w];A.modelViewMatrix.multiplyMatrices(v.matrixWorldInverse,A.matrixWorld),A.z=-A.modelViewMatrix.elements[14]}i.sort(g);var S=[],E=[];for(w=0,_=i.length;w<_;w++){A=i[w];var M=A.material;if(!1!==M.visible){A.onBeforeRender(e,m,v,void 0,M,void 0),t.uniform1f(u.alphaTest,M.alphaTest),t.uniformMatrix4fv(u.modelViewMatrix,!1,A.modelViewMatrix.elements),A.matrixWorld.decompose(h,d,p),S[0]=p.x,S[1]=p.y,E[0]=A.center.x-.5,E[1]=A.center.y-.5;var T=0;m.fog&&M.fog&&(T=x),y!==T&&(t.uniform1i(u.fogType,T),y=T),null!==M.map?(t.uniform2f(u.uvOffset,M.map.offset.x,M.map.offset.y),t.uniform2f(u.uvScale,M.map.repeat.x,M.map.repeat.y)):(t.uniform2f(u.uvOffset,0,0),t.uniform2f(u.uvScale,1,1)),t.uniform1f(u.opacity,M.opacity),t.uniform3f(u.color,M.color.r,M.color.g,M.color.b),t.uniform1f(u.rotation,M.rotation),t.uniform2fv(u.center,E),t.uniform2fv(u.scale,S),n.setBlending(M.blending,M.blendEquation,M.blendSrc,M.blendDst,M.blendEquationAlpha,M.blendSrcAlpha,M.blendDstAlpha,M.premultipliedAlpha),n.buffers.depth.setTest(M.depthTest),n.buffers.depth.setMask(M.depthWrite),n.buffers.color.setMask(M.colorWrite),r.setTexture2D(M.map||c,0),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),A.onAfterRender(e,m,v,void 0,M,void 0)}}n.enable(t.CULL_FACE),n.reset()}}}function xs(e,t,n){function r(){var t=!1,n=new zt,r=null,i=new zt(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,o,s,a){!0===a&&(t*=s,r*=s,o*=s),n.set(t,r,o,s),!1===i.equals(n)&&(e.clearColor(t,r,o,s),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}}function i(){var t=!1,n=null,r=null,i=null;return{setTest:function(t){t?le(e.DEPTH_TEST):ue(e.DEPTH_TEST)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case H:e.depthFunc(e.NEVER);break;case G:e.depthFunc(e.ALWAYS);break;case q:e.depthFunc(e.LESS);break;case W:e.depthFunc(e.LEQUAL);break;case $:e.depthFunc(e.EQUAL);break;case X:e.depthFunc(e.GEQUAL);break;case Y:e.depthFunc(e.GREATER);break;case Z:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}}function o(){var t=!1,n=null,r=null,i=null,o=null,s=null,a=null,l=null,u=null;return{setTest:function(t){t?le(e.STENCIL_TEST):ue(e.STENCIL_TEST)},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,s){r===t&&i===n&&o===s||(e.stencilFunc(t,n,s),r=t,i=n,o=s)},setOp:function(t,n,r){s===t&&a===n&&l===r||(e.stencilOp(t,n,r),s=t,a=n,l=r)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,n=null,r=null,i=null,o=null,s=null,a=null,l=null,u=null}}}var s=new r,a=new i,l=new o,d=e.getParameter(e.MAX_VERTEX_ATTRIBS),p=new Uint8Array(d),f=new Uint8Array(d),v=new Uint8Array(d),y={},x=null,b=null,T=null,C=null,P=null,R=null,L=null,O=null,D=null,I=!1,k=null,N=null,F=null,V=null,z=null,U=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),j=!1,B=0,J=e.getParameter(e.VERSION);-1!==J.indexOf("WebGL")?(B=parseFloat(/^WebGL\ ([0-9])/.exec(J)[1]),j=B>=1):-1!==J.indexOf("OpenGL ES")&&(B=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(J)[1]),j=B>=2);var Q=null,K={},ee=new zt,te=new zt;function ne(t,n,r){var i=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var s=0;s<r;s++)e.texImage2D(n+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,i);return o}var re={};function ie(){for(var e=0,t=p.length;e<t;e++)p[e]=0}function oe(n){if(p[n]=1,0===f[n]&&(e.enableVertexAttribArray(n),f[n]=1),0!==v[n]){var r=t.get("ANGLE_instanced_arrays");r.vertexAttribDivisorANGLE(n,0),v[n]=0}}function se(n,r){if(p[n]=1,0===f[n]&&(e.enableVertexAttribArray(n),f[n]=1),v[n]!==r){var i=t.get("ANGLE_instanced_arrays");i.vertexAttribDivisorANGLE(n,r),v[n]=r}}function ae(){for(var t=0,n=f.length;t!==n;++t)f[t]!==p[t]&&(e.disableVertexAttribArray(t),f[t]=0)}function le(t){!0!==y[t]&&(e.enable(t),y[t]=!0)}function ue(t){!1!==y[t]&&(e.disable(t),y[t]=!1)}function ce(){if(null===x&&(x=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")||t.get("WEBGL_compressed_texture_astc")))for(var n=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),r=0;r<n.length;r++)x.push(n[r]);return x}function he(t){return b!==t&&(e.useProgram(t),b=t,!0)}function de(t,r,i,o,s,a,l,u){if(t!==w?le(e.BLEND):ue(e.BLEND),t!==M){if(t!==T||u!==I)switch(t){case A:u?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE,e.ONE,e.ONE)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE));break;case S:u?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR));break;case E:u?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR));break;default:u?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA))}C=null,P=null,R=null,L=null,O=null,D=null}else s=s||r,a=a||i,l=l||o,r===C&&s===L||(e.blendEquationSeparate(n.convert(r),n.convert(s)),C=r,L=s),i===P&&o===R&&a===O&&l===D||(e.blendFuncSeparate(n.convert(i),n.convert(o),n.convert(a),n.convert(l)),P=i,R=o,O=a,D=l);T=t,I=u}function pe(t,n){t.side===g?ue(e.CULL_FACE):le(e.CULL_FACE);var r=t.side===m;n&&(r=!r),fe(r),!0===t.transparent?de(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):de(w),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),s.setMask(t.colorWrite),ve(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)}function fe(t){k!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),k=t)}function me(t){t!==u?(le(e.CULL_FACE),t!==N&&(t===c?e.cullFace(e.BACK):t===h?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):ue(e.CULL_FACE),N=t}function ge(t){t!==F&&(j&&e.lineWidth(t),F=t)}function ve(t,n,r){t?(le(e.POLYGON_OFFSET_FILL),V===n&&z===r||(e.polygonOffset(n,r),V=n,z=r)):ue(e.POLYGON_OFFSET_FILL)}function ye(t){t?le(e.SCISSOR_TEST):ue(e.SCISSOR_TEST)}function xe(t){void 0===t&&(t=e.TEXTURE0+U-1),Q!==t&&(e.activeTexture(t),Q=t)}function be(t,n){null===Q&&xe();var r=K[Q];void 0===r&&(r={type:void 0,texture:void 0},K[Q]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||re[t]),r.type=t,r.texture=n)}function we(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}}function _e(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}}function Ae(t){!1===ee.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),ee.copy(t))}function Se(t){!1===te.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),te.copy(t))}function Ee(){for(var t=0;t<f.length;t++)1===f[t]&&(e.disableVertexAttribArray(t),f[t]=0);y={},x=null,Q=null,K={},b=null,T=null,k=null,N=null,s.reset(),a.reset(),l.reset()}return re[e.TEXTURE_2D]=ne(e.TEXTURE_2D,e.TEXTURE_2D,1),re[e.TEXTURE_CUBE_MAP]=ne(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),s.setClear(0,0,0,1),a.setClear(1),l.setClear(0),le(e.DEPTH_TEST),a.setFunc(W),fe(!1),me(c),le(e.CULL_FACE),le(e.BLEND),de(_),{buffers:{color:s,depth:a,stencil:l},initAttributes:ie,enableAttribute:oe,enableAttributeAndDivisor:se,disableUnusedAttributes:ae,enable:le,disable:ue,getCompressedTextureFormats:ce,useProgram:he,setBlending:de,setMaterial:pe,setFlipSided:fe,setCullFace:me,setLineWidth:ge,setPolygonOffset:ve,setScissorTest:ye,activeTexture:xe,bindTexture:be,compressedTexImage2D:we,texImage2D:_e,scissor:Ae,viewport:Se,reset:Ee}}function bs(e,t,n,r,i,o,s){var a,l="undefined"!==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,u={};function c(e,t){if(e.width>t||e.height>t){if("data"in e)return void console.warn("THREE.WebGLRenderer: image in DataTexture is too big ("+e.width+"x"+e.height+").");var n=t/Math.max(e.width,e.height),r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");r.width=Math.floor(e.width*n),r.height=Math.floor(e.height*n);var i=r.getContext("2d");return i.drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+r.width+"x"+r.height,e),r}return e}function h(e){return Lt.isPowerOfTwo(e.width)&&Lt.isPowerOfTwo(e.height)}function d(e){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap){void 0===a&&(a=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),a.width=Lt.floorPowerOfTwo(e.width),a.height=Lt.floorPowerOfTwo(e.height);var t=a.getContext("2d");return t.drawImage(e,0,0,a.width,a.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+a.width+"x"+a.height,e),a}return e}function p(e){return e.wrapS!==fe||e.wrapT!==fe||e.minFilter!==ge&&e.minFilter!==xe}function f(e,t){return e.generateMipmaps&&t&&e.minFilter!==ge&&e.minFilter!==xe}function m(t,n,i,o){e.generateMipmap(t);var s=r.get(n);s.__maxMipLevel=Math.log(Math.max(i,o))*Math.LOG2E}function g(t){return t===ge||t===ve||t===ye?e.NEAREST:e.LINEAR}function v(e){var t=e.target;t.removeEventListener("dispose",v),x(t),t.isVideoTexture&&delete u[t.id],s.memory.textures--}function y(e){var t=e.target;t.removeEventListener("dispose",y),b(t),s.memory.textures--}function x(t){var n=r.get(t);if(t.image&&n.__image__webglTextureCube)e.deleteTexture(n.__image__webglTextureCube);else{if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture)}r.remove(t)}function b(t){var n=r.get(t),i=r.get(t.texture);if(t){if(void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLRenderTargetCube)for(var o=0;o<6;o++)e.deleteFramebuffer(n.__webglFramebuffer[o]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[o]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer);r.remove(t.texture),r.remove(t)}}function w(t,i){var o=r.get(t);if(t.isVideoTexture&&O(t),t.version>0&&o.__version!==t.version){var s=t.image;if(void 0===s)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",t);else{if(!1!==s.complete)return void E(o,t,i);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",t)}}n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_2D,o.__webglTexture)}function _(t,a){var l=r.get(t);if(6===t.image.length)if(t.version>0&&l.__version!==t.version){l.__image__webglTextureCube||(t.addEventListener("dispose",v),l.__image__webglTextureCube=e.createTexture(),s.memory.textures++),n.activeTexture(e.TEXTURE0+a),n.bindTexture(e.TEXTURE_CUBE_MAP,l.__image__webglTextureCube),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var u=t&&t.isCompressedTexture,d=t.image[0]&&t.image[0].isDataTexture,p=[],g=0;g<6;g++)p[g]=u||d?d?t.image[g].image:t.image[g]:c(t.image[g],i.maxCubemapSize);var y=p[0],x=h(y),b=o.convert(t.format),w=o.convert(t.type);S(e.TEXTURE_CUBE_MAP,t,x);for(g=0;g<6;g++)if(u)for(var _,A=p[g].mipmaps,E=0,M=A.length;E<M;E++)_=A[E],t.format!==Ne&&t.format!==ke?n.getCompressedTextureFormats().indexOf(b)>-1?n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+g,E,b,_.width,_.height,0,_.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+g,E,b,_.width,_.height,0,b,w,_.data);else d?n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,b,p[g].width,p[g].height,0,b,w,p[g].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,b,b,w,p[g]);l.__maxMipLevel=u?A.length-1:0,f(t,x)&&m(e.TEXTURE_CUBE_MAP,t,y.width,y.height),l.__version=t.version,t.onUpdate&&t.onUpdate(t)}else n.activeTexture(e.TEXTURE0+a),n.bindTexture(e.TEXTURE_CUBE_MAP,l.__image__webglTextureCube)}function A(t,i){n.activeTexture(e.TEXTURE0+i),n.bindTexture(e.TEXTURE_CUBE_MAP,r.get(t).__webglTexture)}function S(n,s,a){var l;if(a?(e.texParameteri(n,e.TEXTURE_WRAP_S,o.convert(s.wrapS)),e.texParameteri(n,e.TEXTURE_WRAP_T,o.convert(s.wrapT)),e.texParameteri(n,e.TEXTURE_MAG_FILTER,o.convert(s.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,o.convert(s.minFilter))):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),s.wrapS===fe&&s.wrapT===fe||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",s),e.texParameteri(n,e.TEXTURE_MAG_FILTER,g(s.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,g(s.minFilter)),s.minFilter!==ge&&s.minFilter!==xe&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",s)),l=t.get("EXT_texture_filter_anisotropic"),l){if(s.type===Ce&&null===t.get("OES_texture_float_linear"))return;if(s.type===Pe&&null===t.get("OES_texture_half_float_linear"))return;(s.anisotropy>1||r.get(s).__currentAnisotropy)&&(e.texParameterf(n,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,i.getMaxAnisotropy())),r.get(s).__currentAnisotropy=s.anisotropy)}}function E(t,r,a){void 0===t.__webglInit&&(t.__webglInit=!0,r.addEventListener("dispose",v),t.__webglTexture=e.createTexture(),s.memory.textures++),n.activeTexture(e.TEXTURE0+a),n.bindTexture(e.TEXTURE_2D,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment);var u=c(r.image,i.maxTextureSize);p(r)&&!1===h(u)&&(u=d(u));var g=h(u),y=o.convert(r.format),x=o.convert(r.type);S(e.TEXTURE_2D,r,g);var b,w=r.mipmaps;if(r.isDepthTexture){var _=e.DEPTH_COMPONENT;if(r.type===Ce){if(!l)throw new Error("Float Depth Texture only supported in WebGL2.0");_=e.DEPTH_COMPONENT32F}else l&&(_=e.DEPTH_COMPONENT16);r.format===ze&&_===e.DEPTH_COMPONENT&&r.type!==Ee&&r.type!==Te&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=Ee,x=o.convert(r.type)),r.format===Ue&&(_=e.DEPTH_STENCIL,r.type!==De&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=De,x=o.convert(r.type))),n.texImage2D(e.TEXTURE_2D,0,_,u.width,u.height,0,y,x,null)}else if(r.isDataTexture)if(w.length>0&&g){for(var A=0,E=w.length;A<E;A++)b=w[A],n.texImage2D(e.TEXTURE_2D,A,y,b.width,b.height,0,y,x,b.data);r.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else n.texImage2D(e.TEXTURE_2D,0,y,u.width,u.height,0,y,x,u.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(A=0,E=w.length;A<E;A++)b=w[A],r.format!==Ne&&r.format!==ke?n.getCompressedTextureFormats().indexOf(y)>-1?n.compressedTexImage2D(e.TEXTURE_2D,A,y,b.width,b.height,0,b.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(e.TEXTURE_2D,A,y,b.width,b.height,0,y,x,b.data);t.__maxMipLevel=w.length-1}else if(w.length>0&&g){for(A=0,E=w.length;A<E;A++)b=w[A],n.texImage2D(e.TEXTURE_2D,A,y,y,x,b);r.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else n.texImage2D(e.TEXTURE_2D,0,y,y,x,u),t.__maxMipLevel=0;f(r,g)&&m(e.TEXTURE_2D,r,u.width,u.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function M(t,i,s,a){var l=o.convert(i.texture.format),u=o.convert(i.texture.type);n.texImage2D(a,0,l,i.width,i.height,0,l,u,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,s,a,r.get(i.texture).__webglTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}function T(t,n){e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)):n.depthBuffer&&n.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)):e.renderbufferStorage(e.RENDERBUFFER,e.RGBA4,n.width,n.height),e.bindRenderbuffer(e.RENDERBUFFER,null)}function C(t,n){var i=n&&n.isWebGLRenderTargetCube;if(i)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(e.FRAMEBUFFER,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),w(n.depthTexture,0);var o=r.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===ze)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,o,0);else{if(n.depthTexture.format!==Ue)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,o,0)}}function P(t){var n=r.get(t),i=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");C(n.__webglFramebuffer,t)}else if(i){n.__webglDepthbuffer=[];for(var o=0;o<6;o++)e.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer[o]),n.__webglDepthbuffer[o]=e.createRenderbuffer(),T(n.__webglDepthbuffer[o],t)}else e.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),T(n.__webglDepthbuffer,t);e.bindFramebuffer(e.FRAMEBUFFER,null)}function R(t){var i=r.get(t),o=r.get(t.texture);t.addEventListener("dispose",y),o.__webglTexture=e.createTexture(),s.memory.textures++;var a=!0===t.isWebGLRenderTargetCube,l=h(t);if(a){i.__webglFramebuffer=[];for(var u=0;u<6;u++)i.__webglFramebuffer[u]=e.createFramebuffer()}else i.__webglFramebuffer=e.createFramebuffer();if(a){n.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture),S(e.TEXTURE_CUBE_MAP,t.texture,l);for(u=0;u<6;u++)M(i.__webglFramebuffer[u],t,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+u);f(t.texture,l)&&m(e.TEXTURE_CUBE_MAP,t.texture,t.width,t.height),n.bindTexture(e.TEXTURE_CUBE_MAP,null)}else n.bindTexture(e.TEXTURE_2D,o.__webglTexture),S(e.TEXTURE_2D,t.texture,l),M(i.__webglFramebuffer,t,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),f(t.texture,l)&&m(e.TEXTURE_2D,t.texture,t.width,t.height),n.bindTexture(e.TEXTURE_2D,null);t.depthBuffer&&P(t)}function L(t){var i=t.texture,o=h(t);if(f(i,o)){var s=t.isWebGLRenderTargetCube?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,a=r.get(i).__webglTexture;n.bindTexture(s,a),m(s,i,t.width,t.height),n.bindTexture(s,null)}}function O(e){var t=e.id,n=s.render.frame;u[t]!==n&&(u[t]=n,e.update())}this.setTexture2D=w,this.setTextureCube=_,this.setTextureCubeDynamic=A,this.setupRenderTarget=R,this.updateRenderTargetMipmap=L}function ws(e,t){function n(n){var r;if(n===pe)return e.REPEAT;if(n===fe)return e.CLAMP_TO_EDGE;if(n===me)return e.MIRRORED_REPEAT;if(n===ge)return e.NEAREST;if(n===ve)return e.NEAREST_MIPMAP_NEAREST;if(n===ye)return e.NEAREST_MIPMAP_LINEAR;if(n===xe)return e.LINEAR;if(n===be)return e.LINEAR_MIPMAP_NEAREST;if(n===we)return e.LINEAR_MIPMAP_LINEAR;if(n===_e)return e.UNSIGNED_BYTE;if(n===Re)return e.UNSIGNED_SHORT_4_4_4_4;if(n===Le)return e.UNSIGNED_SHORT_5_5_5_1;if(n===Oe)return e.UNSIGNED_SHORT_5_6_5;if(n===Ae)return e.BYTE;if(n===Se)return e.SHORT;if(n===Ee)return e.UNSIGNED_SHORT;if(n===Me)return e.INT;if(n===Te)return e.UNSIGNED_INT;if(n===Ce)return e.FLOAT;if(n===Pe&&(r=t.get("OES_texture_half_float"),null!==r))return r.HALF_FLOAT_OES;if(n===Ie)return e.ALPHA;if(n===ke)return e.RGB;if(n===Ne)return e.RGBA;if(n===Fe)return e.LUMINANCE;if(n===Ve)return e.LUMINANCE_ALPHA;if(n===ze)return e.DEPTH_COMPONENT;if(n===Ue)return e.DEPTH_STENCIL;if(n===T)return e.FUNC_ADD;if(n===C)return e.FUNC_SUBTRACT;if(n===P)return e.FUNC_REVERSE_SUBTRACT;if(n===O)return e.ZERO;if(n===D)return e.ONE;if(n===I)return e.SRC_COLOR;if(n===k)return e.ONE_MINUS_SRC_COLOR;if(n===N)return e.SRC_ALPHA;if(n===F)return e.ONE_MINUS_SRC_ALPHA;if(n===V)return e.DST_ALPHA;if(n===z)return e.ONE_MINUS_DST_ALPHA;if(n===U)return e.DST_COLOR;if(n===j)return e.ONE_MINUS_DST_COLOR;if(n===B)return e.SRC_ALPHA_SATURATE;if((n===je||n===Be||n===He||n===Ge)&&(r=t.get("WEBGL_compressed_texture_s3tc"),null!==r)){if(n===je)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Be)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===He)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Ge)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((n===qe||n===We||n===$e||n===Xe)&&(r=t.get("WEBGL_compressed_texture_pvrtc"),null!==r)){if(n===qe)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===We)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===$e)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Xe)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===Ye&&(r=t.get("WEBGL_compressed_texture_etc1"),null!==r))return r.COMPRESSED_RGB_ETC1_WEBGL;if((n===Ze||n===Je||n===Qe||n===Ke||n===et||n===tt||n===nt||n===rt||n===it||n===ot||n===st||n===at||n===lt||n===ut)&&(r=t.get("WEBGL_compressed_texture_astc"),null!==r))return n;if((n===R||n===L)&&(r=t.get("EXT_blend_minmax"),null!==r)){if(n===R)return r.MIN_EXT;if(n===L)return r.MAX_EXT}return n===De&&(r=t.get("WEBGL_depth_texture"),null!==r)?r.UNSIGNED_INT_24_8_WEBGL:0}return{convert:n}}function _s(e,t,n,r){ci.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function As(e){_s.call(this),this.cameras=e||[]}function Ss(e){var t=this,n=null,r=null,i=null,o=new Dt,s=new Dt;"undefined"!==typeof window&&"VRFrameData"in window&&(r=new window.VRFrameData,window.addEventListener("vrdisplaypresentchange",g,!1));var a=new Dt,l=new It,u=new kt,c=new _s;c.bounds=new zt(0,0,.5,1),c.layers.enable(1);var h=new _s;h.bounds=new zt(.5,0,.5,1),h.layers.enable(2);var d,p,f=new As([c,h]);function m(){return null!==n&&!0===n.isPresenting}function g(){if(m()){var r=n.getEyeParameters("left"),i=r.renderWidth,o=r.renderHeight;p=e.getPixelRatio(),d=e.getSize(),e.setDrawingBufferSize(2*i,o,1)}else t.enabled&&e.setDrawingBufferSize(d.width,d.height,p)}f.layers.enable(1),f.layers.enable(2),this.enabled=!1,this.userHeight=1.6,this.getDevice=function(){return n},this.setDevice=function(e){void 0!==e&&(n=e)},this.setPoseTarget=function(e){void 0!==e&&(i=e)},this.getCamera=function(e){if(null===n)return e;n.depthNear=e.near,n.depthFar=e.far,n.getFrameData(r);var d=n.stageParameters;d?o.fromArray(d.sittingToStandingTransform):o.makeTranslation(0,t.userHeight,0);var p=r.pose,m=null!==i?i:e;if(m.matrix.copy(o),m.matrix.decompose(m.position,m.quaternion,m.scale),null!==p.orientation&&(l.fromArray(p.orientation),m.quaternion.multiply(l)),null!==p.position&&(l.setFromRotationMatrix(o),u.fromArray(p.position),u.applyQuaternion(l),m.position.add(u)),m.updateMatrixWorld(),!1===n.isPresenting)return e;c.near=e.near,h.near=e.near,c.far=e.far,h.far=e.far,f.matrixWorld.copy(e.matrixWorld),f.matrixWorldInverse.copy(e.matrixWorldInverse),c.matrixWorldInverse.fromArray(r.leftViewMatrix),h.matrixWorldInverse.fromArray(r.rightViewMatrix),s.getInverse(o),c.matrixWorldInverse.multiply(s),h.matrixWorldInverse.multiply(s);var g=m.parent;null!==g&&(a.getInverse(g.matrixWorld),c.matrixWorldInverse.multiply(a),h.matrixWorldInverse.multiply(a)),c.matrixWorld.getInverse(c.matrixWorldInverse),h.matrixWorld.getInverse(h.matrixWorldInverse),c.projectionMatrix.fromArray(r.leftProjectionMatrix),h.projectionMatrix.fromArray(r.rightProjectionMatrix),f.projectionMatrix.copy(c.projectionMatrix);var v=n.getLayers();if(v.length){var y=v[0];null!==y.leftBounds&&4===y.leftBounds.length&&c.bounds.fromArray(y.leftBounds),null!==y.rightBounds&&4===y.rightBounds.length&&h.bounds.fromArray(y.rightBounds)}return f},this.getStandingMatrix=function(){return o},this.submitFrame=function(){m()&&n.submitFrame()},this.dispose=function(){"undefined"!==typeof window&&window.removeEventListener("vrdisplaypresentchange",g)}}function Es(e){console.log("THREE.WebGLRenderer",l),e=e||{};var t=void 0!==e.canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,a=void 0===e.premultipliedAlpha||e.premultipliedAlpha,u=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",h=null,d=null;this.domElement=t,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=te,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var p,f,m,g,v,x,b,w,_,A,S,E,M,T,C,P,R,L,O,D=this,I=!1,k=null,N=null,F=-1,V="",z=null,U=null,j=new zt,B=new zt,H=null,G=0,q=t.width,W=t.height,$=1,X=new zt(0,0,q,W),Y=new zt(0,0,q,W),Z=!1,J=new Wt,Q=new Gi,K=!1,ee=!1,ne=new Dt,re=new kt;function ie(){return null===k?$:1}try{var oe={alpha:r,depth:i,stencil:o,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:u,powerPreference:c};if(t.addEventListener("webglcontextlost",ue,!1),t.addEventListener("webglcontextrestored",ce,!1),p=n||t.getContext("webgl",oe)||t.getContext("experimental-webgl",oe),null===p)throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===p.getShaderPrecisionFormat&&(p.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(We){console.error("THREE.WebGLRenderer: "+We.message)}function se(){f=new qi(p),f.get("WEBGL_depth_texture"),f.get("OES_texture_float"),f.get("OES_texture_float_linear"),f.get("OES_texture_half_float"),f.get("OES_texture_half_float_linear"),f.get("OES_standard_derivatives"),f.get("OES_element_index_uint"),f.get("ANGLE_instanced_arrays"),O=new ws(p,f),m=new Hi(p,f,e),g=new xs(p,f,O),g.scissor(B.copy(Y).multiplyScalar($)),g.viewport(j.copy(X).multiplyScalar($)),v=new Xi(p),x=new is,b=new bs(p,f,g,x,m,O,v),w=new oi(p),_=new Wi(p,w,v),A=new Ji(_,v),C=new Zi(p),S=new rs(D,f,m),E=new ls,M=new ps,T=new ji(D,g,_,a),P=new Bi(p,f,v),R=new $i(p,f,v),L=new ys(D,p,g,b,m),v.programs=S.programs,D.context=p,D.capabilities=m,D.extensions=f,D.properties=x,D.renderLists=E,D.state=g,D.info=v}se();var ae=new Ss(D);this.vr=ae;var le=new gs(D,A,m.maxTextureSize);function ue(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),I=!0}function ce(){console.log("THREE.WebGLRenderer: Context Restored."),I=!1,se()}function he(e){var t=e.target;t.removeEventListener("dispose",he),de(t)}function de(e){pe(e),x.remove(e)}function pe(e){var t=x.get(e).program;e.program=void 0,void 0!==t&&S.releaseProgram(t)}function fe(e,t,n){e.render((function(e){D.renderBufferImmediate(e,t,n)}))}function me(e,t,n){if(n&&n.isInstancedBufferGeometry&&null===f.get("ANGLE_instanced_arrays"))console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{g.initAttributes();var r=n.attributes,i=t.getAttributes(),o=e.defaultAttributeValues;for(var s in i){var a=i[s];if(a>=0){var l=r[s];if(void 0!==l){var u=l.normalized,c=l.itemSize,h=w.get(l);if(void 0===h)continue;var d=h.buffer,m=h.type,v=h.bytesPerElement;if(l.isInterleavedBufferAttribute){var y=l.data,x=y.stride,b=l.offset;y&&y.isInstancedInterleavedBuffer?(g.enableAttributeAndDivisor(a,y.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=y.meshPerAttribute*y.count)):g.enableAttribute(a),p.bindBuffer(p.ARRAY_BUFFER,d),p.vertexAttribPointer(a,c,m,u,x*v,b*v)}else l.isInstancedBufferAttribute?(g.enableAttributeAndDivisor(a,l.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=l.meshPerAttribute*l.count)):g.enableAttribute(a),p.bindBuffer(p.ARRAY_BUFFER,d),p.vertexAttribPointer(a,c,m,u,0,0)}else if(void 0!==o){var _=o[s];if(void 0!==_)switch(_.length){case 2:p.vertexAttrib2fv(a,_);break;case 3:p.vertexAttrib3fv(a,_);break;case 4:p.vertexAttrib4fv(a,_);break;default:p.vertexAttrib1fv(a,_)}}}}g.disableUnusedAttributes()}}this.shadowMap=le,this.getContext=function(){return p},this.getContextAttributes=function(){return p.getContextAttributes()},this.forceContextLoss=function(){var e=f.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=f.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return $},this.setPixelRatio=function(e){void 0!==e&&($=e,this.setSize(q,W,!1))},this.getSize=function(){return{width:q,height:W}},this.setSize=function(e,n,r){var i=ae.getDevice();i&&i.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(q=e,W=n,t.width=e*$,t.height=n*$,!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(){return{width:q*$,height:W*$}},this.setDrawingBufferSize=function(e,n,r){q=e,W=n,$=r,t.width=e*r,t.height=n*r,this.setViewport(0,0,e,n)},this.getCurrentViewport=function(){return j},this.setViewport=function(e,t,n,r){X.set(e,W-t-r,n,r),g.viewport(j.copy(X).multiplyScalar($))},this.setScissor=function(e,t,n,r){Y.set(e,W-t-r,n,r),g.scissor(B.copy(Y).multiplyScalar($))},this.setScissorTest=function(e){g.setScissorTest(Z=e)},this.getClearColor=function(){return T.getClearColor()},this.setClearColor=function(){T.setClearColor.apply(T,arguments)},this.getClearAlpha=function(){return T.getClearAlpha()},this.setClearAlpha=function(){T.setClearAlpha.apply(T,arguments)},this.clear=function(e,t,n){var r=0;(void 0===e||e)&&(r|=p.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=p.DEPTH_BUFFER_BIT),(void 0===n||n)&&(r|=p.STENCIL_BUFFER_BIT),p.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(e,t,n,r){this.setRenderTarget(e),this.clear(t,n,r)},this.dispose=function(){t.removeEventListener("webglcontextlost",ue,!1),t.removeEventListener("webglcontextrestored",ce,!1),E.dispose(),M.dispose(),x.dispose(),A.dispose(),ae.dispose(),xe()},this.renderBufferImmediate=function(e,t,n){g.initAttributes();var r=x.get(e);e.hasPositions&&!r.position&&(r.position=p.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=p.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=p.createBuffer()),e.hasColors&&!r.color&&(r.color=p.createBuffer());var i=t.getAttributes();if(e.hasPositions&&(p.bindBuffer(p.ARRAY_BUFFER,r.position),p.bufferData(p.ARRAY_BUFFER,e.positionArray,p.DYNAMIC_DRAW),g.enableAttribute(i.position),p.vertexAttribPointer(i.position,3,p.FLOAT,!1,0,0)),e.hasNormals){if(p.bindBuffer(p.ARRAY_BUFFER,r.normal),!n.isMeshPhongMaterial&&!n.isMeshStandardMaterial&&!n.isMeshNormalMaterial&&!0===n.flatShading)for(var o=0,s=3*e.count;o<s;o+=9){var a=e.normalArray,l=(a[o+0]+a[o+3]+a[o+6])/3,u=(a[o+1]+a[o+4]+a[o+7])/3,c=(a[o+2]+a[o+5]+a[o+8])/3;a[o+0]=l,a[o+1]=u,a[o+2]=c,a[o+3]=l,a[o+4]=u,a[o+5]=c,a[o+6]=l,a[o+7]=u,a[o+8]=c}p.bufferData(p.ARRAY_BUFFER,e.normalArray,p.DYNAMIC_DRAW),g.enableAttribute(i.normal),p.vertexAttribPointer(i.normal,3,p.FLOAT,!1,0,0)}e.hasUvs&&n.map&&(p.bindBuffer(p.ARRAY_BUFFER,r.uv),p.bufferData(p.ARRAY_BUFFER,e.uvArray,p.DYNAMIC_DRAW),g.enableAttribute(i.uv),p.vertexAttribPointer(i.uv,2,p.FLOAT,!1,0,0)),e.hasColors&&n.vertexColors!==y&&(p.bindBuffer(p.ARRAY_BUFFER,r.color),p.bufferData(p.ARRAY_BUFFER,e.colorArray,p.DYNAMIC_DRAW),g.enableAttribute(i.color),p.vertexAttribPointer(i.color,3,p.FLOAT,!1,0,0)),g.disableUnusedAttributes(),p.drawArrays(p.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,i,o){var s=i.isMesh&&i.matrixWorld.determinant()<0;g.setMaterial(r,s);var a=Te(e,t,r,i),l=n.id+"_"+a.id+"_"+(!0===r.wireframe),u=!1;l!==V&&(V=l,u=!0),i.morphTargetInfluences&&(C.update(i,n,r,a),u=!0);var c,h=n.index,d=n.attributes.position,f=1;!0===r.wireframe&&(h=_.getWireframeAttribute(n),f=2);var m=P;null!==h&&(c=w.get(h),m=R,m.setIndex(c)),u&&(me(r,a,n),null!==h&&p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,c.buffer));var v=1/0;null!==h?v=h.count:void 0!==d&&(v=d.count);var y=n.drawRange.start*f,x=n.drawRange.count*f,b=null!==o?o.start*f:0,A=null!==o?o.count*f:1/0,S=Math.max(y,b),E=Math.min(v,y+x,b+A)-1,M=Math.max(0,E-S+1);if(0!==M){if(i.isMesh)if(!0===r.wireframe)g.setLineWidth(r.wireframeLinewidth*ie()),m.setMode(p.LINES);else switch(i.drawMode){case xt:m.setMode(p.TRIANGLES);break;case bt:m.setMode(p.TRIANGLE_STRIP);break;case wt:m.setMode(p.TRIANGLE_FAN);break}else if(i.isLine){var T=r.linewidth;void 0===T&&(T=1),g.setLineWidth(T*ie()),i.isLineSegments?m.setMode(p.LINES):i.isLineLoop?m.setMode(p.LINE_LOOP):m.setMode(p.LINE_STRIP)}else i.isPoints&&m.setMode(p.POINTS);n&&n.isInstancedBufferGeometry?n.maxInstancedCount>0&&m.renderInstances(n,S,M):m.render(S,M)}},this.compile=function(e,t){d=M.get(e,t),d.init(),e.traverse((function(e){e.isLight&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(t),e.traverse((function(t){if(t.material)if(Array.isArray(t.material))for(var n=0;n<t.material.length;n++)Me(t.material[n],e.fog,t);else Me(t.material,e.fog,t)}))};var ge=!1,ve=null;function ye(){ge||(be(),ge=!0)}function xe(){ge=!1}function be(){var e=ae.getDevice();e&&e.isPresenting?e.requestAnimationFrame(we):window.requestAnimationFrame(we)}function we(e){!1!==ge&&(ve(e),be())}function Ae(e,t,n){if(!1!==e.visible){var r=e.layers.test(t.layers);if(r)if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite)e.frustumCulled&&!J.intersectsSprite(e)||d.pushSprite(e);else if(e.isImmediateRenderObject)n&&re.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ne),h.push(e,null,e.material,re.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||J.intersectsObject(e))){n&&re.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ne);var i=A.update(e),o=e.material;if(Array.isArray(o))for(var s=i.groups,a=0,l=s.length;a<l;a++){var u=s[a],c=o[u.materialIndex];c&&c.visible&&h.push(e,i,c,re.z,u)}else o.visible&&h.push(e,i,o,re.z,null)}var p=e.children;for(a=0,l=p.length;a<l;a++)Ae(p[a],t,n)}}function Se(e,t,n,r){for(var i=0,o=e.length;i<o;i++){var s=e[i],a=s.object,l=s.geometry,u=void 0===r?s.material:r,c=s.group;if(n.isArrayCamera){U=n;for(var h=n.cameras,d=0,p=h.length;d<p;d++){var f=h[d];if(a.layers.test(f.layers)){var m=f.bounds,v=m.x*q,y=m.y*W,x=m.z*q,b=m.w*W;g.viewport(j.set(v,y,x,b).multiplyScalar($)),Ee(a,t,f,l,u,c)}}}else U=null,Ee(a,t,n,l,u,c)}}function Ee(e,t,n,r,i,o){if(e.onBeforeRender(D,t,n,r,i,o),d=M.get(t,U||n),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var s=e.isMesh&&e.matrixWorld.determinant()<0;g.setMaterial(i,s);var a=Te(n,t.fog,i,e);V="",fe(e,a,i)}else D.renderBufferDirect(n,t.fog,r,i,e,o);e.onAfterRender(D,t,n,r,i,o),d=M.get(t,U||n)}function Me(e,t,n){var r=x.get(e),i=d.state.lights,o=d.state.shadowsArray,s=S.getParameters(e,i.state,o,t,Q.numPlanes,Q.numIntersection,n),a=S.getProgramCode(e,s),l=r.program,u=!0;if(void 0===l)e.addEventListener("dispose",he);else if(l.code!==a)pe(e);else if(r.lightsHash!==i.state.hash)x.update(e,"lightsHash",i.state.hash),u=!1;else{if(void 0!==s.shaderID)return;u=!1}if(u){if(s.shaderID){var c=ii[s.shaderID];r.shader={name:e.type,uniforms:ei.clone(c.uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}}else r.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(r.shader,D),l=S.acquireProgram(e,r.shader,s,a),r.program=l,e.program=l}var h=l.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var p=0;p<D.maxMorphTargets;p++)h["morphTarget"+p]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(p=0;p<D.maxMorphNormals;p++)h["morphNormal"+p]>=0&&e.numSupportedMorphNormals++}var f=r.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=Q.numPlanes,r.numIntersection=Q.numIntersection,f.clippingPlanes=Q.uniform),r.fog=t,r.lightsHash=i.state.hash,e.lights&&(f.ambientLightColor.value=i.state.ambient,f.directionalLights.value=i.state.directional,f.spotLights.value=i.state.spot,f.rectAreaLights.value=i.state.rectArea,f.pointLights.value=i.state.point,f.hemisphereLights.value=i.state.hemi,f.directionalShadowMap.value=i.state.directionalShadowMap,f.directionalShadowMatrix.value=i.state.directionalShadowMatrix,f.spotShadowMap.value=i.state.spotShadowMap,f.spotShadowMatrix.value=i.state.spotShadowMatrix,f.pointShadowMap.value=i.state.pointShadowMap,f.pointShadowMatrix.value=i.state.pointShadowMatrix);var m=r.program.getUniforms(),g=Uo.seqWithValue(m.seq,f);r.uniformsList=g}function Te(e,t,n,r){G=0;var i=x.get(n),o=d.state.lights;if(K&&(ee||e!==z)){var s=e===z&&n.id===F;Q.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,e,i,s)}!1===n.needsUpdate&&(void 0===i.program||n.fog&&i.fog!==t||n.lights&&i.lightsHash!==o.state.hash?n.needsUpdate=!0:void 0===i.numClippingPlanes||i.numClippingPlanes===Q.numPlanes&&i.numIntersection===Q.numIntersection||(n.needsUpdate=!0)),n.needsUpdate&&(Me(n,t,r),n.needsUpdate=!1);var a=!1,l=!1,u=!1,c=i.program,h=c.getUniforms(),f=i.shader.uniforms;if(g.useProgram(c.program)&&(a=!0,l=!0,u=!0),n.id!==F&&(F=n.id,l=!0),a||e!==z){if(h.setValue(p,"projectionMatrix",e.projectionMatrix),m.logarithmicDepthBuffer&&h.setValue(p,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),z!==(U||e)&&(z=U||e,l=!0,u=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial||n.envMap){var v=h.map.cameraPosition;void 0!==v&&v.setValue(p,re.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.skinning)&&h.setValue(p,"viewMatrix",e.matrixWorldInverse)}if(n.skinning){h.setOptional(p,r,"bindMatrix"),h.setOptional(p,r,"bindMatrixInverse");var y=r.skeleton;if(y){var b=y.bones;if(m.floatVertexTextures){if(void 0===y.boneTexture){var w=Math.sqrt(4*b.length);w=Lt.ceilPowerOfTwo(w),w=Math.max(w,4);var _=new Float32Array(w*w*4);_.set(y.boneMatrices);var A=new Bt(_,w,w,Ne,Ce);A.needsUpdate=!0,y.boneMatrices=_,y.boneTexture=A,y.boneTextureSize=w}h.setValue(p,"boneTexture",y.boneTexture),h.setValue(p,"boneTextureSize",y.boneTextureSize)}else h.setOptional(p,y,"boneMatrices")}}return l&&(h.setValue(p,"toneMappingExposure",D.toneMappingExposure),h.setValue(p,"toneMappingWhitePoint",D.toneMappingWhitePoint),n.lights&&Ge(f,u),t&&n.fog&&Ie(f,t),n.isMeshBasicMaterial?Re(f,n):n.isMeshLambertMaterial?(Re(f,n),ke(f,n)):n.isMeshPhongMaterial?(Re(f,n),n.isMeshToonMaterial?Ve(f,n):Fe(f,n)):n.isMeshStandardMaterial?(Re(f,n),n.isMeshPhysicalMaterial?Ue(f,n):ze(f,n)):n.isMeshDepthMaterial?(Re(f,n),je(f,n)):n.isMeshDistanceMaterial?(Re(f,n),Be(f,n)):n.isMeshNormalMaterial?(Re(f,n),He(f,n)):n.isLineBasicMaterial?(Le(f,n),n.isLineDashedMaterial&&Oe(f,n)):n.isPointsMaterial?De(f,n):n.isShadowMaterial&&(f.color.value=n.color,f.opacity.value=n.opacity),void 0!==f.ltc_1&&(f.ltc_1.value=ri.LTC_1),void 0!==f.ltc_2&&(f.ltc_2.value=ri.LTC_2),Uo.upload(p,i.uniformsList,f,D)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Uo.upload(p,i.uniformsList,f,D),n.uniformsNeedUpdate=!1),h.setValue(p,"modelViewMatrix",r.modelViewMatrix),h.setValue(p,"normalMatrix",r.normalMatrix),h.setValue(p,"modelMatrix",r.matrixWorld),c}function Re(e,t){var n;e.opacity.value=t.opacity,t.color&&(e.diffuse.value=t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap&&t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=x.get(t.envMap).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?n=t.map:t.specularMap?n=t.specularMap:t.displacementMap?n=t.displacementMap:t.normalMap?n=t.normalMap:t.bumpMap?n=t.bumpMap:t.roughnessMap?n=t.roughnessMap:t.metalnessMap?n=t.metalnessMap:t.alphaMap?n=t.alphaMap:t.emissiveMap&&(n=t.emissiveMap),void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}function Le(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function Oe(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function De(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*$,e.scale.value=.5*W,e.map.value=t.map,null!==t.map&&(!0===t.map.matrixAutoUpdate&&t.map.updateMatrix(),e.uvTransform.value.copy(t.map.matrix))}function Ie(e,t){e.fogColor.value=t.color,t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}function ke(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}function Fe(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function Ve(e,t){Fe(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}function ze(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}function Ue(e,t){e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness,ze(e,t)}function je(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function Be(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}function He(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function Ge(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLights.needsUpdate=t,e.pointLights.needsUpdate=t,e.spotLights.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}function qe(){var e=G;return e>=m.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+m.maxTextures),G+=1,e}this.animate=function(e){ve=e,null!==ve?ye():xe()},this.render=function(e,t,n,r){if(t&&t.isCamera){if(!I){V="",F=-1,z=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),ae.enabled&&(t=ae.getCamera(t)),d=M.get(e,t),d.init(),e.onBeforeRender(D,e,t,n),ne.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),J.setFromMatrix(ne),ee=this.localClippingEnabled,K=Q.init(this.clippingPlanes,ee,t),h=E.get(e,t),h.init(),Ae(e,t,D.sortObjects),!0===D.sortObjects&&h.sort(),K&&Q.beginShadows();var i=d.state.shadowsArray;le.render(i,e,t),d.setupLights(t),K&&Q.endShadows(),this.info.autoReset&&this.info.reset(),void 0===n&&(n=null),this.setRenderTarget(n),T.render(h,e,t,r);var o=h.opaque,s=h.transparent;if(e.overrideMaterial){var a=e.overrideMaterial;o.length&&Se(o,e,t,a),s.length&&Se(s,e,t,a)}else o.length&&Se(o,e,t),s.length&&Se(s,e,t);var l=d.state.spritesArray;L.render(l,e,t),n&&b.updateRenderTargetMipmap(n),g.buffers.depth.setTest(!0),g.buffers.depth.setMask(!0),g.buffers.color.setMask(!0),g.setPolygonOffset(!1),e.onAfterRender(D,e,t),ae.enabled&&ae.submitFrame(),h=null,d=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.allocTextureUnit=qe,this.setTexture2D=function(){var e=!1;return function(t,n){t&&t.isWebGLRenderTarget&&(e||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),b.setTexture2D(t,n)}}(),this.setTexture=function(){var e=!1;return function(t,n){e||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),b.setTexture2D(t,n)}}(),this.setTextureCube=function(){var e=!1;return function(t,n){t&&t.isWebGLRenderTargetCube&&(e||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?b.setTextureCube(t,n):b.setTextureCubeDynamic(t,n)}}(),this.getRenderTarget=function(){return k},this.setRenderTarget=function(e){k=e,e&&void 0===x.get(e).__webglFramebuffer&&b.setupRenderTarget(e);var t=null,n=!1;if(e){var r=x.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(t=r[e.activeCubeFace],n=!0):t=r,j.copy(e.viewport),B.copy(e.scissor),H=e.scissorTest}else j.copy(X).multiplyScalar($),B.copy(Y).multiplyScalar($),H=Z;if(N!==t&&(p.bindFramebuffer(p.FRAMEBUFFER,t),N=t),g.viewport(j),g.scissor(B),g.setScissorTest(H),n){var i=x.get(e.texture);p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,i.__webglTexture,e.activeMipMapLevel)}},this.readRenderTargetPixels=function(e,t,n,r,i,o){if(e&&e.isWebGLRenderTarget){var s=x.get(e).__webglFramebuffer;if(s){var a=!1;s!==N&&(p.bindFramebuffer(p.FRAMEBUFFER,s),a=!0);try{var l=e.texture,u=l.format,c=l.type;if(u!==Ne&&O.convert(u)!==p.getParameter(p.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(c!==_e&&O.convert(c)!==p.getParameter(p.IMPLEMENTATION_COLOR_READ_TYPE)&&(c!==Ce||!f.get("OES_texture_float")&&!f.get("WEBGL_color_buffer_float"))&&(c!==Pe||!f.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");p.checkFramebufferStatus(p.FRAMEBUFFER)===p.FRAMEBUFFER_COMPLETE?t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&p.readPixels(t,n,r,i,O.convert(u),O.convert(c),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{a&&p.bindFramebuffer(p.FRAMEBUFFER,N)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,n){var r=t.image.width,i=t.image.height,o=O.convert(t.format);this.setTexture2D(t,0),p.copyTexImage2D(p.TEXTURE_2D,n||0,o,e.x,e.y,r,i,0)},this.copyTextureToTexture=function(e,t,n,r){var i=t.image.width,o=t.image.height,s=O.convert(n.format),a=O.convert(n.type),l=t.isDataTexture?t.image.data:t.image;this.setTexture2D(n,0),p.texSubImage2D(p.TEXTURE_2D,r||0,e.x,e.y,i,o,s,a,l)}}function Ms(e,t){this.name="",this.color=new ni(e),this.density=void 0!==t?t:25e-5}function Ts(e,t,n){this.name="",this.color=new ni(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3}function Cs(){ui.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function Ps(e){Ii.call(this),this.type="SpriteMaterial",this.color=new ni(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(e)}function Rs(e){ui.call(this),this.type="Sprite",this.material=void 0!==e?e:new Ps,this.center=new Ot(.5,.5)}function Ls(){ui.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function Os(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new Dt)}}function Ds(){ui.call(this),this.type="Bone"}function Is(e,t){Ui.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Dt,this.bindMatrixInverse=new Dt;var n=this.initBones(),r=new Os(n);this.bind(r,this.matrixWorld),this.normalizeSkinWeights()}function ks(e){Ii.call(this),this.type="LineBasicMaterial",this.color=new ni(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}function Ns(e,t,n){if(1===n)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new Fs(e,t);ui.call(this),this.type="Line",this.geometry=void 0!==e?e:new Ci,this.material=void 0!==t?t:new ks({color:16777215*Math.random()})}function Fs(e,t){Ns.call(this,e,t),this.type="LineSegments"}function Vs(e,t){Ns.call(this,e,t),this.type="LineLoop"}function zs(e){Ii.call(this),this.type="PointsMaterial",this.color=new ni(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(e)}function Us(e,t){ui.call(this),this.type="Points",this.geometry=void 0!==e?e:new Ci,this.material=void 0!==t?t:new zs({color:16777215*Math.random()})}function js(){ui.call(this),this.type="Group"}function Bs(e,t,n,r,i,o,s,a,l){Vt.call(this,e,t,n,r,i,o,s,a,l),this.generateMipmaps=!1}function Hs(e,t,n,r,i,o,s,a,l,u,c,h){Vt.call(this,null,o,s,a,l,u,r,i,c,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function Gs(e,t,n,r,i,o,s,a,l,u){if(u=void 0!==u?u:ze,u!==ze&&u!==Ue)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&u===ze&&(n=Ee),void 0===n&&u===Ue&&(n=De),Vt.call(this,null,r,i,o,s,a,u,n,l),this.image={width:e,height:t},this.magFilter=void 0!==s?s:ge,this.minFilter=void 0!==a?a:ge,this.flipY=!1,this.generateMipmaps=!1}function qs(e){Ci.call(this),this.type="WireframeGeometry";var t,n,r,i,o,s,a,l,u,c,h=[],d=[0,0],p={},f=["a","b","c"];if(e&&e.isGeometry){var m=e.faces;for(t=0,r=m.length;t<r;t++){var g=m[t];for(n=0;n<3;n++)a=g[f[n]],l=g[f[(n+1)%3]],d[0]=Math.min(a,l),d[1]=Math.max(a,l),u=d[0]+","+d[1],void 0===p[u]&&(p[u]={index1:d[0],index2:d[1]})}for(u in p)s=p[u],c=e.vertices[s.index1],h.push(c.x,c.y,c.z),c=e.vertices[s.index2],h.push(c.x,c.y,c.z)}else if(e&&e.isBufferGeometry){var v,y,x,b,w,_,A,S;if(c=new kt,null!==e.index){for(v=e.attributes.position,y=e.index,x=e.groups,0===x.length&&(x=[{start:0,count:y.count,materialIndex:0}]),i=0,o=x.length;i<o;++i)for(b=x[i],w=b.start,_=b.count,t=w,r=w+_;t<r;t+=3)for(n=0;n<3;n++)a=y.getX(t+n),l=y.getX(t+(n+1)%3),d[0]=Math.min(a,l),d[1]=Math.max(a,l),u=d[0]+","+d[1],void 0===p[u]&&(p[u]={index1:d[0],index2:d[1]});for(u in p)s=p[u],c.fromBufferAttribute(v,s.index1),h.push(c.x,c.y,c.z),c.fromBufferAttribute(v,s.index2),h.push(c.x,c.y,c.z)}else for(v=e.attributes.position,t=0,r=v.count/3;t<r;t++)for(n=0;n<3;n++)A=3*t+n,c.fromBufferAttribute(v,A),h.push(c.x,c.y,c.z),S=3*t+(n+1)%3,c.fromBufferAttribute(v,S),h.push(c.x,c.y,c.z)}this.addAttribute("position",new Ai(h,3))}function Ws(e,t,n){fi.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n},this.fromBufferGeometry(new $s(e,t,n)),this.mergeVertices()}function $s(e,t,n){Ci.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};var r,i,o=[],s=[],a=[],l=[],u=1e-5,c=new kt,h=new kt,d=new kt,p=new kt,f=new kt,m=t+1;for(r=0;r<=n;r++){var g=r/n;for(i=0;i<=t;i++){var v=i/t;e(v,g,h),s.push(h.x,h.y,h.z),v-u>=0?(e(v-u,g,d),p.subVectors(h,d)):(e(v+u,g,d),p.subVectors(d,h)),g-u>=0?(e(v,g-u,d),f.subVectors(h,d)):(e(v,g+u,d),f.subVectors(d,h)),c.crossVectors(p,f).normalize(),a.push(c.x,c.y,c.z),l.push(v,g)}}for(r=0;r<n;r++)for(i=0;i<t;i++){var y=r*m+i,x=r*m+i+1,b=(r+1)*m+i+1,w=(r+1)*m+i;o.push(y,x,w),o.push(x,b,w)}this.setIndex(o),this.addAttribute("position",new Ai(s,3)),this.addAttribute("normal",new Ai(a,3)),this.addAttribute("uv",new Ai(l,2))}function Xs(e,t,n,r){fi.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r},this.fromBufferGeometry(new Ys(e,t,n,r)),this.mergeVertices()}function Ys(e,t,n,r){Ci.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r},n=n||1,r=r||0;var i=[],o=[];function s(e){for(var n=new kt,r=new kt,i=new kt,o=0;o<t.length;o+=3)d(t[o+0],n),d(t[o+1],r),d(t[o+2],i),a(n,r,i,e)}function a(e,t,n,r){var i,o,s=Math.pow(2,r),a=[];for(i=0;i<=s;i++){a[i]=[];var l=e.clone().lerp(n,i/s),u=t.clone().lerp(n,i/s),c=s-i;for(o=0;o<=c;o++)a[i][o]=0===o&&i===s?l:l.clone().lerp(u,o/c)}for(i=0;i<s;i++)for(o=0;o<2*(s-i)-1;o++){var d=Math.floor(o/2);o%2===0?(h(a[i][d+1]),h(a[i+1][d]),h(a[i][d])):(h(a[i][d+1]),h(a[i+1][d+1]),h(a[i+1][d]))}}function l(e){for(var t=new kt,n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}function u(){for(var e=new kt,t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];var n=m(e)/2/Math.PI+.5,r=g(e)/Math.PI+.5;o.push(n,1-r)}p(),c()}function c(){for(var e=0;e<o.length;e+=6){var t=o[e+0],n=o[e+2],r=o[e+4],i=Math.max(t,n,r),s=Math.min(t,n,r);i>.9&&s<.1&&(t<.2&&(o[e+0]+=1),n<.2&&(o[e+2]+=1),r<.2&&(o[e+4]+=1))}}function h(e){i.push(e.x,e.y,e.z)}function d(t,n){var r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function p(){for(var e=new kt,t=new kt,n=new kt,r=new kt,s=new Ot,a=new Ot,l=new Ot,u=0,c=0;u<i.length;u+=9,c+=6){e.set(i[u+0],i[u+1],i[u+2]),t.set(i[u+3],i[u+4],i[u+5]),n.set(i[u+6],i[u+7],i[u+8]),s.set(o[c+0],o[c+1]),a.set(o[c+2],o[c+3]),l.set(o[c+4],o[c+5]),r.copy(e).add(t).add(n).divideScalar(3);var h=m(r);f(s,c+0,e,h),f(a,c+2,t,h),f(l,c+4,n,h)}}function f(e,t,n,r){r<0&&1===e.x&&(o[t]=e.x-1),0===n.x&&0===n.z&&(o[t]=r/2/Math.PI+.5)}function m(e){return Math.atan2(e.z,-e.x)}function g(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}s(r),l(n),u(),this.addAttribute("position",new Ai(i,3)),this.addAttribute("normal",new Ai(i.slice(),3)),this.addAttribute("uv",new Ai(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}function Zs(e,t){fi.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Js(e,t)),this.mergeVertices()}function Js(e,t){var n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];Ys.call(this,n,r,e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Qs(e,t){fi.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ks(e,t)),this.mergeVertices()}function Ks(e,t){var n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];Ys.call(this,n,r,e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function ea(e,t){fi.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new ta(e,t)),this.mergeVertices()}function ta(e,t){var n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],i=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];Ys.call(this,r,i,e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function na(e,t){fi.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new ra(e,t)),this.mergeVertices()}function ra(e,t){var n=(1+Math.sqrt(5))/2,r=1/n,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];Ys.call(this,i,o,e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function ia(e,t,n,r,i,o){fi.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var s=new oa(e,t,n,r,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals,this.fromBufferGeometry(s),this.mergeVertices()}function oa(e,t,n,r,i){Ci.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i},t=t||64,n=n||1,r=r||8,i=i||!1;var o=e.computeFrenetFrames(t,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var s,a,l=new kt,u=new kt,c=new Ot,h=new kt,d=[],p=[],f=[],m=[];function g(){for(s=0;s<t;s++)v(s);v(!1===i?t:0),x(),y()}function v(i){h=e.getPointAt(i/t,h);var s=o.normals[i],c=o.binormals[i];for(a=0;a<=r;a++){var f=a/r*Math.PI*2,m=Math.sin(f),g=-Math.cos(f);u.x=g*s.x+m*c.x,u.y=g*s.y+m*c.y,u.z=g*s.z+m*c.z,u.normalize(),p.push(u.x,u.y,u.z),l.x=h.x+n*u.x,l.y=h.y+n*u.y,l.z=h.z+n*u.z,d.push(l.x,l.y,l.z)}}function y(){for(a=1;a<=t;a++)for(s=1;s<=r;s++){var e=(r+1)*(a-1)+(s-1),n=(r+1)*a+(s-1),i=(r+1)*a+s,o=(r+1)*(a-1)+s;m.push(e,n,o),m.push(n,i,o)}}function x(){for(s=0;s<=t;s++)for(a=0;a<=r;a++)c.x=s/t,c.y=a/r,f.push(c.x,c.y)}g(),this.setIndex(m),this.addAttribute("position",new Ai(d,3)),this.addAttribute("normal",new Ai(p,3)),this.addAttribute("uv",new Ai(f,2))}function sa(e,t,n,r,i,o,s){fi.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:o},void 0!==s&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new aa(e,t,n,r,i,o)),this.mergeVertices()}function aa(e,t,n,r,i,o){Ci.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:o},e=e||1,t=t||.4,n=Math.floor(n)||64,r=Math.floor(r)||8,i=i||2,o=o||3;var s,a,l=[],u=[],c=[],h=[],d=new kt,p=new kt,f=new kt,m=new kt,g=new kt,v=new kt,y=new kt;for(s=0;s<=n;++s){var x=s/n*i*Math.PI*2;for(T(x,i,o,e,f),T(x+.01,i,o,e,m),v.subVectors(m,f),y.addVectors(m,f),g.crossVectors(v,y),y.crossVectors(g,v),g.normalize(),y.normalize(),a=0;a<=r;++a){var b=a/r*Math.PI*2,w=-t*Math.cos(b),_=t*Math.sin(b);d.x=f.x+(w*y.x+_*g.x),d.y=f.y+(w*y.y+_*g.y),d.z=f.z+(w*y.z+_*g.z),u.push(d.x,d.y,d.z),p.subVectors(d,f).normalize(),c.push(p.x,p.y,p.z),h.push(s/n),h.push(a/r)}}for(a=1;a<=n;a++)for(s=1;s<=r;s++){var A=(r+1)*(a-1)+(s-1),S=(r+1)*a+(s-1),E=(r+1)*a+s,M=(r+1)*(a-1)+s;l.push(A,S,M),l.push(S,E,M)}function T(e,t,n,r,i){var o=Math.cos(e),s=Math.sin(e),a=n/t*e,l=Math.cos(a);i.x=r*(2+l)*.5*o,i.y=r*(2+l)*s*.5,i.z=r*Math.sin(a)*.5}this.setIndex(l),this.addAttribute("position",new Ai(u,3)),this.addAttribute("normal",new Ai(c,3)),this.addAttribute("uv",new Ai(h,2))}function la(e,t,n,r,i){fi.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},this.fromBufferGeometry(new ua(e,t,n,r,i)),this.mergeVertices()}function ua(e,t,n,r,i){Ci.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},e=e||1,t=t||.4,n=Math.floor(n)||8,r=Math.floor(r)||6,i=i||2*Math.PI;var o,s,a=[],l=[],u=[],c=[],h=new kt,d=new kt,p=new kt;for(o=0;o<=n;o++)for(s=0;s<=r;s++){var f=s/r*i,m=o/n*Math.PI*2;d.x=(e+t*Math.cos(m))*Math.cos(f),d.y=(e+t*Math.cos(m))*Math.sin(f),d.z=t*Math.sin(m),l.push(d.x,d.y,d.z),h.x=e*Math.cos(f),h.y=e*Math.sin(f),p.subVectors(d,h).normalize(),u.push(p.x,p.y,p.z),c.push(s/r),c.push(o/n)}for(o=1;o<=n;o++)for(s=1;s<=r;s++){var g=(r+1)*o+s-1,v=(r+1)*(o-1)+s-1,y=(r+1)*(o-1)+s,x=(r+1)*o+s;a.push(g,v,x),a.push(v,y,x)}this.setIndex(a),this.addAttribute("position",new Ai(l,3)),this.addAttribute("normal",new Ai(u,3)),this.addAttribute("uv",new Ai(c,2))}fs.prototype=Object.create(Ii.prototype),fs.prototype.constructor=fs,fs.prototype.isMeshDepthMaterial=!0,fs.prototype.copy=function(e){return Ii.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},ms.prototype=Object.create(Ii.prototype),ms.prototype.constructor=ms,ms.prototype.isMeshDistanceMaterial=!0,ms.prototype.copy=function(e){return Ii.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},vs.prototype=Object.create(Vt.prototype),vs.prototype.constructor=vs,_s.prototype=Object.assign(Object.create(ci.prototype),{constructor:_s,isPerspectiveCamera:!0,copy:function(e,t){return ci.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Lt.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Lt.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Lt.RAD2DEG*Math.atan(Math.tan(.5*Lt.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,r,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Lt.DEG2RAD*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r,o=this.view;if(null!==this.view&&this.view.enabled){var s=o.fullWidth,a=o.fullHeight;i+=o.offsetX*r/s,t-=o.offsetY*n/a,r*=o.width/s,n*=o.height/a}var l=this.filmOffset;0!==l&&(i+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far)},toJSON:function(e){var t=ui.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),As.prototype=Object.assign(Object.create(_s.prototype),{constructor:As,isArrayCamera:!0}),Ms.prototype.isFogExp2=!0,Ms.prototype.clone=function(){return new Ms(this.color.getHex(),this.density)},Ms.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},Ts.prototype.isFog=!0,Ts.prototype.clone=function(){return new Ts(this.color.getHex(),this.near,this.far)},Ts.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},Cs.prototype=Object.assign(Object.create(ui.prototype),{constructor:Cs,copy:function(e,t){return ui.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=ui.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}),Ps.prototype=Object.create(Ii.prototype),Ps.prototype.constructor=Ps,Ps.prototype.isSpriteMaterial=!0,Ps.prototype.copy=function(e){return Ii.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this},Rs.prototype=Object.assign(Object.create(ui.prototype),{constructor:Rs,isSprite:!0,raycast:function(){var e=new kt,t=new kt,n=new kt;return function(r,i){t.setFromMatrixPosition(this.matrixWorld),r.ray.closestPointToPoint(t,e),n.setFromMatrixScale(this.matrixWorld);var o=n.x*n.y/4;if(!(t.distanceToSquared(e)>o)){var s=r.ray.origin.distanceTo(e);s<r.near||s>r.far||i.push({distance:s,point:e.clone(),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return ui.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}}),Ls.prototype=Object.assign(Object.create(ui.prototype),{constructor:Ls,copy:function(e){ui.prototype.copy.call(this,e,!1);for(var t=e.levels,n=0,r=t.length;n<r;n++){var i=t[n];this.addLevel(i.object.clone(),i.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var n=this.levels,r=0;r<n.length;r++)if(t<n[r].distance)break;n.splice(r,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,n=1,r=t.length;n<r;n++)if(e<t[n].distance)break;return t[n-1].object},raycast:function(){var e=new kt;return function(t,n){e.setFromMatrixPosition(this.matrixWorld);var r=t.ray.origin.distanceTo(e);this.getObjectForDistance(r).raycast(t,n)}}(),update:function(){var e=new kt,t=new kt;return function(n){var r=this.levels;if(r.length>1){e.setFromMatrixPosition(n.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var i=e.distanceTo(t);r[0].object.visible=!0;for(var o=1,s=r.length;o<s;o++){if(!(i>=r[o].distance))break;r[o-1].object.visible=!1,r[o].object.visible=!0}for(;o<s;o++)r[o].object.visible=!1}}}(),toJSON:function(e){var t=ui.prototype.toJSON.call(this,e);t.object.levels=[];for(var n=this.levels,r=0,i=n.length;r<i;r++){var o=n[r];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),Object.assign(Os.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new Dt;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},pose:function(){var e,t,n;for(t=0,n=this.bones.length;t<n;t++)e=this.bones[t],e&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,n=this.bones.length;t<n;t++)e=this.bones[t],e&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){var e=new Dt,t=new Dt;return function(){for(var n=this.bones,r=this.boneInverses,i=this.boneMatrices,o=this.boneTexture,s=0,a=n.length;s<a;s++){var l=n[s]?n[s].matrixWorld:t;e.multiplyMatrices(l,r[s]),e.toArray(i,16*s)}void 0!==o&&(o.needsUpdate=!0)}}(),clone:function(){return new Os(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,n=this.bones.length;t<n;t++){var r=this.bones[t];if(r.name===e)return r}}}),Ds.prototype=Object.assign(Object.create(ui.prototype),{constructor:Ds,isBone:!0}),Is.prototype=Object.assign(Object.create(Ui.prototype),{constructor:Is,isSkinnedMesh:!0,initBones:function(){var e,t,n,r,i=[];if(this.geometry&&void 0!==this.geometry.bones){for(n=0,r=this.geometry.bones.length;n<r;n++)t=this.geometry.bones[n],e=new Ds,i.push(e),e.name=t.name,e.position.fromArray(t.pos),e.quaternion.fromArray(t.rotq),void 0!==t.scl&&e.scale.fromArray(t.scl);for(n=0,r=this.geometry.bones.length;n<r;n++)t=this.geometry.bones[n],-1!==t.parent&&null!==t.parent&&void 0!==i[t.parent]?i[t.parent].add(i[n]):this.add(i[n])}return this.updateMatrixWorld(!0),i},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var e,t;if(this.geometry&&this.geometry.isGeometry)for(t=0;t<this.geometry.skinWeights.length;t++){var n=this.geometry.skinWeights[t];e=1/n.manhattanLength(),e!==1/0?n.multiplyScalar(e):n.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var r=new zt,i=this.geometry.attributes.skinWeight;for(t=0;t<i.count;t++)r.x=i.getX(t),r.y=i.getY(t),r.z=i.getZ(t),r.w=i.getW(t),e=1/r.manhattanLength(),e!==1/0?r.multiplyScalar(e):r.set(1,0,0,0),i.setXYZW(t,r.x,r.y,r.z,r.w)}},updateMatrixWorld:function(e){Ui.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),ks.prototype=Object.create(Ii.prototype),ks.prototype.constructor=ks,ks.prototype.isLineBasicMaterial=!0,ks.prototype.copy=function(e){return Ii.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},Ns.prototype=Object.assign(Object.create(ui.prototype),{constructor:Ns,isLine:!0,computeLineDistances:function(){var e=new kt,t=new kt;return function(){var n=this.geometry;if(n.isBufferGeometry)if(null===n.index){for(var r=n.attributes.position,i=[0],o=1,s=r.count;o<s;o++)e.fromBufferAttribute(r,o-1),t.fromBufferAttribute(r,o),i[o]=i[o-1],i[o]+=e.distanceTo(t);n.addAttribute("lineDistance",new Ai(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(n.isGeometry){var a=n.vertices;i=n.lineDistances;i[0]=0;for(o=1,s=a.length;o<s;o++)i[o]=i[o-1],i[o]+=a[o-1].distanceTo(a[o])}return this}}(),raycast:function(){var e=new Dt,t=new Fi,n=new Gt;return function(r,i){var o=r.linePrecision,s=o*o,a=this.geometry,l=this.matrixWorld;if(null===a.boundingSphere&&a.computeBoundingSphere(),n.copy(a.boundingSphere),n.applyMatrix4(l),!1!==r.ray.intersectsSphere(n)){e.getInverse(l),t.copy(r.ray).applyMatrix4(e);var u=new kt,c=new kt,h=new kt,d=new kt,p=this&&this.isLineSegments?2:1;if(a.isBufferGeometry){var f=a.index,m=a.attributes,g=m.position.array;if(null!==f)for(var v=f.array,y=0,x=v.length-1;y<x;y+=p){var b=v[y],w=v[y+1];u.fromArray(g,3*b),c.fromArray(g,3*w);var _=t.distanceSqToSegment(u,c,d,h);if(!(_>s)){d.applyMatrix4(this.matrixWorld);var A=r.ray.origin.distanceTo(d);A<r.near||A>r.far||i.push({distance:A,point:h.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}else for(y=0,x=g.length/3-1;y<x;y+=p){u.fromArray(g,3*y),c.fromArray(g,3*y+3);_=t.distanceSqToSegment(u,c,d,h);if(!(_>s)){d.applyMatrix4(this.matrixWorld);A=r.ray.origin.distanceTo(d);A<r.near||A>r.far||i.push({distance:A,point:h.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}else if(a.isGeometry){var S=a.vertices,E=S.length;for(y=0;y<E-1;y+=p){_=t.distanceSqToSegment(S[y],S[y+1],d,h);if(!(_>s)){d.applyMatrix4(this.matrixWorld);A=r.ray.origin.distanceTo(d);A<r.near||A>r.far||i.push({distance:A,point:h.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Fs.prototype=Object.assign(Object.create(Ns.prototype),{constructor:Fs,isLineSegments:!0,computeLineDistances:function(){var e=new kt,t=new kt;return function(){var n=this.geometry;if(n.isBufferGeometry)if(null===n.index){for(var r=n.attributes.position,i=[],o=0,s=r.count;o<s;o+=2)e.fromBufferAttribute(r,o),t.fromBufferAttribute(r,o+1),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+e.distanceTo(t);n.addAttribute("lineDistance",new Ai(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(n.isGeometry){var a=n.vertices;for(i=n.lineDistances,o=0,s=a.length;o<s;o+=2)e.copy(a[o]),t.copy(a[o+1]),i[o]=0===o?0:i[o-1],i[o+1]=i[o]+e.distanceTo(t)}return this}}()}),Vs.prototype=Object.assign(Object.create(Ns.prototype),{constructor:Vs,isLineLoop:!0}),zs.prototype=Object.create(Ii.prototype),zs.prototype.constructor=zs,zs.prototype.isPointsMaterial=!0,zs.prototype.copy=function(e){return Ii.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this},Us.prototype=Object.assign(Object.create(ui.prototype),{constructor:Us,isPoints:!0,raycast:function(){var e=new Dt,t=new Fi,n=new Gt;return function(r,i){var o=this,s=this.geometry,a=this.matrixWorld,l=r.params.Points.threshold;if(null===s.boundingSphere&&s.computeBoundingSphere(),n.copy(s.boundingSphere),n.applyMatrix4(a),n.radius+=l,!1!==r.ray.intersectsSphere(n)){e.getInverse(a),t.copy(r.ray).applyMatrix4(e);var u=l/((this.scale.x+this.scale.y+this.scale.z)/3),c=u*u,h=new kt,d=new kt;if(s.isBufferGeometry){var p=s.index,f=s.attributes,m=f.position.array;if(null!==p)for(var g=p.array,v=0,y=g.length;v<y;v++){var x=g[v];h.fromArray(m,3*x),_(h,x)}else{v=0;for(var b=m.length/3;v<b;v++)h.fromArray(m,3*v),_(h,v)}}else{var w=s.vertices;for(v=0,b=w.length;v<b;v++)_(w[v],v)}}function _(e,n){var s=t.distanceSqToPoint(e);if(s<c){t.closestPointToPoint(e,d),d.applyMatrix4(a);var l=r.ray.origin.distanceTo(d);if(l<r.near||l>r.far)return;i.push({distance:l,distanceToRay:Math.sqrt(s),point:d.clone(),index:n,face:null,object:o})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),js.prototype=Object.assign(Object.create(ui.prototype),{constructor:js,isGroup:!0}),Bs.prototype=Object.assign(Object.create(Vt.prototype),{constructor:Bs,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Hs.prototype=Object.create(Vt.prototype),Hs.prototype.constructor=Hs,Hs.prototype.isCompressedTexture=!0,Gs.prototype=Object.create(Vt.prototype),Gs.prototype.constructor=Gs,Gs.prototype.isDepthTexture=!0,qs.prototype=Object.create(Ci.prototype),qs.prototype.constructor=qs,Ws.prototype=Object.create(fi.prototype),Ws.prototype.constructor=Ws,$s.prototype=Object.create(Ci.prototype),$s.prototype.constructor=$s,Xs.prototype=Object.create(fi.prototype),Xs.prototype.constructor=Xs,Ys.prototype=Object.create(Ci.prototype),Ys.prototype.constructor=Ys,Zs.prototype=Object.create(fi.prototype),Zs.prototype.constructor=Zs,Js.prototype=Object.create(Ys.prototype),Js.prototype.constructor=Js,Qs.prototype=Object.create(fi.prototype),Qs.prototype.constructor=Qs,Ks.prototype=Object.create(Ys.prototype),Ks.prototype.constructor=Ks,ea.prototype=Object.create(fi.prototype),ea.prototype.constructor=ea,ta.prototype=Object.create(Ys.prototype),ta.prototype.constructor=ta,na.prototype=Object.create(fi.prototype),na.prototype.constructor=na,ra.prototype=Object.create(Ys.prototype),ra.prototype.constructor=ra,ia.prototype=Object.create(fi.prototype),ia.prototype.constructor=ia,oa.prototype=Object.create(Ci.prototype),oa.prototype.constructor=oa,sa.prototype=Object.create(fi.prototype),sa.prototype.constructor=sa,aa.prototype=Object.create(Ci.prototype),aa.prototype.constructor=aa,la.prototype=Object.create(fi.prototype),la.prototype.constructor=la,ua.prototype=Object.create(Ci.prototype),ua.prototype.constructor=ua;var ca={triangulate:function(e,t,n){n=n||2;var r,i,o,s,a,l,u,c=t&&t.length,h=c?t[0]*n:e.length,d=ha(e,0,h,n,!0),p=[];if(!d)return p;if(c&&(d=ya(e,t,d,n)),e.length>80*n){r=o=e[0],i=s=e[1];for(var f=n;f<h;f+=n)a=e[f],l=e[f+1],a<r&&(r=a),l<i&&(i=l),a>o&&(o=a),l>s&&(s=l);u=Math.max(o-r,s-i),u=0!==u?1/u:0}return pa(d,p,n,r,i,u),p}};function ha(e,t,n,r,i){var o,s;if(i===Va(e,t,n,r)>0)for(o=t;o<n;o+=r)s=ka(o,e[o],e[o+1],s);else for(o=n-r;o>=t;o-=r)s=ka(o,e[o],e[o+1],s);return s&&Pa(s,s.next)&&(Na(s),s=s.next),s}function da(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!Pa(r,r.next)&&0!==Ca(r.prev,r,r.next))r=r.next;else{if(Na(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function pa(e,t,n,r,i,o,s){if(e){!s&&o&&_a(e,r,i,o);var a,l,u=e;while(e.prev!==e.next)if(a=e.prev,l=e.next,o?ma(e,r,i,o):fa(e))t.push(a.i/n),t.push(e.i/n),t.push(l.i/n),Na(e),e=l.next,u=l.next;else if(e=l,e===u){s?1===s?(e=ga(e,t,n),pa(e,t,n,r,i,o,2)):2===s&&va(e,t,n,r,i,o):pa(da(e),t,n,r,i,o,1);break}}}function fa(e){var t=e.prev,n=e,r=e.next;if(Ca(t,n,r)>=0)return!1;var i=e.next.next;while(i!==e.prev){if(Ma(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Ca(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function ma(e,t,n,r){var i=e.prev,o=e,s=e.next;if(Ca(i,o,s)>=0)return!1;var a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,l=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,u=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,c=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,h=Sa(a,l,t,n,r),d=Sa(u,c,t,n,r),p=e.nextZ;while(p&&p.z<=d){if(p!==e.prev&&p!==e.next&&Ma(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Ca(p.prev,p,p.next)>=0)return!1;p=p.nextZ}p=e.prevZ;while(p&&p.z>=h){if(p!==e.prev&&p!==e.next&&Ma(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&Ca(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function ga(e,t,n){var r=e;do{var i=r.prev,o=r.next.next;!Pa(i,o)&&Ra(i,r,r.next,o)&&Oa(i,o)&&Oa(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),Na(r),Na(r.next),r=e=o),r=r.next}while(r!==e);return r}function va(e,t,n,r,i,o){var s=e;do{var a=s.next.next;while(a!==s.prev){if(s.i!==a.i&&Ta(s,a)){var l=Ia(s,a);return s=da(s,s.next),l=da(l,l.next),pa(s,t,n,r,i,o),void pa(l,t,n,r,i,o)}a=a.next}s=s.next}while(s!==e)}function ya(e,t,n,r){var i,o,s,a,l,u=[];for(i=0,o=t.length;i<o;i++)s=t[i]*r,a=i<o-1?t[i+1]*r:e.length,l=ha(e,s,a,r,!1),l===l.next&&(l.steiner=!0),u.push(Ea(l));for(u.sort(xa),i=0;i<u.length;i++)ba(u[i],n),n=da(n,n.next);return n}function xa(e,t){return e.x-t.x}function ba(e,t){if(t=wa(e,t),t){var n=Ia(t,e);da(n,n.next)}}function wa(e,t){var n,r=t,i=e.x,o=e.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>s){if(s=a,a===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===s)return n.prev;var l,u=n,c=n.x,h=n.y,d=1/0;r=n.next;while(r!==u)i>=r.x&&r.x>=c&&i!==r.x&&Ma(o<h?i:s,o,c,h,o<h?s:i,o,r.x,r.y)&&(l=Math.abs(o-r.y)/(i-r.x),(l<d||l===d&&r.x>n.x)&&Oa(r,e)&&(n=r,d=l)),r=r.next;return n}function _a(e,t,n,r){var i=e;do{null===i.z&&(i.z=Sa(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,Aa(i)}function Aa(e){var t,n,r,i,o,s,a,l,u=1;do{n=e,e=null,o=null,s=0;while(n){for(s++,r=n,a=0,t=0;t<u;t++)if(a++,r=r.nextZ,!r)break;l=u;while(a>0||l>0&&r)0!==a&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,u*=2}while(s>1);return e}function Sa(e,t,n,r,i){return e=32767*(e-n)*i,t=32767*(t-r)*i,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e|t<<1}function Ea(e){var t=e,n=e;do{t.x<n.x&&(n=t),t=t.next}while(t!==e);return n}function Ma(e,t,n,r,i,o,s,a){return(i-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(r-a)-(n-s)*(t-a)>=0&&(n-s)*(o-a)-(i-s)*(r-a)>=0}function Ta(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!La(e,t)&&Oa(e,t)&&Oa(t,e)&&Da(e,t)}function Ca(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Pa(e,t){return e.x===t.x&&e.y===t.y}function Ra(e,t,n,r){return!!(Pa(e,t)&&Pa(n,r)||Pa(e,r)&&Pa(n,t))||Ca(e,t,n)>0!==Ca(e,t,r)>0&&Ca(n,r,e)>0!==Ca(n,r,t)>0}function La(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Ra(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function Oa(e,t){return Ca(e.prev,e,e.next)<0?Ca(e,t,e.next)>=0&&Ca(e,e.prev,t)>=0:Ca(e,t,e.prev)<0||Ca(e,e.next,t)<0}function Da(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!==n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}function Ia(e,t){var n=new Fa(e.i,e.x,e.y),r=new Fa(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function ka(e,t,n,r){var i=new Fa(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Na(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Fa(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Va(e,t,n,r){for(var i=0,o=t,s=n-r;o<n;o+=r)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}var za={area:function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n},isClockWise:function(e){return za.area(e)<0},triangulateShape:function(e,t){var n=[],r=[],i=[];Ua(e),ja(n,e);var o=e.length;t.forEach(Ua);for(var s=0;s<t.length;s++)r.push(o),o+=t[s].length,ja(n,t[s]);var a=ca.triangulate(n,r);for(s=0;s<a.length;s+=3)i.push(a.slice(s,s+3));return i}};function Ua(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function ja(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}function Ba(e,t){fi.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new Ha(e,t)),this.mergeVertices()}function Ha(e,t){Ci.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var n=this,r=[],i=[],o=0,s=e.length;o<s;o++){var a=e[o];l(a,t)}function l(e){var o,s,a,l,u,c,h,d,p=[],f=void 0!==t.curveSegments?t.curveSegments:12,m=void 0!==t.steps?t.steps:1,g=void 0!==t.amount?t.amount:100,v=void 0===t.bevelEnabled||t.bevelEnabled,y=void 0!==t.bevelThickness?t.bevelThickness:6,x=void 0!==t.bevelSize?t.bevelSize:y-2,b=void 0!==t.bevelSegments?t.bevelSegments:3,w=t.extrudePath,_=void 0!==t.UVGenerator?t.UVGenerator:Ga,A=!1;w&&(o=w.getSpacedPoints(m),A=!0,v=!1,s=w.computeFrenetFrames(m,!1),a=new kt,l=new kt,u=new kt),v||(b=0,y=0,x=0);var S=e.extractPoints(f),E=S.shape,M=S.holes,T=!za.isClockWise(E);if(T)for(E=E.reverse(),h=0,d=M.length;h<d;h++)c=M[h],za.isClockWise(c)&&(M[h]=c.reverse());var C=za.triangulateShape(E,M),P=E;for(h=0,d=M.length;h<d;h++)c=M[h],E=E.concat(c);function R(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var L,O,D,I,k,N,F=E.length,V=C.length;function z(e,t,n){var r,i,o,s=e.x-t.x,a=e.y-t.y,l=n.x-e.x,u=n.y-e.y,c=s*s+a*a,h=s*u-a*l;if(Math.abs(h)>Number.EPSILON){var d=Math.sqrt(c),p=Math.sqrt(l*l+u*u),f=t.x-a/d,m=t.y+s/d,g=n.x-u/p,v=n.y+l/p,y=((g-f)*u-(v-m)*l)/(s*u-a*l);r=f+s*y-e.x,i=m+a*y-e.y;var x=r*r+i*i;if(x<=2)return new Ot(r,i);o=Math.sqrt(x/2)}else{var b=!1;s>Number.EPSILON?l>Number.EPSILON&&(b=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(b=!0):Math.sign(a)===Math.sign(u)&&(b=!0),b?(r=-a,i=s,o=Math.sqrt(c)):(r=s,i=a,o=Math.sqrt(c/2))}return new Ot(r/o,i/o)}for(var U=[],j=0,B=P.length,H=B-1,G=j+1;j<B;j++,H++,G++)H===B&&(H=0),G===B&&(G=0),U[j]=z(P[j],P[H],P[G]);var q,W,$=[],X=U.concat();for(h=0,d=M.length;h<d;h++){for(c=M[h],q=[],j=0,B=c.length,H=B-1,G=j+1;j<B;j++,H++,G++)H===B&&(H=0),G===B&&(G=0),q[j]=z(c[j],c[H],c[G]);$.push(q),X=X.concat(q)}for(L=0;L<b;L++){for(D=L/b,I=y*Math.cos(D*Math.PI/2),O=x*Math.sin(D*Math.PI/2),j=0,B=P.length;j<B;j++)k=R(P[j],U[j],O),Q(k.x,k.y,-I);for(h=0,d=M.length;h<d;h++)for(c=M[h],q=$[h],j=0,B=c.length;j<B;j++)k=R(c[j],q[j],O),Q(k.x,k.y,-I)}for(O=x,j=0;j<F;j++)k=v?R(E[j],X[j],O):E[j],A?(l.copy(s.normals[0]).multiplyScalar(k.x),a.copy(s.binormals[0]).multiplyScalar(k.y),u.copy(o[0]).add(l).add(a),Q(u.x,u.y,u.z)):Q(k.x,k.y,0);for(W=1;W<=m;W++)for(j=0;j<F;j++)k=v?R(E[j],X[j],O):E[j],A?(l.copy(s.normals[W]).multiplyScalar(k.x),a.copy(s.binormals[W]).multiplyScalar(k.y),u.copy(o[W]).add(l).add(a),Q(u.x,u.y,u.z)):Q(k.x,k.y,g/m*W);for(L=b-1;L>=0;L--){for(D=L/b,I=y*Math.cos(D*Math.PI/2),O=x*Math.sin(D*Math.PI/2),j=0,B=P.length;j<B;j++)k=R(P[j],U[j],O),Q(k.x,k.y,g+I);for(h=0,d=M.length;h<d;h++)for(c=M[h],q=$[h],j=0,B=c.length;j<B;j++)k=R(c[j],q[j],O),A?Q(k.x,k.y+o[m-1].y,o[m-1].x+I):Q(k.x,k.y,g+I)}function Y(){var e=r.length/3;if(v){var t=0,i=F*t;for(j=0;j<V;j++)N=C[j],K(N[2]+i,N[1]+i,N[0]+i);for(t=m+2*b,i=F*t,j=0;j<V;j++)N=C[j],K(N[0]+i,N[1]+i,N[2]+i)}else{for(j=0;j<V;j++)N=C[j],K(N[2],N[1],N[0]);for(j=0;j<V;j++)N=C[j],K(N[0]+F*m,N[1]+F*m,N[2]+F*m)}n.addGroup(e,r.length/3-e,0)}function Z(){var e=r.length/3,t=0;for(J(P,t),t+=P.length,h=0,d=M.length;h<d;h++)c=M[h],J(c,t),t+=c.length;n.addGroup(e,r.length/3-e,1)}function J(e,t){var n,r;j=e.length;while(--j>=0){n=j,r=j-1,r<0&&(r=e.length-1);var i=0,o=m+2*b;for(i=0;i<o;i++){var s=F*i,a=F*(i+1),l=t+n+s,u=t+r+s,c=t+r+a,h=t+n+a;ee(l,u,c,h)}}}function Q(e,t,n){p.push(e),p.push(t),p.push(n)}function K(e,t,i){te(e),te(t),te(i);var o=r.length/3,s=_.generateTopUV(n,r,o-3,o-2,o-1);ne(s[0]),ne(s[1]),ne(s[2])}function ee(e,t,i,o){te(e),te(t),te(o),te(t),te(i),te(o);var s=r.length/3,a=_.generateSideWallUV(n,r,s-6,s-3,s-2,s-1);ne(a[0]),ne(a[1]),ne(a[3]),ne(a[1]),ne(a[2]),ne(a[3])}function te(e){r.push(p[3*e+0]),r.push(p[3*e+1]),r.push(p[3*e+2])}function ne(e){i.push(e.x),i.push(e.y)}Y(),Z()}this.addAttribute("position",new Ai(r,3)),this.addAttribute("uv",new Ai(i,2)),this.computeVertexNormals()}Ba.prototype=Object.create(fi.prototype),Ba.prototype.constructor=Ba,Ha.prototype=Object.create(Ci.prototype),Ha.prototype.constructor=Ha;var Ga={generateTopUV:function(e,t,n,r,i){var o=t[3*n],s=t[3*n+1],a=t[3*r],l=t[3*r+1],u=t[3*i],c=t[3*i+1];return[new Ot(o,s),new Ot(a,l),new Ot(u,c)]},generateSideWallUV:function(e,t,n,r,i,o){var s=t[3*n],a=t[3*n+1],l=t[3*n+2],u=t[3*r],c=t[3*r+1],h=t[3*r+2],d=t[3*i],p=t[3*i+1],f=t[3*i+2],m=t[3*o],g=t[3*o+1],v=t[3*o+2];return Math.abs(a-c)<.01?[new Ot(s,1-l),new Ot(u,1-h),new Ot(d,1-f),new Ot(m,1-v)]:[new Ot(a,1-l),new Ot(c,1-h),new Ot(p,1-f),new Ot(g,1-v)]}};function qa(e,t){fi.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Wa(e,t)),this.mergeVertices()}function Wa(e,t){t=t||{};var n=t.font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new fi;var r=n.generateShapes(e,t.size,t.curveSegments);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),Ha.call(this,r,t),this.type="TextBufferGeometry"}function $a(e,t,n,r,i,o,s){fi.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new Xa(e,t,n,r,i,o,s)),this.mergeVertices()}function Xa(e,t,n,r,i,o,s){Ci.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:s},e=e||1,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,o=void 0!==o?o:0,s=void 0!==s?s:Math.PI;var a,l,u=o+s,c=0,h=[],d=new kt,p=new kt,f=[],m=[],g=[],v=[];for(l=0;l<=n;l++){var y=[],x=l/n;for(a=0;a<=t;a++){var b=a/t;d.x=-e*Math.cos(r+b*i)*Math.sin(o+x*s),d.y=e*Math.cos(o+x*s),d.z=e*Math.sin(r+b*i)*Math.sin(o+x*s),m.push(d.x,d.y,d.z),p.set(d.x,d.y,d.z).normalize(),g.push(p.x,p.y,p.z),v.push(b,1-x),y.push(c++)}h.push(y)}for(l=0;l<n;l++)for(a=0;a<t;a++){var w=h[l][a+1],_=h[l][a],A=h[l+1][a],S=h[l+1][a+1];(0!==l||o>0)&&f.push(w,_,S),(l!==n-1||u<Math.PI)&&f.push(_,A,S)}this.setIndex(f),this.addAttribute("position",new Ai(m,3)),this.addAttribute("normal",new Ai(g,3)),this.addAttribute("uv",new Ai(v,2))}function Ya(e,t,n,r,i,o){fi.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},this.fromBufferGeometry(new Za(e,t,n,r,i,o)),this.mergeVertices()}function Za(e,t,n,r,i,o){Ci.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},e=e||.5,t=t||1,i=void 0!==i?i:0,o=void 0!==o?o:2*Math.PI,n=void 0!==n?Math.max(3,n):8,r=void 0!==r?Math.max(1,r):1;var s,a,l,u=[],c=[],h=[],d=[],p=e,f=(t-e)/r,m=new kt,g=new Ot;for(a=0;a<=r;a++){for(l=0;l<=n;l++)s=i+l/n*o,m.x=p*Math.cos(s),m.y=p*Math.sin(s),c.push(m.x,m.y,m.z),h.push(0,0,1),g.x=(m.x/t+1)/2,g.y=(m.y/t+1)/2,d.push(g.x,g.y);p+=f}for(a=0;a<r;a++){var v=a*(n+1);for(l=0;l<n;l++){s=l+v;var y=s,x=s+n+1,b=s+n+2,w=s+1;u.push(y,x,w),u.push(x,b,w)}}this.setIndex(u),this.addAttribute("position",new Ai(c,3)),this.addAttribute("normal",new Ai(h,3)),this.addAttribute("uv",new Ai(d,2))}function Ja(e,t,n,r){fi.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},this.fromBufferGeometry(new Qa(e,t,n,r)),this.mergeVertices()}function Qa(e,t,n,r){Ci.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t)||12,n=n||0,r=r||2*Math.PI,r=Lt.clamp(r,0,2*Math.PI);var i,o,s,a=[],l=[],u=[],c=1/t,h=new kt,d=new Ot;for(o=0;o<=t;o++){var p=n+o*c*r,f=Math.sin(p),m=Math.cos(p);for(s=0;s<=e.length-1;s++)h.x=e[s].x*f,h.y=e[s].y,h.z=e[s].x*m,l.push(h.x,h.y,h.z),d.x=o/t,d.y=s/(e.length-1),u.push(d.x,d.y)}for(o=0;o<t;o++)for(s=0;s<e.length-1;s++){i=s+o*e.length;var g=i,v=i+e.length,y=i+e.length+1,x=i+1;a.push(g,v,x),a.push(v,y,x)}if(this.setIndex(a),this.addAttribute("position",new Ai(l,3)),this.addAttribute("uv",new Ai(u,2)),this.computeVertexNormals(),r===2*Math.PI){var b=this.attributes.normal.array,w=new kt,_=new kt,A=new kt;for(i=t*e.length*3,o=0,s=0;o<e.length;o++,s+=3)w.x=b[s+0],w.y=b[s+1],w.z=b[s+2],_.x=b[i+s+0],_.y=b[i+s+1],_.z=b[i+s+2],A.addVectors(w,_).normalize(),b[s+0]=b[i+s+0]=A.x,b[s+1]=b[i+s+1]=A.y,b[s+2]=b[i+s+2]=A.z}}function Ka(e,t){fi.call(this),this.type="ShapeGeometry","object"===typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new el(e,t)),this.mergeVertices()}function el(e,t){Ci.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var n=[],r=[],i=[],o=[],s=0,a=0;if(!1===Array.isArray(e))u(e);else for(var l=0;l<e.length;l++)u(e[l]),this.addGroup(s,a,l),s+=a,a=0;function u(e){var s,l,u,c=r.length/3,h=e.extractPoints(t),d=h.shape,p=h.holes;if(!1===za.isClockWise(d))for(d=d.reverse(),s=0,l=p.length;s<l;s++)u=p[s],!0===za.isClockWise(u)&&(p[s]=u.reverse());var f=za.triangulateShape(d,p);for(s=0,l=p.length;s<l;s++)u=p[s],d=d.concat(u);for(s=0,l=d.length;s<l;s++){var m=d[s];r.push(m.x,m.y,0),i.push(0,0,1),o.push(m.x,m.y)}for(s=0,l=f.length;s<l;s++){var g=f[s],v=g[0]+c,y=g[1]+c,x=g[2]+c;n.push(v,y,x),a+=3}}this.setIndex(n),this.addAttribute("position",new Ai(r,3)),this.addAttribute("normal",new Ai(i,3)),this.addAttribute("uv",new Ai(o,2))}function tl(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++){var i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}function nl(e,t){Ci.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var n,r,i,o,s=[],a=Math.cos(Lt.DEG2RAD*t),l=[0,0],u={},c=["a","b","c"];e.isBufferGeometry?(o=new fi,o.fromBufferGeometry(e)):o=e.clone(),o.mergeVertices(),o.computeFaceNormals();for(var h=o.vertices,d=o.faces,p=0,f=d.length;p<f;p++)for(var m=d[p],g=0;g<3;g++)n=m[c[g]],r=m[c[(g+1)%3]],l[0]=Math.min(n,r),l[1]=Math.max(n,r),i=l[0]+","+l[1],void 0===u[i]?u[i]={index1:l[0],index2:l[1],face1:p,face2:void 0}:u[i].face2=p;for(i in u){var v=u[i];if(void 0===v.face2||d[v.face1].normal.dot(d[v.face2].normal)<=a){var y=h[v.index1];s.push(y.x,y.y,y.z),y=h[v.index2],s.push(y.x,y.y,y.z)}}this.addAttribute("position",new Ai(s,3))}function rl(e,t,n,r,i,o,s,a){fi.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a},this.fromBufferGeometry(new il(e,t,n,r,i,o,s,a)),this.mergeVertices()}function il(e,t,n,r,i,o,s,a){Ci.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a};var l=this;e=void 0!==e?e:1,t=void 0!==t?t:1,n=n||1,r=Math.floor(r)||8,i=Math.floor(i)||1,o=void 0!==o&&o,s=void 0!==s?s:0,a=void 0!==a?a:2*Math.PI;var u=[],c=[],h=[],d=[],p=0,f=[],m=n/2,g=0;function v(){var o,v,y=new kt,x=new kt,b=0,w=(t-e)/n;for(v=0;v<=i;v++){var _=[],A=v/i,S=A*(t-e)+e;for(o=0;o<=r;o++){var E=o/r,M=E*a+s,T=Math.sin(M),C=Math.cos(M);x.x=S*T,x.y=-A*n+m,x.z=S*C,c.push(x.x,x.y,x.z),y.set(T,w,C).normalize(),h.push(y.x,y.y,y.z),d.push(E,1-A),_.push(p++)}f.push(_)}for(o=0;o<r;o++)for(v=0;v<i;v++){var P=f[v][o],R=f[v+1][o],L=f[v+1][o+1],O=f[v][o+1];u.push(P,R,O),u.push(R,L,O),b+=6}l.addGroup(g,b,0),g+=b}function y(n){var i,o,f,v=new Ot,y=new kt,x=0,b=!0===n?e:t,w=!0===n?1:-1;for(o=p,i=1;i<=r;i++)c.push(0,m*w,0),h.push(0,w,0),d.push(.5,.5),p++;for(f=p,i=0;i<=r;i++){var _=i/r,A=_*a+s,S=Math.cos(A),E=Math.sin(A);y.x=b*E,y.y=m*w,y.z=b*S,c.push(y.x,y.y,y.z),h.push(0,w,0),v.x=.5*S+.5,v.y=.5*E*w+.5,d.push(v.x,v.y),p++}for(i=0;i<r;i++){var M=o+i,T=f+i;!0===n?u.push(T,T+1,M):u.push(T+1,T,M),x+=3}l.addGroup(g,x,!0===n?1:2),g+=x}v(),!1===o&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(u),this.addAttribute("position",new Ai(c,3)),this.addAttribute("normal",new Ai(h,3)),this.addAttribute("uv",new Ai(d,2))}function ol(e,t,n,r,i,o,s){rl.call(this,0,e,t,n,r,i,o,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:s}}function sl(e,t,n,r,i,o,s){il.call(this,0,e,t,n,r,i,o,s),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:s}}function al(e,t,n,r){fi.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},this.fromBufferGeometry(new ll(e,t,n,r)),this.mergeVertices()}function ll(e,t,n,r){Ci.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},e=e||1,t=void 0!==t?Math.max(3,t):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var i,o,s=[],a=[],l=[],u=[],c=new kt,h=new Ot;for(a.push(0,0,0),l.push(0,0,1),u.push(.5,.5),o=0,i=3;o<=t;o++,i+=3){var d=n+o/t*r;c.x=e*Math.cos(d),c.y=e*Math.sin(d),a.push(c.x,c.y,c.z),l.push(0,0,1),h.x=(a[i]/e+1)/2,h.y=(a[i+1]/e+1)/2,u.push(h.x,h.y)}for(i=1;i<=t;i++)s.push(i,i+1,0);this.setIndex(s),this.addAttribute("position",new Ai(a,3)),this.addAttribute("normal",new Ai(l,3)),this.addAttribute("uv",new Ai(u,2))}qa.prototype=Object.create(fi.prototype),qa.prototype.constructor=qa,Wa.prototype=Object.create(Ha.prototype),Wa.prototype.constructor=Wa,$a.prototype=Object.create(fi.prototype),$a.prototype.constructor=$a,Xa.prototype=Object.create(Ci.prototype),Xa.prototype.constructor=Xa,Ya.prototype=Object.create(fi.prototype),Ya.prototype.constructor=Ya,Za.prototype=Object.create(Ci.prototype),Za.prototype.constructor=Za,Ja.prototype=Object.create(fi.prototype),Ja.prototype.constructor=Ja,Qa.prototype=Object.create(Ci.prototype),Qa.prototype.constructor=Qa,Ka.prototype=Object.create(fi.prototype),Ka.prototype.constructor=Ka,Ka.prototype.toJSON=function(){var e=fi.prototype.toJSON.call(this),t=this.parameters.shapes;return tl(t,e)},el.prototype=Object.create(Ci.prototype),el.prototype.constructor=el,el.prototype.toJSON=function(){var e=Ci.prototype.toJSON.call(this),t=this.parameters.shapes;return tl(t,e)},nl.prototype=Object.create(Ci.prototype),nl.prototype.constructor=nl,rl.prototype=Object.create(fi.prototype),rl.prototype.constructor=rl,il.prototype=Object.create(Ci.prototype),il.prototype.constructor=il,ol.prototype=Object.create(rl.prototype),ol.prototype.constructor=ol,sl.prototype=Object.create(il.prototype),sl.prototype.constructor=sl,al.prototype=Object.create(fi.prototype),al.prototype.constructor=al,ll.prototype=Object.create(Ci.prototype),ll.prototype.constructor=ll;var ul=Object.freeze({WireframeGeometry:qs,ParametricGeometry:Ws,ParametricBufferGeometry:$s,TetrahedronGeometry:Zs,TetrahedronBufferGeometry:Js,OctahedronGeometry:Qs,OctahedronBufferGeometry:Ks,IcosahedronGeometry:ea,IcosahedronBufferGeometry:ta,DodecahedronGeometry:na,DodecahedronBufferGeometry:ra,PolyhedronGeometry:Xs,PolyhedronBufferGeometry:Ys,TubeGeometry:ia,TubeBufferGeometry:oa,TorusKnotGeometry:sa,TorusKnotBufferGeometry:aa,TorusGeometry:la,TorusBufferGeometry:ua,TextGeometry:qa,TextBufferGeometry:Wa,SphereGeometry:$a,SphereBufferGeometry:Xa,RingGeometry:Ya,RingBufferGeometry:Za,PlaneGeometry:Li,PlaneBufferGeometry:Oi,LatheGeometry:Ja,LatheBufferGeometry:Qa,ShapeGeometry:Ka,ShapeBufferGeometry:el,ExtrudeGeometry:Ba,ExtrudeBufferGeometry:Ha,EdgesGeometry:nl,ConeGeometry:ol,ConeBufferGeometry:sl,CylinderGeometry:rl,CylinderBufferGeometry:il,CircleGeometry:al,CircleBufferGeometry:ll,BoxGeometry:Pi,BoxBufferGeometry:Ri});function cl(e){Ii.call(this),this.type="ShadowMaterial",this.color=new ni(0),this.transparent=!0,this.setValues(e)}function hl(e){Ni.call(this,e),this.type="RawShaderMaterial"}function dl(e){Ii.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ni(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ni(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function pl(e){dl.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}function fl(e){Ii.call(this),this.type="MeshPhongMaterial",this.color=new ni(16777215),this.specular=new ni(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ni(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=J,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function ml(e){fl.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function gl(e){Ii.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new Ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function vl(e){Ii.call(this),this.type="MeshLambertMaterial",this.color=new ni(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ni(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=J,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function yl(e){ks.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}cl.prototype=Object.create(Ii.prototype),cl.prototype.constructor=cl,cl.prototype.isShadowMaterial=!0,cl.prototype.copy=function(e){return Ii.prototype.copy.call(this,e),this.color.copy(e.color),this},hl.prototype=Object.create(Ni.prototype),hl.prototype.constructor=hl,hl.prototype.isRawShaderMaterial=!0,dl.prototype=Object.create(Ii.prototype),dl.prototype.constructor=dl,dl.prototype.isMeshStandardMaterial=!0,dl.prototype.copy=function(e){return Ii.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},pl.prototype=Object.create(dl.prototype),pl.prototype.constructor=pl,pl.prototype.isMeshPhysicalMaterial=!0,pl.prototype.copy=function(e){return dl.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},fl.prototype=Object.create(Ii.prototype),fl.prototype.constructor=fl,fl.prototype.isMeshPhongMaterial=!0,fl.prototype.copy=function(e){return Ii.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},ml.prototype=Object.create(fl.prototype),ml.prototype.constructor=ml,ml.prototype.isMeshToonMaterial=!0,ml.prototype.copy=function(e){return fl.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},gl.prototype=Object.create(Ii.prototype),gl.prototype.constructor=gl,gl.prototype.isMeshNormalMaterial=!0,gl.prototype.copy=function(e){return Ii.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},vl.prototype=Object.create(Ii.prototype),vl.prototype.constructor=vl,vl.prototype.isMeshLambertMaterial=!0,vl.prototype.copy=function(e){return Ii.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},yl.prototype=Object.create(ks.prototype),yl.prototype.constructor=yl,yl.prototype.isLineDashedMaterial=!0,yl.prototype.copy=function(e){return ks.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var xl=Object.freeze({ShadowMaterial:cl,SpriteMaterial:Ps,RawShaderMaterial:hl,ShaderMaterial:Ni,PointsMaterial:zs,MeshPhysicalMaterial:pl,MeshStandardMaterial:dl,MeshPhongMaterial:fl,MeshToonMaterial:ml,MeshNormalMaterial:gl,MeshLambertMaterial:vl,MeshDepthMaterial:fs,MeshDistanceMaterial:ms,MeshBasicMaterial:ki,LineDashedMaterial:yl,LineBasicMaterial:ks,Material:Ii}),bl={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function wl(e,t,n){var r=this,i=!1,o=0,s=0,a=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){s++,!1===i&&void 0!==r.onStart&&r.onStart(e,o,s),i=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,s),o===s&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return a?a(e):e},this.setURLModifier=function(e){return a=e,this}}var _l=new wl,Al={};function Sl(e){this.manager=void 0!==e?e:_l}function El(e){this.manager=void 0!==e?e:_l,this._parser=null}function Ml(e){this.manager=void 0!==e?e:_l,this._parser=null}function Tl(e){this.manager=void 0!==e?e:_l}function Cl(e){this.manager=void 0!==e?e:_l}function Pl(e){this.manager=void 0!==e?e:_l}function Rl(){this.type="Curve",this.arcLengthDivisions=200}function Ll(e,t,n,r,i,o,s,a){Rl.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=s||!1,this.aRotation=a||0}function Ol(e,t,n,r,i,o){Ll.call(this,e,t,n,n,r,i,o),this.type="ArcCurve"}function Dl(){var e=0,t=0,n=0,r=0;function i(i,o,s,a){e=i,t=s,n=-3*i+3*o-2*s-a,r=2*i-2*o+s+a}return{initCatmullRom:function(e,t,n,r,o){i(t,n,o*(n-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,o,s,a){var l=(t-e)/o-(n-e)/(o+s)+(n-t)/s,u=(n-t)/s-(r-t)/(s+a)+(r-n)/a;l*=s,u*=s,i(t,n,l,u)},calc:function(i){var o=i*i,s=o*i;return e+t*i+n*o+r*s}}}Object.assign(Sl.prototype,{load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=bl.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;if(void 0===Al[e]){var s=/^data:(.*?)(;base64)?,(.*)$/,a=e.match(s);if(a){var l=a[1],u=!!a[2],c=a[3];c=window.decodeURIComponent(c),u&&(c=window.atob(c));try{var h,d=(this.responseType||"").toLowerCase();switch(d){case"arraybuffer":case"blob":for(var p=new Uint8Array(c.length),f=0;f<c.length;f++)p[f]=c.charCodeAt(f);h="blob"===d?new Blob([p.buffer],{type:l}):p.buffer;break;case"document":var m=new DOMParser;h=m.parseFromString(c,l);break;case"json":h=JSON.parse(c);break;default:h=c;break}window.setTimeout((function(){t&&t(h),i.manager.itemEnd(e)}),0)}catch(y){window.setTimeout((function(){r&&r(y),i.manager.itemEnd(e),i.manager.itemError(e)}),0)}}else{Al[e]=[],Al[e].push({onLoad:t,onProgress:n,onError:r});var g=new XMLHttpRequest;for(var v in g.open("GET",e,!0),g.addEventListener("load",(function(t){var n=this.response;bl.add(e,n);var r=Al[e];if(delete Al[e],200===this.status){for(var o=0,s=r.length;o<s;o++){var a=r[o];a.onLoad&&a.onLoad(n)}i.manager.itemEnd(e)}else if(0===this.status){console.warn("THREE.FileLoader: HTTP Status 0 received.");for(o=0,s=r.length;o<s;o++){a=r[o];a.onLoad&&a.onLoad(n)}i.manager.itemEnd(e)}else{for(o=0,s=r.length;o<s;o++){a=r[o];a.onError&&a.onError(t)}i.manager.itemEnd(e),i.manager.itemError(e)}}),!1),g.addEventListener("progress",(function(t){for(var n=Al[e],r=0,i=n.length;r<i;r++){var o=n[r];o.onProgress&&o.onProgress(t)}}),!1),g.addEventListener("error",(function(t){var n=Al[e];delete Al[e];for(var r=0,o=n.length;r<o;r++){var s=n[r];s.onError&&s.onError(t)}i.manager.itemEnd(e),i.manager.itemError(e)}),!1),void 0!==this.responseType&&(g.responseType=this.responseType),void 0!==this.withCredentials&&(g.withCredentials=this.withCredentials),g.overrideMimeType&&g.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)g.setRequestHeader(v,this.requestHeader[v]);g.send(null)}return i.manager.itemStart(e),g}Al[e].push({onLoad:t,onProgress:n,onError:r})},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(El.prototype,{load:function(e,t,n,r){var i=this,o=[],s=new Hs;s.image=o;var a=new Sl(this.manager);function l(l){a.load(e[l],(function(e){var n=i._parser(e,!0);o[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},u+=1,6===u&&(1===n.mipmapCount&&(s.minFilter=xe),s.format=n.format,s.needsUpdate=!0,t&&t(s))}),n,r)}if(a.setPath(this.path),a.setResponseType("arraybuffer"),Array.isArray(e))for(var u=0,c=0,h=e.length;c<h;++c)l(c);else a.load(e,(function(e){var n=i._parser(e,!0);if(n.isCubemap)for(var r=n.mipmaps.length/n.mipmapCount,a=0;a<r;a++){o[a]={mipmaps:[]};for(var l=0;l<n.mipmapCount;l++)o[a].mipmaps.push(n.mipmaps[a*n.mipmapCount+l]),o[a].format=n.format,o[a].width=n.width,o[a].height=n.height}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=xe),s.format=n.format,s.needsUpdate=!0,t&&t(s)}),n,r);return s},setPath:function(e){return this.path=e,this}}),Object.assign(Ml.prototype,{load:function(e,t,n,r){var i=this,o=new Bt,s=new Sl(this.manager);return s.setResponseType("arraybuffer"),s.load(e,(function(e){var n=i._parser(e);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:fe,o.wrapT=void 0!==n.wrapT?n.wrapT:fe,o.magFilter=void 0!==n.magFilter?n.magFilter:xe,o.minFilter=void 0!==n.minFilter?n.minFilter:we,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps),1===n.mipmapCount&&(o.minFilter=xe),o.needsUpdate=!0,t&&t(o,n))}),n,r),o}}),Object.assign(Tl.prototype,{crossOrigin:"Anonymous",load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,o=bl.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;var s=document.createElementNS("http://www.w3.org/1999/xhtml","img");return s.addEventListener("load",(function(){bl.add(e,this),t&&t(this),i.manager.itemEnd(e)}),!1),s.addEventListener("error",(function(t){r&&r(t),i.manager.itemEnd(e),i.manager.itemError(e)}),!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),i.manager.itemStart(e),s.src=e,s},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Cl.prototype,{crossOrigin:"Anonymous",load:function(e,t,n,r){var i=new Qi,o=new Tl(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var s=0;function a(n){o.load(e[n],(function(e){i.images[n]=e,s++,6===s&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(var l=0;l<e.length;++l)a(l);return i},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Pl.prototype,{crossOrigin:"Anonymous",load:function(e,t,n,r){var i=new Vt,o=new Tl(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(n){i.image=n;var r=e.search(/\.(jpg|jpeg)$/)>0||0===e.search(/^data\:image\/jpeg/);i.format=r?ke:Ne,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Rl.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n,r=[],i=this.getPoint(0),o=0;for(r.push(0),n=1;n<=e;n++)t=this.getPoint(n/e),o+=t.distanceTo(i),r.push(o),i=t;return this.cacheArcLengths=r,r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var n,r=this.getLengths(),i=0,o=r.length;n=t||e*r[o-1];var s,a=0,l=o-1;while(a<=l)if(i=Math.floor(a+(l-a)/2),s=r[i]-n,s<0)a=i+1;else{if(!(s>0)){l=i;break}l=i-1}if(i=l,r[i]===n)return i/(o-1);var u=r[i],c=r[i+1],h=c-u,d=(n-u)/h,p=(i+d)/(o-1);return p},getTangent:function(e){var t=1e-4,n=e-t,r=e+t;n<0&&(n=0),r>1&&(r=1);var i=this.getPoint(n),o=this.getPoint(r),s=o.clone().sub(i);return s.normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var n,r,i,o=new kt,s=[],a=[],l=[],u=new kt,c=new Dt;for(n=0;n<=e;n++)r=n/e,s[n]=this.getTangentAt(r),s[n].normalize();a[0]=new kt,l[0]=new kt;var h=Number.MAX_VALUE,d=Math.abs(s[0].x),p=Math.abs(s[0].y),f=Math.abs(s[0].z);for(d<=h&&(h=d,o.set(1,0,0)),p<=h&&(h=p,o.set(0,1,0)),f<=h&&o.set(0,0,1),u.crossVectors(s[0],o).normalize(),a[0].crossVectors(s[0],u),l[0].crossVectors(s[0],a[0]),n=1;n<=e;n++)a[n]=a[n-1].clone(),l[n]=l[n-1].clone(),u.crossVectors(s[n-1],s[n]),u.length()>Number.EPSILON&&(u.normalize(),i=Math.acos(Lt.clamp(s[n-1].dot(s[n]),-1,1)),a[n].applyMatrix4(c.makeRotationAxis(u,i))),l[n].crossVectors(s[n],a[n]);if(!0===t)for(i=Math.acos(Lt.clamp(a[0].dot(a[e]),-1,1)),i/=e,s[0].dot(u.crossVectors(a[0],a[e]))>0&&(i=-i),n=1;n<=e;n++)a[n].applyMatrix4(c.makeRotationAxis(s[n],i*n)),l[n].crossVectors(s[n],a[n]);return{tangents:s,normals:a,binormals:l}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),Ll.prototype=Object.create(Rl.prototype),Ll.prototype.constructor=Ll,Ll.prototype.isEllipseCurve=!0,Ll.prototype.getPoint=function(e,t){var n=t||new Ot,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;while(i<0)i+=r;while(i>r)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);var s=this.aStartAngle+e*i,a=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){var u=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=a-this.aX,d=l-this.aY;a=h*u-d*c+this.aX,l=h*c+d*u+this.aY}return n.set(a,l)},Ll.prototype.copy=function(e){return Rl.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Ll.prototype.toJSON=function(){var e=Rl.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Ll.prototype.fromJSON=function(e){return Rl.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Ol.prototype=Object.create(Ll.prototype),Ol.prototype.constructor=Ol,Ol.prototype.isArcCurve=!0;var Il=new kt,kl=new Dl,Nl=new Dl,Fl=new Dl;function Vl(e,t,n,r){Rl.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=n||"centripetal",this.tension=r||.5}function zl(e,t,n,r,i){var o=.5*(r-t),s=.5*(i-n),a=e*e,l=e*a;return(2*n-2*r+o+s)*l+(-3*n+3*r-2*o-s)*a+o*e+n}function Ul(e,t){var n=1-e;return n*n*t}function jl(e,t){return 2*(1-e)*e*t}function Bl(e,t){return e*e*t}function Hl(e,t,n,r){return Ul(e,t)+jl(e,n)+Bl(e,r)}function Gl(e,t){var n=1-e;return n*n*n*t}function ql(e,t){var n=1-e;return 3*n*n*e*t}function Wl(e,t){return 3*(1-e)*e*e*t}function $l(e,t){return e*e*e*t}function Xl(e,t,n,r,i){return Gl(e,t)+ql(e,n)+Wl(e,r)+$l(e,i)}function Yl(e,t,n,r){Rl.call(this),this.type="CubicBezierCurve",this.v0=e||new Ot,this.v1=t||new Ot,this.v2=n||new Ot,this.v3=r||new Ot}function Zl(e,t,n,r){Rl.call(this),this.type="CubicBezierCurve3",this.v0=e||new kt,this.v1=t||new kt,this.v2=n||new kt,this.v3=r||new kt}function Jl(e,t){Rl.call(this),this.type="LineCurve",this.v1=e||new Ot,this.v2=t||new Ot}function Ql(e,t){Rl.call(this),this.type="LineCurve3",this.v1=e||new kt,this.v2=t||new kt}function Kl(e,t,n){Rl.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Ot,this.v1=t||new Ot,this.v2=n||new Ot}function eu(e,t,n){Rl.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new kt,this.v1=t||new kt,this.v2=n||new kt}function tu(e){Rl.call(this),this.type="SplineCurve",this.points=e||[]}Vl.prototype=Object.create(Rl.prototype),Vl.prototype.constructor=Vl,Vl.prototype.isCatmullRomCurve3=!0,Vl.prototype.getPoint=function(e,t){var n,r,i,o,s=t||new kt,a=this.points,l=a.length,u=(l-(this.closed?0:1))*e,c=Math.floor(u),h=u-c;if(this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/l)+1)*l:0===h&&c===l-1&&(c=l-2,h=1),this.closed||c>0?n=a[(c-1)%l]:(Il.subVectors(a[0],a[1]).add(a[0]),n=Il),r=a[c%l],i=a[(c+1)%l],this.closed||c+2<l?o=a[(c+2)%l]:(Il.subVectors(a[l-1],a[l-2]).add(a[l-1]),o=Il),"centripetal"===this.curveType||"chordal"===this.curveType){var d="chordal"===this.curveType?.5:.25,p=Math.pow(n.distanceToSquared(r),d),f=Math.pow(r.distanceToSquared(i),d),m=Math.pow(i.distanceToSquared(o),d);f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),kl.initNonuniformCatmullRom(n.x,r.x,i.x,o.x,p,f,m),Nl.initNonuniformCatmullRom(n.y,r.y,i.y,o.y,p,f,m),Fl.initNonuniformCatmullRom(n.z,r.z,i.z,o.z,p,f,m)}else"catmullrom"===this.curveType&&(kl.initCatmullRom(n.x,r.x,i.x,o.x,this.tension),Nl.initCatmullRom(n.y,r.y,i.y,o.y,this.tension),Fl.initCatmullRom(n.z,r.z,i.z,o.z,this.tension));return s.set(kl.calc(h),Nl.calc(h),Fl.calc(h)),s},Vl.prototype.copy=function(e){Rl.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Vl.prototype.toJSON=function(){var e=Rl.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Vl.prototype.fromJSON=function(e){Rl.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new kt).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Yl.prototype=Object.create(Rl.prototype),Yl.prototype.constructor=Yl,Yl.prototype.isCubicBezierCurve=!0,Yl.prototype.getPoint=function(e,t){var n=t||new Ot,r=this.v0,i=this.v1,o=this.v2,s=this.v3;return n.set(Xl(e,r.x,i.x,o.x,s.x),Xl(e,r.y,i.y,o.y,s.y)),n},Yl.prototype.copy=function(e){return Rl.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Yl.prototype.toJSON=function(){var e=Rl.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Yl.prototype.fromJSON=function(e){return Rl.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Zl.prototype=Object.create(Rl.prototype),Zl.prototype.constructor=Zl,Zl.prototype.isCubicBezierCurve3=!0,Zl.prototype.getPoint=function(e,t){var n=t||new kt,r=this.v0,i=this.v1,o=this.v2,s=this.v3;return n.set(Xl(e,r.x,i.x,o.x,s.x),Xl(e,r.y,i.y,o.y,s.y),Xl(e,r.z,i.z,o.z,s.z)),n},Zl.prototype.copy=function(e){return Rl.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Zl.prototype.toJSON=function(){var e=Rl.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Zl.prototype.fromJSON=function(e){return Rl.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Jl.prototype=Object.create(Rl.prototype),Jl.prototype.constructor=Jl,Jl.prototype.isLineCurve=!0,Jl.prototype.getPoint=function(e,t){var n=t||new Ot;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Jl.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Jl.prototype.getTangent=function(){var e=this.v2.clone().sub(this.v1);return e.normalize()},Jl.prototype.copy=function(e){return Rl.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Jl.prototype.toJSON=function(){var e=Rl.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Jl.prototype.fromJSON=function(e){return Rl.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Ql.prototype=Object.create(Rl.prototype),Ql.prototype.constructor=Ql,Ql.prototype.isLineCurve3=!0,Ql.prototype.getPoint=function(e,t){var n=t||new kt;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Ql.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Ql.prototype.copy=function(e){return Rl.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ql.prototype.toJSON=function(){var e=Rl.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Ql.prototype.fromJSON=function(e){return Rl.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Kl.prototype=Object.create(Rl.prototype),Kl.prototype.constructor=Kl,Kl.prototype.isQuadraticBezierCurve=!0,Kl.prototype.getPoint=function(e,t){var n=t||new Ot,r=this.v0,i=this.v1,o=this.v2;return n.set(Hl(e,r.x,i.x,o.x),Hl(e,r.y,i.y,o.y)),n},Kl.prototype.copy=function(e){return Rl.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Kl.prototype.toJSON=function(){var e=Rl.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Kl.prototype.fromJSON=function(e){return Rl.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},eu.prototype=Object.create(Rl.prototype),eu.prototype.constructor=eu,eu.prototype.isQuadraticBezierCurve3=!0,eu.prototype.getPoint=function(e,t){var n=t||new kt,r=this.v0,i=this.v1,o=this.v2;return n.set(Hl(e,r.x,i.x,o.x),Hl(e,r.y,i.y,o.y),Hl(e,r.z,i.z,o.z)),n},eu.prototype.copy=function(e){return Rl.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},eu.prototype.toJSON=function(){var e=Rl.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},eu.prototype.fromJSON=function(e){return Rl.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},tu.prototype=Object.create(Rl.prototype),tu.prototype.constructor=tu,tu.prototype.isSplineCurve=!0,tu.prototype.getPoint=function(e,t){var n=t||new Ot,r=this.points,i=(r.length-1)*e,o=Math.floor(i),s=i-o,a=r[0===o?o:o-1],l=r[o],u=r[o>r.length-2?r.length-1:o+1],c=r[o>r.length-3?r.length-1:o+2];return n.set(zl(s,a.x,l.x,u.x,c.x),zl(s,a.y,l.y,u.y,c.y)),n},tu.prototype.copy=function(e){Rl.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this},tu.prototype.toJSON=function(){var e=Rl.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e},tu.prototype.fromJSON=function(e){Rl.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new Ot).fromArray(r))}return this};var nu=Object.freeze({ArcCurve:Ol,CatmullRomCurve3:Vl,CubicBezierCurve:Yl,CubicBezierCurve3:Zl,EllipseCurve:Ll,LineCurve:Jl,LineCurve3:Ql,QuadraticBezierCurve:Kl,QuadraticBezierCurve3:eu,SplineCurve:tu});function ru(){Rl.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function iu(e){ru.call(this),this.type="Path",this.currentPoint=new Ot,e&&this.setFromPoints(e)}function ou(e){iu.call(this,e),this.uuid=Lt.generateUUID(),this.type="Shape",this.holes=[]}function su(e,t){ui.call(this),this.type="Light",this.color=new ni(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function au(e,t,n){su.call(this,e,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(ui.DefaultUp),this.updateMatrix(),this.groundColor=new ni(t)}function lu(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Ot(512,512),this.map=null,this.matrix=new Dt}function uu(){lu.call(this,new _s(50,1,.5,500))}function cu(e,t,n,r,i,o){su.call(this,e,t),this.type="SpotLight",this.position.copy(ui.DefaultUp),this.updateMatrix(),this.target=new ui,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==o?o:1,this.shadow=new uu}function hu(e,t,n,r){su.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new lu(new _s(90,1,.5,500))}function du(){lu.call(this,new hi(-5,5,5,-5,.5,500))}function pu(e,t){su.call(this,e,t),this.type="DirectionalLight",this.position.copy(ui.DefaultUp),this.updateMatrix(),this.target=new ui,this.shadow=new du}function fu(e,t){su.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function mu(e,t,n,r){su.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}function gu(e,t,n,r){Tu.call(this,e,t,n,r)}function vu(e,t,n){Tu.call(this,e,t,n)}function yu(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function xu(e,t,n,r){yu.call(this,e,t,n,r)}function bu(e,t,n,r){Tu.call(this,e,t,n,r)}function wu(e,t,n,r){Tu.call(this,e,t,n,r)}function _u(e,t,n,r){Tu.call(this,e,t,n,r)}function Au(e,t,n,r){yu.call(this,e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Su(e,t,n,r){yu.call(this,e,t,n,r)}function Eu(e,t,n,r){yu.call(this,e,t,n,r)}ru.prototype=Object.assign(Object.create(Rl.prototype),{constructor:ru,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Jl(t,e))},getPoint:function(e){var t=e*this.getLength(),n=this.getCurveLengths(),r=0;while(r<n.length){if(n[r]>=t){var i=n[r]-t,o=this.curves[r],s=o.getLength(),a=0===s?0:1-i/s;return o.getPointAt(a)}r++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,n=[],r=0,i=this.curves;r<i.length;r++)for(var o=i[r],s=o&&o.isEllipseCurve?2*e:o&&o.isLineCurve?1:o&&o.isSplineCurve?e*o.points.length:e,a=o.getPoints(s),l=0;l<a.length;l++){var u=a[l];t&&t.equals(u)||(n.push(u),t=u)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(e){Rl.prototype.copy.call(this,e),this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Rl.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,n=this.curves.length;t<n;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e},fromJSON:function(e){Rl.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push((new nu[r.type]).fromJSON(r))}return this}}),iu.prototype=Object.assign(Object.create(ru.prototype),{constructor:iu,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var n=new Jl(this.currentPoint.clone(),new Ot(e,t));this.curves.push(n),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,n,r){var i=new Kl(this.currentPoint.clone(),new Ot(e,t),new Ot(n,r));this.curves.push(i),this.currentPoint.set(n,r)},bezierCurveTo:function(e,t,n,r,i,o){var s=new Yl(this.currentPoint.clone(),new Ot(e,t),new Ot(n,r),new Ot(i,o));this.curves.push(s),this.currentPoint.set(i,o)},splineThru:function(e){var t=[this.currentPoint.clone()].concat(e),n=new tu(t);this.curves.push(n),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,n,r,i,o){var s=this.currentPoint.x,a=this.currentPoint.y;this.absarc(e+s,t+a,n,r,i,o)},absarc:function(e,t,n,r,i,o){this.absellipse(e,t,n,n,r,i,o)},ellipse:function(e,t,n,r,i,o,s,a){var l=this.currentPoint.x,u=this.currentPoint.y;this.absellipse(e+l,t+u,n,r,i,o,s,a)},absellipse:function(e,t,n,r,i,o,s,a){var l=new Ll(e,t,n,r,i,o,s,a);if(this.curves.length>0){var u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);var c=l.getPoint(1);this.currentPoint.copy(c)},copy:function(e){return ru.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=ru.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return ru.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),ou.prototype=Object.assign(Object.create(iu.prototype),{constructor:ou,getPointsHoles:function(e){for(var t=[],n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){iu.prototype.copy.call(this,e),this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push(r.clone())}return this},toJSON:function(){var e=iu.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,n=this.holes.length;t<n;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e},fromJSON:function(e){iu.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push((new iu).fromJSON(r))}return this}}),su.prototype=Object.assign(Object.create(ui.prototype),{constructor:su,isLight:!0,copy:function(e){return ui.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=ui.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),au.prototype=Object.assign(Object.create(su.prototype),{constructor:au,isHemisphereLight:!0,copy:function(e){return su.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(lu.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),uu.prototype=Object.assign(Object.create(lu.prototype),{constructor:uu,isSpotLightShadow:!0,update:function(e){var t=this.camera,n=2*Lt.RAD2DEG*e.angle,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix())}}),cu.prototype=Object.assign(Object.create(su.prototype),{constructor:cu,isSpotLight:!0,copy:function(e){return su.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),hu.prototype=Object.assign(Object.create(su.prototype),{constructor:hu,isPointLight:!0,copy:function(e){return su.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),du.prototype=Object.assign(Object.create(lu.prototype),{constructor:du}),pu.prototype=Object.assign(Object.create(su.prototype),{constructor:pu,isDirectionalLight:!0,copy:function(e){return su.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),fu.prototype=Object.assign(Object.create(su.prototype),{constructor:fu,isAmbientLight:!0}),mu.prototype=Object.assign(Object.create(su.prototype),{constructor:mu,isRectAreaLight:!0,copy:function(e){return su.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=su.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),gu.prototype=Object.assign(Object.create(Tu.prototype),{constructor:gu,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:pt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),vu.prototype=Object.assign(Object.create(Tu.prototype),{constructor:vu,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:pt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Object.assign(yu.prototype,{evaluate:function(e){var t=this.parameterPositions,n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{var o;n:{r:if(!(e<r)){for(var s=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===s)break;if(i=r,r=t[++n],e<r)break t}o=t.length;break n}if(e>=i)break e;var a=t[1];e<a&&(n=2,i=a);for(s=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===s)break;if(r=i,i=t[--n-1],e>=i)break t}o=n,n=0}while(n<o){var l=n+o>>>1;e<t[l]?o=l:n=l+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r,o=0;o!==r;++o)t[o]=n[i+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(yu.prototype,{beforeStart_:yu.prototype.copySampleValue_,afterEnd_:yu.prototype.copySampleValue_}),xu.prototype=Object.assign(Object.create(yu.prototype),{constructor:xu,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=(n-t)/(r-t),u=a+s;a!==u;a+=4)It.slerpFlat(i,0,o,a-s,o,a,l);return i}}),bu.prototype=Object.assign(Object.create(Tu.prototype),{constructor:bu,ValueTypeName:"quaternion",DefaultInterpolation:ft,InterpolantFactoryMethodLinear:function(e){return new xu(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),wu.prototype=Object.assign(Object.create(Tu.prototype),{constructor:wu,ValueTypeName:"color"}),_u.prototype=Object.assign(Object.create(Tu.prototype),{constructor:_u,ValueTypeName:"number"}),Au.prototype=Object.assign(Object.create(yu.prototype),{constructor:Au,DefaultSettings_:{endingStart:gt,endingEnd:gt},intervalChanged_:function(e,t,n){var r=this.parameterPositions,i=e-2,o=e+1,s=r[i],a=r[o];if(void 0===s)switch(this.getSettings_().endingStart){case vt:i=e,s=2*t-n;break;case yt:i=r.length-2,s=t+r[i]-r[i+1];break;default:i=e,s=n}if(void 0===a)switch(this.getSettings_().endingEnd){case vt:o=e,a=2*n-t;break;case yt:o=1,a=n+r[1]-r[0];break;default:o=e-1,a=t}var l=.5*(n-t),u=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(a-n),this._offsetPrev=i*u,this._offsetNext=o*u},interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(r-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f,b=0;b!==s;++b)i[b]=g*o[u+b]+v*o[l+b]+y*o[a+b]+x*o[c+b];return i}}),Su.prototype=Object.assign(Object.create(yu.prototype),{constructor:Su,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,l=a-s,u=(n-t)/(r-t),c=1-u,h=0;h!==s;++h)i[h]=o[l+h]*c+o[a+h]*u;return i}}),Eu.prototype=Object.assign(Object.create(yu.prototype),{constructor:Eu,interpolate_:function(e){return this.copySampleValue_(e-1)}});var Mu={arraySlice:function(e,t,n){return Mu.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){function t(t,n){return e[t]-e[n]}for(var n=e.length,r=new Array(n),i=0;i!==n;++i)r[i]=i;return r.sort(t),r},sortedArray:function(e,t,n){for(var r=e.length,i=new e.constructor(r),o=0,s=0;s!==r;++o)for(var a=n[o]*t,l=0;l!==t;++l)i[s++]=e[a+l];return i},flattenJSON:function(e,t,n,r){var i=1,o=e[0];while(void 0!==o&&void 0===o[r])o=e[i++];if(void 0!==o){var s=o[r];if(void 0!==s)if(Array.isArray(s))do{s=o[r],void 0!==s&&(t.push(o.time),n.push.apply(n,s)),o=e[i++]}while(void 0!==o);else if(void 0!==s.toArray)do{s=o[r],void 0!==s&&(t.push(o.time),s.toArray(n,n.length)),o=e[i++]}while(void 0!==o);else do{s=o[r],void 0!==s&&(t.push(o.time),n.push(s)),o=e[i++]}while(void 0!==o)}}};function Tu(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Mu.convertArray(t,this.TimeBufferType),this.values=Mu.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation),this.validate(),this.optimize()}function Cu(e,t,n,r){Tu.call(this,e,t,n,r)}function Pu(e,t,n){this.name=e,this.tracks=n,this.duration=void 0!==t?t:-1,this.uuid=Lt.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}function Ru(e){this.manager=void 0!==e?e:_l,this.textures={}}function Lu(e){this.manager=void 0!==e?e:_l}Object.assign(Tu,{parse:function(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=Tu._getTrackTypeForValueTypeName(e.type);if(void 0===e.times){var n=[],r=[];Mu.flattenJSON(e.keys,n,r,"value"),e.times=n,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)},toJSON:function(e){var t,n=e.constructor;if(void 0!==n.toJSON)t=n.toJSON(e);else{t={name:e.name,times:Mu.convertArray(e.times,Array),values:Mu.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t},_getTrackTypeForValueTypeName:function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return _u;case"vector":case"vector2":case"vector3":case"vector4":return Cu;case"color":return wu;case"quaternion":return bu;case"bool":case"boolean":return vu;case"string":return gu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}}),Object.assign(Tu.prototype,{constructor:Tu,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:ft,InterpolantFactoryMethodDiscrete:function(e){return new Eu(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Su(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Au(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case pt:t=this.InterpolantFactoryMethodDiscrete;break;case ft:t=this.InterpolantFactoryMethodLinear;break;case mt:t=this.InterpolantFactoryMethodSmooth;break}if(void 0!==t)this.createInterpolant=t;else{var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}console.warn("THREE.KeyframeTrack:",n)}},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return pt;case this.InterpolantFactoryMethodLinear:return ft;case this.InterpolantFactoryMethodSmooth:return mt}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]*=e;return this},trim:function(e,t){var n=this.times,r=n.length,i=0,o=r-1;while(i!==r&&n[i]<e)++i;while(-1!==o&&n[o]>t)--o;if(++o,0!==i||o!==r){i>=o&&(o=Math.max(o,1),i=o-1);var s=this.getValueSize();this.times=Mu.arraySlice(n,i,o),this.values=Mu.arraySlice(this.values,i*s,o*s)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var o=null,s=0;s!==i;s++){var a=n[s];if("number"===typeof a&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,a),e=!1;break}if(null!==o&&o>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,a,o),e=!1;break}o=a}if(void 0!==r&&Mu.isTypedArray(r)){s=0;for(var l=r.length;s!==l;++s){var u=r[s];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,u),e=!1;break}}}return e},optimize:function(){for(var e=this.times,t=this.values,n=this.getValueSize(),r=this.getInterpolation()===mt,i=1,o=e.length-1,s=1;s<o;++s){var a=!1,l=e[s],u=e[s+1];if(l!==u&&(1!==s||l!==l[0]))if(r)a=!0;else for(var c=s*n,h=c-n,d=c+n,p=0;p!==n;++p){var f=t[c+p];if(f!==t[h+p]||f!==t[d+p]){a=!0;break}}if(a){if(s!==i){e[i]=e[s];var m=s*n,g=i*n;for(p=0;p!==n;++p)t[g+p]=t[m+p]}++i}}if(o>0){e[i]=e[o];for(m=o*n,g=i*n,p=0;p!==n;++p)t[g+p]=t[m+p];++i}return i!==e.length&&(this.times=Mu.arraySlice(e,0,i),this.values=Mu.arraySlice(t,0,i*n)),this}}),Cu.prototype=Object.assign(Object.create(Tu.prototype),{constructor:Cu,ValueTypeName:"vector"}),Object.assign(Pu,{parse:function(e){for(var t=[],n=e.tracks,r=1/(e.fps||1),i=0,o=n.length;i!==o;++i)t.push(Tu.parse(n[i]).scale(r));return new Pu(e.name,e.duration,t)},toJSON:function(e){for(var t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t},i=0,o=n.length;i!==o;++i)t.push(Tu.toJSON(n[i]));return r},CreateFromMorphTargetSequence:function(e,t,n,r){for(var i=t.length,o=[],s=0;s<i;s++){var a=[],l=[];a.push((s+i-1)%i,s,(s+1)%i),l.push(0,1,0);var u=Mu.getKeyframeOrder(a);a=Mu.sortedArray(a,1,u),l=Mu.sortedArray(l,1,u),r||0!==a[0]||(a.push(i),l.push(l[0])),o.push(new _u(".morphTargetInfluences["+t[s].name+"]",a,l).scale(1/n))}return new Pu(e,-1,o)},findByName:function(e,t){var n=e;if(!Array.isArray(e)){var r=e;n=r.geometry&&r.geometry.animations||r.animations}for(var i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,o=0,s=e.length;o<s;o++){var a=e[o],l=a.name.match(i);if(l&&l.length>1){var u=l[1],c=r[u];c||(r[u]=c=[]),c.push(a)}}var h=[];for(var u in r)h.push(Pu.CreateFromMorphTargetSequence(u,r[u],t,n));return h},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,r,i){if(0!==n.length){var o=[],s=[];Mu.flattenJSON(n,o,s,r),0!==o.length&&i.push(new e(t,o,s))}},r=[],i=e.name||"default",o=e.length||-1,s=e.fps||30,a=e.hierarchy||[],l=0;l<a.length;l++){var u=a[l].keys;if(u&&0!==u.length)if(u[0].morphTargets){for(var c={},h=0;h<u.length;h++)if(u[h].morphTargets)for(var d=0;d<u[h].morphTargets.length;d++)c[u[h].morphTargets[d]]=-1;for(var p in c){var f=[],m=[];for(d=0;d!==u[h].morphTargets.length;++d){var g=u[h];f.push(g.time),m.push(g.morphTarget===p?1:0)}r.push(new _u(".morphTargetInfluence["+p+"]",f,m))}o=c.length*(s||1)}else{var v=".bones["+t[l].name+"]";n(Cu,v+".position",u,"pos",r),n(bu,v+".quaternion",u,"rot",r),n(Cu,v+".scale",u,"scl",r)}}if(0===r.length)return null;var y=new Pu(i,o,r);return y}}),Object.assign(Pu.prototype,{resetDuration:function(){for(var e=this.tracks,t=0,n=0,r=e.length;n!==r;++n){var i=this.tracks[n];t=Math.max(t,i.times[i.times.length-1])}this.duration=t},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}}),Object.assign(Ru.prototype,{load:function(e,t,n,r){var i=this,o=new Sl(i.manager);o.load(e,(function(e){t(i.parse(JSON.parse(e)))}),n,r)},setTextures:function(e){this.textures=e},parse:function(e){var t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var r=new xl[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearCoat&&(r.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(r.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.uniforms&&(r.uniforms=e.uniforms),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(r.vertexColors=e.vertexColors),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.side&&(r.side=e.side),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap),r.transparent=!0),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalScale){var i=e.normalScale;!1===Array.isArray(i)&&(i=[i,i]),r.normalScale=(new Ot).fromArray(i)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),r}}),Object.assign(Lu.prototype,{load:function(e,t,n,r){var i=this,o=new Sl(i.manager);o.load(e,(function(e){t(i.parse(JSON.parse(e)))}),n,r)},parse:function(e){var t=new Ci,n=e.data.index;if(void 0!==n){var r=new Ou[n.type](n.array);t.setIndex(new mi(r,1))}var i=e.data.attributes;for(var o in i){var s=i[o];r=new Ou[s.type](s.array);t.addAttribute(o,new mi(r,s.itemSize,s.normalized))}var a=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==a)for(var l=0,u=a.length;l!==u;++l){var c=a[l];t.addGroup(c.start,c.count,c.materialIndex)}var h=e.data.boundingSphere;if(void 0!==h){var d=new kt;void 0!==h.center&&d.fromArray(h.center),t.boundingSphere=new Gt(d,h.radius)}return t}});var Ou={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!==typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Du(){}Du.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,n=0,r=t.length;n<r;n+=2){var i=t[n],o=t[n+1];if(i.test(e))return o}return null}},Object.assign(Du.prototype,{crossOrigin:void 0,onLoadStart:function(){},onLoadProgress:function(){},onLoadComplete:function(){},initMaterials:function(e,t,n){for(var r=[],i=0;i<e.length;++i)r[i]=this.createMaterial(e[i],t,n);return r},createMaterial:function(){var e={NoBlending:w,NormalBlending:_,AdditiveBlending:A,SubtractiveBlending:S,MultiplyBlending:E,CustomBlending:M},t=new ni,n=new Pl,r=new Ru;return function(i,o,s){var a={};function l(e,t,r,i,l){var u,c=o+e,h=Du.Handlers.get(c);null!==h?u=h.load(c):(n.setCrossOrigin(s),u=n.load(c)),void 0!==t&&(u.repeat.fromArray(t),1!==t[0]&&(u.wrapS=pe),1!==t[1]&&(u.wrapT=pe)),void 0!==r&&u.offset.fromArray(r),void 0!==i&&("repeat"===i[0]&&(u.wrapS=pe),"mirror"===i[0]&&(u.wrapS=me),"repeat"===i[1]&&(u.wrapT=pe),"mirror"===i[1]&&(u.wrapT=me)),void 0!==l&&(u.anisotropy=l);var d=Lt.generateUUID();return a[d]=u,d}var u={uuid:Lt.generateUUID(),type:"MeshLambertMaterial"};for(var c in i){var h=i[c];switch(c){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":u.name=h;break;case"blending":u.blending=e[h];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",c,"is no longer supported.");break;case"colorDiffuse":u.color=t.fromArray(h).getHex();break;case"colorSpecular":u.specular=t.fromArray(h).getHex();break;case"colorEmissive":u.emissive=t.fromArray(h).getHex();break;case"specularCoef":u.shininess=h;break;case"shading":"basic"===h.toLowerCase()&&(u.type="MeshBasicMaterial"),"phong"===h.toLowerCase()&&(u.type="MeshPhongMaterial"),"standard"===h.toLowerCase()&&(u.type="MeshStandardMaterial");break;case"mapDiffuse":u.map=l(h,i.mapDiffuseRepeat,i.mapDiffuseOffset,i.mapDiffuseWrap,i.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":u.emissiveMap=l(h,i.mapEmissiveRepeat,i.mapEmissiveOffset,i.mapEmissiveWrap,i.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":u.lightMap=l(h,i.mapLightRepeat,i.mapLightOffset,i.mapLightWrap,i.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":u.aoMap=l(h,i.mapAORepeat,i.mapAOOffset,i.mapAOWrap,i.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":u.bumpMap=l(h,i.mapBumpRepeat,i.mapBumpOffset,i.mapBumpWrap,i.mapBumpAnisotropy);break;case"mapBumpScale":u.bumpScale=h;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":u.normalMap=l(h,i.mapNormalRepeat,i.mapNormalOffset,i.mapNormalWrap,i.mapNormalAnisotropy);break;case"mapNormalFactor":u.normalScale=h;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":u.specularMap=l(h,i.mapSpecularRepeat,i.mapSpecularOffset,i.mapSpecularWrap,i.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":u.metalnessMap=l(h,i.mapMetalnessRepeat,i.mapMetalnessOffset,i.mapMetalnessWrap,i.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":u.roughnessMap=l(h,i.mapRoughnessRepeat,i.mapRoughnessOffset,i.mapRoughnessWrap,i.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":u.alphaMap=l(h,i.mapAlphaRepeat,i.mapAlphaOffset,i.mapAlphaWrap,i.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":u.side=m;break;case"doubleSided":u.side=g;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),u.opacity=h;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":u[c]=h;break;case"vertexColors":!0===h&&(u.vertexColors=b),"face"===h&&(u.vertexColors=x);break;default:console.error("THREE.Loader.createMaterial: Unsupported",c,h);break}}return"MeshBasicMaterial"===u.type&&delete u.emissive,"MeshPhongMaterial"!==u.type&&delete u.specular,u.opacity<1&&(u.transparent=!0),r.setTextures(a),r.parse(u)}}()});var Iu={decodeText:function(e){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);return decodeURIComponent(escape(t))},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function ku(e){"boolean"===typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:_l,this.withCredentials=!1}function Nu(e){this.manager=void 0!==e?e:_l,this.texturePath=""}Object.assign(ku.prototype,{load:function(e,t,n,r){var i=this,o=this.texturePath&&"string"===typeof this.texturePath?this.texturePath:Iu.extractUrlBase(e),s=new Sl(this.manager);s.setWithCredentials(this.withCredentials),s.load(e,(function(n){var r=JSON.parse(n),s=r.metadata;if(void 0!==s){var a=s.type;if(void 0!==a&&"object"===a.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.")}var l=i.parse(r,o);t(l.geometry,l.materials)}),n,r)},setTexturePath:function(e){this.texturePath=e},parse:function(){function e(e,t){function n(e,t){return e&1<<t}var r,i,o,s,a,l,u,c,h,d,p,f,m,g,v,y,x,b,w,_,A,S,E,M,T,C,P,R=e.faces,L=e.vertices,O=e.normals,D=e.colors,I=e.scale,k=0;if(void 0!==e.uvs){for(r=0;r<e.uvs.length;r++)e.uvs[r].length&&k++;for(r=0;r<k;r++)t.faceVertexUvs[r]=[]}s=0,a=L.length;while(s<a)b=new kt,b.x=L[s++]*I,b.y=L[s++]*I,b.z=L[s++]*I,t.vertices.push(b);s=0,a=R.length;while(s<a)if(d=R[s++],p=n(d,0),f=n(d,1),m=n(d,3),g=n(d,4),v=n(d,5),y=n(d,6),x=n(d,7),p){if(_=new di,_.a=R[s],_.b=R[s+1],_.c=R[s+3],A=new di,A.a=R[s+1],A.b=R[s+2],A.c=R[s+3],s+=4,f&&(h=R[s++],_.materialIndex=h,A.materialIndex=h),o=t.faces.length,m)for(r=0;r<k;r++)for(M=e.uvs[r],t.faceVertexUvs[r][o]=[],t.faceVertexUvs[r][o+1]=[],i=0;i<4;i++)c=R[s++],C=M[2*c],P=M[2*c+1],T=new Ot(C,P),2!==i&&t.faceVertexUvs[r][o].push(T),0!==i&&t.faceVertexUvs[r][o+1].push(T);if(g&&(u=3*R[s++],_.normal.set(O[u++],O[u++],O[u]),A.normal.copy(_.normal)),v)for(r=0;r<4;r++)u=3*R[s++],E=new kt(O[u++],O[u++],O[u]),2!==r&&_.vertexNormals.push(E),0!==r&&A.vertexNormals.push(E);if(y&&(l=R[s++],S=D[l],_.color.setHex(S),A.color.setHex(S)),x)for(r=0;r<4;r++)l=R[s++],S=D[l],2!==r&&_.vertexColors.push(new ni(S)),0!==r&&A.vertexColors.push(new ni(S));t.faces.push(_),t.faces.push(A)}else{if(w=new di,w.a=R[s++],w.b=R[s++],w.c=R[s++],f&&(h=R[s++],w.materialIndex=h),o=t.faces.length,m)for(r=0;r<k;r++)for(M=e.uvs[r],t.faceVertexUvs[r][o]=[],i=0;i<3;i++)c=R[s++],C=M[2*c],P=M[2*c+1],T=new Ot(C,P),t.faceVertexUvs[r][o].push(T);if(g&&(u=3*R[s++],w.normal.set(O[u++],O[u++],O[u])),v)for(r=0;r<3;r++)u=3*R[s++],E=new kt(O[u++],O[u++],O[u]),w.vertexNormals.push(E);if(y&&(l=R[s++],w.color.setHex(D[l])),x)for(r=0;r<3;r++)l=R[s++],w.vertexColors.push(new ni(D[l]));t.faces.push(w)}}function t(e,t){var n=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var r=0,i=e.skinWeights.length;r<i;r+=n){var o=e.skinWeights[r],s=n>1?e.skinWeights[r+1]:0,a=n>2?e.skinWeights[r+2]:0,l=n>3?e.skinWeights[r+3]:0;t.skinWeights.push(new zt(o,s,a,l))}if(e.skinIndices)for(r=0,i=e.skinIndices.length;r<i;r+=n){var u=e.skinIndices[r],c=n>1?e.skinIndices[r+1]:0,h=n>2?e.skinIndices[r+2]:0,d=n>3?e.skinIndices[r+3]:0;t.skinIndices.push(new zt(u,c,h,d))}t.bones=e.bones,t.bones&&t.bones.length>0&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)&&console.warn("When skinning, number of vertices ("+t.vertices.length+"), skinIndices ("+t.skinIndices.length+"), and skinWeights ("+t.skinWeights.length+") should match.")}function n(e,t){var n=e.scale;if(void 0!==e.morphTargets)for(var r=0,i=e.morphTargets.length;r<i;r++){t.morphTargets[r]={},t.morphTargets[r].name=e.morphTargets[r].name,t.morphTargets[r].vertices=[];for(var o=t.morphTargets[r].vertices,s=e.morphTargets[r].vertices,a=0,l=s.length;a<l;a+=3){var u=new kt;u.x=s[a]*n,u.y=s[a+1]*n,u.z=s[a+2]*n,o.push(u)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var c=t.faces,h=e.morphColors[0].colors;for(r=0,i=c.length;r<i;r++)c[r].color.fromArray(h,3*r)}}function r(e,t){var n=[],r=[];void 0!==e.animation&&r.push(e.animation),void 0!==e.animations&&(e.animations.length?r=r.concat(e.animations):r.push(e.animations));for(var i=0;i<r.length;i++){var o=Pu.parseAnimation(r[i],t.bones);o&&n.push(o)}if(t.morphTargets){var s=Pu.CreateClipsFromMorphTargetSequences(t.morphTargets,10);n=n.concat(s)}n.length>0&&(t.animations=n)}return function(i,o){void 0!==i.data&&(i=i.data),void 0!==i.scale?i.scale=1/i.scale:i.scale=1;var s=new fi;if(e(i,s),t(i,s),n(i,s),r(i,s),s.computeFaceNormals(),s.computeBoundingSphere(),void 0===i.materials||0===i.materials.length)return{geometry:s};var a=Du.prototype.initMaterials(i.materials,o,this.crossOrigin);return{geometry:s,materials:a}}}()}),Object.assign(Nu.prototype,{load:function(e,t,n,r){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var i=this,o=new Sl(i.manager);o.load(e,(function(n){var o=null;try{o=JSON.parse(n)}catch(a){return void 0!==r&&r(a),void console.error("THREE:ObjectLoader: Can't parse "+e+".",a.message)}var s=o.metadata;void 0!==s&&void 0!==s.type&&"geometry"!==s.type.toLowerCase()?i.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e+". Use THREE.JSONLoader instead.")}),n,r)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var n=this.parseShape(e.shapes),r=this.parseGeometries(e.geometries,n),i=this.parseImages(e.images,(function(){void 0!==t&&t(a)})),o=this.parseTextures(e.textures,i),s=this.parseMaterials(e.materials,o),a=this.parseObject(e.object,r,s);return e.animations&&(a.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(a),a},parseShape:function(e){var t={};if(void 0!==e)for(var n=0,r=e.length;n<r;n++){var i=(new ou).fromJSON(e[n]);t[i.uuid]=i}return t},parseGeometries:function(e,t){var n={};if(void 0!==e)for(var r=new ku,i=new Lu,o=0,s=e.length;o<s;o++){var a,l=e[o];switch(l.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new ul[l.type](l.width,l.height,l.widthSegments,l.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new ul[l.type](l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new ul[l.type](l.radius,l.segments,l.thetaStart,l.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new ul[l.type](l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new ul[l.type](l.radius,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new ul[l.type](l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new ul[l.type](l.radius,l.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new ul[l.type](l.innerRadius,l.outerRadius,l.thetaSegments,l.phiSegments,l.thetaStart,l.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new ul[l.type](l.radius,l.tube,l.radialSegments,l.tubularSegments,l.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new ul[l.type](l.radius,l.tube,l.tubularSegments,l.radialSegments,l.p,l.q);break;case"LatheGeometry":case"LatheBufferGeometry":a=new ul[l.type](l.points,l.segments,l.phiStart,l.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new ul[l.type](l.vertices,l.indices,l.radius,l.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var u=[],c=0,h=l.shapes.length;c<h;c++){var d=t[l.shapes[c]];u.push(d)}a=new ul[l.type](u,l.curveSegments);break;case"BufferGeometry":a=i.parse(l);break;case"Geometry":a=r.parse(l,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+l.type+'"');continue}a.uuid=l.uuid,void 0!==l.name&&(a.name=l.name),n[l.uuid]=a}return n},parseMaterials:function(e,t){var n={};if(void 0!==e){var r=new Ru;r.setTextures(t);for(var i=0,o=e.length;i<o;i++){var s=e[i];if("MultiMaterial"===s.type){for(var a=[],l=0;l<s.materials.length;l++)a.push(r.parse(s.materials[l]));n[s.uuid]=a}else n[s.uuid]=r.parse(s)}}return n},parseAnimations:function(e){for(var t=[],n=0;n<e.length;n++){var r=Pu.parse(e[n]);t.push(r)}return t},parseImages:function(e,t){var n=this,r={};function i(e){return n.manager.itemStart(e),s.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemEnd(e),n.manager.itemError(e)}))}if(void 0!==e&&e.length>0){var o=new wl(t),s=new Tl(o);s.setCrossOrigin(this.crossOrigin);for(var a=0,l=e.length;a<l;a++){var u=e[a],c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u.url)?u.url:n.texturePath+u.url;r[u.uuid]=i(c)}}return r},parseTextures:function(e,t){function n(e,t){return"number"===typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(void 0!==e)for(var i=0,o=e.length;i<o;i++){var s=e[i];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);var a=new Vt(t[s.image]);a.needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=n(s.mapping,Vu)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=n(s.wrap[0],zu),a.wrapT=n(s.wrap[1],zu)),void 0!==s.format&&(a.format=s.format),void 0!==s.minFilter&&(a.minFilter=n(s.minFilter,Uu)),void 0!==s.magFilter&&(a.magFilter=n(s.magFilter,Uu)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),r[s.uuid]=a}return r},parseObject:function(e,t,n){var r;function i(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function o(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],r=0,i=e.length;r<i;r++){var o=e[r];void 0===n[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),t.push(n[o])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}switch(e.type){case"Scene":r=new Cs,void 0!==e.background&&Number.isInteger(e.background)&&(r.background=new ni(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?r.fog=new Ts(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(r.fog=new Ms(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new _s(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(r.focus=e.focus),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.filmGauge&&(r.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(r.filmOffset=e.filmOffset),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new hi(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new fu(e.color,e.intensity);break;case"DirectionalLight":r=new pu(e.color,e.intensity);break;case"PointLight":r=new hu(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new mu(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new cu(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new au(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var s=i(e.geometry),a=o(e.material);r=s.bones&&s.bones.length>0?new Is(s,a):new Ui(s,a);break;case"LOD":r=new Ls;break;case"Line":r=new Ns(i(e.geometry),o(e.material),e.mode);break;case"LineLoop":r=new Vs(i(e.geometry),o(e.material));break;case"LineSegments":r=new Fs(i(e.geometry),o(e.material));break;case"PointCloud":case"Points":r=new Us(i(e.geometry),o(e.material));break;case"Sprite":r=new Rs(o(e.material));break;case"Group":r=new js;break;default:r=new ui}if(r.uuid=e.uuid,void 0!==e.name&&(r.name=e.name),void 0!==e.matrix?(r.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==e.position&&r.position.fromArray(e.position),void 0!==e.rotation&&r.rotation.fromArray(e.rotation),void 0!==e.quaternion&&r.quaternion.fromArray(e.quaternion),void 0!==e.scale&&r.scale.fromArray(e.scale)),void 0!==e.castShadow&&(r.castShadow=e.castShadow),void 0!==e.receiveShadow&&(r.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(r.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(r.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&r.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(r.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.frustumCulled&&(r.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(r.renderOrder=e.renderOrder),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.children)for(var l=e.children,u=0;u<l.length;u++)r.add(this.parseObject(l[u],t,n));if("LOD"===e.type)for(var c=e.levels,h=0;h<c.length;h++){var d=c[h],p=r.getObjectByProperty("uuid",d.object);void 0!==p&&r.addLevel(p,d.distance)}return r}});var Fu,Vu={UVMapping:oe,CubeReflectionMapping:se,CubeRefractionMapping:ae,EquirectangularReflectionMapping:le,EquirectangularRefractionMapping:ue,SphericalReflectionMapping:ce,CubeUVReflectionMapping:he,CubeUVRefractionMapping:de},zu={RepeatWrapping:pe,ClampToEdgeWrapping:fe,MirroredRepeatWrapping:me},Uu={NearestFilter:ge,NearestMipMapNearestFilter:ve,NearestMipMapLinearFilter:ye,LinearFilter:xe,LinearMipMapNearestFilter:be,LinearMipMapLinearFilter:we};function ju(e){"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==e?e:_l,this.options=void 0}function Bu(){this.type="ShapePath",this.color=new ni,this.subPaths=[],this.currentPath=null}function Hu(e){this.type="Font",this.data=e}function Gu(e,t,n,r){for(var i=String(e).split(""),o=t/r.resolution,s=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*o,a=[],l=0,u=0,c=0;c<i.length;c++){var h=i[c];if("\n"===h)l=0,u-=s;else{var d=qu(h,n,o,l,u,r);l+=d.offsetX,a.push(d.path)}}return a}function qu(e,t,n,r,i,o){var s=o.glyphs[e]||o.glyphs["?"];if(s){var a,l,u,c,h,d,p,f,m=new Bu;if(s.o)for(var g=s._cachedOutline||(s._cachedOutline=s.o.split(" ")),v=0,y=g.length;v<y;){var x=g[v++];switch(x){case"m":a=g[v++]*n+r,l=g[v++]*n+i,m.moveTo(a,l);break;case"l":a=g[v++]*n+r,l=g[v++]*n+i,m.lineTo(a,l);break;case"q":u=g[v++]*n+r,c=g[v++]*n+i,h=g[v++]*n+r,d=g[v++]*n+i,m.quadraticCurveTo(h,d,u,c);break;case"b":u=g[v++]*n+r,c=g[v++]*n+i,h=g[v++]*n+r,d=g[v++]*n+i,p=g[v++]*n+r,f=g[v++]*n+i,m.bezierCurveTo(h,d,p,f,u,c);break}}return{offsetX:s.ha*n,path:m}}}function Wu(e){this.manager=void 0!==e?e:_l}ju.prototype={constructor:ju,setOptions:function(e){return this.options=e,this},load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e);var i=this,o=bl.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;fetch(e).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,i.options)})).then((function(n){bl.add(e,n),t&&t(n),i.manager.itemEnd(e)})).catch((function(t){r&&r(t),i.manager.itemEnd(e),i.manager.itemError(e)}))},setCrossOrigin:function(){return this},setPath:function(e){return this.path=e,this}},Object.assign(Bu.prototype,{moveTo:function(e,t){this.currentPath=new iu,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,n,r){this.currentPath.quadraticCurveTo(e,t,n,r)},bezierCurveTo:function(e,t,n,r,i,o){this.currentPath.bezierCurveTo(e,t,n,r,i,o)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function n(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n],o=new ou;o.curves=i.curves,t.push(o)}return t}function r(e,t){for(var n=t.length,r=!1,i=n-1,o=0;o<n;i=o++){var s=t[i],a=t[o],l=a.x-s.x,u=a.y-s.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(s=t[o],l=-l,a=t[i],u=-u),e.y<s.y||e.y>a.y)continue;if(e.y===s.y){if(e.x===s.x)return!0}else{var c=u*(e.x-s.x)-l*(e.y-s.y);if(0===c)return!0;if(c<0)continue;r=!r}}else{if(e.y!==s.y)continue;if(a.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=a.x)return!0}}return r}var i=za.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return n(o);var s,a,l,u=[];if(1===o.length)return a=o[0],l=new ou,l.curves=a.curves,u.push(l),u;var c=!i(o[0].getPoints());c=e?!c:c;var h,d,p=[],f=[],m=[],g=0;f[g]=void 0,m[g]=[];for(var v=0,y=o.length;v<y;v++)a=o[v],h=a.getPoints(),s=i(h),s=e?!s:s,s?(!c&&f[g]&&g++,f[g]={s:new ou,p:h},f[g].s.curves=a.curves,c&&g++,m[g]=[]):m[g].push({h:a,p:h[0]});if(!f[0])return n(o);if(f.length>1){for(var x=!1,b=[],w=0,_=f.length;w<_;w++)p[w]=[];for(w=0,_=f.length;w<_;w++)for(var A=m[w],S=0;S<A.length;S++){for(var E=A[S],M=!0,T=0;T<f.length;T++)r(E.p,f[T].p)&&(w!==T&&b.push({froms:w,tos:T,hole:S}),M?(M=!1,p[T].push(E)):x=!0);M&&p[w].push(E)}b.length>0&&(x||(m=p))}v=0;for(var C=f.length;v<C;v++){l=f[v].s,u.push(l),d=m[v];for(var P=0,R=d.length;P<R;P++)l.holes.push(d[P].h)}return u}}),Object.assign(Hu.prototype,{isFont:!0,generateShapes:function(e,t,n){void 0===t&&(t=100),void 0===n&&(n=4);for(var r=[],i=Gu(e,t,n,this.data),o=0,s=i.length;o<s;o++)Array.prototype.push.apply(r,i[o].toShapes());return r}}),Object.assign(Wu.prototype,{load:function(e,t,n,r){var i=this,o=new Sl(this.manager);o.setPath(this.path),o.load(e,(function(e){var n;try{n=JSON.parse(e)}catch(o){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}var r=i.parse(n);t&&t(r)}),n,r)},parse:function(e){return new Hu(e)},setPath:function(e){return this.path=e,this}});var $u={getContext:function(){return void 0===Fu&&(Fu=new(window.AudioContext||window.webkitAudioContext)),Fu},setContext:function(e){Fu=e}};function Xu(e){this.manager=void 0!==e?e:_l}function Yu(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new _s,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new _s,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function Zu(e,t,n){ui.call(this),this.type="CubeCamera";var r=90,i=1,o=new _s(r,i,e,t);o.up.set(0,-1,0),o.lookAt(new kt(1,0,0)),this.add(o);var s=new _s(r,i,e,t);s.up.set(0,-1,0),s.lookAt(new kt(-1,0,0)),this.add(s);var a=new _s(r,i,e,t);a.up.set(0,0,1),a.lookAt(new kt(0,1,0)),this.add(a);var l=new _s(r,i,e,t);l.up.set(0,0,-1),l.lookAt(new kt(0,-1,0)),this.add(l);var u=new _s(r,i,e,t);u.up.set(0,-1,0),u.lookAt(new kt(0,0,1)),this.add(u);var c=new _s(r,i,e,t);c.up.set(0,-1,0),c.lookAt(new kt(0,0,-1)),this.add(c);var h={format:ke,magFilter:xe,minFilter:xe};this.renderTarget=new jt(n,n,h),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,r=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,n.activeCubeFace=0,e.render(t,o,n),n.activeCubeFace=1,e.render(t,s,n),n.activeCubeFace=2,e.render(t,a,n),n.activeCubeFace=3,e.render(t,l,n),n.activeCubeFace=4,e.render(t,u,n),n.texture.generateMipmaps=r,n.activeCubeFace=5,e.render(t,c,n),e.setRenderTarget(null)},this.clear=function(e,t,n,r){for(var i=this.renderTarget,o=0;o<6;o++)i.activeCubeFace=o,e.setRenderTarget(i),e.clear(t,n,r);e.setRenderTarget(null)}}function Ju(){ui.call(this),this.type="AudioListener",this.context=$u.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function Qu(e){ui.call(this),this.type="Audio",this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function Ku(e){Qu.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function ec(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function tc(e,t,n){this.binding=e,this.valueSize=n;var r,i=Float64Array;switch(t){case"quaternion":r=this._slerp;break;case"string":case"bool":i=Array,r=this._select;break;default:r=this._lerp}this.buffer=new i(4*n),this._mixBufferRegion=r,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Object.assign(Xu.prototype,{load:function(e,t,n,r){var i=new Sl(this.manager);i.setResponseType("arraybuffer"),i.load(e,(function(e){var n=$u.getContext();n.decodeAudioData(e,(function(e){t(e)}))}),n,r)}}),Object.assign(Yu.prototype,{update:function(){var e,t,n,r,i,o,s,a,l=new Dt,u=new Dt;return function(c){var h=e!==this||t!==c.focus||n!==c.fov||r!==c.aspect*this.aspect||i!==c.near||o!==c.far||s!==c.zoom||a!==this.eyeSep;if(h){e=this,t=c.focus,n=c.fov,r=c.aspect*this.aspect,i=c.near,o=c.far,s=c.zoom;var d=c.projectionMatrix.clone();a=this.eyeSep/2;var p,f,m=a*i/t,g=i*Math.tan(Lt.DEG2RAD*n*.5)/s;u.elements[12]=-a,l.elements[12]=a,p=-g*r+m,f=g*r+m,d.elements[0]=2*i/(f-p),d.elements[8]=(f+p)/(f-p),this.cameraL.projectionMatrix.copy(d),p=-g*r-m,f=g*r-m,d.elements[0]=2*i/(f-p),d.elements[8]=(f+p)/(f-p),this.cameraR.projectionMatrix.copy(d)}this.cameraL.matrixWorld.copy(c.matrixWorld).multiply(u),this.cameraR.matrixWorld.copy(c.matrixWorld).multiply(l)}}()}),Zu.prototype=Object.create(ui.prototype),Zu.prototype.constructor=Zu,Ju.prototype=Object.assign(Object.create(ui.prototype),{constructor:Ju,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(e){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01)},updateMatrixWorld:function(){var e=new kt,t=new It,n=new kt,r=new kt;return function(i){ui.prototype.updateMatrixWorld.call(this,i);var o=this.context.listener,s=this.up;this.matrixWorld.decompose(e,t,n),r.set(0,0,-1).applyQuaternion(t),o.positionX?(o.positionX.setValueAtTime(e.x,this.context.currentTime),o.positionY.setValueAtTime(e.y,this.context.currentTime),o.positionZ.setValueAtTime(e.z,this.context.currentTime),o.forwardX.setValueAtTime(r.x,this.context.currentTime),o.forwardY.setValueAtTime(r.y,this.context.currentTime),o.forwardZ.setValueAtTime(r.z,this.context.currentTime),o.upX.setValueAtTime(s.x,this.context.currentTime),o.upY.setValueAtTime(s.y,this.context.currentTime),o.upZ.setValueAtTime(s.z,this.context.currentTime)):(o.setPosition(e.x,e.y,e.z),o.setOrientation(r.x,r.y,r.z,s.x,s.y,s.z))}}()}),Qu.prototype=Object.assign(Object.create(ui.prototype),{constructor:Qu,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),e.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}),Ku.prototype=Object.assign(Object.create(Qu.prototype),{constructor:Ku,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){this.panner.refDistance=e},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){this.panner.rolloffFactor=e},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){this.panner.distanceModel=e},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){this.panner.maxDistance=e},updateMatrixWorld:function(){var e=new kt;return function(t){ui.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}()}),Object.assign(ec.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}),Object.assign(tc.prototype,{accumulate:function(e,t){var n=this.buffer,r=this.valueSize,i=e*r+r,o=this.cumulativeWeight;if(0===o){for(var s=0;s!==r;++s)n[i+s]=n[s];o=t}else{o+=t;var a=t/o;this._mixBufferRegion(n,i,0,a,r)}this.cumulativeWeight=o},apply:function(e){var t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,i<1){var s=3*t;this._mixBufferRegion(n,r,s,1-i,t)}for(var a=t,l=t+t;a!==l;++a)if(n[a]!==n[a+t]){o.setValue(n,r);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,n=this.valueSize,r=3*n;e.getValue(t,r);for(var i=n,o=r;i!==o;++i)t[i]=t[r+i%n];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,n,r,i){if(r>=.5)for(var o=0;o!==i;++o)e[t+o]=e[n+o]},_slerp:function(e,t,n,r){It.slerpFlat(e,t,e,t,e,n,r)},_lerp:function(e,t,n,r,i){for(var o=1-r,s=0;s!==i;++s){var a=t+s;e[a]=e[a]*o+e[n+s]*r}}});var nc,rc,ic="\\[\\]\\.:\\/";function oc(e,t,n){var r=n||sc.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function sc(e,t,n){this.path=t,this.parsedPath=n||sc.parseTrackName(t),this.node=sc.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function ac(){this.uuid=Lt.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}function lc(e,t,n){this._mixer=e,this._clip=t,this._localRoot=n||null;for(var r=t.tracks,i=r.length,o=new Array(i),s={endingStart:gt,endingEnd:gt},a=0;a!==i;++a){var l=r[a].createInterpolant(null);o[a]=l,l.settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=ht,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function uc(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function cc(e){"string"===typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function hc(){Ci.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function dc(e,t,n,r){this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}function pc(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0}function fc(e,t,n){pc.call(this,e,t),this.meshPerAttribute=n||1}function mc(e,t,n){mi.call(this,e,t),this.meshPerAttribute=n||1}function gc(e,t,n,r){this.ray=new Fi(e,t),this.near=n||0,this.far=r||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function vc(e,t){return e.distance-t.distance}function yc(e,t,n,r){if(!1!==e.visible&&(e.raycast(t,n),!0===r))for(var i=e.children,o=0,s=i.length;o<s;o++)yc(i[o],t,n,!0)}function xc(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function bc(e,t,n){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==n?n:0,this}function wc(e,t,n){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==n?n:0,this}function _c(e,t){this.min=void 0!==e?e:new Ot(1/0,1/0),this.max=void 0!==t?t:new Ot(-1/0,-1/0)}function Ac(e){ui.call(this),this.material=e,this.render=function(){}}function Sc(e,t,n,r){this.object=e,this.size=void 0!==t?t:1;var i=void 0!==n?n:16711680,o=void 0!==r?r:1,s=0,a=this.object.geometry;a&&a.isGeometry?s=3*a.faces.length:a&&a.isBufferGeometry&&(s=a.attributes.normal.count);var l=new Ci,u=new Ai(2*s*3,3);l.addAttribute("position",u),Fs.call(this,l,new ks({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function Ec(e,t){ui.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var n=new Ci,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,o=1,s=32;i<s;i++,o++){var a=i/s*Math.PI*2,l=o/s*Math.PI*2;r.push(Math.cos(a),Math.sin(a),1,Math.cos(l),Math.sin(l),1)}n.addAttribute("position",new Ai(r,3));var u=new ks({fog:!1});this.cone=new Fs(n,u),this.add(this.cone),this.update()}function Mc(e){var t=[];e&&e.isBone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,Mc(e.children[n]));return t}function Tc(e){for(var t=Mc(e),n=new Ci,r=[],i=[],o=new ni(0,0,1),s=new ni(0,1,0),a=0;a<t.length;a++){var l=t[a];l.parent&&l.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(s.r,s.g,s.b))}n.addAttribute("position",new Ai(r,3)),n.addAttribute("color",new Ai(i,3));var u=new ks({vertexColors:b,depthTest:!1,depthWrite:!1,transparent:!0});Fs.call(this,n,u),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function Cc(e,t,n){this.light=e,this.light.updateMatrixWorld(),this.color=n;var r=new Xa(t,4,2),i=new ki({wireframe:!0,fog:!1});Ui.call(this,r,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function Pc(e,t){ui.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;var n=new ks({fog:!1}),r=new Ci;r.addAttribute("position",new mi(new Float32Array(15),3)),this.line=new Ns(r,n),this.add(this.line),this.update()}function Rc(e,t,n){ui.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;var r=new Ks(t);r.rotateY(.5*Math.PI),this.material=new ki({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=b);var i=r.getAttribute("position"),o=new Float32Array(3*i.count);r.addAttribute("color",new mi(o,3)),this.add(new Ui(r,this.material)),this.update()}function Lc(e,t,n,r){e=e||10,t=t||10,n=new ni(void 0!==n?n:4473924),r=new ni(void 0!==r?r:8947848);for(var i=t/2,o=e/t,s=e/2,a=[],l=[],u=0,c=0,h=-s;u<=t;u++,h+=o){a.push(-s,0,h,s,0,h),a.push(h,0,-s,h,0,s);var d=u===i?n:r;d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3,d.toArray(l,c),c+=3}var p=new Ci;p.addAttribute("position",new Ai(a,3)),p.addAttribute("color",new Ai(l,3));var f=new ks({vertexColors:b});Fs.call(this,p,f)}function Oc(e,t,n,r,i,o){e=e||10,t=t||16,n=n||8,r=r||64,i=new ni(void 0!==i?i:4473924),o=new ni(void 0!==o?o:8947848);var s,a,l,u,c,h,d,p=[],f=[];for(u=0;u<=t;u++)l=u/t*(2*Math.PI),s=Math.sin(l)*e,a=Math.cos(l)*e,p.push(0,0,0),p.push(s,0,a),d=1&u?i:o,f.push(d.r,d.g,d.b),f.push(d.r,d.g,d.b);for(u=0;u<=n;u++)for(d=1&u?i:o,h=e-e/n*u,c=0;c<r;c++)l=c/r*(2*Math.PI),s=Math.sin(l)*h,a=Math.cos(l)*h,p.push(s,0,a),f.push(d.r,d.g,d.b),l=(c+1)/r*(2*Math.PI),s=Math.sin(l)*h,a=Math.cos(l)*h,p.push(s,0,a),f.push(d.r,d.g,d.b);var m=new Ci;m.addAttribute("position",new Ai(p,3)),m.addAttribute("color",new Ai(f,3));var g=new ks({vertexColors:b});Fs.call(this,m,g)}function Dc(e,t,n,r){this.object=e,this.size=void 0!==t?t:1;var i=void 0!==n?n:16776960,o=void 0!==r?r:1,s=0,a=this.object.geometry;a&&a.isGeometry?s=a.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var l=new Ci,u=new Ai(2*s*3,3);l.addAttribute("position",u),Fs.call(this,l,new ks({color:i,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function Ic(e,t,n){ui.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);var r=new Ci;r.addAttribute("position",new Ai([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var i=new ks({fog:!1});this.lightPlane=new Ns(r,i),this.add(this.lightPlane),r=new Ci,r.addAttribute("position",new Ai([0,0,0,0,0,1],3)),this.targetLine=new Ns(r,i),this.add(this.targetLine),this.update()}function kc(e){var t=new Ci,n=new ks({color:16777215,vertexColors:x}),r=[],i=[],o={},s=new ni(16755200),a=new ni(16711680),l=new ni(43775),u=new ni(16777215),c=new ni(3355443);function h(e,t,n){d(e,n),d(t,n)}function d(e,t){r.push(0,0,0),i.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(r.length/3-1)}h("n1","n2",s),h("n2","n4",s),h("n4","n3",s),h("n3","n1",s),h("f1","f2",s),h("f2","f4",s),h("f4","f3",s),h("f3","f1",s),h("n1","f1",s),h("n2","f2",s),h("n3","f3",s),h("n4","f4",s),h("p","n1",a),h("p","n2",a),h("p","n3",a),h("p","n4",a),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",u),h("p","c",c),h("cn1","cn2",c),h("cn3","cn4",c),h("cf1","cf2",c),h("cf3","cf4",c),t.addAttribute("position",new Ai(r,3)),t.addAttribute("color",new Ai(i,3)),Fs.call(this,t,n),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function Nc(e,t){this.object=e,void 0===t&&(t=16776960);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new Ci;i.setIndex(new mi(n,1)),i.addAttribute("position",new mi(r,3)),Fs.call(this,i,new ks({color:t})),this.matrixAutoUpdate=!1,this.update()}function Fc(e,t){this.type="Box3Helper",this.box=e;var n=void 0!==t?t:16776960,r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],o=new Ci;o.setIndex(new mi(r,1)),o.addAttribute("position",new Ai(i,3)),Fs.call(this,o,new ks({color:n})),this.geometry.computeBoundingSphere()}function Vc(e,t,n){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var r=void 0!==n?n:16776960,i=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],o=new Ci;o.addAttribute("position",new Ai(i,3)),o.computeBoundingSphere(),Ns.call(this,o,new ks({color:r}));var s=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],a=new Ci;a.addAttribute("position",new Ai(s,3)),a.computeBoundingSphere(),this.add(new Ui(a,new ki({color:r,opacity:.2,transparent:!0,depthWrite:!1})))}function zc(e,t,n,r,i,o){ui.call(this),void 0===r&&(r=16776960),void 0===n&&(n=1),void 0===i&&(i=.2*n),void 0===o&&(o=.2*i),void 0===nc&&(nc=new Ci,nc.addAttribute("position",new Ai([0,0,0,0,1,0],3)),rc=new il(0,.5,1,5,1),rc.translate(0,-.5,0)),this.position.copy(t),this.line=new Ns(nc,new ks({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ui(rc,new ki({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,o)}function Uc(e){e=e||1;var t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Ci;r.addAttribute("position",new Ai(t,3)),r.addAttribute("color",new Ai(n,3));var i=new ks({vertexColors:b});Fs.call(this,r,i)}Object.assign(oc.prototype,{getValue:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)},setValue:function(e,t){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(sc,{Composite:oc,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new sc.Composite(e,t,n):new sc(e,t,n)},sanitizeNodeName:function(){var e=new RegExp("["+ic+"]","g");return function(t){return t.replace(/\s/g,"_").replace(e,"")}}(),parseTrackName:function(){var e="[^"+ic+"]",t="[^"+ic.replace("\\.","")+"]",n=/((?:WC+[\/:])*)/.source.replace("WC",e),r=/(WCOD+)?/.source.replace("WCOD",t),i=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",e),o=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",e),s=new RegExp("^"+n+r+i+o+"$"),a=["material","materials","bones"];return function(e){var t=s.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var i=n.nodeName.substring(r+1);-1!==a.indexOf(i)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}}(),findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var r=function(e){for(var n=0;n<e.length;n++){var i=e[n];if(i.name===t||i.uuid===t)return i;var o=r(i.children);if(o)return o}return null},i=r(e.children);if(i)return i}return null}}),Object.assign(sc.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)e[t++]=n[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++]},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,n=t.objectName,r=t.propertyName,i=t.propertyIndex;if(e||(e=sc.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(n){var o=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var s=0;s<e.length;s++)if(e[s].name===o){o=s;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==o){if(void 0===e[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var a=e[r];if(void 0!==a){var l=this.Versioning.None;void 0!==e.needsUpdate?(l=this.Versioning.NeedsUpdate,this.targetObject=e):void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=e);var u=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(s=0;s<this.node.geometry.morphAttributes.position.length;s++)if(e.geometry.morphAttributes.position[s].name===i){i=s;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(s=0;s<this.node.geometry.morphTargets.length;s++)if(e.geometry.morphTargets[s].name===i){i=s;break}}}u=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=i}else void 0!==a.fromArray&&void 0!==a.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(u=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][l]}else{var c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(sc.prototype,{_getValue_unbound:sc.prototype.getValue,_setValue_unbound:sc.prototype.setValue}),Object.assign(ac.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._paths,o=this._parsedPaths,s=this._bindings,a=s.length,l=void 0,u=0,c=arguments.length;u!==c;++u){var h=arguments[u],d=h.uuid,p=r[d];if(void 0===p){p=t++,r[d]=p,e.push(h);for(var f=0,m=a;f!==m;++f)s[f].push(new sc(h,i[f],o[f]))}else if(p<n){l=e[p];var g=--n,v=e[g];r[v.uuid]=p,e[p]=v,r[d]=g,e[g]=h;for(f=0,m=a;f!==m;++f){var y=s[f],x=y[g],b=y[p];y[p]=x,void 0===b&&(b=new sc(h,i[f],o[f])),y[g]=b}}else e[p]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,i=r.length,o=0,s=arguments.length;o!==s;++o){var a=arguments[o],l=a.uuid,u=n[l];if(void 0!==u&&u>=t){var c=t++,h=e[c];n[h.uuid]=u,e[u]=h,n[l]=c,e[c]=a;for(var d=0,p=i;d!==p;++d){var f=r[d],m=f[c],g=f[u];f[u]=m,f[c]=g}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._bindings,o=i.length,s=0,a=arguments.length;s!==a;++s){var l=arguments[s],u=l.uuid,c=r[u];if(void 0!==c)if(delete r[u],c<n){var h=--n,d=e[h],p=--t,f=e[p];r[d.uuid]=c,e[c]=d,r[f.uuid]=h,e[h]=f,e.pop();for(var m=0,g=o;m!==g;++m){var v=i[m],y=v[h],x=v[p];v[c]=y,v[h]=x,v.pop()}}else{p=--t,f=e[p];r[f.uuid]=c,e[c]=f,e.pop();for(m=0,g=o;m!==g;++m){v=i[m];v[c]=v[p],v.pop()}}}this.nCachedObjects_=n},subscribe_:function(e,t){var n=this._bindingsIndicesByPath,r=n[e],i=this._bindings;if(void 0!==r)return i[r];var o=this._paths,s=this._parsedPaths,a=this._objects,l=a.length,u=this.nCachedObjects_,c=new Array(l);r=i.length,n[e]=r,o.push(e),s.push(t),i.push(c);for(var h=u,d=a.length;h!==d;++h){var p=a[h];c[h]=new sc(p,e,t)}return c},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var r=this._paths,i=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s],l=e[s];t[l]=n,o[n]=a,o.pop(),i[n]=i[s],i.pop(),r[n]=r[s],r.pop()}}}),Object.assign(lc.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var r=this._clip.duration,i=e._clip.duration,o=i/r,s=r/i;e.warp(1,o,t),this.warp(s,1,t)}return this},crossFadeTo:function(e,t,n){return e.crossFadeFrom(this,t,n)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,n){var r=this._mixer,i=r.time,o=this._timeScaleInterpolant,s=this.timeScale;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);var a=o.parameterPositions,l=o.sampleValues;return a[0]=i,a[1]=i+n,l[0]=e/s,l[1]=t/s,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,n,r){if(this.enabled){var i=this._startTime;if(null!==i){var o=(e-i)*n;if(o<0||0===n)return;this._startTime=null,t=n*o}t*=this._updateTimeScale(e);var s=this._updateTime(t),a=this._updateWeight(e);if(a>0)for(var l=this._interpolants,u=this._propertyBindings,c=0,h=l.length;c!==h;++c)l[c].evaluate(s),u[c].accumulate(r,a)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n){var r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e;if(0===e)return t;var n=this._clip.duration,r=this.loop,i=this._loopCount;if(r===ct){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=n)t=n;else{if(!(t<0))break e;t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{var o=r===dt;if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=n||t<0){var s=Math.floor(t/n);t-=n*s,i+=Math.abs(s);var a=this.repetitions-i;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?n:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){var l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s})}}if(o&&1===(1&i))return this.time=t,n-t}return this.time=t,t},_setEndings:function(e,t,n){var r=this._interpolantSettings;n?(r.endingStart=vt,r.endingEnd=vt):(r.endingStart=e?this.zeroSlopeAtStart?vt:gt:yt,r.endingEnd=t?this.zeroSlopeAtEnd?vt:gt:yt)},_scheduleFading:function(e,t,n){var r=this._mixer,i=r.time,o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);var s=o.parameterPositions,a=o.sampleValues;return s[0]=i,a[0]=t,s[1]=i+e,a[1]=n,this}}),uc.prototype=Object.assign(Object.create(a.prototype),{constructor:uc,_bindAction:function(e,t){var n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,o=e._propertyBindings,s=e._interpolants,a=n.uuid,l=this._bindingsByRootAndName,u=l[a];void 0===u&&(u={},l[a]=u);for(var c=0;c!==i;++c){var h=r[c],d=h.name,p=u[d];if(void 0!==p)o[c]=p;else{if(p=o[c],void 0!==p){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,a,d));continue}var f=t&&t._propertyBindings[c].binding.parsedPath;p=new tc(sc.create(n,d,f),h.ValueTypeName,h.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,a,d),o[c]=p}s[c].resultBuffer=p.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}for(var i=e._propertyBindings,o=0,s=i.length;o!==s;++o){var a=i[o];0===a.useCount++&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0===--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){var r=this._actions,i=this._actionsByClip,o=i[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{var s=o.knownActions;e._byClipCacheIndex=s.length,s.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e},_removeInactiveAction:function(e){var t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;var i=e._clip.uuid,o=this._actionsByClip,s=o[i],a=s.knownActions,l=a[a.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,a[u]=l,a.pop(),e._byClipCacheIndex=null;var c=s.actionByRoot,h=(e._localRoot||this._root).uuid;delete c[h],0===a.length&&delete o[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0===--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(e){var t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackAction:function(e){var t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_addInactiveBinding:function(e,t,n){var r=this._bindingsByRootAndName,i=r[t],o=this._bindings;void 0===i&&(i={},r[t]=i),i[n]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,s=o[r],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete s[i];e:{for(var u in s)break e;delete o[r]}},_lendBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&(n=new Su(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var n=t||this._root,r=n.uuid,i="string"===typeof e?Pu.findByName(n,e):e,o=null!==i?i.uuid:e,s=this._actionsByClip[o],a=null;if(void 0!==s){var l=s.actionByRoot[r];if(void 0!==l)return l;a=s.knownActions[0],null===i&&(i=a._clip)}if(null===i)return null;var u=new lc(this,i,t);return this._bindAction(u,a),this._addInactiveAction(u,o,r),u},existingAction:function(e,t){var n=t||this._root,r=n.uuid,i="string"===typeof e?Pu.findByName(n,e):e,o=i?i.uuid:e,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[r]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,n=this._bindings,r=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==t;++i)e[i].reset();for(i=0;i!==r;++i)n[i].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1,s=0;s!==n;++s){var a=t[s];a._update(r,e,i,o)}var l=this._bindings,u=this._nActiveBindings;for(s=0;s!==u;++s)l[s].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){for(var o=i.knownActions,s=0,a=o.length;s!==a;++s){var l=o[s];this._deactivateAction(l);var u=l._cacheIndex,c=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,c._cacheIndex=u,t[u]=c,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[n]}},uncacheRoot:function(e){var t=e.uuid,n=this._actionsByClip;for(var r in n){var i=n[r].actionByRoot,o=i[t];void 0!==o&&(this._deactivateAction(o),this._removeInactiveAction(o))}var s=this._bindingsByRootAndName,a=s[t];if(void 0!==a)for(var l in a){var u=a[l];u.restoreOriginalState(),this._removeInactiveBinding(u)}},uncacheAction:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}),cc.prototype.clone=function(){return new cc(void 0===this.value.clone?this.value:this.value.clone())},hc.prototype=Object.assign(Object.create(Ci.prototype),{constructor:hc,isInstancedBufferGeometry:!0,copy:function(e){return Ci.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),Object.defineProperties(dc.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(dc.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}}),Object.defineProperty(pc.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(pc.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");return this.count=void 0!==e?e.length/this.stride:0,this.array=e,this},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),fc.prototype=Object.assign(Object.create(pc.prototype),{constructor:fc,isInstancedInterleavedBuffer:!0,copy:function(e){return pc.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),mc.prototype=Object.assign(Object.create(mi.prototype),{constructor:mc,isInstancedBufferAttribute:!0,copy:function(e){return mi.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(gc.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,n){var r=n||[];return yc(e,this,r,t),r.sort(vc),r},intersectObjects:function(e,t,n){var r=n||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var i=0,o=e.length;i<o;i++)yc(e[i],this,r,t);return r.sort(vc),r}}),Object.assign(xc.prototype,{start:function(){this.startTime=("undefined"===typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"===typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),Object.assign(bc.prototype,{set:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){var e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this},setFromVector3:function(e){return this.radius=e.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e.x,e.z),this.phi=Math.acos(Lt.clamp(e.y/this.radius,-1,1))),this}}),Object.assign(wc.prototype,{set:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.radius=Math.sqrt(e.x*e.x+e.z*e.z),this.theta=Math.atan2(e.x,e.z),this.y=e.y,this}}),Object.assign(_c.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new Ot;return function(t,n){var r=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Ot),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Ot),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Ot),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Ot),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new Ot;return function(t){var n=e.copy(t).clamp(this.min,this.max);return n.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Ac.prototype=Object.create(ui.prototype),Ac.prototype.constructor=Ac,Ac.prototype.isImmediateRenderObject=!0,Sc.prototype=Object.create(Fs.prototype),Sc.prototype.constructor=Sc,Sc.prototype.update=function(){var e=new kt,t=new kt,n=new Nt;return function(){var r=["a","b","c"];this.object.updateMatrixWorld(!0),n.getNormalMatrix(this.object.matrixWorld);var i=this.object.matrixWorld,o=this.geometry.attributes.position,s=this.object.geometry;if(s&&s.isGeometry)for(var a=s.vertices,l=s.faces,u=0,c=0,h=l.length;c<h;c++)for(var d=l[c],p=0,f=d.vertexNormals.length;p<f;p++){var m=a[d[r[p]]],g=d.vertexNormals[p];e.copy(m).applyMatrix4(i),t.copy(g).applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),o.setXYZ(u,e.x,e.y,e.z),u+=1,o.setXYZ(u,t.x,t.y,t.z),u+=1}else if(s&&s.isBufferGeometry){var v=s.attributes.position,y=s.attributes.normal;for(u=0,p=0,f=v.count;p<f;p++)e.set(v.getX(p),v.getY(p),v.getZ(p)).applyMatrix4(i),t.set(y.getX(p),y.getY(p),y.getZ(p)),t.applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),o.setXYZ(u,e.x,e.y,e.z),u+=1,o.setXYZ(u,t.x,t.y,t.z),u+=1}o.needsUpdate=!0}}(),Ec.prototype=Object.create(ui.prototype),Ec.prototype.constructor=Ec,Ec.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Ec.prototype.update=function(){var e=new kt,t=new kt;return function(){this.light.updateMatrixWorld();var n=this.light.distance?this.light.distance:1e3,r=n*Math.tan(this.light.angle);this.cone.scale.set(r,r,n),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),Tc.prototype=Object.create(Fs.prototype),Tc.prototype.constructor=Tc,Tc.prototype.updateMatrixWorld=function(){var e=new kt,t=new Dt,n=new Dt;return function(r){var i=this.bones,o=this.geometry,s=o.getAttribute("position");n.getInverse(this.root.matrixWorld);for(var a=0,l=0;a<i.length;a++){var u=i[a];u.parent&&u.parent.isBone&&(t.multiplyMatrices(n,u.matrixWorld),e.setFromMatrixPosition(t),s.setXYZ(l,e.x,e.y,e.z),t.multiplyMatrices(n,u.parent.matrixWorld),e.setFromMatrixPosition(t),s.setXYZ(l+1,e.x,e.y,e.z),l+=2)}o.getAttribute("position").needsUpdate=!0,ui.prototype.updateMatrixWorld.call(this,r)}}(),Cc.prototype=Object.create(Ui.prototype),Cc.prototype.constructor=Cc,Cc.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Cc.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},Pc.prototype=Object.create(ui.prototype),Pc.prototype.constructor=Pc,Pc.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Pc.prototype.update=function(){var e=.5*this.light.width,t=.5*this.light.height,n=this.line.geometry.attributes.position,r=n.array;r[0]=e,r[1]=-t,r[2]=0,r[3]=e,r[4]=t,r[5]=0,r[6]=-e,r[7]=t,r[8]=0,r[9]=-e,r[10]=-t,r[11]=0,r[12]=e,r[13]=-t,r[14]=0,n.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},Rc.prototype=Object.create(ui.prototype),Rc.prototype.constructor=Rc,Rc.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Rc.prototype.update=function(){var e=new kt,t=new ni,n=new ni;return function(){var r=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var i=r.geometry.getAttribute("color");t.copy(this.light.color),n.copy(this.light.groundColor);for(var o=0,s=i.count;o<s;o++){var a=o<s/2?t:n;i.setXYZ(o,a.r,a.g,a.b)}i.needsUpdate=!0}r.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),Lc.prototype=Object.create(Fs.prototype),Lc.prototype.constructor=Lc,Oc.prototype=Object.create(Fs.prototype),Oc.prototype.constructor=Oc,Dc.prototype=Object.create(Fs.prototype),Dc.prototype.constructor=Dc,Dc.prototype.update=function(){var e=new kt,t=new kt,n=new Nt;return function(){this.object.updateMatrixWorld(!0),n.getNormalMatrix(this.object.matrixWorld);for(var r=this.object.matrixWorld,i=this.geometry.attributes.position,o=this.object.geometry,s=o.vertices,a=o.faces,l=0,u=0,c=a.length;u<c;u++){var h=a[u],d=h.normal;e.copy(s[h.a]).add(s[h.b]).add(s[h.c]).divideScalar(3).applyMatrix4(r),t.copy(d).applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),i.setXYZ(l,e.x,e.y,e.z),l+=1,i.setXYZ(l,t.x,t.y,t.z),l+=1}i.needsUpdate=!0}}(),Ic.prototype=Object.create(ui.prototype),Ic.prototype.constructor=Ic,Ic.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Ic.prototype.update=function(){var e=new kt,t=new kt,n=new kt;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),n.subVectors(t,e),this.lightPlane.lookAt(n),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(n),this.targetLine.scale.z=n.length()}}(),kc.prototype=Object.create(Fs.prototype),kc.prototype.constructor=kc,kc.prototype.update=function(){var e,t,n=new kt,r=new ci;function i(i,o,s,a){n.set(o,s,a).unproject(r);var l=t[i];if(void 0!==l)for(var u=e.getAttribute("position"),c=0,h=l.length;c<h;c++)u.setXYZ(l[c],n.x,n.y,n.z)}return function(){e=this.geometry,t=this.pointMap;var n=1,o=1;r.projectionMatrix.copy(this.camera.projectionMatrix),i("c",0,0,-1),i("t",0,0,1),i("n1",-n,-o,-1),i("n2",n,-o,-1),i("n3",-n,o,-1),i("n4",n,o,-1),i("f1",-n,-o,1),i("f2",n,-o,1),i("f3",-n,o,1),i("f4",n,o,1),i("u1",.7*n,1.1*o,-1),i("u2",.7*-n,1.1*o,-1),i("u3",0,2*o,-1),i("cf1",-n,0,1),i("cf2",n,0,1),i("cf3",0,-o,1),i("cf4",0,o,1),i("cn1",-n,0,-1),i("cn2",n,0,-1),i("cn3",0,-o,-1),i("cn4",0,o,-1),e.getAttribute("position").needsUpdate=!0}}(),Nc.prototype=Object.create(Fs.prototype),Nc.prototype.constructor=Nc,Nc.prototype.update=function(){var e=new Ht;return function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){var n=e.min,r=e.max,i=this.geometry.attributes.position,o=i.array;o[0]=r.x,o[1]=r.y,o[2]=r.z,o[3]=n.x,o[4]=r.y,o[5]=r.z,o[6]=n.x,o[7]=n.y,o[8]=r.z,o[9]=r.x,o[10]=n.y,o[11]=r.z,o[12]=r.x,o[13]=r.y,o[14]=n.z,o[15]=n.x,o[16]=r.y,o[17]=n.z,o[18]=n.x,o[19]=n.y,o[20]=n.z,o[21]=r.x,o[22]=n.y,o[23]=n.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),Nc.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Fc.prototype=Object.create(Fs.prototype),Fc.prototype.constructor=Fc,Fc.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),ui.prototype.updateMatrixWorld.call(this,e))},Vc.prototype=Object.create(Ns.prototype),Vc.prototype.constructor=Vc,Vc.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.lookAt(this.plane.normal),ui.prototype.updateMatrixWorld.call(this,e)},zc.prototype=Object.create(ui.prototype),zc.prototype.constructor=zc,zc.prototype.setDirection=function(){var e,t=new kt;return function(n){n.y>.99999?this.quaternion.set(0,0,0,1):n.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(n.z,0,-n.x).normalize(),e=Math.acos(n.y),this.quaternion.setFromAxisAngle(t,e))}}(),zc.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},zc.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},Uc.prototype=Object.create(Fs.prototype),Uc.prototype.constructor=Uc;function jc(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Vl.call(this,e),this.type="catmullrom",this.closed=!0}function Bc(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Vl.call(this,e),this.type="catmullrom"}function Hc(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Vl.call(this,e),this.type="catmullrom"}Rl.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Rl.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(ru.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new fi,n=0,r=e.length;n<r;n++){var i=e[n];t.vertices.push(new kt(i.x,i.y,i.z||0))}return t}}),Object.assign(iu.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),jc.prototype=Object.create(Vl.prototype),Bc.prototype=Object.create(Vl.prototype),Hc.prototype=Object.create(Vl.prototype),Object.assign(Hc.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Lc.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Tc.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Du.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Iu.extractUrlBase(e)}}),Object.assign(_c.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Ht.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Vi.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Lt,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Lt.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Lt.ceilPowerOfTwo(e)}}),Object.assign(Nt.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Dt.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new kt),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,i,o)}}),qt.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},It.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(Fi.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(zi.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(zi,{barycoordFromPoint:function(e,t,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),zi.getBarycoord(e,t,n,r,i)},normal:function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),zi.getNormal(e,t,n,r)}}),Object.assign(ou.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Ba(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Ka(this,e)}}),Object.assign(Ot.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(kt.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(zt.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(fi.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}}),Object.assign(ui.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")}}),Object.defineProperties(ui.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(Ls.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Os.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Object.defineProperty(Rl.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),_s.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(su.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(mi.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")}}),Object.assign(Ci.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(Ci.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.assign(Ha.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(cc.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Ii.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new ni}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===v}}}),Object.defineProperties(fl.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Ni.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(Es.prototype,{getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}}),Object.defineProperties(Es.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(gs.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Ut.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(Ss.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}}}),Qu.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this,n=new Xu;return n.load(e,(function(e){t.setBuffer(e)})),this},ec.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Zu.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};const Gc=1e-6;function qc(e){return Math.abs(e)<Gc}function Wc(e,t,n){return new kt(e,t,n)}function $c(e){return e.clone()}function Xc(e,t){let n=Wc(e.x,e.y,e.z);return n.multiplyScalar(t),n}function Yc(e){return Xc(e,1/e.length())}function Zc(e,t){return Wc(e.x-t.x,e.y-t.y,e.z-t.z)}function Jc(e,t){return Wc(t.x+e.x,t.y+e.y,t.z+e.z)}function Qc(e,t){let n,r=t.length();if(qc(r))n=Wc(e.x,e.y,e.z);else{let i=th(e,t)/r/r;n=Xc(t,i)}return n}function Kc(e,t){return Zc(e,Qc(e,t))}function eh(e,t){return(new kt).crossVectors(e,t)}function th(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}function nh(e,t){return Zc(e,t).length()}function rh(e,t){let n=e.length(),r=t.length();if(qc(n*r))return 0;let i=th(e,t)/n/r;return i>=1?0:i<-1?Math.PI:Math.acos(i)}function ih(e,t,n){let r=Kc(e,t),i=Kc(n,t),o=rh(r,i),s=eh(r,i);return th(s,t)>0&&(o=-o),o}function oh(e,t){let n=Jc(e,t);return Xc(n,.5)}function sh(){return Wc(Math.random(),Math.random(),Math.random())}function ah(e,t){return!!qc(e.x-t.x)&&(!!qc(e.y-t.y)&&!!qc(e.y-t.y))}function lh(e,t){return qc(rh(e,t))}let uh=Dt;function ch(e,t){let n=new uh;return n.multiplyMatrices(e,t),n}function hh(e,t){let n=e.clone().normalize();return(new uh).makeRotationAxis(n,t)}function dh(e){let t=new uh;return t.makeTranslation(e.x,e.y,e.z)}function ph(e){return e*Math.PI/180}var fh={SMALL:Gc,isNearZero:qc,create:Wc,clone:$c,scaled:Xc,normalized:Yc,diff:Zc,sum:Jc,parallel:Qc,perpendicular:Kc,crossProduct:eh,dotProduct:th,distance:nh,angle:rh,dihedral:ih,midPoint:oh,random:sh,isEqual:ah,isAligned:lh,Matrix4:uh,matrixProduct:ch,rotation:hh,translation:dh,degToRad:ph};function mh(e){return!s.a.isNil(e)}function gh(e,t,n){return i()("<span>").html(e).addClass(t).on("click touch",(function(e){e.preventDefault(),n()}))}function vh(e,t,n,r){t.css({position:"absolute","z-index":"2"});let i=e.position().top,o=e.position().left;i=0,o=0;let s=e.outerWidth(),a=e.outerHeight();e.prepend(t);let l=t.outerWidth(),u=t.outerHeight();t.css({top:i+a/2-u/2-r,left:o+s/2-l/2-n})}function yh(e,t){return t.indexOf(e)>=0}function xh(e){let t="0123456789abcdefghiklmnopqrstuvwxyz",n="";for(let r=0;r<e;r++){let e=Math.floor(Math.random()*t.length);n+=t.substring(e,e+1)}return n}function bh(){return"view:"+xh(6)}function wh(e,t,n){function r(){h.remove(),window.keyboardLock=!1}function o(){n(u.val()),r(),window.keyboardLock=!1}function s(){r(),window.keyboardLock=!1}t||(t=""),window.keyboardLock=!0;let a=gh("okay","jolecule-small-button",o),l=gh("discard","jolecule-small-button",s),u=i()("<textarea>").css("width","100%").css("margin-bottom","0.5em").addClass("jolecule-view-text").keydown((function(e){if(27===e.keyCode)return s(),!0})),c=i()("<div>").css("width","100%").append(t).append(u).append(a).append(" ").append(l),h=i()("<div>").addClass("jolecule-dialog").css("display","block").css("z-index","2000").css("width",Math.min(400,e.width()-100)).append(c);vh(e,h,0,20),setTimeout(()=>{c.find("textarea").focus()},100)}function _h(e){return new Promise(t=>{setTimeout(t,e)})}function Ah(e){let t=document.createElement("textarea");t.style.position="fixed",t.style.top=0,t.style.left=0,t.style.width="2em",t.style.height="2em",t.style.padding=0,t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent",t.value=e,document.body.appendChild(t),t.select();try{let e=document.execCommand("copy"),t=e?"successful":"unsuccessful";console.log("> copyTextToClipboard",t)}catch(n){console.log("> copyTextToClipboard failed")}document.body.removeChild(t)}function Sh(e,t,n,r,i){let o=.5*(r-t),s=.5*(i-n),a=e*e,l=e*a;return(2*n-2*r+o+s)*l+(-3*n+3*r-2*o-s)*a+o*e+n}function Eh(e,t,n,r,i){return fh.create(Sh(e,t.x,n.x,r.x,i.x),Sh(e,t.y,n.y,r.y,i.y),Sh(e,t.z,n.z,r.z,i.z))}class Mh{constructor(){this.points=[],this.normals=[],this.tangents=[],this.binormals=[],this.colors=[],this.indexColors=[],this.segmentTypes=[],this.refIndices=[]}slice(e,t){let n=new Mh;return n.points=this.points.slice(e,t),n.normals=this.normals.slice(e,t),n.tangents=this.tangents.slice(e,t),n.binormals=this.binormals.slice(e,t),n}}function Th(e,t,n,r){let i=new Mh;i.points.push(e.points[n]);for(let o=n;o<r-1;o+=1){let n=1,r=t+1;for(let s=n;s<r;s+=1){let n,r,a=s/t;n=o>0?e.points[o-1]:e.points[o].clone().sub(e.tangents[o]),r=o<e.points.length-2?e.points[o+2]:e.points[o+1].clone().add(e.tangents[o]),i.points.push(Eh(a,n,e.points[o],e.points[o+1],r))}}i.normals.push(e.normals[n]);for(let o=n;o<r-1;o+=1)for(let n=1;n<t+1;n+=1){let r,s,a=n/t;r=o>0?e.normals[o-1]:e.normals[o],s=o<e.normals.length-2?e.normals[o+2]:e.normals[o+1],i.normals.push(Eh(a,r,e.normals[o],e.normals[o+1],s).normalize())}for(let o=0;o<i.points.length;o+=1)0===o?i.tangents.push(e.tangents[0]):o===i.points.length-1?i.tangents.push(e.tangents[r-1]):i.tangents.push(i.points[o+1].clone().sub(i.points[o-1]).normalize());for(let o=0;o<i.points.length;o+=1)i.binormals.push(fh.create().crossVectors(i.tangents[o],i.normals[o]));return i}class Ch extends Mh{constructor(){super(),this.indices=[],this.detail=4}getReference(e){let t=this.indices[e];return this.referenceObjects[t]}calcTangents(){let e=0,t=this.points.length,n=t-1;if(t-e>2){this.tangents[e]=this.points[e+1].clone().sub(this.points[e]).normalize();for(let t=e+1;t<n;t+=1)this.tangents[t]=this.points[t+1].clone().sub(this.points[t-1]).normalize();this.tangents[n]=this.points[n].clone().sub(this.points[n-1]).normalize()}else{let t=this.points[n].clone().sub(this.points[e]).normalize();this.tangents[e]=t,this.tangents[n]=t}}calcNormals(){let e=0,t=this.points.length,n=t-1;if(t-e>2){for(let t=e+1;t<n;t+=1)if(null!==this.normals[t])this.normals[t]=Ih(this.tangents[t],this.normals[t]),this.normals[t].normalize();else{let e=this.points[t].clone().sub(this.points[t-1]);this.normals[t]=fh.create().crossVectors(e,this.tangents[t]).normalize();let n=this.normals[t-1];null!==n&&this.normals[t].dot(n)<0&&this.normals[t].negate()}this.normals[e]=this.normals[e+1],this.normals[n]=this.normals[n-1]}else for(let r=e;r<=n;r+=1)if(null!==this.normals[r])this.normals[r]=Ih(this.tangents[r],this.normals[r]),this.normals[r].normalize();else{let e=this.points[r];this.normals[r]=fh.create().crossVectors(e,this.tangents[r]).normalize()}}calcBinormals(){let e=0,t=this.points.length;for(let n=e;n<t;n+=1)this.binormals[n]=fh.create().crossVectors(this.tangents[n],this.normals[n])}expand(){this.detailedPath=Th(this,2*this.detail,0,this.points.length)}getGeometry(e,t,n,r,i){let o=this.detailedPath,s=0,a=this.points.length,l=2*s*this.detail-this.detail;l<0&&(l=0);let u=2*a*this.detail-this.detail+1;u>=o.points.length&&(u=o.points.length-1);let c=o.slice(l,u),h=new Ph(this,c,t,n,r,i);return h}}class Ph extends Ci{constructor(e,t,n=!1){super(),this.type="BufferRibbonGeometry",this.parameters={shape:t,traces:e,isIndexColor:n},this.shapePoints=t.extractPoints(4).shape,this.nShape=this.shapePoints.length,this.nVertex=0,this.nFace=0,this.countVertexAndFacesOfPath(),this.setAttributes(),this.build(),this.setColors()}countVertexAndFacesOfPath(){this.nVertex=0,this.nFace=0,this.paths=[];for(let e of this.parameters.traces){let t=e.detailedPath;this.paths.push(t);let n=t.points.length;this.nVertex+=(n+e.points.length-1)*this.nShape,this.nVertex+=this.nShape,this.nVertex+=this.nShape;let r=e.points.length;this.nFace+=2*(r-1)*this.nShape*(2*e.detail+1),this.nFace+=this.nShape-2,this.nFace+=this.nShape-2,this.nVertex=3*this.nFace}}build(){for(let r of s.a.range(this.paths.length)){let i=this.paths[r],o=this.parameters.traces[r],a=0,l=o.points.length;function e(e){return"C"===o.segmentTypes[e]?.7:8}let u=null,c=null,h=null,d=null,p=!0;for(let r=a;r<l;r+=1){let f=2*r*o.detail-o.detail;f<0&&(f=0);let m=2*(r+1)*o.detail-o.detail+1;m>=i.points.length&&(m=i.points.length);for(let g=f;g<m;g+=1){let v=e(r),y=.7;if(g===f&&g>0&&"C"===o.segmentTypes[r-1]&&"C"!==o.segmentTypes[r]&&(v=e(r-1)),g===m-1&&r<o.points.length-1){let t=r+1;"C"===o.segmentTypes[t]&&"C"!==o.segmentTypes[r]&&(v=e(t))}p="C"!==o.segmentTypes[r];let x=i.points[g],b=i.normals[g],w=i.binormals[g],_=s.a.cloneDeep(this.shapePoints);for(let e of _)e.x=e.x*v,e.y=e.y*y;u=[];for(let e of _){let t=b.clone().multiplyScalar(e.x),n=w.clone().multiplyScalar(e.y),r=x.clone().add(t).add(n);u.push(r)}let A=0===g&&r===a;if(A){let e=_.length,t=e-1,n=kh([u[0],u[1],u[t]]);for(let r=0;r<e-2;r+=1)this.pushVerticesNormalsOfFace(u[r],u[r+1],u[t],n,n,n)}function t(e){let t,n,r=_.length,o=[],s=new Ot,a=new Ot,l=new Ot;for(let u=0;u<r;u+=1){let c=u>0?u-1:r-1,h=u+1<r?u+1:0,d=_[u];s.subVectors(d,_[c]).normalize(),a.subVectors(d,_[h]).normalize(),l.addVectors(s,a).normalize(),t=i.normals[e].clone().multiplyScalar(l.x),n=i.binormals[e].clone().multiplyScalar(l.y),o.push(t.add(n))}return o}function n(e){let t,n,r=_.length,o=[],s=new Ot;for(let a=0;a<r;a+=1){let l=a>0?a-1:r-1,u=_[a];s.subVectors(u,_[l]).normalize(),t=i.normals[e].clone().multiplyScalar(s.x),n=i.binormals[e].clone().multiplyScalar(s.y),o.push(t.add(n))}return o}if(h=p?n(g):t(g),0===g){d=h,c=u;continue}for(let e=0;e<this.nShape;e+=1){let t;t=0===e?this.nShape-1:e-1,p?(this.pushVerticesNormalsOfFace(c[t],u[t],u[e],d[t],h[t],h[t]),this.pushVerticesNormalsOfFace(c[e],c[t],u[e],d[t],d[t],h[t])):(this.pushVerticesNormalsOfFace(c[t],u[t],u[e],d[t],h[t],h[e]),this.pushVerticesNormalsOfFace(c[e],c[t],u[e],d[e],d[t],h[e]))}let S=g===m-1&&r===l-1;if(S){let e=_.length,t=e-1,n=kh([u[2],u[1],u[0]]);for(let r=0;r<e-2;r+=1)this.pushVerticesNormalsOfFace(u[t],u[r+1],u[r],n,n,n)}d=h,c=u}}}}setColors(){let e=0;for(let t of s.a.range(this.paths.length)){let n=this.paths[t],r=this.parameters.traces[t],i=0,o=r.points.length;for(let t=i;t<o;t+=1){let s=2*t*r.detail-r.detail;s<0&&(s=0);let a=2*(t+1)*r.detail-r.detail+1;a>=n.points.length&&(a=n.points.length);for(let n=s;n<a;n+=1){let s,l=this.shapePoints.length;s=this.parameters.isIndexColor?r.indexColors[t]:r.colors[t].clone();let u=0===n&&t===i;if(u)for(let t=0;t<3*(l-2);t+=1)this.setColor(e,s),e+=1;if(n>0)for(let t=0;t<6*l;t+=1)this.setColor(e,s),e+=1;let c=n===a-1&&t===o-1;if(c)for(let t=0;t<3*(l-2);t+=1)this.setColor(e,s),e+=1}}}this.attributes.color.needsUpdate=!0}setAttributes(){let e=new Float32Array(3*this.nVertex),t=new Float32Array(3*this.nVertex),n=new Int32Array(3*this.nFace),r=new Float32Array(3*this.nVertex);this.addAttribute("position",new Ai(e,3)),this.addAttribute("normal",new Ai(t,3)),this.addAttribute("color",new Ai(r,3)),this.setIndex(new _i(n,1)),this.positions=this.attributes.position.array,this.normals=this.attributes.normal.array,this.indices=this.index.array,this.colors=this.attributes.color.array,this.positionCount=0,this.indexCount=0,this.vertexCount=0}setColor(e,t){let n=3*e;this.colors[n]=t.r,this.colors[n+1]=t.g,this.colors[n+2]=t.b}pushVertex(e){this.positions[this.positionCount]=e.x,this.positions[this.positionCount+1]=e.y,this.positions[this.positionCount+2]=e.z,this.positionCount+=3,this.vertexCount+=1}pushVerticesNormalsOfFace(e,t,n,r,i,o){this.pushVertex(e),this.pushVertex(t),this.pushVertex(n);let s=this.indexCount;this.indices[this.indexCount]=s,this.indices[this.indexCount+1]=s+1,this.indices[this.indexCount+2]=s+2,this.indexCount+=3;let a=s+1,l=s+2;this.normals[3*s]=r.x,this.normals[3*s+1]=r.y,this.normals[3*s+2]=r.z,this.normals[3*a]=i.x,this.normals[3*a+1]=i.y,this.normals[3*a+2]=i.z,this.normals[3*l]=o.x,this.normals[3*l+1]=o.y,this.normals[3*l+2]=o.z}getVertex(e){return fh.create(this.positions[3*e],this.positions[3*e+1],this.positions[3*e+2])}}class Rh extends Ci{constructor(e,t,n){super(),this.type="BufferRaisedShapesGeometry",this.parameters={verticesList:e,thickness:n,colorList:t},this.nVertex=0,this.nFace=0,this.countVertexAndFacesOfPath(),this.setAttributes(),this.setPath()}countVertexAndFacesOfPath(e,t){this.nVertex=0,this.nFace=0;for(let n of this.parameters.verticesList){let e=n.length;this.nFace+=e-2,this.nFace+=e-2,this.nFace+=2*e}this.nVertex=3*this.nFace}setPath(){for(let[e,t]of this.parameters.verticesList.entries()){let n=kh(t.slice(0,3)),r=n.clone().multiplyScalar(this.parameters.thickness/2),i=this.parameters.colorList[e],o=t.length,s=o-1,a=[];for(let e=0;e<t.length;e+=1)a.push(t[e].clone().add(r));let l=[];for(let e=0;e<t.length;e+=1)l.push(t[e].clone().sub(r));for(let e=0;e<o-2;e+=1)this.pushVerticesOfFace(a[e],a[e+1],a[s],i);for(let e=0;e<o-2;e+=1)this.pushVerticesOfFace(l[e],l[s],l[e+1],i);for(let e=0;e<o;e+=1){let t=e===o-1?0:e+1;this.pushVerticesOfFace(a[e],l[e],l[t],i),this.pushVerticesOfFace(a[e],l[t],a[t],i)}}this.computeVertexNormals()}setColor(e,t){let n=3*e;this.colors[n]=t.r,this.colors[n+1]=t.g,this.colors[n+2]=t.b}recolor(e){this.parameters.colorList=e;let t=0;for(let[n,r]of this.parameters.verticesList.entries()){let e=this.parameters.colorList[n],i=r.length,o=6*(i-2)+6*i;for(let n=0;n<o;n+=1)this.setColor(t,e),t+=1}this.attributes.color.needsUpdate=!0}setAttributes(){let e=new Float32Array(3*this.nVertex),t=new Float32Array(3*this.nVertex),n=new Int32Array(3*this.nFace),r=new Float32Array(3*this.nVertex);this.addAttribute("position",new Ai(e,3)),this.addAttribute("normal",new Ai(t,3)),this.addAttribute("color",new Ai(r,3)),this.setIndex(new _i(n,1)),this.positions=this.attributes.position.array,this.normals=this.attributes.normal.array,this.indices=this.index.array,this.colors=this.attributes.color.array,this.positionCount=0,this.indexCount=0,this.vertexCount=0}pushVertex(e,t){this.positions[this.positionCount]=e.x,this.positions[this.positionCount+1]=e.y,this.positions[this.positionCount+2]=e.z,this.colors[this.positionCount]=t.r,this.colors[this.positionCount+1]=t.g,this.colors[this.positionCount+2]=t.b,this.positionCount+=3,this.vertexCount+=1}pushVerticesOfFace(e,t,n,r){this.pushVertex(e,r),this.pushVertex(t,r),this.pushVertex(n,r);let i=this.indexCount;this.indices[this.indexCount]=i,this.indices[this.indexCount+1]=i+1,this.indices[this.indexCount+2]=i+2,this.indexCount+=3}getVertex(e){return fh.create(this.positions[3*e],this.positions[3*e+1],this.positions[3*e+2])}}class Lh extends Ba{constructor(){let e=new ou([new Ot(-.25,-.5),new Ot(0,.5),new Ot(.25,-.5)]),t=new Vl([fh.create(0,-.2,0),fh.create(0,.2,0)]);super(e,{steps:2,bevelEnabled:!1,extrudePath:t}),this.type="BlockArrowGeometry",this.applyMatrix((new Dt).makeRotationFromEuler(new si(0,Math.PI/2,0)))}}function Oh(e,t){s.a.isUndefined(e)||e.traverse((function(e){e.visible=t}))}function Dh(e){let t=e.children.length-1;for(let n=t;n>=0;n-=1){let t=e.children[n];s.a.isUndefined(t.dontDelete)&&(s.a.isUndefined(t.geometry)||t.geometry.dispose(),s.a.isUndefined(t.material)||t.material.dispose(),e.remove(t))}}function Ih(e,t){let n=e.clone().multiplyScalar(t.dot(e));return t.clone().sub(n)}function kh(e){let t=new kt,n=new kt;return t.subVectors(e[2],e[1]),n.subVectors(e[0],e[1]),t.cross(n),t.normalize(),t}function Nh(e,t){return(new It).setFromUnitVectors(e,t)}function Fh(e,t,n){return n*(t-e)+e}function Vh(e,t){let n=new It;return n.slerp(e,t)}function zh(e,t){let n=new ui;return n.matrix.identity(),n.position.copy(e),n.scale.set(t,t,t),n.updateMatrix(),n.matrix}function Uh(e,t){s.a.isUndefined(t)&&(t=4);let n=new il(e,e,1,t,1,!1);return n.applyMatrix((new Dt).makeRotationFromEuler(new si(Math.PI/2,Math.PI,0))),n}function jh(e,t,n){let r=new ui;return r.scale.set(n,n,e.distanceTo(t)),r.position.copy(e).add(t).multiplyScalar(.5),r.lookAt(t),r.updateMatrix(),r.matrix}function Bh(e,t,n,r){let i=e.elements;for(let o=n;o<r;o+=3){let e=t[o],n=t[o+1],r=t[o+2];t[o]=i[0]*e+i[4]*n+i[8]*r+i[12],t[o+1]=i[1]*e+i[5]*n+i[9]*r+i[13],t[o+2]=i[2]*e+i[6]*n+i[10]*r+i[14]}}function Hh(e,t,n,r){let i=e.elements;for(let o=n;o<r;o+=3){let e=t[o],n=t[o+1],r=t[o+2];t[o]=i[0]*e+i[4]*n+i[8]*r,t[o+1]=i[1]*e+i[5]*n+i[9]*r,t[o+2]=i[2]*e+i[6]*n+i[10]*r}}function Gh(e,t){let n=e.length,r=new Float32Array(n*t);for(let i=0;i<t;i+=1){let t=i*n;for(let i=0;i<n;i+=1)r[t+i]=e[i]}return r}function qh(e,t,n,r){for(let i=n;i<r;i+=3)t[i]=e.r,t[i+1]=e.g,t[i+2]=e.b}function Wh(e,t,n){let r=e.length,i=new Uint32Array(r*t);for(let o=0;o<t;o+=1){let t=o*r,s=o*n;for(let n=0;n<r;n+=1)i[t+n]=e[n]+s}return i}class $h extends Ci{constructor(e,t){super(),this.type="CopyBufferGeometry",this.parameters={nCopy:t},this.refBufferGeometry=e;let n=Gh(e.attributes.position.array,t);this.addAttribute("position",new Ai(n,3));let r=Gh(e.attributes.normal.array,t);this.addAttribute("normal",new Ai(r,3));let i=Gh(e.attributes.uv.array,t);this.addAttribute("uv",new Ai(i,2));let o=e.attributes.position.count;if("index"in e&&e.index){let n=Wh(e.index.array,t,o);this.setIndex(new _i(n,1))}let s=new Float32Array(3*o*t);this.addAttribute("color",new Ai(s,3))}applyMatrixToCopy(e,t){let n=this.refBufferGeometry.attributes.position.array.length,r=this.attributes.position.array,i=this.attributes.normal.array,o=t*n,s=o+n;Bh(e,r,o,s),Hh(e,i,o,s)}applyColorToCopy(e,t){let n=this.refBufferGeometry.attributes.position.array.length,r=this.attributes.color.array,i=t*n,o=i+n;qh(e,r,i,o)}}class Xh{constructor(){this.id="view:000000",this.iAtom=-1,this.order=1,this.cameraParams={focus:fh.create(0,0,0),position:fh.create(0,0,-1),up:fh.create(0,1,0),zFront:0,zBack:0,zoom:1},this.selected=[],this.labels=[],this.distances=[],this.selectedTraces=[],this.text="Default view of PDB file",this.userId="",this.pdbId="",this.show={sidechain:!0,peptide:!0,hydrogen:!1,water:!1,ligands:!0,trace:!0,backbone:!1,ribbon:!0,sphere:!1,transparent:!1},this.grid={isElem:{},bCutoff:null,isChanged:!1},this.lock=!1,this.creator="public"}setCamera(e){this.cameraParams=e}getViewTranslatedTo(e){let t=this.clone(),n=e.clone().sub(t.cameraParams.focus);return t.cameraParams.focus.copy(e),t.cameraParams.position.add(n),t}clone(){let e=new Xh;return e.id=this.id,e.pdbId=this.pdbId,e.iAtom=this.iAtom,e.selected=this.selected,e.selectedTraces=s.a.cloneDeep(this.selectedTraces),e.labels=s.a.cloneDeep(this.labels),e.distances=s.a.cloneDeep(this.distances),e.order=this.order,e.text=this.text,e.time=this.time,e.cameraParams=s.a.cloneDeep(this.cameraParams),e.show=s.a.cloneDeep(this.show),e.grid=s.a.cloneDeep(this.grid),e.lock=this.lock,e.creator=this.creator,e}getDict(){let e=this.cameraParams.focus.clone().sub(this.cameraParams.position),t=e.length();e.normalize();let n=this.cameraParams.focus,r=n.clone().add(e),i=n.clone().sub(this.cameraParams.up),o=s.a.clone(this.show);return o.all_atom=o.backbone,delete o.backbone,{version:2,view_id:this.id,user_id:this.userId,pdb_id:this.pdbId,order:this.order,show:o,grid:s.a.cloneDeep(this.grid),text:this.text,i_atom:this.iAtom,labels:this.labels,selected:this.selected,selected_traces:this.selectedTraces,distances:this.distances,camera:{slab:{z_front:this.cameraParams.zFront,z_back:this.cameraParams.zBack,zoom:t},pos:[n.x,n.y,n.z],up:[i.x,i.y,i.z],in:[r.x,r.y,r.z]},lock:this.lock,creator:this.creator}}setFromDict(e){this.id=e.view_id,this.pdbId=e.pdb_id,this.lock=e.lock,this.creator=e.creator,this.text=e.text,this.userId=e.user_id,this.order=e.order,this.resId=e.resId,this.iAtom=e.i_atom,this.labels=e.labels,this.selected=e.selected,this.distances=e.distances;for(let c of s.a.keys(e.show))c in this.show&&(this.show[c]=!!e.show[c]),"all_atom"===c&&(this.show.backbone=!!e.show.all_atom);this.show.backbone||this.show.trace||this.show.ribbon||(this.show.ribbon=!0),this.show.all_atom||this.show.trace||this.show.ribbon||(this.show.backbone=!0),"grid"in e&&(this.grid=e.grid),"selected_traces"in e&&(this.selectedTraces=s.a.cloneDeep(e["selected_traces"]));let t=fh.create(e.camera.pos[0],e.camera.pos[1],e.camera.pos[2]),n=fh.create(e.camera.up[0],e.camera.up[1],e.camera.up[2]),r=fh.create(e.camera.in[0],e.camera.in[1],e.camera.in[2]),i=e.camera.slab.zoom,o=fh.clone(t),a=fh.clone(r).sub(o).multiplyScalar(i).negate(),l=fh.clone(o).add(a),u=fh.clone(n).sub(o).negate();this.cameraParams={focus:o,position:l,up:u,zFront:e.camera.slab.z_front,zBack:e.camera.slab.z_back,zoom:i}}}function Yh(e,t,n){let r=e.position.clone().sub(e.focus),i=r.length();r.normalize();let o=t.position.clone().sub(t.focus),s=o.length();o.normalize();let a=Nh(r,o),l=e.up.clone().applyQuaternion(a),u=Nh(l,t.up).multiply(a),c=Vh(u,n),h=t.focus.clone().sub(e.focus).multiplyScalar(n),d=e.focus.clone().add(h),p=Fh(i,s,n),f=r.clone().applyQuaternion(c).multiplyScalar(p);return{focus:d,position:d.clone().add(f),up:e.up.clone().applyQuaternion(c),zFront:Fh(e.zFront,t.zFront,n),zBack:Fh(e.zBack,t.zBack,n),zoom:p}}class Zh{constructor(e){this.soup=e,this.isChanged=!0,this.isUpdateSidechain=!1,this.isUpdateColors=!1,this.isStartTargetAfterRender=!1,this.isUpdateObservers=!0,this.currentView=new Xh,this.savedViewsByViewId={},this.savedViews=[],this.iLastViewSelected=0,this.animateState="none",this.targetView=null,this.nUpdateStep=-1,this.maxUpdateStep=70,this.msPerStep=17,this.mode="normal"}build(){0!==this.savedViews.length||this.soup.isEmpty()||this.setCurrentViewToDefaultAndSave(),this.saveGridToCurrentView()}getMode(){return this.mode}setMode(e){this.mode=e}saveGridToCurrentView(){for(let e in this.soup.grid.isElem)e in this.soup.grid.isElem&&(this.currentView.grid.isElem[e]=this.soup.grid.isElem[e]);mh(this.soup.grid.bCutoff)&&(this.currentView.grid.bCutoff=this.soup.grid.bCutoff)}setCurrentViewToDefaultAndSave(){this.currentView.show.sidechain=!1,this.currentView.order=0,this.currentView.text=this.soup.title,this.currentView.pdbId=this.soup.structureIds[0],this.currentView=this.getZoomedOutViewOfCurrentView(),this.saveView(this.currentView),this.isChanged=!0}setTargetView(e){this.isStartTargetAfterRender=!0,this.saveTargetView=e.clone(),this.saveTargetView.iAtom=this.soup.getIAtomAtPosition(e.cameraParams.focus)}startTargetView(){this.targetView=this.saveTargetView,this.saveTargetView=null,this.isUpdateObservers=!0,this.isStartTargetAfterRender=!1,this.isChanged=!0}getICenteredAtom(){return this.currentView.iAtom}getIViewFromViewId(e){for(let t=0;t<this.savedViews.length;t+=1)if(this.savedViews[t].id===e)return t;return-1}insertView(e,t,n){this.savedViewsByViewId[t]=n,e>=this.savedViews.length?this.savedViews.push(n):this.savedViews.splice(e,0,n),this.iLastViewSelected=e;for(let r=0;r<this.savedViews.length;r++)this.savedViews[r].order=r}removeView(e){let t=this.getIViewFromViewId(e);if(!(t<0)){this.savedViews.splice(t,1),delete this.savedViewsByViewId[e];for(let e=0;e<this.savedViews.length;e++)this.savedViews[e].order=e;this.iLastViewSelected>=this.savedViews.length&&(this.iLastViewSelected=this.savedViews.length-1),this.isChanged=!0}}saveView(e){this.savedViewsByViewId[e.id]=e,this.savedViews.push(e)}getZoomedOutViewOf(e){let t=this.soup.calcMaxLength(),n=this.currentView.clone();if(0===t)return n;let r=n.cameraParams;r.zFront=-t/2,r.zBack=t/2,r.zoom=1.75*Math.abs(t);let i=this.soup.getCenter(e),o=r.position.clone().sub(r.focus).normalize();return r.focus.copy(i),r.position=r.focus.clone().add(o.multiplyScalar(r.zoom)),n.iAtom=this.soup.getIAtomAtPosition(i),n.selectedTraces.length=0,n}getZoomedOutViewOfCurrentView(){let e=s.a.range(this.soup.getAtomCount());return this.getZoomedOutViewOf(e)}setTargetViewByViewId(e){let t=this.savedViewsByViewId[e];this.iLastViewSelected=this.savedViewsByViewId[e].order,this.setTargetView(t)}getTracesOfChainContainingResidue(e){let t=[],n=this.soup.getResidueProxy(e),r=n.chain,i=n.iStructure;for(let[o,s]of this.soup.traces.entries())n.load(s.indices[0]),n.chain===r&&n.iStructure===i&&t.push(o);return t}setTargetViewByIAtom(e){let t=this.soup.getAtomProxy(e),n=this.currentView.getViewTranslatedTo(t.pos);n.iAtom=this.soup.getIAtomAtPosition(n.cameraParams.focus),n.selectedTraces=this.getTracesOfChainContainingResidue(t.iRes),this.setTargetView(n)}getZoomedOutViewOfSelection(){let e=this.currentView.clone(),t=[],n=this.soup.getResidueProxy();for(let l of s.a.range(this.soup.getResidueCount()))n.load(l),n.selected&&t.push(n.iAtom);let r=this.soup.getCenter(t),i=this.soup.calcMaxLength(t);if(0===i)return e;let o=e.cameraParams;o.zFront=-i/2,o.zBack=i/2,o.zoom=1.2*Math.abs(i);let a=o.position.clone().sub(o.focus).normalize();return o.focus.copy(r),o.position=o.focus.clone().add(a.multiplyScalar(o.zoom)),e.iAtom=this.soup.getIAtomAtPosition(r),e}saveCurrentView(){let e=this.currentView.clone();e.id=bh(),e.text="Click edit to change this text.",e.pdbId=this.soup.structureIds[0],e.selected=this.soup.makeSelectedResidueList(),e.selectedTraces=s.a.cloneDeep(this.soup.selectedTraces);let t=this.iLastViewSelected+1;return this.insertView(t,e.id,e),this.setTargetViewByViewId(e.id),this.isChanged=!0,this.isUpdateColors=!0,console.log("Soupview.saveCurrentView",e),e.id}setCurrentView(e){let t=this.currentView.selected;this.currentView=e.clone(),this.soup.selectedTraces=s.a.cloneDeep(e.selectedTraces),s.a.isEqual(t.sort(),e.selected.sort())||(this.soup.clearSidechainResidues(),this.soup.setSidechainOfResidues(e.selected,!0),this.isUpdateSidechain=!0);for(let n in e.grid.isElem)n in this.soup.grid.isElem&&e.grid.isElem[n]!==this.soup.grid.isElem[n]&&(this.soup.grid.isElem[n]=e.grid.isElem[n],this.isUpdateObservers=!0,this.soup.grid.isChanged=!0);s.a.isNil(e.grid.bCutoff)||this.soup.grid.bCutoff!==e.grid.bCutoff&&(this.soup.grid.bCutoff=e.grid.bCutoff,this.isUpdateObservers=!0,this.soup.grid.isChanged=!0),this.isChanged=!0}setTargetToPrevView(){if(0===this.savedViews.length)return"";this.iLastViewSelected-=1,this.iLastViewSelected<0&&(this.iLastViewSelected=this.savedViews.length-1);let e=this.savedViews[this.iLastViewSelected].id;return this.setTargetViewByViewId(e),e}setTargetToNextView(){if(0===this.savedViews.length)return"";this.iLastViewSelected+=1,this.iLastViewSelected>=this.savedViews.length&&(this.iLastViewSelected=0);let e=this.savedViews[this.iLastViewSelected].id;return this.setTargetViewByViewId(e),e}setTargetToPrevResidue(){let e=s.a.get(this.targetView,"iAtom");e=mh(e)?this.targetView.iAtom:this.currentView.iAtom,e<0&&(e=0);let t=this.soup.getAtomProxy(e).iRes;t<=0?t=this.soup.getResidueCount()-1:t-=1,e=this.soup.getResidueProxy(t).iAtom,this.setTargetViewByIAtom(e)}setTargetToNextResidue(){let e=s.a.get(this.targetView,"iAtom");e=mh(e)?this.targetView.iAtom:this.currentView.iAtom,e<0&&(e=0);let t=this.soup.getAtomProxy(e).iRes;t>=this.soup.getResidueCount()-1?t=0:t+=1,e=this.soup.getResidueProxy(t).iAtom,this.setTargetViewByIAtom(e)}adjustCamera(e,t,n,r){let i=this.currentView.cameraParams,o=i.up,s=i.position.clone().sub(i.focus).normalize(),a=fh.create().crossVectors(o,s).normalize(),l=(new It).setFromAxisAngle(s,n),u=(new It).setFromAxisAngle(o,-t),c=(new It).setFromAxisAngle(a,-e),h=(new It).multiply(l).multiply(u).multiply(c),d=r*i.zoom;d<2&&(d=2),d>1e3&&(d=1e3);let p=i.position.clone().sub(i.focus).applyQuaternion(h).normalize().multiplyScalar(d).add(i.focus),f=this.currentView.clone();f.cameraParams.focus=i.focus.clone(),f.cameraParams.position=p,f.cameraParams.up=i.up.clone().applyQuaternion(h),f.cameraParams.zoom=d,this.setCurrentView(f)}setCurrentViewToTargetView(){this.setCurrentView(this.targetView),"chain"===this.getMode()&&(this.currentView.show.transparent=!0),this.targetView=null,this.isUpdateColors=!0,this.isUpdateObservers=!0,this.isChanged=!0,this.targetView=null}scalingFunction(e,t,n,r){return(n-r)/2*(Math.sin(2*Math.PI/t*e-.5*Math.PI)+1)+r}animate(e){if(this.nUpdateStep-=e/this.msPerStep,this.nUpdateStep<0){if(null!==this.targetView)this.setCurrentViewToTargetView(),this.nUpdateStep=this.maxUpdateStep;else if(this.isStartTargetAfterRender)this.isChanged=!0;else if("loop"===this.animateState)this.nUpdateStep<-this.maxWaitStep&&this.setTargetToNextView();else if("rotate"===this.animateState)this.adjustCamera(0,.002,0,1);else if("rock"===this.animateState){let e=18,t=this.scalingFunction(-this.nUpdateStep-e,2*e,4,1),n=.001,r=n*t;this.nUpdateStep>-e?this.adjustCamera(0,r,0,1):this.nUpdateStep>-3*e?this.adjustCamera(0,-r,0,1):this.nUpdateStep>-4*e?this.adjustCamera(0,+r,0,1):this.nUpdateStep=0}}else if(this.nUpdateStep>0&&null!=this.targetView){let e=this.currentView.clone(),t=this.nUpdateStep,n=this.scalingFunction(t,this.maxUpdateStep,4,1),r=1/t*n;r>1&&(r=1),e.setCamera(Yh(this.currentView.cameraParams,this.targetView.cameraParams,r)),this.setCurrentView(e)}}}class Jh{constructor(e){this.soup=e.soup,this.soupView=e,this.iResLastSelected=null}deleteDistance(e){this.soupView.currentView.distances.splice(e,1),this.soupView.isChanged=!0}makeDistance(e,t){this.soupView.currentView.distances.push({i_atom1:e,i_atom2:t}),this.soupView.isChanged=!0}makeAtomLabel(e,t){this.soupView.currentView.labels.push({i_atom:e,text:t}),this.soupView.isChanged=!0}deleteAtomLabel(e){this.soupView.currentView.labels.splice(e,1),this.soupView.isChanged=!0}setTargetView(e){this.soupView.setTargetView(e)}setTargetViewByViewId(e){this.soupView.setTargetViewByViewId(e)}setTargetViewByIAtom(e){this.soupView.setTargetViewByIAtom(e)}setTargetToPrevResidue(){let e=null,t=this.soup.getResidueProxy();for(let n=0;n<this.soup.getResidueCount();n+=1)if(t.load(n).selected){e=n;break}null!==e?(e>0?e-=1:e=this.soup.getResidueCount-1,t.load(e),this.clearSelectedResidues(),this.setTargetViewByIAtom(t.iAtom)):this.soupView.setTargetToPrevResidue()}setTargetToNextResidue(){let e=null,t=this.soup.getResidueProxy(),n=this.soup.getResidueCount();for(let r=n-1;r>0;r-=1)if(t.load(r).selected){e=r;break}null!==e?(e<n-1?e+=1:e=0,t.load(e),this.clearSelectedResidues(),this.setTargetViewByIAtom(t.iAtom)):this.soupView.setTargetToNextResidue()}selectPrevResidue(e=!0){let t=null,n=this.soup.getResidueProxy();for(let r=0;r<this.soup.getResidueCount();r+=1)if(n.load(r).selected){t=r;break}if(null!==t)t>0?t-=1:t=this.soup.getResidueCount-1,e&&this.clearSelectedResidues(),this.selectResidue(t,!0);else{e&&this.clearSelectedResidues();let t=null;for(let e=this.soup.getResidueCount()-1;e>=0;e-=1)if(n.load(e).isPolymer){t=e;break}this.selectResidue(t,!0)}this.soupView.isUpdateSidechain=!0,this.soupView.isChanged=!0}selectNextResidue(e=!0){let t=null,n=this.soup.getResidueProxy(),r=this.soup.getResidueCount();for(let i=r-1;i>=0;i-=1)if(n.load(i).selected){t=i;break}if(console.log("Contreoller.selectNextResidue",t,e),null!==t)t<r-1?t+=1:t=0,e&&this.clearSelectedResidues(),this.selectResidue(t,!0);else{this.clearSelectedResidues();let e=null;for(let t=0;t<r-1;t+=1)if(n.load(t).isPolymer){e=t;break}this.selectResidue(e,!0)}this.soupView.isUpdateSidechain=!0,this.soupView.isChanged=!0}setTargetToPrevView(){return this.soupView.setTargetToPrevView()}setTargetToNextView(){return this.soupView.setTargetToNextView()}swapViews(e,t){this.soupView.savedViews[t].order=e,this.soupView.savedViews[e].order=t;let n=this.soupView.savedViews[t];this.soupView.savedViews[t]=this.soupView.savedViews[e],this.soupView.savedViews[e]=n}getViewDicts(){let e=[];for(let t=1;t<this.soupView.savedViews.length;t+=1)e.push(this.soupView.savedViews[t].getDict());return e}clearSidechainResidues(){this.soup.clearSidechainResidues(),this.soupView.currentView.selected=this.soup.makeSelectedResidueList(),this.soupView.isUpdateSidechain=!0,this.soupView.isChanged=!0}clearSelectedResidues(){this.soup.clearSelectedResidues(),this.soupView.currentView.selected=this.soup.makeSelectedResidueList(),this.soupView.isUpdateColors=!0,this.soupView.isChanged=!0}setResidueSelect(e,t){let n=this.soup.getResidueProxy(e);n.selected=t,this.soupView.isUpdateColors=!0,this.soupView.isChanged=!0}showAllSidechains(){let e=this.soup.getResidueProxy();for(let t of s.a.range(this.soup.getResidueCount()))e.load(t).sidechain=!0;this.soupView.isUpdateSidechain=!0,this.soupView.isChanged=!0}selectResidue(e,t){let n=this.soup.getResidueProxy(e);s.a.isUndefined(t)&&(t=!n.selected),this.setResidueSelect(e,t),this.iResLastSelected=t?e:null,this.soupView.isUpdateColors=!0,this.soupView.isChanged=!0}selectAllSidechains(e){for(let t=0;t<this.soup.getResidueCount();t+=1)this.setResidueSelect(t,e);this.iResLastSelected=null,this.soupView.isUpdateColors=!0,this.soupView.isChanged=!0}selectAdditionalResidue(e){let t=this.soup.getResidueProxy(e),n=!t.selected;this.setResidueSelect(e,n),this.iResLastSelected=n?e:null,this.soupView.isUpdateColors=!0,this.soupView.isChanged=!0}selectAdditionalRangeToResidue(e){let t=this.soup.getResidueProxy(e),n=!t.selected;if(null!==this.iResLastSelected){let n=this.soup.getResidueProxy(this.iResLastSelected);if(t.iStructure===n.iStructure){let t=Math.min(this.iResLastSelected,e),n=Math.max(this.iResLastSelected,e);for(let e=t;e<n+1;e+=1)this.setResidueSelect(e,!0)}}this.iResLastSelected=n?e:null,this.soupView.isUpdateColors=!0,this.soupView.isChanged=!0}getResListOfSs(e){let t=this.soup.getResidueProxy(e),n=t.ss,r=this.soup.getResidueCount(),i=[];for(let o=e;o>=0;o-=1){if(t.load(o),t.ss!==n)break;i.push(o)}for(let o=e+1;o<r;o+=1){if(t.load(o),t.ss!==n)break;i.push(o)}return i}selectSecondaryStructure(e,t=!0){this.clearSelectedResidues();let n=this.getResListOfSs(e),r=this.soup.getResidueProxy(e);for(let i of n)r.load(i).selected=t;this.soupView.isUpdateColors=!0,this.soupView.isChanged=!0}toggleSecondaryStructure(e){let t=this.getResListOfSs(e),n=this.soup.getResidueProxy(e),r=s.a.every(s.a.map(t,e=>!n.load(e).selected));r?this.selectSecondaryStructure(e,!0):this.selectSecondaryStructure(e,!1)}toggleSelectedSidechains(){let e=this.soup.getResidueProxy(),t=[],n=0,r=0,i=0;for(let o=0;o<this.soup.getResidueCount();o+=1)e.load(o),e.selected&&(n+=1,t.push(o),e.sidechain&&(r+=1)),e.sidechain&&(i+=1);if(0===n){let t=!0;i>0&&(t=!1);for(let n=0;n<this.soup.getResidueCount();n+=1)e.load(n),e.sidechain=t}else{let n=!0;r>0&&(n=!1);for(let r of t)e.load(r),e.sidechain=n}this.soupView.isUpdateSidechain=!0,this.soupView.isChanged=!0}toggleResidueNeighbors(){let e=[],t=0,n=this.soup.getResidueProxy();for(let o=0;o<this.soup.getResidueCount();o+=1)n.load(o),n.selected&&(e=s.a.concat(e,this.soup.getNeighbours(o)),t+=1);if(0===t){console.log("Controller.toggleResidueNeighbors none selected");let t=this.soupView.currentView.cameraParams.focus;e=this.soup.getNeighboursOfPoint(t)}if(0===e.length){let t=this.soupView.currentView.iAtom,n=this.soup.getAtomProxy(t).iRes;e=s.a.concat(e,this.soup.getNeighbours(n))}let r=0;for(let o of e)n.load(o).sidechain&&(r+=1);let i=r<e.length;this.soup.setSidechainOfResidues(e,i),this.soupView.currentView.selected=this.soup.makeSelectedResidueList(),this.soupView.isChanged=!0,this.soupView.isUpdateSidechain=!0}saveCurrentView(){return this.soupView.saveCurrentView()}deleteView(e){this.soupView.removeView(e)}sortViewsByOrder(){function e(e,t){return e.order-t.order}this.soupView.savedViews.sort(e);for(let t=0;t<this.soupView.savedViews.length;t+=1)this.soupView.savedViews[t].order=t}loadViewsFromViewDicts(e){for(let t=0;t<e.length;t+=1){let n=new Xh;n.setFromDict(e[t]),"view:000000"!==n.id&&this.soupView.saveView(n)}this.sortViewsByOrder()}async asyncLoadProteinData(e,t){await this.soup.asyncLoadProteinData(e,t),this.soupView.build(),this.soupView.isChanged=!0,this.soupView.isUpdateObservers=!0}selectChain(e,t){this.soup.selectedTraces.length=0,this.clearSelectedResidues();let n=null;for(let[r,i]of this.soup.traces.entries()){let o=i.indices[0],s=this.soup.getResidueProxy(o);s.iStructure===e&&s.chain===t&&(this.soup.selectedTraces.push(r),n=s.iAtom)}s.a.isNil(n)||this.zoomToChainContainingAtom(n)}setShowOption(e,t){console.log("Controller.setShowOption",e,t),this.soupView.currentView.show[e]=t,this.soupView.isUpdateObservers=!0,this.soupView.isChanged=!0}getShowOption(e){return this.soupView.currentView.show[e]}toggleShowOption(e){let t=this.getShowOption(e);this.setShowOption(e,!t)}setChangeFlag(){this.soupView.isChanged=!0}setZoom(e,t){let n=this.soupView.currentView.cameraParams;n.zBack=e,n.zFront=t,this.soupView.isUpdateObservers=!0,this.soupView.isChanged=!0}toggleGridElem(e){let t=this.soup.grid.isElem[e];this.soup.grid.isElem[e]=!t,this.soup.grid.isChanged=!0,this.soupView.currentView.grid.isElem=s.a.cloneDeep(this.soup.grid.isElem),this.soupView.isChanged=!0,this.soupView.isUpdateObservers=!0,this.soupView.isUpdateColors=!0}setGridCutoff(e){this.soup.grid.bCutoff=e,this.soup.grid.isChanged=!0,this.soupView.currentView.grid.bCutoff=e,mh(this.soupView.targetView)&&(this.soupView.targetView.grid.bCutoff=e),mh(this.soupView.saveTargetView)&&(this.soupView.saveTargetView.grid.bCutoff=e),this.soupView.isUpdateObservers=!0,this.soupView.isChanged=!0}clear(){let e=this.soupView.currentView.distances;for(let n of s.a.reverse(s.a.range(e.length)))this.deleteDistance(n);let t=this.soupView.currentView.labels;for(let n of s.a.reverse(s.a.range(t.length)))this.deleteAtomLabel(n);this.clearSidechainResidues(),this.clearSelectedResidues()}getAnimateState(){return this.soupView.animateState}setAnimateState(e){this.soupView.animateState=e,this.soupView.isUpdateObservers=!0,this.soupView.isChanged=!0}deleteStructure(e){let t=this.soup.getAtomProxy(),n=this.soup.getResidueProxy(),r=null,i=null,o=null,a=null,l=null,u=null;for(let s=0;s<this.soup.getAtomCount();s+=1)t.iAtom=s,n.iRes=t.iRes,n.iStructure===e&&(null===r&&(r=s),i=s+1,null===o&&(o=t.iRes),a=t.iRes+1);for(let w of s.a.range(this.soup.traces.length)){let e=this.soup.traces[w];for(let t of e.indices)c(t,o,a)&&(s.a.isNil(l)?(l=w,u=w+1):u=w+1)}function c(e,t,n){return e>=t&&e<n}function h(e,t,n){return e>=n?e-(n-t):e}function d(e){s.a.remove(e.selectedTraces,s.a.partial(c,l,u)),e.selectedTraces=s.a.map(e.selectedTraces,s.a.partial(h,l,u)),s.a.remove(e.distances,e=>c(e.i_atom1,r,i)||c(e.i_atom2,r,i));for(let t of e.distances)t.i_atom1=h(t.i_atom1,r,i),t.i_atom2=h(t.i_atom2,r,i);s.a.remove(e.selected,e=>c(e,o,a)),e.selected=s.a.map(e.selected,e=>h(e,o,a)),s.a.remove(e.labels,e=>c(e.iAtom,r,i));for(let t of e.labels)t.iAtom=h(t.iAtom,r,i)}s.a.remove(this.soup.selectedTraces,s.a.partial(c,l,u)),this.soup.selectedTraces=s.a.map(this.soup.selectedTraces,s.a.partial(h,l,u)),d(this.soupView.currentView);for(let s of this.soupView.savedViews)d(s);let p=i-r,f=this.soup.getAtomCount(),m=f-p,g=f-i,v=a-o,y=this.soup.getResidueCount(),x=y-v,b=y-a;this.soup.atomStore.copyWithin(r,i,g),this.soup.atomStore.count-=p;for(let s=0;s<m;s+=1)t.iAtom=s,t.iRes>=o&&(t.iRes-=v);for(let s=0;s<x;s+=1)if(s>=o){let e=s+v;e in this.soup.residueNormal&&(this.soup.residueNormal[s]=this.soup.residueNormal[e].clone())}for(let s=x;s<y;s+=1)delete this.soup.residueNormal[s];this.soup.residueStore.copyWithin(o,a,b),this.soup.residueStore.count-=v,this.soup.resIds.splice(o,v);for(let s=0;s<x;s+=1)n.iRes=s,n.iAtom>=r&&(n.iAtom-=p,t.iAtom=n.iAtom),this.soup.residueStore.atomOffset[s]>=r&&(this.soup.residueStore.atomOffset[s]-=p),n.iStructure>=e&&(n.iStructure-=1);if(this.soup.structureIds.splice(e,1),this.soup.iStructure-=1,this.soup.calcBondsStrategic(),this.soup.calculateTracesForRibbons(),this.soup.isEmpty()){this.soupView.savedViews.length=0;for(let e of s.a.keys(this.soupView.savedViewsByViewId))delete this.soupView.savedViewsByViewId[e];this.soupView.currentView=new Xh,this.soupView.targetView=null,this.soupView.isStartTargetAfterRender=!1,this.soupView.nUpdateStep=-1}else this.soupView.isUpdateSidechain=!0,this.soupView.isUpdateColors=!0;this.soupView.isUpdateObservers=!0,this.soupView.isChanged=!0}zoomOut(){this.soup.isEmpty()||(this.setTargetView(this.soupView.getZoomedOutViewOfCurrentView()),this.soupView.isChanged=!0)}zoomToChainContainingAtom(e){let t=this.soup.getAtomProxy(e),n=this.soup.getAtomsOfChainContainingResidue(t.iRes),r=this.soupView.getZoomedOutViewOf(n);r.selectedTraces=this.soupView.getTracesOfChainContainingResidue(t.iRes),this.setTargetView(r)}zoomToSelection(){this.soup.isEmpty()||(this.setTargetView(this.soupView.getZoomedOutViewOfSelection()),this.soupView.isChanged=!0)}adjustCamera(e,t,n,r){this.soupView.adjustCamera(e,t,n,r)}triggerAtom(e){if(s.a.isNil(e))this.clearSelectedResidues(),this.zoomOut();else{let t=this.soup.getAtomProxy(e),n=this.soup.getResidueProxy(t.iRes),r=n.chain,i=n.iStructure,o=!1;if("chain"===this.soupView.getMode()){if(this.soup.selectedTraces.length>0){let e=this.soup.selectedTraces[0],t=this.soup.traces[e].indices[0],n=this.soup.getResidueProxy(t);n.iStructure===i&&n.chain===r&&(o=!0)}if(!o)return this.clearSelectedResidues(),void this.zoomToChainContainingAtom(t.iAtom)}this.clearSelectedResidues(),this.selectResidue(t.iRes,!0),this.setTargetViewByIAtom(e)}this.soupView.isUpdateColors=!0,this.soupView.isUpdateObservers=!0}}class Qh{constructor(e){this.vertices=e,this.padding=.05,this.div=5,this.invDiv=1/this.div,this.maxima=[0,0,0],this.minima=[0,0,0],this.spans=[0,0,0],this.sizes=[0,0,0];for(let t=0;t<3;t++){for(let e=0;e<this.vertices.length;e+=1)this.minima[t]>this.vertices[e][t]&&(this.minima[t]=this.vertices[e][t]),this.maxima[t]<this.vertices[e][t]&&(this.maxima[t]=this.vertices[e][t]);this.minima[t]-=this.padding,this.maxima[t]+=this.padding,this.spans[t]=this.maxima[t]-this.minima[t],this.sizes[t]=Math.ceil(this.spans[t]*this.invDiv)}this.cells={},this.spaces=[];for(let t=0;t<this.vertices.length;t++){let e=this.vertices[t],n=this.getSpaceFromVertex(e);this.spaces.push(n);let r=this.getHashFromSpace(n);r in this.cells||(this.cells[r]=[]),this.cells[r].push(t)}}getSpaceFromVertex(e){let t=[];for(let n=0;n<3;n++)t.push(Math.round((e[n]-this.minima[n])*this.invDiv));return t}getHashFromSpace(e){return e[0]*this.sizes[1]*this.sizes[2]+e[1]*this.sizes[2]+e[2]}pushCellOfSpace(e,t,n){let r=this.getSpaceFromVertex(t),i=Math.max(0,r[0]-1),o=Math.min(this.sizes[0],r[0]+2),s=Math.max(0,r[1]-1),a=Math.min(this.sizes[1],r[1]+2),l=Math.max(0,r[2]-1),u=Math.min(this.sizes[2],r[2]+2);for(let c=i;c<o;c++)for(let t=s;t<a;t++)for(let r=l;r<u;r++){let i=this.getHashFromSpace([c,t,r]);if(i in this.cells){let t=this.cells[i];for(let r=0;r<t.length;r++){let i=t[r];e.push([n,i])}}}}getClosePairs(){let e=[];for(let t=0;t<this.vertices.length;t++)this.pushCellOfSpace(e,this.vertices[t],t);return e}getVerticesNearPoint(e,t){let n=[];return this.pushCellOfSpace(n,e,t),n}}function Kh(e,t){switch(e){case"int8":return new Int8Array(t);case"int16":return new Int16Array(t);case"int32":return new Int32Array(t);case"uint8":return new Uint8Array(t);case"uint16":return new Uint16Array(t);case"uint32":return new Uint32Array(t);case"float32":return new Float32Array(t);default:throw new Error("arrayType unknown: "+e)}}class ed{constructor(e,t){this.length=0,this.count=0,this._fields=e,Number.isInteger(t)?this._init(t):this._init(0)}_init(e){this.length=e,this.count=0;for(let t of this._fields)this._initField(...t)}_initField(e,t,n){this[e]=Kh(n,this.length*t)}addField(e,t,n){this._fields.push([e,t,n]),this._initField(e,t,n)}resize(e){this.length=Math.round(e||0),this.count=Math.min(this.count,this.length);for(let t=0,n=this._fields.length;t<n;++t){const e=this._fields[t][0],n=this._fields[t][1],r=this.length*n,i=new this[e].constructor(r);this[e].length>r?i.set(this[e].subarray(0,r)):i.set(this[e]),this[e]=i}}growIfFull(){if(this.count>=this.length){const e=Math.round(1.5*this.length);this.resize(Math.max(256,e))}}increment(){this.count+=1,this.growIfFull()}copyFrom(e,t,n,r){for(let i=0,o=this._fields.length;i<o;++i){const o=this._fields[i][0],s=this._fields[i][1],a=this[o],l=e[o];for(let e=0;e<r;++e){const r=s*(t+e),i=s*(n+e);for(let e=0;e<s;++e)a[r+e]=l[i+e]}}}copyWithin(e,t,n){for(let r=0,i=this._fields.length;r<i;++r){const i=this._fields[r][0],o=this._fields[r][1],s=this[i];for(let r=0;r<n;++r){const n=o*(e+r),i=o*(t+r);for(let e=0;e<o;++e)s[n+e]=s[i+e]}}}sort(e){const t=this,n=new this.constructor(this._fields,1);function r(e,r){e!==r&&(n.copyFrom(t,0,e,1),t.copyWithin(e,r,1),t.copyFrom(n,r,0,1))}function i(t,n){if(t<n){let o=Math.floor((t+n)/2),s=t,a=n;do{while(e(s,o)<0)s+=1;while(e(a,o)>0)a-=1;s<=a&&(s===o?o=a:a===o&&(o=s),r(s,a),s+=1,a-=1)}while(s<=a);i(t,a),i(s,n)}}i(0,this.count-1)}clear(){this.count=0}dispose(){delete this.length,delete this.count;for(let e=0,t=this._fields.length;e<t;++e){const t=this._fields[e][0];delete this[t]}}}var td=ed;const nd=["ALA","CYS","ASP","GLU","PHE","GLY","HIS","ILE","LYS","LEU","MET","ASN","PRO","GLN","ARG","SER","THR","TRP","VAL","TYR"],rd=["DA","DT","DG","DC","A","T","G","C"],id=["RA","RU","RC","RG","A","G","C","U"],od=new ni(7315026),sd=new ni(6590902),ad=new ni(16172569),ld=new ni(9795754),ud=new ni(12303291),cd=new ni(10040115),hd=new ni(10066329);let dd={H:13421772,C:11184810,O:13369344,N:204,S:11184640,P:6693580,F:52224,CL:52224,BR:8921600,I:6684842,FE:13395456,CA:8947882,He:8095426,Ne:10408676,Ar:6145214,Kr:11326326,Xe:16228220,Rn:14851781};for(let[qp,Wp]of s.a.toPairs(dd))dd[qp]=new ni(Wp);function pd(e){return"E"===e?ad:"H"===e?sd:"D"===e?ld:"C"===e?od:"W"===e?cd:ud}const fd={ALA:"A",CYS:"C",ASP:"D",GLU:"E",PHE:"F",GLY:"G",HIS:"H",ILE:"I",LYS:"K",LEU:"L",MET:"M",ASN:"N",PRO:"P",GLN:"Q",ARG:"R",SER:"S",THR:"T",VAL:"V",TRP:"W",TYR:"Y",DA:"A",DT:"T",DG:"G",DC:"C",A:"A",T:"T",G:"G",C:"C",RA:"A",RU:"U",RC:"C",RG:"G",U:"U"},md=["N","C","O","H","HA","CA","OXT","C3'","P","OP1","O5'","OP2","C5'","O5'","O3'","C4'","O4'","C1'","C2'","O2'","H2'","H2''","H3'","H4'","H5'","H5''","HO3'"],gd=new ou([new Ot(-.2,-.2),new Ot(-.2,.2),new Ot(.2,.2),new Ot(.2,-.2)]);function vd(e){let t=[];return"DA"===e||"A"===e||"DG"===e||"G"===e?t=["N9","C8","N7","C5","C6","N1","C2","N3","C4"]:"DT"===e||"U"===e?t=["C6","N1","C2","N3","C4","C5"]:"DC"!==e&&"C"!==e||(t=["C6","N1","C2","N3","C4","C5"]),t}function yd(e){let t=[];return"DA"===e||"A"===e||"DG"===e||"G"===e?t=[["C3'","C2'"],["C2'","C1'"],["C1'","N9"]]:"DT"===e||"U"===e?t=[["C3'","C2'"],["C2'","C1'"],["C1'","N1"]]:"DC"!==e&&"C"!==e||(t=[["C3'","C2'"],["C2'","C1'"],["C1'","N1"]]),t}function xd(e){return e.replace(/\d+/,"")}function bd(e,t,n){t in e||(e[t]=[]),e[t].push(n)}function wd(e,t,n=null){if(s.a.isNil(n))return s.a.includes(e,t)||e.push(t),e.indexOf(t);{let r=s.a.findIndex(e,e=>n(t,e));return r>=0?r:(e.push(t),e.length-1)}}function _d(e){return 1===e}function Ad(e){return e?1:0}function Sd(e){return e?String.fromCharCode(e):""}function Ed(e){return e.charCodeAt(0)}function Md(e){let t="",n=e.split(/\r?\n/);for(let r of n)"TITLE"===r.substring(0,5)&&(t+=r.substring(10));return t}function Td(e){return(new ni).setHex(e+1)}const Cd=[["x",1,"float32"],["y",1,"float32"],["z",1,"float32"],["bfactor",1,"float32"],["alt",1,"uint8"],["iAtomType",1,"uint16"],["iElem",1,"uint16"],["iRes",1,"uint32"],["iChain",1,"int32"],["bondOffset",1,"uint32"],["bondCount",1,"uint16"]];class Pd{constructor(e,t){this.soup=e,Number.isInteger(t)&&this.load(t),this._pos=fh.create()}load(e){return this.iAtom=e,this}get pos(){return this._pos.x=this.soup.atomStore.x[this.iAtom],this._pos.y=this.soup.atomStore.y[this.iAtom],this._pos.z=this.soup.atomStore.z[this.iAtom],this._pos}get resId(){return this.soup.resIds[this.iRes]}get elem(){let e=this.soup.atomStore.iElem[this.iAtom];return this.soup.elemTable[e]}get bfactor(){return this.soup.atomStore.bfactor[this.iAtom]}get atomType(){let e=this.soup.atomStore.iAtomType[this.iAtom];return this.soup.atomTypeTable[e]}get alt(){return Sd(this.soup.atomStore.alt[this.iAtom])}set alt(e){this.soup.atomStore.alt[this.iAtom]=Ed(e)}get iRes(){return this.soup.atomStore.iRes[this.iAtom]}set iRes(e){this.soup.atomStore.iRes[this.iAtom]=e}get resType(){let e=this.soup.residueStore.iResType[this.iRes];return this.soup.resTypeTable[e]}get label(){let e=this.soup.residueStore.iResType[this.iRes],t=this.soup.resTypeTable[e],n=this.soup.resIds[this.iRes]+":"+t+":"+this.atomType;return this.alt&&(n+=":"+this.alt),n}getBondIndices(){let e=this.soup.atomStore.bondOffset[this.iAtom],t=this.soup.atomStore.bondCount[this.iAtom],n=e+t;return s.a.range(e,n)}get color(){let e=this.soup.getResidueProxy(this.iRes);if(e.isPolymer){let t=e.activeColor;if("C"===this.elem||"H"===this.elem)return t;if(this.elem in dd){let e=dd[this.elem].clone().offsetHSL(0,-.3,-.3);return(new ni).addColors(t,e)}}return this.elem in dd?dd[this.elem]:hd}}const Rd=[["atomOffset",1,"uint32"],["atomCount",1,"uint16"],["iCentralAtom",1,"uint32"],["iResType",1,"uint16"],["iChain",1,"uint8"],["iStructure",1,"uint8"],["resNum",1,"int32"],["insCode",1,"uint8"],["sstruc",1,"uint8"],["iColor",1,"uint16"],["iCustomColor",1,"uint16"],["isPolymer",1,"uint8"],["selected",1,"uint8"],["sidechain",1,"uint8"],["iChain",1,"uint8"]];function Ld(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b}class Od{constructor(e,t){this.soup=e,Number.isInteger(t)&&this.load(t)}load(e){return this.iRes=e,this}get iAtom(){return this.soup.residueStore.iCentralAtom[this.iRes]}set iAtom(e){this.soup.residueStore.iCentralAtom[this.iRes]=e}get iChain(){return this.soup.residueStore.iChain[this.iRes]}get chain(){return this.soup.chains[this.iChain]}get iStructure(){return this.soup.residueStore.iStructure[this.iRes]}set iStructure(e){this.soup.residueStore.iStructure[this.iRes]=e}get resId(){return this.soup.resIds[this.iRes]}get resNum(){return this.soup.residueStore.resNum[this.iRes]}get insCode(){return Sd(this.soup.residueStore.insCode[this.iRes])}set insCode(e){this.soup.residueStore.insCode[this.iRes]=Ed(e)}get isPolymer(){return _d(this.soup.residueStore.isPolymer[this.iRes])}set isPolymer(e){this.soup.residueStore.isPolymer[this.iRes]=Ad(e)}get sidechain(){return _d(this.soup.residueStore.sidechain[this.iRes])}set sidechain(e){this.soup.residueStore.sidechain[this.iRes]=Ad(e)}get selected(){return _d(this.soup.residueStore.selected[this.iRes])}set selected(e){this.soup.residueStore.selected[this.iRes]=Ad(e)}get color(){let e=this.soup.residueStore.iColor[this.iRes];return this.soup.colorTable[e]}set color(e){let t=wd(this.soup.colorTable,new ni(e),Ld);this.soup.residueStore.iColor[this.iRes]=t}get customColor(){let e=this.soup.residueStore.iCustomColor[this.iRes];return this.soup.colorTable[e]}set customColor(e){let t=wd(this.soup.colorTable,new ni(e),Ld);this.soup.residueStore.iCustomColor[this.iRes]=t}get activeColor(){let e=this.soup.residueStore.iColor[this.iRes],t=this.soup.colorTable[e];return this.selected&&(t=t.clone().offsetHSL(0,0,.3)),t}get resType(){let e=this.soup.residueStore.iResType[this.iRes];return this.soup.resTypeTable[e]}get normal(){let e=this.iRes in this.soup.residueNormal;return e?this.soup.residueNormal[this.iRes].clone():null}get ss(){return Sd(this.soup.residueStore.sstruc[this.iRes])}set ss(e){this.soup.residueStore.sstruc[this.iRes]=Ed(e)}get label(){let e=this.soup.residueStore.iResType[this.iRes],t=this.soup.resTypeTable[e],n=this.soup.resIds[this.iRes]+":"+t;return n}getAtomIndices(){let e=this.soup.residueStore.atomOffset[this.iRes],t=this.soup.residueStore.atomCount[this.iRes],n=e+t;return s.a.range(e,n)}getAtomProxy(e){let t=this.soup.getAtomProxy();for(let n of this.getAtomIndices())if(t.iAtom=n,t.atomType===e)return t;return null}getIAtom(e){for(let t of this.getAtomIndices()){let n=this.soup.atomStore.iAtomType[t],r=this.soup.atomTypeTable[n];if(r===e)return t}return null}checkAtomTypes(e){for(let t of e)if(null===this.getIAtom(t))return!1;return!0}isProteinConnectedToPrev(){if(0===this.iRes)return!1;let e=this,t=new Od(this.soup,this.iRes-1);const n=["CA"];if(t.checkAtomTypes(n)&&e.checkAtomTypes(n)){let n=t.getAtomProxy("CA").pos,r=e.getAtomProxy("CA").pos;if(fh.distance(n,r)<5)return!0}return!1}isNucleotideConnectedToPrev(){if(0===this.iRes)return!1;let e=this,t=new Od(this.soup,this.iRes-1);const n=["C3'","O3'"];if(t.checkAtomTypes(n)&&e.checkAtomTypes(n)&&e.checkAtomTypes(["P"])){let n=t.getAtomProxy("O3'").pos,r=e.getAtomProxy("P").pos;if(fh.distance(n,r)<2.5)return!0}return!1}isConnectedToPrev(){return this.isProteinConnectedToPrev()||this.isNucleotideConnectedToPrev()}getNucleotideNormal(){let e=this.getAtomProxy("C3'").pos,t=this.getAtomProxy("C5'").pos,n=this.getAtomProxy("C1'").pos,r=fh.diff(e,t),i=fh.diff(n,e);return fh.crossProduct(r,i)}}const Dd=[["iAtom1",1,"int32"],["iAtom2",1,"int32"]];class Id{constructor(e,t){this.soup=e,Number.isInteger(t)&&this.load(t)}load(e){return this.iBond=e,this}get iAtom1(){return this.soup.bondStore.iAtom1[this.iBond]}get iAtom2(){return this.soup.bondStore.iAtom2[this.iBond]}}class kd{constructor(){this.parsingError="",this.title="",this.structureIds=[],this.structureId=null,this.iStructure=-1,this.chains=[],this.maxLength=null,this.traces=[],this.selectedTraces=[],this.colorMode="secondary",this.atomStore=new td(Cd),this.residueStore=new td(Rd),this.bondStore=new td(Dd),this.resIds=[],this.residueNormal={},this.residueProxy=new Od(this),this.atomProxy=new Pd(this),this.elemTable=[],this.atomTypeTable=[],this.resTypeTable=[],this.colorTable=[],this.grid={bCutoff:.8,bMax:2,bMin:.4,changed:!0,isElem:{},convertB:e=>-e.toFixed(2)}}isEmpty(){return 0===this.getAtomCount()}parseAtomLines(e){let t,n,r,i,o,a,l,u,c,h,d;for(let f=0;f<e.length;f+=1){let m=e[f];if("ATOM"===m.substr(0,4)||"HETATM"===m.substr(0,6)){try{a=s.a.trim(m.substr(12,4)),c=s.a.trim(m.substr(16,1)),o=s.a.trim(m.substr(17,3)),i=m[21],h=parseInt(m.substr(22,4)),d=m.substr(26,1),t=parseFloat(m.substr(30,7)),n=parseFloat(m.substr(38,7)),r=parseFloat(m.substr(46,7)),l=parseFloat(m.substr(60,6)),u=xd(s.a.trim(m.substr(76,2)))}catch(p){this.parsingError="line "+f,console.log(`Error: "${m}"`);continue}""===u&&(u=xd(s.a.trim(a)).substr(0,1)),this.addAtom(t,n,r,l,c,a,u,o,h,d,i)}}}parseSecondaryStructureLines(e){this.assignResidueProperties(this.iStructure),this.parsedSecondaryStructure=!1;let t=this.getResidueProxy();for(let n=0;n<e.length;n+=1){let r=e[n];if("HELIX"===r.substr(0,5)){this.parsedSecondaryStructure=!0;let e=r.substr(19,1),n=parseInt(r.substr(21,4)),i=parseInt(r.substr(33,4));for(let r of this.findResidueIndices(this.iStructure,e,n)){t.iRes=r;while(t.resNum<=i&&e===t.chain)t.ss="H",t.iRes=t.iRes+1}}if("SHEET"===r.substr(0,5)){this.parsedSecondaryStructure=!0;let e=r.substr(21,1),n=parseInt(r.substr(22,4)),i=parseInt(r.substr(33,4));for(let r of this.findResidueIndices(this.iStructure,e,n)){t.iRes=r;while(t.resNum<=i&&e===t.chain)t.ss="E",t.iRes=t.iRes+1}}}}parsePdbData(e,t){this.structureId=t,this.structureIds.push(t),this.iStructure=this.structureIds.length-1;let n=Md(e),r=this.structureId.toUpperCase();this.title=`[<a href="http://www.rcsb.org/structure/${r}">${r}</a>] `+n;let i=e.split(/\r?\n/);if(0!==i.length){for(let e of s.a.range(i.length))if(s.a.includes(["END"],i[e].slice(0,3))){i=i.slice(0,e);break}this.parseAtomLines(i),this.parseSecondaryStructureLines(i)}else this.parsingError="No atom lines"}load(e){console.log(`Soup.load parse ${this.structureId}...`),this.parsePdbData(e.pdbText,this.structureId),console.log(`Soup.load processed ${this.getAtomCount()} atoms, `+this.getResidueCount()+" residues"),console.log("Soup.load finding bonds..."),this.calcBondsStrategic(),console.log(`Soup.load calculated ${this.getBondCount()} bonds`)}async asyncLoadProteinData(e,t){let n=e.pdbText,r=e.pdbId;if(0===e.pdbText.length)return void await t("Error: no soup data");if(await t(`Parsing '${r}'`),this.parsePdbData(n,r),this.parsingError){let e=this.soup.parsingError;return void await t("Error parsing soup: "+e)}let i=this.getAtomCount(),o=this.getResidueCount();await t(`Calculating bonds for ${i} atoms, ${o} residues...`),this.calcBondsStrategic(),this.parsedSecondaryStructure||(await t(`Calculated ${this.getBondCount()} bonds. Calculating secondary structure...`),this.findSecondaryStructure()),this.maxLength=this.calcMaxLength(),this.findGridLimits(),this.setSecondaryStructureColorResidues(),this.colorResidues(),this.calculateTracesForRibbons()}addAtom(e,t,n,r,i,o,s,a,l,u,c){let h=this.atomStore.count;this.atomStore.increment(),this.atomStore.x[h]=e,this.atomStore.y[h]=t,this.atomStore.z[h]=n,this.atomStore.bfactor[h]=r,this.atomStore.alt[h]=Ed(i),this.atomStore.bondCount[h]=0,this.atomStore.iAtomType[h]=wd(this.atomTypeTable,o),this.atomStore.iElem[h]=wd(this.elemTable,s);let d=this.getResidueCount(),p=!1;0===d?p=!0:(this.residueProxy.iRes=d-1,(this.residueProxy.resNum!==l||this.residueProxy.insCode!==u||this.chains[this.residueProxy.iChain]!==c)&&(p=!0)),p&&this.addResidue(h,l,u,c,a);let f=this.getResidueCount()-1;this.residueStore.atomCount[f]+=1,this.atomStore.iRes[h]=f}addResidue(e,t,n,r,i){let o=this.getResidueCount();this.residueStore.increment();let a=this.structureId+":";r&&(a+=r+":"),a+=t+s.a.trim(n),this.resIds.push(a);let l=wd(this.chains,r);this.residueStore.iChain[o]=l,this.residueStore.resNum[o]=t,this.residueStore.insCode[o]=Ed(n),this.residueStore.iResType[o]=wd(this.resTypeTable,i),this.residueStore.atomOffset[o]=e,this.residueStore.atomCount[o]=0,this.residueStore.iStructure[o]=this.iStructure}findFirstResidue(e,t){let n=this.getResidueProxy();for(let r of s.a.range(this.getResidueCount()))if(n.iRes=r,n.chain===e&&n.resNum===t)return n;return null}findResidueIndices(e,t,n){let r=[],i=this.getResidueProxy();for(let o of s.a.range(this.getResidueCount()))i.iRes=o,i.iStructure===e&&i.chain===t&&i.resNum===n&&r.push(o);return r}assignResidueProperties(e){let t=this.getResidueProxy();for(let n=0;n<this.getResidueCount();n+=1)if(t.iRes=n,t.iStructure===e)if(s.a.includes(nd,t.resType))t.iAtom=t.getIAtom("CA"),t.ss="C",t.isPolymer=!0;else if(s.a.includes(rd,t.resType)||s.a.includes(id,t.resType))t.iAtom=t.getIAtom("C3'"),t.ss="D",t.isPolymer=!0;else{t.isPolymer=!1,"HOH"===t.resType?t.ss="W":"XXX"===t.resType?t.ss="G":t.ss="-";let e=this.getCenter(t.getAtomIndices());t.iAtom=this.getIAtomClosest(e,t.getAtomIndices())}}getIAtomClosest(e,t){let n=null,r=1e6,i=this.getAtomProxy();for(let o of t)if(null===n)n=o;else{i.iAtom=o;let t=fh.distance(e,i.pos);t<r&&(n=o,r=t)}return n}getIAtomAtPosition(e){let t=s.a.range(this.getAtomCount()),n=null,r=1e6,i=this.getAtomProxy();for(let o of t)if(null===n)n=o;else{i.iAtom=o;let t=fh.distance(e,i.pos);t<r&&(n=o,r=t)}return r<.1?n:-1}getCenter(e){let t=fh.create(0,0,0),n=this.getAtomProxy();for(let r of e)t=fh.sum(t,n.load(r).pos);return t.divideScalar(e.length),t}calcMaxLength(e=null){let t=[0,0,0],n=[0,0,0],r=[0,0,0];function i(e,t){return 0===t?e.x:1===t?e.y:2===t?e.z:void 0}s.a.isNull(e)&&(e=s.a.range(this.getAtomCount()));let o=this.getAtomProxy();for(let s=0;s<3;s++){for(let r of e){let e=o.load(r).pos;n[s]>i(e,s)&&(n[s]=i(e,s)),t[s]<i(e,s)&&(t[s]=i(e,s))}r[s]=t[s]-n[s]}return Math.max(r[0],r[1],r[2])}calcBondsStrategic(){this.bondStore.count=0;const e=1.44,t=3.61,n=5.76,r=["C","H","O","N","P","S"];function i(i,o){if(null===i||null===o)return!1;if(""!==i.alt&&""!==o.alt&&i.alt!==o.alt)return!1;let s;s="H"===i.elem||"H"===o.elem?e:yh(i.elem,r)&&yh(o.elem,r)?t:n;let a=i.pos.x-o.pos.x,l=i.pos.y-o.pos.y,u=i.pos.z-o.pos.z,c=a*a+l*l+u*u;return c<=s}let o=(e,t)=>{let n=this.getBondCount();this.bondStore.increment(),this.bondStore.iAtom1[n]=e.iAtom,this.bondStore.iAtom2[n]=t.iAtom,n=this.getBondCount(),this.bondStore.increment(),this.bondStore.iAtom1[n]=t.iAtom,this.bondStore.iAtom2[n]=e.iAtom},s=this.getResidueProxy(),a=this.getResidueProxy(),l=this.getResidueCount(),u=this.getAtomProxy(),c=this.getAtomProxy();for(let f=0;f<l;f++){a.iRes=f;for(let e of a.getAtomIndices())for(let t of a.getAtomIndices())u.iAtom=e,c.iAtom=t,i(u,c)&&o(u,c)}for(let f=1;f<l;f++){if(s.iRes=f-1,a.iRes=f,a.isProteinConnectedToPrev())s.checkAtomTypes(["C"])&&a.checkAtomTypes(["N"])&&(u.iAtom=s.getIAtom("C"),c.iAtom=a.getIAtom("N"));else{if(!a.isNucleotideConnectedToPrev())continue;s.checkAtomTypes(["O3'"])&&a.checkAtomTypes(["P"])&&(u.iAtom=s.getIAtom("O3'"),c.iAtom=a.getIAtom("P"))}o(u,c)}let h=this.bondStore.iAtom1;this.bondStore.sort((e,t)=>h[e]-h[t]);for(let f=0;f<this.getAtomCount();f+=1)this.atomStore.bondCount[f]=0;let d=this.getBondProxy(),p=null;for(let f=0;f<this.getBondCount();f+=1)d.iBond=f,p!==d.iAtom1&&(p=d.iAtom1,this.atomStore.bondOffset[p]=f),this.atomStore.bondCount[p]+=1}findBackboneHbonds(){let e=this.getResidueProxy(),t=this.getAtomProxy(),n=this.getAtomProxy(),r=[],i=3.5;for(let o=0;o<this.structureIds.length;o+=1){let s=[],a=[];for(let n=0;n<this.getResidueCount();n+=1)if(e.iRes=n,e.iStructure===o&&e.isPolymer)for(let r of["O","N"]){let n=e.getIAtom(r);null!==n&&(t.iAtom=n,s.push([t.pos.x,t.pos.y,t.pos.z]),a.push(n))}let l=new Qh(s);for(let e of l.getClosePairs()){if(t.iAtom=a[e[0]],n.iAtom=a[e[1]],"O"===t.elem&&"N"===n.elem&&([t,n]=[n,t]),"N"!==t.elem||"O"!==n.elem)continue;let o=t.iRes,s=n.iRes;o!==s&&(fh.distance(t.pos,n.pos)<=i&&bd(r,o,s))}}this.conhPartners=r}findSecondaryStructure(){this.findBackboneHbonds();let e=this.conhPartners,t={},n=this.getResidueCount(),r=this.getResidueProxy(),i=this.getResidueProxy(),o=this.getAtomProxy(),a=this.getAtomProxy();function l(t,r){return!(r<0||r>=n||t<0||t>=n)&&s.a.includes(e[r],t)}function u(e,t){return o.iAtom=r.load(e).iAtom,a.iAtom=i.load(t).iAtom,fh.diff(o.pos,a.pos)}let c=[],h=[],d=[];for(let s=0;s<this.getResidueCount();s+=1)if(r.iRes=s,r.isPolymer&&"D"!==r.ss){let e=r.getIAtom("CA");null!==e&&(o.iAtom=e,c.push([o.pos.x,o.pos.y,o.pos.z]),h.push(e),d.push(s))}for(let s=0;s<n;s+=1)if(r.iRes=s,r.isPolymer)if("D"!==r.ss){if(l(s,s+4)&&l(s+1,s+5)){let e=u(s,s+4),n=u(s+1,s+5);for(let i=s+1;i<s+5;i+=1)r.load(i).ss="H",bd(t,i,e),bd(t,i,n)}if(l(s,s+3)&&l(s+1,s+4)){let e=u(s,s+3),n=u(s+1,s+4);for(let i=s+1;i<s+4;i+=1)r.load(i).ss="H",bd(t,i,e),bd(t,i,n)}}else bd(t,s,r.getNucleotideNormal());let p=[],f=new Qh(c);for(let s of f.getClosePairs()){let[e,n]=s,r=d[e],i=d[n];if(!(Math.abs(r-i)<=5)){if(l(r,i+1)&&l(i-1,r)&&(p=p.concat([r,i])),l(r-1,i)&&l(i,r+1)&&(p=p.concat([r,i])),l(r,i)&&l(i,r)){p=p.concat([r,i]);let e=u(r,i);bd(t,r,e),bd(t,i,fh.scaled(e,-1))}if(l(r-1,i+1)&&l(i-1,r+1)){p=p.concat([r,i]);let e=u(r,i);bd(t,r,fh.scaled(e,-1)),bd(t,i,e)}}}for(let s of p)r.load(s).ss="E";for(let s=0;s<n;s+=1)if(s in t&&t[s].length>0){let e=fh.create(0,0,0);for(let n of t[s])e=fh.sum(e,n);this.residueNormal[s]=fh.normalized(e)}for(let s=1;s<n;s+=1)r.iRes=s-1,i.iRes=s,"E"===r.ss&&r.normal&&"E"===i.ss&&i.normal&&i.normal.dot(r.normal)<0&&this.residueNormal[s].negate()}calculateTracesForRibbons(){let e;this.traces.length=0;let t=this.getResidueProxy(),n=this.getResidueProxy(),r=this.getAtomProxy(),i=this.getResidueCount();for(let o=0;o<i;o+=1)if(t.iRes=o,o<i-1&&(n.iRes=o+1,n.isConnectedToPrev()&&(t.isPolymer=!0,n.isPolymer=!0)),t.isPolymer){if(s.a.isUndefined(e)||0===o||!t.isConnectedToPrev()){let n=new Ch;n.getReference=e=>(t.iRes=n.indices[e],t),this.traces.push(n),e=n}e.indices.push(o),t.getIAtom("CA")?r.iAtom=t.getIAtom("CA"):t.getIAtom("C3'")?r.iAtom=t.getIAtom("C3'"):r.iAtom=t.iAtom,e.refIndices.push(t.iRes),e.points.push(r.pos.clone()),e.colors.push(t.activeColor),e.indexColors.push(Td(t.iAtom)),e.segmentTypes.push(t.ss),e.normals.push(t.normal)}for(let o of this.traces)o.calcTangents(),o.calcNormals(),o.calcBinormals(),o.expand()}getIStructureAndChain(){if(this.selectedTraces.length>0){let e=this.selectedTraces[0],t=this.traces[e];if(s.a.isNil(t))return null;let n=this.traces[e].indices[0],r=this.getResidueProxy(n),i=r.iStructure,o=r.chain;return{iStructure:i,chain:o}}return null}getAtomProxy(e){return new Pd(this,e)}getAtomCount(){return this.atomStore.count}getResidueProxy(e){return new Od(this,e)}getBondProxy(e){return new Id(this,e)}getBondCount(){return this.bondStore.count}getResidueCount(){return this.residueStore.count}areCloseResidues(e,t){let n=this.getAtomProxy(),r=this.getAtomProxy(),i=this.getResidueProxy(e),o=n.load(i.iAtom).pos.clone(),s=i.getAtomIndices(),a=this.getResidueProxy(t),l=r.load(a.iAtom).pos.clone(),u=a.getAtomIndices();if(fh.distance(o,l)>17)return!1;for(let c of s)for(let e of u)if(fh.distance(n.load(c).pos,r.load(e).pos)<4)return!0;return!1}clearSelectedResidues(){let e=this.getResidueProxy();for(let t=0;t<this.getResidueCount();t+=1)e.load(t).selected=!1}clearSidechainResidues(){let e=this.getResidueProxy();for(let t=0;t<this.getResidueCount();t+=1)e.load(t).sidechain=!1}setSidechainOfResidues(e,t){let n=this.getResidueProxy();for(let r of e)n.load(r).sidechain=t}getAtomsOfChainContainingResidue(e){let t=this.getResidueProxy(e),n=t.iStructure,r=t.chain,i=[];for(let o=0;o<this.getResidueCount();o+=1)t.iRes=o,t.iStructure===n&&t.chain===r&&i.push(t.iAtom);return i}getNeighbours(e){let t=[e];for(let n=0;n<this.getResidueCount();n+=1)this.areCloseResidues(n,e)&&t.push(n);return t}isResCloseToPoint(e,t){let n=this.getAtomProxy(),r=this.getResidueProxy(e),i=n.load(r.iAtom).pos.clone();if(fh.distance(i,t)>17)return!1;let o=r.getAtomIndices();for(let s of o)if(fh.distance(n.load(s).pos,t)<5)return!0;return!1}getNeighboursOfPoint(e){let t=[];for(let n=0;n<this.getResidueCount();n+=1)this.isResCloseToPoint(n,e)&&t.push(n);return t}setSecondaryStructureColorResidues(){let e=this.getResidueProxy();for(let t of s.a.range(this.getResidueCount()))e.iRes=t,e.customColor=pd(e.ss)}colorResidues(){let e=this.getResidueProxy(),t=s.a.some(s.a.values(this.grid.isElem));if(t)for(let n of s.a.range(this.getResidueCount()))e.iRes=n,e.color=hd;for(let n of s.a.range(this.getResidueCount()))e.iRes=n,e.color=t?hd:e.customColor}findGridLimits(){let e=this.getResidueProxy(),t=this.getAtomProxy();this.grid.isElem={};for(let n=0;n<this.getResidueCount();n+=1)e.iRes=n,"G"===e.ss&&(t.iAtom=e.iAtom,t.elem in this.grid.isElem||(this.grid.isElem[t.elem]=!0),null===this.grid.bMin?(this.grid.bMin=t.bfactor,this.grid.bMax=t.bfactor):(t.bfactor>this.grid.bMax&&(this.grid.bMax=t.bfactor),t.bfactor<this.grid.bMin&&(this.grid.bMin=t.bfactor)));null===this.grid.bMin&&(this.grid.bMin=0),null===this.grid.bMax&&(this.grid.bMin=0),s.a.isNil(this.grid)&&(this.grid.bCutoff=this.grid.bMin)}makeSelectedResidueList(){let e=[],t=this.getResidueProxy();for(let n=0;n<this.getResidueCount();n+=1)t.load(n).sidechain&&e.push(n);return e}}var Nd=n("9e12"),Fd=n.n(Nd);n("0e33"),n("4939");class Vd{constructor(e,t){this.color=t,this.div=i()("<canvas>").css({position:"absolute","z-index":"1",display:"none","pointer-events":"none"}),this.canvas=this.div[0],this.context2d=this.canvas.getContext("2d"),this.parentDiv=i()(e.divTag),this.parentDiv.append(this.div)}hide(){this.div.css("display","none")}move(e,t,n,r){this.parentDiv.position();let i=Math.abs(e-n),o=Math.abs(t-r),s=Math.min(e,n),a=Math.min(t,r);this.div.css("display","block").css("width",i).css("height",o).css("top",a).css("left",s),this.canvas.width=i,this.canvas.height=o,this.context2d.clearRect(0,0,i,o),this.context2d.beginPath(),this.context2d.moveTo(e-s,t-a),this.context2d.lineTo(n-s,r-a),this.context2d.lineWidth=2,this.context2d.strokeStyle=this.color,this.context2d.stroke()}}class zd{constructor(e){this.parentDiv=i()(e),this.parentDivId=this.parentDiv.attr("id"),this.div=i()("<div>").css("user-select","none"),this.parentDiv.append(this.div),this.canvas=i()("<canvas>"),this.div.append(this.canvas),this.canvasDom=this.canvas[0],this.drawContext=this.canvasDom.getContext("2d"),this.mousePressed=!1,this.downTimer=null;const t=this.canvasDom,n=(e,n)=>{t.addEventListener(e,n)};n("mousedown",e=>this.mousedown(e)),n("mousemove",e=>this.mousemove(e)),n("mouseup",e=>this.mouseup(e)),n("mouseout",e=>this.mouseout(e)),n("touchstart",e=>this.mousedown(e)),n("touchmove",e=>this.mousemove(e)),n("touchend",e=>this.mouseup(e)),n("touchcancel",e=>this.mouseup(e))}width(){return this.parentDiv.width()}height(){return this.parentDiv.height()}x(){let e=this.parentDiv.position();return e.left}y(){let e=this.parentDiv.position();return e.top}inside(e,t){return e>=this.x()&&e<=this.x()+this.width()&&t>=this.y()&&t<=this.y()+this.height()}update(){}resize(){this.canvasDom.width=this.width(),this.canvasDom.height=this.height()}strokeRect(e,t,n,r,i){this.drawContext.strokeStyle=i,this.drawContext.strokeRect(e,t,n,r)}fillRect(e,t,n,r,i){this.drawContext.fillStyle=i,this.drawContext.strokeStyle="none",this.drawContext.fillRect(e,t,n,r)}line(e,t,n,r,i,o){this.drawContext.fillStyle=o,this.drawContext.strokeStyle=o,this.drawContext.beginPath(),this.drawContext.lineWidth=i,this.drawContext.moveTo(e,t),this.drawContext.lineTo(n,r),this.drawContext.stroke()}text(e,t,n,r,i,o){this.drawContext.fillStyle=i,this.drawContext.font=r,this.drawContext.textAlign=o,this.drawContext.textBaseline="middle",this.drawContext.fillText(e,t,n)}textWidth(e,t){return this.drawContext.font=t,this.drawContext.textAlign="center",this.drawContext.measureText(e).width}saveMouse(){this.saveMouseX=this.pointerX,this.saveMouseY=this.pointerY,this.saveMouseR=this.mouseR,this.saveMouseT=this.mouseT}click(e){}doubleclick(e){}mousedown(e){e.preventDefault(),this.getPointer(e),this.saveMouse(),this.mousePressed=!0,null===this.downTimer?this.downTimer=setTimeout(()=>this.click(e),250):(clearTimeout(this.downTimer),this.doubleclick(e),this.downTimer=null),this.mousemove(e)}mousemove(e){}mouseout(e){}mouseup(e){e.preventDefault(),this.mousePressed=!1}getPointer(e){mh(e.touches)&&e.touches.length>0?(this.eventX=e.touches[0].clientX,this.eventY=e.touches[0].clientY):(this.eventX=e.clientX,this.eventY=e.clientY);let t=e.target.getBoundingClientRect();this.pointerX=this.eventX-t.left,this.pointerY=this.eventY-t.top;let n=this.pointerX-this.width()/2,r=this.pointerY-this.height()/2;this.mouseR=Math.sqrt(n*n+r*r),this.mouseT=Math.atan(r/n),n<0&&(r>0?this.mouseT+=Math.PI:this.mouseT-=Math.PI)}}class Ud{constructor(e,t){s.a.isUndefined(t)?this.heightArrow=30:this.heightArrow=t,this.div=i()("<div>").css({position:"absolute",top:0,left:0,background:"white","box-sizing":"border-box",font:"12px Helvetica",color:"#666",padding:"5",opacity:.8,display:"none","max-width":"300px","z-index":1,cursor:"pointer","user-select":"none","pointer-events":"none"}),this.arrow=i()("<div>").css({position:"absolute",top:0,left:0,width:0,height:0,"box-sizing":"border-box","border-left":"5px solid transparent","border-right":"5px solid transparent","border-top":this.heightArrow+"px solid white",opacity:.8,display:"none","z-index":1,"pointer-events":"none","user-select":"none"}),this.parentDiv=i()(e),this.parentDiv.append(this.div),this.parentDiv.append(this.arrow)}move(e,t){this.div.css({display:"block"});let n=this.div[0].getBoundingClientRect(),r=n.width,i=n.height;this.arrow.css({display:"block"}),e<0||e>this.parentDiv.width()||t<0||t>this.parentDiv.height()?this.hide():(this.arrow.css({top:t-this.heightArrow,left:e-5}),this.div.css({top:t-this.heightArrow-i,left:e-r/2}))}hide(){this.div.css("display","none"),this.arrow.css("display","none")}html(e){this.div.html(e)}remove(){this.div.remove(),this.arrow.remove()}}class jd{constructor(e){this.soupWidget=e,this.soupView=e.soupView,this.controller=e.controller,this.popups=[]}removePopup(e){this.controller.deleteAtomLabel(e),this.popups[e].remove(),this.popups.splice(e,1)}createPopup(e){let t=new Ud(this.soupWidget.divTag);return t.i=e,t.div.css("pointer-events","auto"),t.div.click(()=>{this.removePopup(t.i)}),t}drawFrame(){let e=this.soupView.currentView.labels;if(e.length>this.popups.length)for(let n=this.popups.length;n<e.length;n+=1)this.popups.push(this.createPopup(n));if(this.popups.length>e.length)for(let n=this.popups.length-1;n>=e.length;n-=1)this.removePopup(n);let t=this.soupView.soup.getAtomProxy();for(let n=0;n<e.length;n+=1){this.popups[n].i=n,t.iAtom=e[n].i_atom,this.popups[n].html(e[n].text);let r=.7*this.soupWidget.opacity(t.pos)+.2;this.popups[n].div.css("opacity",r),this.popups[n].arrow.css("opacity",r);let i=this.soupWidget.getPosXY(t.pos);this.popups[n].move(i.x,i.y),this.soupWidget.inZlab(t.pos)||(this.popups[n].div.css("display","none"),this.popups[n].arrow.css("display","none"))}}}class Bd{constructor(e){this.distanceMeasures=[],this.scene=e.displayScene,this.soupView=e.soupView,this.controller=e.controller,this.soupWidget=e,this.parentDiv=i()(this.soupWidget.divTag),this.divs=[]}removeDistance(e){this.scene.remove(this.distanceMeasures[e].line),this.distanceMeasures[e].div.remove(),this.controller.deleteDistance(e),this.distanceMeasures.splice(e,1)}createDistanceMeasure(e){let t=i()("<div>").css({position:"absolute",top:0,left:0,"background-color":"#FFDDDD",padding:"5",opacity:.7,"font-family":"sans-serif"});t.i=e,t.click(()=>{this.removeDistance(t.i)}),this.parentDiv.append(t);let n=new fi;n.vertices.push(new kt(0,0,0)),n.vertices.push(new kt(1,1,1));let r=new yl({color:16742263,dashSize:3,gapSize:4,linewidth:1}),o=new Ns(n,r);return o.dontDelete=!0,this.scene.add(o),{line:o,div:t}}drawFrame(){let e=this.soupView.currentView.distances;if(e.length>this.distanceMeasures.length)for(let r=this.distanceMeasures.length;r<e.length;r+=1)this.distanceMeasures.push(this.createDistanceMeasure(r));if(this.distanceMeasures.length>e.length)for(let r=this.distanceMeasures.length-1;r>=e.length;r-=1)this.removeDistance(r);this.parentDiv.position();let t=this.soupView.soup.getAtomProxy(),n=this.soupView.soup.getAtomProxy();for(let r=0;r<e.length;r+=1){let i=e[r];this.distanceMeasures[r].div.i=r;let o=this.distanceMeasures[r],s=t.load(i.i_atom1).pos,a=n.load(i.i_atom2).pos,l=s.distanceTo(a).toFixed(1);o.div.text(l);let u=s.clone().add(a).multiplyScalar(.5),c=.7*this.soupWidget.opacity(u)+.3,h=this.soupWidget.getPosXY(u),d=h.x,p=h.y;if(d<0||d>this.parentDiv.width()||p<0||p>this.parentDiv.height()){o.div.hide();continue}let f=o.div.innerHeight(),m=o.div.innerWidth();o.div.css({top:p-f/2,left:d-m/2,display:"block",cursor:"pointer",opacity:c}),o.line.geometry.vertices[0].copy(s),o.line.geometry.vertices[1].copy(a),this.soupWidget.inZlab(u)||o.div.css("display","none")}}}class Hd extends zd{constructor(e,t){super(e),this.soupWidget=t,this.soupView=t.soupView,this.soup=t.soup,this.controller=t.controller,this.soupWidget.addObserver(this),this.residue=this.soup.getResidueProxy(),this.charWidth=14,this.charHeight=15,this.offsetY=6,this.heightStructureBar=7,this.spacingY=12,this.yTopSequence=this.offsetY+this.heightStructureBar+2*this.spacingY,this.yBottom=parseInt(this.yTopSequence+2.7*+this.spacingY+this.charHeight),this.yMidSequence=this.yTopSequence+1.2*this.spacingY+this.charHeight/2,this.unclickableColor="#AAA",this.structBarBgroundColor="#CCC",this.seqBarBgroundColor="#FFF",this.highlightColor="red",this.borderColor="#999",this.div.attr("id",this.parentDivId+"-inner"),this.div.css({"background-color":"#CCC",position:"relative"}),this.isWaitForDoubleClick=!1,this.charEntries=[],this.nChar=null,this.iCharSeqStart=null,this.iCharSeqEnd=null,this.nCharSeq=null,this.iCharStructStart=null,this.iCharStructEnd=null,this.nCharStruct=null,this.nPadChar=0,this.hover=new Ud(`#${this.parentDivId}-inner`,15),this.pressSection="none"}width(){return this.parentDiv.width()}height(){return this.yBottom}resize(){super.resize(),this.div.height(this.height()),this.parentDiv.height(this.height())}iCharFromXStruct(e){return parseInt(e*this.nCharStruct/this.textWidth())+this.iCharStructStart}xStructFromIChar(e){return parseInt((e-this.iCharStructStart)/this.nCharStruct*this.textWidth())}textWidth(){return this.width()}iCharFromXSeq(e){return parseInt(e*this.nCharSeq/this.textWidth())+this.iCharSeqStart}xSeqFromIChar(e){return parseInt((e-this.iCharSeqStart)/this.nCharSeq*this.textWidth())}calcNPad(){let e=[];for(let r of s.a.range(this.soup.structureIds.length))e.push(0);let t=this.soup.getResidueProxy();for(let r of s.a.range(this.soup.getResidueCount()))t.iRes=r,t.isPolymer&&(e[t.iStructure]+=1);e=s.a.filter(e,e=>e>0);let n=s.a.mean(e);this.nPadChar=parseInt(.02*n)}rebuild(){this.charEntries.length=0,this.calcNPad();let e=-1,t=0,n=this.soup.getResidueProxy();for(let r of s.a.range(this.soup.getResidueCount())){if(n.iRes=r,!n.isPolymer)continue;if(t!==n.iStructure||e!==n.iChain){e=n.iChain,t=n.iStructure;for(let r of s.a.range(this.nPadChar)){let i=null;0===r&&(i=this.soup.structureIds[t],i+=":"+this.soup.chains[e]),this.charEntries.push({chain:n.chain,iStructure:t,c:"",startLabel:i,iRes:null,ss:""})}}let i={iStructure:t,chain:n.chain,iRes:r,startLabel:null,ss:n.ss,label:n.resId+":"+n.resType,resNum:n.resNum},o=n.resType;i.c=o in fd?fd[o]:".",this.charEntries.push(i)}this.nChar=this.charEntries.length,this.iCharSeqStart=this.nPadChar,this.iCharStructStart=0,this.nCharStruct=this.nChar,this.iCharStructEnd=this.nChar}centerSeqOnIChar(e){this.iCharSeqStart=Math.max(e-.5*this.nCharSeq,0),this.iCharSeqStart=Math.min(this.iCharSeqStart,this.nChar-this.nCharSeq),this.iCharSeqStart=parseInt(this.iCharSeqStart),this.iCharSeqEnd=this.iCharSeqStart+this.nCharSeq}getColorStyle(e){if(e>=this.charEntries.length)return this.unclickableColor;let t=this.charEntries[e].iRes;return s.a.isNil(t)?this.unclickableColor:(this.residue.load(t),s.a.isNil(this.residue.activeColor)?this.unclickableColor:"#"+this.residue.activeColor.getHexString())}findFirstResidue(e){for(let t=e;t<this.nChar-1;t+=1){let e=this.charEntries[t+1];if(!s.a.isNil(e.iRes))return t}return null}checkChain(){this.nCharSeq=Math.ceil(this.width()/this.charWidth);let e=this.chain;if(this.iCharStructStart=0,this.nCharStruct=this.charEntries.length,this.iCharStructEnd=this.iCharStructStart+this.nCharStruct,"chain"===this.soupView.getMode()){let t=this.soup.getIStructureAndChain();if(s.a.isNil(t))this.chain=null;else{this.iCharStructStart=null;for(let e of s.a.range(this.charEntries.length)){let n=this.charEntries[e];n.iStructure===t.iStructure&&n.chain===t.chain&&(s.a.isNil(this.iCharStructStart)&&(this.iCharStructStart=e,this.chain=n.chain),this.iCharStructEnd=e+1)}if(this.nCharStruct=this.iCharStructEnd-this.iCharStructStart,s.a.isNil(e)&&!s.a.isNil(this.chain)){for(let e=this.iCharStructStart;e<this.iCharStructEnd;e+=1)if(s.a.has(this.charEntries[e],"iRes")){this.iCharSeqStart=e,this.iCharSeqEnd=this.iCharSeqStart+this.nCharSeq;break}}else if(this.iCharSeqStart<this.iCharStructStart||this.iCharSeqStart>=this.iCharStructEnd){let e=this.findFirstResidue(this.iCharStructStart);s.a.isNil(e)?this.iCharSeqStart=this.iCharStructStart:this.iCharSeqStart=e,this.iCharSeqEnd=this.iCharSeqStart+this.nCharSeq}}}this.iCharSeqStart+this.nCharSeq>this.charEntries.length&&(this.iCharSeqStart=this.iCharSeqEnd-this.nCharSeq),this.iCharSeqStart<0&&(this.iCharSeqStart=0),this.iCharSeqEnd=this.iCharSeqStart+this.nCharSeq}draw(){this.checkChain();let e=this.offsetY-2,t=this.offsetY+7,n=this.yTopSequence-e+2,r=e+n/2+2,i=this.yBottom-this.yTopSequence;if(this.fillRect(0,0,this.width(),this.height(),this.structBarBgroundColor),this.fillRect(0,this.yTopSequence,this.width(),i,this.seqBarBgroundColor),this.line(0,this.yTopSequence,this.width(),this.yTopSequence,1,this.borderColor),this.line(0,this.yBottom,this.width(),this.yBottom,1,this.borderColor),!mh(this.soupView))return;if(0===this.charEntries.length)return;let o,a=this.soupView.currentView.iAtom,l=this.soupView.soup.getAtomProxy(a).iRes,u=this.xStructFromIChar(this.iCharSeqStart),c=this.xStructFromIChar(this.iCharSeqEnd);this.fillRect(u,e,c-u,n,this.seqBarBgroundColor),this.line(0,r,this.width(),r,1,this.borderColor);let h,d=this.charEntries[0].ss,p=this.charEntries[0].c,f=this.getColorStyle(0),m=0,g=0;while(g<this.nChar){g+=1,h=this.getColorStyle(g);let e=this.charEntries[g],t=s.a.isNil(e)||g===this.nChar||e.ss!==d||h!==f;if(t){let t=this.xStructFromIChar(m),n=this.xStructFromIChar(g),i=this.heightStructureBar,o=r-i/2;""!==p&&("C"!==d&&"."!==d&&(o-=2,i+=4),this.fillRect(t,o,n-t,i,f)),g<=this.nChar-1&&(m=g,d=e.ss,p=e.c,f=h)}}this.line(0,this.yMidSequence,this.width(),this.yMidSequence,1,this.borderColor);for(let y=this.iCharSeqStart;y<this.iCharSeqEnd;y+=1){let e=this.charEntries[y];if(s.a.isUndefined(e)||""===e.c)continue;o=this.getColorStyle(y);let t=this.xSeqFromIChar(y),n=this.xSeqFromIChar(y+1),r=n-t,i=t+r/2,a=this.charHeight,u=this.yMidSequence-a/2;"C"!==e.ss&&"."!==e.ss&&(u-=4,a+=8),this.fillRect(t,u,r,a,o),this.text(e.c,i,this.yMidSequence,"7pt Helvetica","white","center"),this.soupWidget.isCrossHairs&&l>=0&&l===e.iRes&&this.strokeRect(t,u-5,r,a+10,this.highlightColor),e.resNum%20!==0&&1!==e.resNum||(this.line(t,this.yBottom,t,this.yBottom-6,1,this.borderColor),this.text(""+e.resNum,t+3,this.yBottom-6,"7pt Helvetica",this.borderColor,"left"))}this.line(u-1,e,c+1,e,1,this.borderColor),this.line(u-1,e,u-1,this.yTopSequence+1,1,this.borderColor),this.line(c+1,e,c+1,this.yTopSequence+1,1,this.borderColor);let v=0;while(v<this.nChar){if(this.charEntries[v].startLabel){let e=this.xStructFromIChar(v)+12;this.text(this.charEntries[v].startLabel,e,t,"7pt Helvetica","#666","left")}v+=1}}update(){let e=s.a.get(this.soupView,"targetView.iAtom"),t=this.soupView.soup.getAtomProxy(e).iRes;if(!s.a.isNil(t))for(let n in s.a.range(this.nChar))if(this.charEntries[n].iRes===t){(n<this.iCharSeqStart||n>=this.iCharSeqStart+this.nCharSeq)&&this.centerSeqOnIChar(n);break}this.draw()}mousemove(e){if(this.getPointer(e),this.pointerY<this.yTopSequence){this.hover.hide();let e=this.iCharFromXStruct(this.pointerX),t=this.charEntries[e];""!==s.a.get(t,"c","")&&(this.hover.html(t.label),this.hover.move(this.xStructFromIChar(e),25))}else{this.hover.hide();let e=this.iCharFromXSeq(this.pointerX),t=this.charEntries[e];if(""!==s.a.get(t,"c","")){this.hover.html(t.label);let n=this.xSeqFromIChar(e)+this.charWidth/2;this.hover.move(n,this.yMidSequence)}}if("top"===this.mousePressed)this.centerSeqOnIChar(this.iCharFromXStruct(this.pointerX)),this.draw();else if("bottom"===this.mousePressed){let e=this.iCharFromXSeq(this.pointerX),t=e-this.iCharPressed;this.iCharSeqStart-=t,this.draw()}}mouseout(){this.hover.hide(),this.mousePressed=""}mouseup(){this.isWaitForDoubleClick&&this.click(event),this.hover.hide(),this.mousePressed=""}doubleclick(e){console.log("SequenceWidget.doubleclick",this.pressSection,this.iCharPressed),this.getPointer(e);let t=null;t="bottom"===this.pressSection?this.iCharFromXSeq(this.pointerX):this.iCharFromXStruct(this.pointerX);let n=this.charEntries[t];if(!s.a.isNil(n.iRes)){"top"===this.pressSection?this.controller.selectSecondaryStructure(n.iRes):this.controller.setResidueSelect(n.iRes,!0);let e=this.soup.getResidueProxy(n.iRes);this.controller.triggerAtom(e.iAtom)}}click(e){let t=null;if(t="bottom"===this.pressSection?this.iCharFromXSeq(this.pointerX):this.iCharFromXStruct(this.pointerX),t===this.iCharPressed)if("top"===this.pressSection){let e=this.charEntries[this.iCharPressed];if(!s.a.isNil(e.iRes)){let t=e.iRes;this.controller.toggleSecondaryStructure(t)}}else if("bottom"===this.pressSection){let t=this.charEntries[this.iCharPressed];if(!s.a.isNil(t.iRes)){let n=t.iRes;e.metaKey||e.shiftKey?e.shiftKey?this.controller.selectAdditionalRangeToResidue(n):this.controller.selectAdditionalResidue(n):this.controller.selectResidue(n)}}}mousedown(e){e.preventDefault(),this.getPointer(e),this.saveMouse(),this.pointerY<this.yTopSequence?this.mousePressed="top":this.mousePressed="bottom";let t=(new Date).getTime(),n=this.timePressed?t-this.timePressed:0;n>600&&(this.isWaitForDoubleClick=!1),this.isWaitForDoubleClick?n<600&&(this.doubleclick(e),this.isWaitForDoubleClick=!1):(this.pressSection=this.mousePressed,"bottom"===this.pressSection?this.iCharPressed=this.iCharFromXSeq(this.pointerX):this.iCharPressed=this.iCharFromXStruct(this.pointerX),this.isWaitForDoubleClick=!0),this.timePressed=(new Date).getTime(),this.mousemove(e)}}class Gd extends zd{constructor(e,t){super(t),this.div.css("position","relative"),this.soupView=e.soupView,this.controller=e.controller,e.addObserver(this),this.maxZLength=0,this.div.css("box-sizing","border-box"),this.zFrontColor="rgb(150, 90, 90)"}resize(){this.div.css({width:this.width(),height:this.height()}),super.resize(),this.update()}x(){return 0}y(){return 0}width(){let e=this.parentDiv[0].getBoundingClientRect();return e.width-20}height(){return this.parentDiv.height()}xToZ(e){let t=e/this.width();return(.5-t)*this.maxZLength}zToX(e){let t=e/this.maxZLength;return(.5-t)*this.width()}update(){let e=this.soupView.soup,t=this.soupView.currentView.cameraParams;this.maxZLength=2*e.maxLength;let n=this.zToX(t.zBack),r=this.zToX(t.zFront),i=this.zToX(0),o=this.height()/2,s="9pt Helvetica";this.fillRect(0,0,this.width(),this.height(),"#999"),this.fillRect(0,o-3,this.width(),6,"#AAB"),this.fillRect(i,o-3,n-i,6,this.zFrontColor);let a=this.textWidth("back",s);this.fillRect(n-6-a,0,a+6,this.height(),"#666"),this.text("back",n-3-a,o,s,"#AAA","left"),this.fillRect(r,o-3,i-r,6,this.zFrontColor);let l=this.textWidth("front",s);this.fillRect(r,0,l+6,this.height(),"#666"),this.text("front",r+3,o,s,"#AAA","left"),this.line(i,0,i,this.height(),1,"#995555")}getZ(e){this.getPointer(e),this.z=this.xToZ(this.pointerX)}mousedown(e){this.getZ(e),this.z>0?(this.back=!0,this.front=!1):(this.front=!0,this.back=!1),super.mousedown(e)}mousemove(e){if(e.preventDefault(),super.mousemove(e),!this.mousePressed)return;this.getZ(e);let t=this.soupView.currentView.cameraParams,n=t.zBack,r=t.zFront;this.back?this.controller.setZoom(Math.max(2,this.z),r):this.front&&this.controller.setZoom(n,Math.min(-2,this.z)),this.update()}}class qd{constructor(e,t,n,r,o,s){this.soupView=e.soupView,this.controller=e.controller,this.elem=n,this.color=s,this.div=i()(t).text(n).addClass("jolecule-button").css("position","absolute").css("top",o+"px").css("left",r+"px").css("height","15px").css("width","20px").on("click touch",e=>{e.preventDefault(),this.toggle()}),this.update(),e.addObserver(this)}getToggle(){return this.soupView.soup.grid.isElem[this.elem]}toggle(){this.controller.toggleGridElem(this.elem),this.update()}update(){this.getToggle()?this.color?this.div.css("background-color",this.color):this.div.addClass("jolecule-button-toggle-on"):this.color?this.div.css("background-color",""):this.div.removeClass("jolecule-button-toggle-on")}}class Wd extends zd{constructor(e){super(e.divTag),this.soupWidget=e,this.soupView=e.soupView,this.controller=e.controller,e.addObserver(this),this.backgroundColor="#999",this.buttonHeight=40,this.sliderHeight=6*this.buttonHeight-30,this.isGrid=e.isGrid,this.div.css("display","none"),this.div.attr("id","grid-control"),this.div.css("height",this.height()),this.div.addClass("jolecule-button"),this.buttonsDiv=i()('<div id="grid-control-buttons">'),this.div.append(this.buttonsDiv)}rebuild(){if(!this.isGrid)return;this.buttonsDiv.empty();let e=10;for(let t of s.a.keys(this.soupView.soup.grid.isElem))this.makeElemButton(t,e),e+=this.buttonHeight;0===s.a.keys(this.soupView.soup.grid.isElem).length?this.div.hide():this.div.show()}makeElemButton(e,t){let n=dd[e],r="#"+n.getHexString(),o="grid-button-"+e.toLowerCase(),s="#"+o;this.buttonsDiv.append(i()(`<div id="${o}">`)),new qd(this.soupWidget,s,e,50,t,r)}resize(){this.isGrid&&(this.div.css({width:this.width(),height:this.height(),top:this.y(),left:this.x()}),this.canvasDom.width=this.width(),this.canvasDom.height=this.height())}width(){return 84}height(){return 6*this.buttonHeight+10}x(){let e=this.parentDiv.position();return e.left+5}y(){let e=this.parentDiv.position();return e.top+50}yToZ(e){let t=(e-20)/this.sliderHeight,n=this.soupView.soup.grid,r=n.bMax-n.bMin,i=t*r+n.bMin;return i<this.soupView.soup.grid.bMin&&(i=this.soupView.soup.grid.bMin),i>this.soupView.soup.grid.bMax&&(i=this.soupView.soup.grid.bMax),i}zToY(e){let t=this.soupView.soup.grid,n=t.bMax-t.bMin;return(e-t.bMin)/n*this.sliderHeight+20}update(){if(!this.isGrid)return;this.fillRect(0,0,this.width(),this.height(),this.backgroundColor);let e=20,t=this.zToY(this.soupView.soup.grid.bMin),n=this.zToY(this.soupView.soup.grid.bMax);this.fillRect(e-3,t,6,n-t,"#AAB");let r="10px sans-serif",i="#333",o=this.zToY(this.soupView.soup.grid.bCutoff),s=this.soupView.soup.grid.convertB(this.soupView.soup.grid.bCutoff).toFixed(2);this.fillRect(e-3,o,6,n-o,"rgb(150, 90, 90)"),this.fillRect(5,o,30,5,i),this.text(s,e,o-8,r,i,"center"),this.line(5,n,35,n,1,"#666"),s=this.soupView.soup.grid.convertB(this.soupView.soup.grid.bMax).toFixed(2),this.text(s,e,n+6,r,i,"center")}getZ(e){this.getPointer(e),this.z=this.yToZ(this.pointerY)}mousedown(e){e.preventDefault(),this.getZ(e),this.mousePressed=!0,this.mousemove(e)}mousemove(e){e.preventDefault(),this.mousePressed&&(this.getZ(e),this.controller.setGridCutoff(this.z),this.update())}mouseup(e){e.preventDefault(),this.mousePressed=!1}}class $d extends zd{constructor(e){super(e.divTag),this.offset={x:5,y:5},this.canvas.hide(),this.default(),this.div.css("display","block"),this.div.attr("id","color-legend"),this.div.addClass("jolecule-button"),this.div.css({padding:"8px",position:"absolute",height:"auto",width:"auto"}),this.buttonsDiv=i()("<div>").attr("id","color-legend-buttons").css("text-align","left"),this.div.append(this.buttonsDiv),this.isShow=!0,e.addObserver(this),this.rebuild()}default(){let e=e=>"#"+pd(e).getHexString();this.title="Secondary Structure",this.colorEntries=[{color:e("E"),label:"Strand"},{color:e("H"),label:"Helix"},{color:e("C"),label:"Coil"},{color:e("D"),label:"DNA/RNA"}]}rebuild(){this.buttonsDiv.empty(),this.title&&this.buttonsDiv.append(i()("<div>").text(this.title).css({"font-size":"0.8em","font-style":"italic"}));for(let[e,t]of this.colorEntries.entries()){let n="color-legend-"+e,r=i()("<div>").attr("id",n).css({"font-size":"0.8em","line-height":"1.5em",display:"block"}),o=i()("<div>").html("&block;").css({color:t.color,display:"inline","font-size":"1em","margin-right":"0.7em"});r.append(o),r.append(t.label),this.buttonsDiv.append(r)}this.resize(),this.update()}resize(){this.div.css({bottom:this.offset.y,left:this.offset.x})}width(){return 80}height(){return this.buttonsDiv.height()}update(){this.isShow?this.div.show():this.div.hide()}}class Xd extends zd{constructor(e){super(e.divTag),this.soupWidget=e,this.offset={x:5,y:5},this.canvas.hide(),this.div.css("display","block"),this.div.attr("id",e.webglDivId+"-selection"),this.div.addClass("jolecule-button"),this.div.css({padding:"8px",position:"absolute","max-width":"180px",height:"auto","font-size":"0.8em","text-align":"left"}),this.isShow=!1,e.addObserver(this)}resize(){this.div.css({bottom:this.offset.y,right:this.offset.x})}getText(){let e=this.soupWidget.soup,t=e.getResidueProxy(),n="",r=null,i=null,o=null,s=!1;for(let a=0;a<e.getResidueCount();a+=1)t.iRes=a,t.selected?(null!==o&&o===t.chain||(null!==o&&(n+="<br>"),o=t.chain,n+=e.structureIds[t.iStructure]+"-"+o+": ",s=!1),null===r?(r=t.resNum,i=t.resNum):i=t.resNum):null!==r&&(s?n+=", ":s=!0,n+=r===i?r:r+"-"+i,r=null,i=null);if(!n&&"chain"===this.soupWidget.soupView.getMode()&&e.selectedTraces.length>0){let t=e.selectedTraces[0],r=e.traces[t].indices[0],i=e.getResidueProxy(r),o=e.structureIds[i.iStructure];n+=`${o}-${i.chain}`}return n}async update(){let e=this.getText();e?(this.div.show(),this.div.html(e),this.resize()):this.div.hide()}}class Yd{constructor(e,t){this.controller=e.controller,this.soupView=e.soupView,this.soupWidget=e,this.soupWidget.addObserver(this),this.div=i()(t).css("z-index",2),this.divId=this.div.attr("id"),this.selectId=this.divId+"-residue-select",this.$select=i()("<select>").attr("id",this.selectId),this.div.append(this.$select),this.$select.change(()=>this.change()),this.$select.select2({width:"150px"})}change(){let e=parseInt(this.$select.val()),t=this.soupView.soup.getResidueProxy(e);this.controller.clearSelectedResidues(),this.controller.setResidueSelect(e,!0),this.controller.setTargetViewByIAtom(t.iAtom)}rebuild(){this.$select.empty(),this.soup=this.soupView.soup;let e=this.soup.getResidueProxy();for(let t of s.a.range(this.soup.getResidueCount())){if(e.iRes=t,"XXX"===e.resType)continue;let n=e.resId+"-"+e.resType;this.$select.append(new Option(n,""+t))}}update(){if(this.$select){let e=this.soupView.currentView.iAtom,t=this.soupView.soup.getAtomProxy(e).iRes,n=s.a.isNil(t)?null:""+t,r=this.$select.val();if(r!==n){let e=new Date;this.$select.val(n).trigger("change.select2");let t=(new Date-e)/1e3;console.log(`ResidueSelectorWidget.update ${r} -> ${n} in ${t.toFixed(3)}s`)}}}}class Zd{constructor(e,t,n=!0){this.soupWidget=e,this.controller=e.controller,this.isShowPanel=!1,this.isPopAbove=n,this.div=i()(t).html("Graphics").addClass("jolecule-button").on("click touch",e=>{this.isShowPanel=!this.isShowPanel,this.update(),e.preventDefault()}),this.divId=this.div.attr("id"),this.popOutPanelDiv=i()("<div>").addClass("jolecule-embed-view").css({position:"absolute","z-index":1,padding:"4px 5px"}),this.div.parent().append(this.popOutPanelDiv),this.widget={},this.popOutPanelDiv.append(i()(`<div id="${this.divId}-transparent">`)),this.widget.transparent=new Qd(e,`#${this.divId}-transparent`,"transparent"),this.popOutPanelDiv.append(i()(`<div id="${this.divId}-sphere">`)),this.widget.sphere=new Qd(e,`#${this.divId}-sphere`,"sphere"),this.popOutPanelDiv.append(i()(`<div id="${this.divId}-backbone">`)),this.widget.backbone=new Qd(e,`#${this.divId}-backbone`,"backbone"),this.popOutPanelDiv.append(i()(`<div id="${this.divId}-water">`)),this.widget.water=new Qd(e,`#${this.divId}-water`,"water"),this.popOutPanelDiv.append(i()(`<div id="${this.divId}-ribbon">`)),this.widget.ribbon=new Qd(e,`#${this.divId}-ribbon`,"ribbon"),this.popOutPanelDiv.append(i()(`<div id="${this.divId}-ligand">`)),this.widget.ligand=new Qd(e,`#${this.divId}-ligand`,"ligands"),this.soupWidget.addObserver(this),this.update()}update(){this.popOutPanelDiv.css("display",this.isShowPanel?"block":"none"),this.isShowPanel?this.div.addClass("jolecule-button-toggle-on"):this.div.removeClass("jolecule-button-toggle-on");let e=this.div.position();this.isPopAbove?this.popOutPanelDiv.css({top:e.top-this.popOutPanelDiv.outerHeight()-4,left:e.left-7}):this.popOutPanelDiv.css({top:e.top+this.div.outerHeight()+4,left:e.left-7});let t=this.popOutPanelDiv.position().left+this.popOutPanelDiv.width();t>e.left+this.div.width()&&this.popOutPanelDiv.css("left",e.left+this.div.width()-this.popOutPanelDiv.width())}}class Jd{constructor(e,t){this.soupWidget=e,this.controller=e.controller,this.div=i()(t).html(this.html()).addClass("jolecule-button").on("click touch",e=>{this.set(!this.get()),this.update(),e.preventDefault()}),this.soupWidget.addObserver(this)}html(){}get(){}set(e){}update(){this.get()?this.div.hasClass("jolecule-button-toggle-on")||this.div.addClass("jolecule-button-toggle-on"):this.div.hasClass("jolecule-button-toggle-on")&&this.div.removeClass("jolecule-button-toggle-on")}}class Qd extends Jd{constructor(e,t,n){super(e,t),this.option=n,this.div.html(this.html())}html(){return s.a.capitalize(this.option)}get(){return this.controller.getShowOption(this.option)}set(e){this.controller.setShowOption(this.option,e)}}class Kd extends Jd{constructor(e,t,n,r){super(e,t),this.state=n,this.text=r,this.div.html(this.html())}html(){return this.text}get(){return this.controller.getAnimateState()===this.state}set(e){e?this.controller.setAnimateState(this.state):this.controller.setAnimateState("none")}}class ep extends Jd{constructor(e,t){super(e,t),this.soupView=this.soupWidget.soupView,this.isText=!0}html(){return"Text"}get(){return this.isText}set(e){this.isText=e}async update(){if(super.update(),this.isText&&this.soupWidget){let e,t=this.soupView.savedViews.length;if(t>0){let n=this.soupView.currentView.order+1;e=`${n}/${t}: ${this.soupView.currentView.text}`,await this.soupWidget.asyncSetMesssage(e)}}else this.soupWidget.cleanupMessage()}}function tp(e){window.keyboardLock=!0;let t=i()("<div>").addClass("jolecule-dialog").css("display","block").css("z-index","5").css("width",Math.min(400,e.width()-100));function n(){t.remove(),window.keyboardLock=!1}let r=gh("close","jolecule-small-button",n),o=i()("<div>").css({width:"100%","box-sizing":"border-box","margin-bottom":"0.5em",padding:"1em"}).addClass("jolecule-view-text").html('<label>Jolecule is an embeddable WebGL molecular viewer with easy facilities to\n         make interactive slide shows. For more info, see\n         <a href="https://jolecule.com">jolecule.com</a>\n       </label>').keydown((function(e){if(27===e.keyCode)return n(),!0})),s=i()("<div>").css("width","100%").append(o).append(" ").append(r);t.append(s),vh(e,t,0,0),setTimeout(()=>{s.find("textarea").focus()},100)}class np{constructor(e,t,n,r=!0,o=!0){this.embedJolecule=e,this.soupWidget=this.embedJolecule.soupWidget,this.proteinDisplayDiv=i()(t),this.isToolbarOnTop=o,this.isChange=!0,this.isToggleOn=!r,this.buttonInDisplayOffset={x:0,y:0},this.toolbarDiv=i()(n),this.buttonInDisplayDiv=i()('<div id="toggle-toolbar-button">').html("&#9776;").addClass("jolecule-button").css({margin:"5px",position:"absolute"}).on("click touch",e=>{this.isChange=!0,this.update(),e.preventDefault()}),this.proteinDisplayDiv.append(this.buttonInDisplayDiv),this.buttonInToolbarDiv=i()('<div id="toggle-toolbar-button2">').html("&#9776;").addClass("jolecule-button").addClass("jolecule-button-toggle-on").on("click touch",e=>{this.isChange=!0,this.update(),e.preventDefault()}),this.toolbarDiv.append(this.buttonInToolbarDiv),this.soupWidget.addObserver(this),this.resize()}resize(){this.isToolbarOnTop?this.buttonInDisplayDiv.css({top:this.buttonInDisplayOffset.y,left:this.buttonInDisplayOffset.x}):this.buttonInDisplayDiv.css({bottom:this.buttonInDisplayOffset.y,left:this.buttonInDisplayOffset.x})}async update(){this.isChange&&(this.isToggleOn=!this.isToggleOn,this.isChange=!1,this.isToggleOn?(this.buttonInDisplayDiv.hide(),this.toolbarDiv.show()):(this.buttonInDisplayDiv.show(),this.toolbarDiv.hide()),this.isToolbarOnTop?this.isToggleOn?(this.soupWidget.messageOffset.x=5,this.soupWidget.messageOffset.y=5):(this.soupWidget.messageOffset.x=35,this.soupWidget.messageOffset.y=5):this.isToggleOn?this.embedJolecule.widget.colorLegend.offset.y=5:this.embedJolecule.widget.colorLegend.offset.y=50,this.resize(),this.embedJolecule.resize())}}var rp={LineElement:Vd,PopupText:Ud,AtomLabelsWidget:jd,DistanceMeasuresWidget:Bd,SequenceWidget:Hd,ClippingPlaneWidget:Gd,ColorLegendWidget:$d,SelectionWidget:Xd,GridControlWidget:Wd,ResidueSelectorWidget:Yd,ToggleOptionWidget:Qd,ToggleAnimateWidget:Kd,GraphicsMenuWidget:Zd,HudTextWidget:ep,openAboutDialog:tp,ToggleToolbarWidget:np};let ip=new ki({vertexColors:b}),op=new fl({vertexColors:b}),sp=new fl({opacity:.15,premultipliedAlpha:!0,vertexColors:b,transparent:!0});function ap(e){return(new ni).setHex(e+1)}function lp(e,t){for(let n of s.a.values(e.children))t.add(n)}class up{constructor(e){this.soup=e,this.displayObj=new ui,this.displayMaterial=op,this.pickingMaterial=ip,this.pickingObj=new ui,this.isTransparent=!1}setTransparent(e){this.isTransparent=e,this.isTransparent?this.displayMaterial=sp:this.displayMaterial=op}build(){}}class cp extends up{constructor(e,t=!1,n=[]){super(e),this.selectedTraces=s.a.cloneDeep(n),this.setTransparent(t),this.traces=[],this.build()}build(){if(this.traces=this.soup.traces,this.selectedTraces.length>0){let e=[];for(let[t,n]of this.traces.entries())s.a.includes(this.selectedTraces,t)&&e.push(n);this.traces=e}Dh(this.displayObj),Dh(this.pickingObj);let e=0;for(let o of this.traces)e+=o.points.length;let t=new Lh,n=(new Ci).fromGeometry(t);this.displayGeom=new $h(n,e),this.pickingGeom=new $h(n,e);let r=new ui,i=0;for(let o of this.traces){let e=o.points.length;for(let t of s.a.range(e)){let e=o.points[t],n=o.tangents[t],s=o.binormals[t],a=e.clone().add(n);r.matrix.identity(),r.position.copy(e),r.up.copy(s),r.lookAt(a),r.updateMatrix(),this.displayGeom.applyMatrixToCopy(r.matrix,i),this.pickingGeom.applyMatrixToCopy(r.matrix,i),this.pickingGeom.applyColorToCopy(o.indexColors[t],i),i+=1}}this.recolor(),this.displayObj.add(new Ui(this.displayGeom,this.displayMaterial)),this.pickingObj.add(new Ui(this.pickingGeom,this.pickingMaterial))}recolor(){let e=0,t=this.soup.getResidueProxy();for(let n of this.traces){let r=n.points.length;for(let i of s.a.range(r)){let r=n.refIndices[i],o=t.load(r).activeColor;this.displayGeom.applyColorToCopy(o,e),e+=1}}this.displayGeom.attributes.color.needsUpdate=!0}}class hp extends up{constructor(e,t=!1,n=[]){super(e),this.selectedTraces=s.a.cloneDeep(n),this.traces=[],this.setTransparent(t),this.build()}build(){if(this.traces=this.soup.traces,this.selectedTraces.length>0){let e=[];for(let[t,n]of this.traces.entries())s.a.includes(this.selectedTraces,t)&&e.push(n);this.traces=e}this.displayGeom=new Ph(this.traces,gd,!1),this.pickingGeom=new Ph(this.traces,gd,!0),Dh(this.displayObj),Dh(this.pickingObj);let e=new Ui(this.displayGeom,this.displayMaterial),t=new Ui(this.pickingGeom,this.pickingMaterial);this.displayObj.add(e),this.pickingObj.add(t),this.recolor()}recolor(){let e=this.soup.getResidueProxy();for(let t of this.traces)for(let n of s.a.range(t.points.length)){let r=t.refIndices[n];t.colors[n]=e.load(r).activeColor}this.displayGeom.setColors()}}class dp extends up{constructor(e,t=!1,n=null){super(e),this.selectedTraces=s.a.cloneDeep(n),this.setTransparent(t),this.traces=[],this.build()}build(){Dh(this.displayObj),Dh(this.pickingObj),this.displayObj.name="NucleotideRepresentation";let e=this.soup.getResidueProxy(),t=this.soup.getAtomProxy();function n(n){let r=e.getIAtom(n);return null===r?null:t.load(r).pos.clone()}let r=[];this.nucleotideColorList=[];let i=[];if(this.traces=this.soup.traces,this.selectedTraces.length>0){let e=[];for(let[t,n]of this.traces.entries())s.a.includes(this.selectedTraces,t)&&e.push(n);this.traces=e}for(let d of this.traces)for(let t of d.indices)if(e.iRes=t,"D"===e.ss&&e.isPolymer){let t=vd(e.resType),o=s.a.map(t,n);if(s.a.some(o,e=>null===e))continue;r.push(o),i.push(ap(e.iAtom)),this.nucleotideColorList.push(e.activeColor)}this.nucleotideGeom=new Rh(r,this.nucleotideColorList,.2);let o=new Ui(this.nucleotideGeom,this.displayMaterial);this.displayObj.add(o);let a=new Rh(r,i,.2),l=new Ui(a,this.pickingMaterial);this.pickingObj.add(l),this.nucleotideConnectList=[];for(let s of this.traces)for(let t of s.indices)if(e.iRes=t,"D"===e.ss&&e.isPolymer)for(let r of yd(e.resType)){let e=n(r[0]),i=n(r[1]);null!=e&&null!=i&&this.nucleotideConnectList.push([e,i,t])}let u=this.nucleotideConnectList.length,c=Uh(.4);this.nucleotideConnectorGeom=new $h(c,u);for(let s=0;s<u;s+=1){let[e,t,n]=this.nucleotideConnectList[s];this.nucleotideConnectorGeom.applyMatrixToCopy(jh(e,t,.3),s)}for(let s=0;s<u;s+=1){let[t,n,r]=this.nucleotideConnectList[s],i=e.load(r).activeColor;this.nucleotideConnectorGeom.applyColorToCopy(i,s)}let h=new Ui(this.nucleotideConnectorGeom,this.displayMaterial);h.name="nucleotideConnector",this.displayObj.add(h)}recolor(){this.nucleotideColorList=[];let e=this.soup.getResidueProxy();for(let n of this.traces)for(let t of n.indices)e.iRes=t,"D"===e.ss&&e.isPolymer&&this.nucleotideColorList.push(e.activeColor);this.nucleotideGeom.recolor(this.nucleotideColorList);let t=this.nucleotideConnectList.length;for(let n=0;n<t;n+=1){let[t,r,i]=this.nucleotideConnectList[n],o=e.load(i).activeColor;this.nucleotideConnectorGeom.applyColorToCopy(o,n)}this.nucleotideConnectorGeom.attributes.color.needsUpdate=!0}}class pp extends up{constructor(e,t=!1,n=[]){super(e),super.setTransparent(t),this.selectedTraces=s.a.cloneDeep(n),this.build()}setTransparent(e){super.setTransparent(e),this.ribbonRepr.setTransparent(e),this.arrowRepr.setTransparent(e),this.nucRepr.setTransparent(e)}build(){this.ribbonRepr=new hp(this.soup,this.isTransparent,this.selectedTraces),this.arrowRepr=new cp(this.soup,this.isTransparent,this.selectedTraces),this.nucRepr=new dp(this.soup,this.isTransparent,this.selectedTraces),Dh(this.displayObj),Dh(this.pickingObj),this.displayObj.name="CartoonRepr",lp(this.ribbonRepr.displayObj,this.displayObj),lp(this.arrowRepr.displayObj,this.displayObj),lp(this.nucRepr.displayObj,this.displayObj),lp(this.ribbonRepr.pickingObj,this.pickingObj),lp(this.arrowRepr.pickingObj,this.pickingObj),lp(this.nucRepr.pickingObj,this.pickingObj)}recolor(){this.ribbonRepr.recolor(),this.arrowRepr.recolor(),this.nucRepr.recolor()}}class fp{constructor(e,t,n,r=!1){this.soup=e,this.displayObj=new ui,this.pickingObj=new ui,this.atomIndices=t,this.atomRadius=n,this.displayMaterial=op,this.pickingMaterial=ip,this.isElementRadius=r,this.build()}build(){if(Dh(this.displayObj),Dh(this.pickingObj),0===this.atomIndices.length)return;let e=this.atomIndices.length,t=new Xa(1,8,8);this.displayGeom=new $h(t,e);let n=new $h(t,e),r=this.soup.getAtomProxy(),i=this.atomRadius;for(let o=0;o<e;o+=1){let e=this.atomIndices[o];r.iAtom=e,this.isElementRadius&&(i="H"===r.elem?1.2:1.7);let t=zh(r.pos,i);this.displayGeom.applyMatrixToCopy(t,o),n.applyMatrixToCopy(t,o),this.displayGeom.applyColorToCopy(r.color,o),n.applyColorToCopy(ap(e),o)}this.displayObj.add(new Ui(this.displayGeom,this.displayMaterial)),this.pickingObj.add(new Ui(n,this.pickingMaterial))}recolor(){if(0===this.atomIndices.length)return;let e=this.atomIndices.length,t=this.soup.getAtomProxy();for(let n=0;n<e;n+=1)t.iAtom=this.atomIndices[n],this.displayGeom.applyColorToCopy(t.color,n);this.displayGeom.attributes.color.needsUpdate=!0}}class mp extends fp{constructor(e,t){super(e,[],t)}build(){let e=this.soup.grid;this.atomIndices=[];let t=this.soup.getResidueProxy(),n=this.soup.getAtomProxy();for(let r of s.a.range(this.soup.getResidueCount()))t.iRes=r,"G"===t.ss&&(n.iAtom=t.iAtom,n.bfactor>e.bCutoff&&e.isElem[n.elem]&&this.atomIndices.push(n.iAtom));super.build()}}class gp extends fp{constructor(e){super(e,[],1.7,!0)}build(){this.soup.grid;this.atomIndices=[];let e=this.soup.getResidueProxy(),t=this.soup.getAtomProxy();for(let n of s.a.range(this.soup.getResidueCount()))if(e.iRes=n,e.isPolymer)for(let r of e.getAtomIndices())t.iAtom=r,this.atomIndices.push(r);this.isElementRadius=!0,super.build()}}class vp{constructor(e,t){this.soup=e,this.bondIndices=t,this.displayObj=new ui,this.pickingObj=new ui,this.displayMaterial=op,this.pickingMaterial=ip,this.build()}build(){Dh(this.displayObj),Dh(this.pickingObj);let e=this.bondIndices;if(0===e.length)return;let t=e.length,n=new il(1,1,1,4,1,!1);n.applyMatrix((new Dt).makeRotationFromEuler(new si(Math.PI/2,Math.PI,0))),this.displayGeom=new $h(n,t);let r=this.soup.getAtomProxy(),i=this.soup.getAtomProxy(),o=this.soup.getBondProxy(),s=this.soup.getResidueProxy();for(let l=0;l<t;l+=1){o.iBond=e[l],r.iAtom=o.iAtom1,i.iAtom=o.iAtom2,s.iRes=r.iRes;let t=r.pos.clone(),n=i.pos.clone();if(r.iRes!==i.iRes){let e=n.clone().add(t).multiplyScalar(.5);r.iRes===s.iRes?n=e:i.iRes===s.iRes&&(t=e)}let a=jh(t,n,.2);this.displayGeom.applyMatrixToCopy(a,l),this.displayGeom.applyColorToCopy(s.activeColor,l)}let a=new Ui(this.displayGeom,this.displayMaterial);this.displayObj.add(a)}recolor(){let e=this.bondIndices;if(0===e.length)return;let t=e.length,n=this.soup.getBondProxy(),r=this.soup.getAtomProxy(),i=this.soup.getResidueProxy();for(let o=0;o<t;o+=1)n.iBond=e[o],r.iAtom=n.iAtom1,i.iRes=r.iRes,this.displayGeom.applyColorToCopy(i.activeColor,o);this.displayGeom.attributes.color.needsUpdate=!0}}class yp{constructor(e,t){this.soup=e,this.radius=t,this.displayObj=new ui,this.pickingObj=new ui,this.build()}build(){Dh(this.displayObj),Dh(this.pickingObj);let e=[],t=[],n=this.soup.getAtomProxy(),r=this.soup.getResidueProxy();for(let i of s.a.range(this.soup.getResidueCount()))if(r.iRes=i,"-"===r.ss)for(let o of r.getAtomIndices()){n.iAtom=o,e.push(o);for(let e of n.getBondIndices())t.push(e)}this.atomRepr=new fp(this.soup,e,this.radius),this.bondRepr=new vp(this.soup,t),e.length>0&&(lp(this.atomRepr.displayObj,this.displayObj),lp(this.bondRepr.displayObj,this.displayObj),lp(this.atomRepr.pickingObj,this.pickingObj))}}class xp extends fp{constructor(e,t){super(e,[],t),this.name="water",this.atomIndices=[];let n=this.soup.getResidueProxy();for(let r of s.a.range(this.soup.getResidueCount()))n.iRes=r,"HOH"===n.resType&&this.atomIndices.push(n.iAtom);this.build()}}class bp{constructor(e,t){this.soup=e,this.displayObj=new ui,this.pickingObj=new ui,this.radius=t,this.build()}build(){Dh(this.displayObj),Dh(this.pickingObj);let e=[],t=[],n=this.soup.getAtomProxy(),r=this.soup.getResidueProxy();for(let i of s.a.range(this.soup.getResidueCount()))if(r.iRes=i,r.isPolymer&&r.sidechain)for(let o of r.getAtomIndices())if(n.iAtom=o,!yh(n.atomType,md)){e.push(o);for(let e of n.getBondIndices())t.push(e)}this.atomRepr=new fp(this.soup,e,this.radius),this.bondRepr=new vp(this.soup,t),lp(this.atomRepr.displayObj,this.displayObj),lp(this.bondRepr.displayObj,this.displayObj),lp(this.atomRepr.pickingObj,this.pickingObj)}recolor(){this.atomRepr.recolor(),this.bondRepr.recolor()}}class wp{constructor(e,t){this.soup=e,this.displayObj=new ui,this.pickingObj=new ui,this.radius=t,this.build()}build(){let e=[],t=[],n=this.soup.getAtomProxy(),r=this.soup.getResidueProxy();for(let i of s.a.range(this.soup.getResidueCount()))if(r.iRes=i,r.isPolymer)for(let o of r.getAtomIndices())if(n.iAtom=o,yh(n.atomType,md)){e.push(o);for(let e of n.getBondIndices())t.push(e)}this.atomRepr=new fp(this.soup,e,this.radius),this.bondRepr=new vp(this.soup,t),e.length>0&&(lp(this.atomRepr.displayObj,this.displayObj),lp(this.bondRepr.displayObj,this.displayObj),lp(this.atomRepr.pickingObj,this.pickingObj))}recolor(){this.atomRepr.recolor(),this.bondRepr.recolor()}}function _p(){if(requestAnimationFrame(_p),window.globalWidgets===[])return;let e=(new Date).getTime(),t=e-window.lastTime;for(let n of window.globalWidgets)n.animate(t);for(let n of window.globalWidgets)n.isChanged()&&n.drawFrame();window.lastTime=e}function Ap(e){"undefined"===typeof window.globalWidgets&&(window.globalWidgets=[],_p(),window.lastTime=(new Date).getTime()),window.globalWidgets.push(e)}class Sp{constructor(e,t){this.divTag=e,this.div=i()(this.divTag),this.div.css("overflow","hidden"),this.backgroundColor=t,this.div.css("background-color",this.backgroundColor),this.webglDivId=this.div.attr("id")+"-canvas-wrapper",this.webglDiv=i()("<div>").attr("id",this.webglDivId).css("overflow","hidden").css("box-sizing","border-box").css("z-index","0").css("background-color","#CCC").css("position","relative"),this.webglDiv.contextmenu(()=>!1),this.div.append(this.webglDiv),this.cameraParams={focus:new kt(0,0,0),position:new kt(0,0,-1),up:new kt(0,1,0),zFront:-40,zBack:20,zoom:1},this.camera=new _s(45,this.width()/this.height()),this.displayScene=new Cs,this.displayScene.background=new ni(this.backgroundColor),this.displayScene.fog=new Ts(this.backgroundColor,1,100),this.representations={},this.displayMeshes={},this.pickingMeshes={},this.pickingScene=new Cs,this.pickingTexture=new Ut(this.width(),this.height()),this.pickingTexture.texture.minFilter=xe,this.lights=[],this.buildLights(),this.messageOffset={x:5,y:5},this.messageDiv=i()("<div>").attr("id","loading-message").css("position","absolute").addClass("jolecule-overlay-text"),this.div.append(this.messageDiv),this.setMesssage("Initialized jolecule."),this.saveMouseX=null,this.saveMouseY=null,this.saveMouseR=null,this.saveMouseT=null,this.mouseX=null,this.mouseY=null,this.mouseR=null,this.mouseT=null}initWebglRenderer(){this.renderer=new Es({antialias:!0}),this.renderer.setClearColor(this.backgroundColor),this.renderer.setSize(this.width(),this.height());let e=this.renderer.domElement;this.webglDiv[0].appendChild(e);const t=(t,n)=>{e.addEventListener(t,n)};t("mousedown",e=>this.mousedown(e)),t("mousemove",e=>this.mousemove(e)),t("mouseup",e=>this.mouseup(e)),t("mouseleave",e=>this.mouseout(e)),t("mousewheel",e=>this.mousewheel(e)),t("DOMMouseScroll",e=>this.mousewheel(e)),t("touchstart",e=>this.mousedown(e)),t("touchmove",e=>this.mousemove(e)),t("touchend",e=>this.mouseup(e)),t("touchcancel",e=>this.mouseup(e)),t("gesturestart",e=>this.gesturestart(e)),t("gesturechange",e=>this.gesturechange(e)),t("gestureend",e=>this.gestureend(e))}render(){mh(this.renderer)||this.initWebglRenderer(),this.renderer.render(this.displayScene,this.camera)}getPosXY(e){let t=.5*this.width(),n=.5*this.height(),r=e.clone().project(this.camera);return{x:r.x*t+t+this.x(),y:-r.y*n+n+this.y()}}getPickColorFromMouse(){let e=this.mouseX,t=this.mouseY;if(null===e||null===t)return null;let n=new Uint8Array(4);return this.renderer.render(this.pickingScene,this.camera,this.pickingTexture),this.renderer.readRenderTargetPixels(this.pickingTexture,this.mouseX,this.pickingTexture.height-t,1,1,n),n[0]<<16|n[1]<<8|n[2]}setCameraParams(e){let t=this.cameraParams.position.clone().sub(this.cameraParams.focus).normalize(),n=e.position.clone().sub(e.focus);n.normalize();let r=Nh(t,n);for(let s=0;s<this.lights.length;s+=1)this.lights[s].position.applyQuaternion(r);this.cameraParams=e;let i=this.cameraParams.zoom+this.cameraParams.zBack,o=this.cameraParams.zoom+this.cameraParams.zFront;o<1&&(o=1),this.camera.position.copy(this.cameraParams.position),this.camera.up.copy(this.cameraParams.up),this.camera.lookAt(this.cameraParams.focus),this.camera.near=o,this.camera.far=i,this.camera.updateProjectionMatrix(),this.displayScene.fog.near=this.cameraParams.zoom,this.displayScene.fog.far=i}buildLights(){this.lights.length=0;let e=new pu(16777215);e.position.copy(fh.create(.2,.2,-100).normalize()),e.dontDelete=!0,this.lights.push(e);let t=new fu(6316128,1);t.dontDelete=!0,this.lights.push(t);for(let n=0;n<this.lights.length;n+=1)this.displayScene.add(this.lights[n])}resize(){let e=this.div.outerHeight();this.webglDiv.css("height",e);let t=this.div.outerWidth();this.webglDiv.css("width",t),this.messageDiv.css({top:this.messageOffset.y,left:this.messageOffset.x}),this.messageDiv.css("max-width",Math.max(.9*this.div.width()-40,this.div.width()-200)),this.camera.aspect=this.width()/this.height(),this.camera.updateProjectionMatrix(),this.pickingTexture.setSize(this.width(),this.height()),mh(this.renderer)&&this.renderer.setSize(this.width(),this.height())}setMesssage(e){console.log("SoupWidget.setMesssage:",e),this.messageDiv.html(e).show()}async asyncSetMesssage(e){this.setMesssage(e),await _h(0)}async asyncFlashMesssage(e,t){this.setMesssage(e),await _h(t),this.messageDiv.hide().html("")}cleanupMessage(){this.messageDiv.hide()}rebuildSceneFromMeshes(){Dh(this.displayScene),Dh(this.pickingScene);for(let e of s.a.values(this.displayMeshes))e.children.length>0&&this.displayScene.add(e);for(let e of s.a.values(this.pickingMeshes))e.children.length>0&&this.pickingScene.add(e)}setMeshVisible(e,t){e in this.displayMeshes&&Oh(this.displayMeshes[e],t),e in this.pickingMeshes&&Oh(this.pickingMeshes[e],t)}x(){return 0}y(){return 0}width(){let e=this.div.width()-this.x();return e}height(){let e=this.div.height()-this.y();return e}getPointer(e){mh(e.touches)&&e.touches.length>0?(this.eventX=e.touches[0].clientX,this.eventY=e.touches[0].clientY):(this.eventX=e.clientX,this.eventY=e.clientY);let t=e.target.getBoundingClientRect();this.mouseX=this.eventX-t.left,this.mouseY=this.eventY-t.top;let n=this.mouseX-this.width()/2,r=this.mouseY-this.height()/2;this.mouseR=Math.sqrt(n*n+r*r),this.mouseT=Math.atan(r/n),n<0&&(r>0?this.mouseT+=Math.PI:this.mouseT-=Math.PI)}savePointer(){this.saveMouseX=this.mouseX,this.saveMouseY=this.mouseY,this.saveMouseR=this.mouseR,this.saveMouseT=this.mouseT}}class Ep extends Sp{constructor(e,t,n,r,i,o){super(t,i),this.observers={rebuilt:new Fd.a,updated:new Fd.a,resized:new Fd.a},this.dataServer=null,this.soupView=e,this.soup=e.soup,this.controller=n,this.atomRadius=.35,this.gridAtomRadius=1,this.isCrossHairs=!0,this.buildCrossHairs(),this.isClickInitiated=!1,this.hover=new rp.PopupText(this.divTag,50),this.iAtomHover=null,this.isGrid=r,this.isMouseWheel=o,this.distanceMeasuresWidget=new rp.DistanceMeasuresWidget(this),this.atomLabelsWidget=new rp.AtomLabelsWidget(this),this.lineElement=new rp.LineElement(this,"#FF7777"),Ap(this)}addObserver(e){"update"in e&&this.observers.updated.add(()=>{e.update()}),"rebuild"in e&&this.observers.rebuilt.add(()=>{e.rebuild()}),"resize"in e&&this.observers.resized.add(()=>{e.resize()})}buildCrossHairs(){let e=2,t=60,n=new ks({color:16733525}),r=new al(e,t);r.vertices.shift(),this.crossHairs=new Vs(r,n),this.crossHairs.dontDelete=!0,this.displayScene.add(this.crossHairs)}setTargetViewByIAtom(e){this.controller.setTargetViewByIAtom(e)}getCameraOfCurrentView(){return this.soupView.currentView.cameraParams}getZ(e){let t=this.getCameraOfCurrentView(),n=t.focus.clone().sub(t.position).normalize(),r=e.clone().sub(t.focus);return r.dot(n)}inZlab(e){let t=this.getZ(e),n=this.getCameraOfCurrentView();return t>=n.zFront&&t<=n.zBack}opacity(e){let t=this.getZ(e),n=this.getCameraOfCurrentView();return t<n.zFront?1:t>n.zBack?0:1-(t-n.zFront)/(n.zBack-n.zFront)}updateCrossHairs(){let e=this.getCameraOfCurrentView();this.crossHairs.position.copy(e.focus),this.crossHairs.lookAt(e.position),this.crossHairs.updateMatrix()}atomLabelDialog(){let e=this.soupView.currentView.iAtom;if(e>=0){let t=this.soup.getAtomProxy(e),n="Label atom : "+t.label,r=t=>{this.controller.makeAtomLabel(e,t)};wh(this.div,n,r)}}getIAtomHover(){let e=this.getPickColorFromMouse();return e>0&&e<this.soup.getAtomCount()+1?e-1:null}popupText(e){let t=this.soup.getAtomProxy(e),n=t.label,r=t.iAtom;"XXX"===t.resType&&(n+=":E="+this.soup.grid.convertB(t.bfactor));let i="";return r===this.soupView.getICenteredAtom()?(i='<div style="text-align: center">',i+=n,i+="<br>[drag distances]<br>",i+="[double-click labels]",i+="</div>"):i=n,i}updateHover(){if(this.iAtomHover=this.getIAtomHover(),this.iAtomHover){this.hover.html(this.popupText(this.iAtomHover));let e=this.soup.getAtomProxy(this.iAtomHover).pos,t=this.getPosXY(e);this.hover.move(t.x,t.y)}else this.hover.hide()}addRepresentation(e,t){this.representations[e]=t,this.displayMeshes[e]=t.displayObj,this.pickingMeshes[e]=t.pickingObj,this.updateMeshesInScene=!0}buildScene(){for(let e of s.a.keys(this.displayMeshes))s.a.unset(this.displayMeshes,e);for(let e of s.a.keys(this.pickingMeshes))s.a.unset(this.pickingMeshes,e);this.addRepresentation("transparentRibbon",new pp(this.soup,!0)),this.addRepresentation("ribbon",new pp(this.soup,!1,this.soup.selectedTraces)),this.addRepresentation("ligand",new yp(this.soup,this.atomRadius)),this.isGrid&&this.addRepresentation("grid",new mp(this.soup,this.gridAtomRadius)),this.addRepresentation("sidechain",new bp(this.soup,this.atomRadius)),this.rebuildSceneFromMeshes(),this.observers.rebuilt.dispatch(),this.soupView.isChanged=!0,this.soupView.isUpdateObservers=!0}deleteStructure(e){this.controller.deleteStructure(e),this.buildScene(),this.observers.rebuilt.dispatch()}isChanged(){return this.soupView.isChanged}drawFrame(){if(!this.isChanged())return;let e=!this.soupView.soup.grid.isChanged&&!this.soupView.isUpdateSidechain&&!this.soupView.isUpdateColors;this.soupView.isStartTargetAfterRender&&e&&(this.soupView.startTargetView(),this.soupView.nUpdateStep=this.soupView.maxUpdateStep),this.updateMeshesInScene=!1;let t=(e,t)=>t&&!(e in this.displayMeshes),n=this.soupView.currentView.show;if(t("water",n.water)&&this.addRepresentation("water",new xp(this.soup,this.atomRadius)),t("backbone",n.backbone)&&this.addRepresentation("backbone",new wp(this.soup,this.atomRadius)),t("sphere",n.sphere)&&this.addRepresentation("sphere",new gp(this.soup)),this.setMeshVisible("ribbon",n.ribbon),this.setMeshVisible("transparentRibbon",n.ribbon&&n.transparent),this.setMeshVisible("water",n.water),this.setMeshVisible("backbone",n.backbone),this.setMeshVisible("ligand",n.ligands),this.setMeshVisible("sphere",n.sphere),n.transparent?s.a.isEqual(this.soup.selectedTraces,this.representations.ribbon.selectedTraces)||(this.representations.ribbon.selectedTraces=s.a.cloneDeep(this.soup.selectedTraces),this.representations.ribbon.build(),this.updateMeshesInScene=!0):this.representations.ribbon&&this.representations.ribbon.selectedTraces.length>0&&(this.representations.ribbon.selectedTraces.length=0,this.representations.ribbon.build(),this.updateMeshesInScene=!0),this.isGrid?this.soupView.soup.grid.isChanged&&(s.a.isUndefined(this.representations.grid)||(this.soup.colorResidues(),this.representations.grid.build()),this.soupView.soup.grid.isChanged=!1):this.soupView.soup.grid.isChanged=!1,this.soupView.isUpdateSidechain&&(this.representations.sidechain.build(),this.soupView.isUpdateSidechain=!1,this.updateMeshesInScene=!0),this.soupView.isUpdateColors){for(let e of s.a.values(this.representations))"recolor"in e&&e.recolor();this.soupView.isUpdateColors=!1,this.soupView.isUpdateObservers=!0}this.updateMeshesInScene&&this.rebuildSceneFromMeshes(),this.updateCrossHairs(),this.setCameraParams(this.getCameraOfCurrentView()),this.distanceMeasuresWidget.drawFrame(),this.render(),this.soupView.isUpdateObservers&&(this.observers.updated.dispatch(),this.soupView.isUpdateObservers=!1),this.atomLabelsWidget.drawFrame(),this.soupView.isChanged=!1}animate(e){this.soupView.animate(e),this.updateHover()}focus(){console.log("SoupWidget.focus")}resize(){super.resize(),this.observers.resized.dispatch(),this.soupView.isUpdateObservers=!0,this.controller.setChangeFlag()}doubleclick(e){null!==this.iAtomHover?(this.iAtomHover===this.soupView.getICenteredAtom()?this.atomLabelDialog():this.iAtomHover===this.iAtomPreClick&&this.controller.triggerAtom(this.iAtomHover),this.isDraggingCentralAtom=!1):this.controller.triggerAtom(),this.iAtomFirstPressed=null,this.iResFirstPressed=null,this.iAtomPreClick=null}click(e){let t=this.iAtomHover,n=this.soup.getAtomProxy(t).iRes;if(mh(n)&&n===this.iResFirstPressed)if(e.metaKey||e.shiftKey)e.shiftKey?this.controller.selectAdditionalRangeToResidue(this.iResFirstPressed):this.controller.selectAdditionalResidue(this.iResFirstPressed);else{let e=this.soup.getResidueProxy(n),t=!e.selected;this.controller.selectResidue(n,t)}else this.controller.clearSelectedResidues();this.iAtomFirstPressed=null,this.iResFirstPressed=null,this.getPointer(e),this.updateHover()}mousedown(e){if(this.focus(),this.isGesture)return;e.preventDefault(),this.getPointer(e),this.updateHover(),this.iAtomFirstPressed=this.iAtomHover,this.iResFirstPressed=this.soup.getAtomProxy(this.iAtomFirstPressed).iRes,this.iAtomFirstPressed===this.soupView.getICenteredAtom()&&(this.isDraggingCentralAtom=null!==this.iAtomFirstPressed);let t=(new Date).getTime(),n=this.timePressed?t-this.timePressed:0;this.isClickInitiated?n<600&&(this.doubleclick(e),this.isClickInitiated=!1):(this.iAtomPreClick=this.iAtomHover,this.isClickInitiated=!0),this.getPointer(e),this.savePointer(),this.timePressed=(new Date).getTime(),this.pointerPressedAndInDiv=!0}mousemove(e){if(e.preventDefault(),!this.isGesture)if(this.getPointer(e),this.updateHover(),this.isDraggingCentralAtom){let e=this.soup.getAtomProxy(this.soupView.getICenteredAtom()).pos,t=this.getPosXY(e);this.lineElement.move(this.mouseX+this.x(),this.mouseY+this.y(),t.x,t.y)}else{let t=2===e.button||3===e.which;if(this.pointerPressedAndInDiv){let n=1,r=0,i=0,o=0,s=this.mouseX-this.saveMouseX,a=this.mouseY-this.saveMouseY;if(this.isClickInitiated=!1,t||e.metaKey)r=this.mouseT-this.saveMouseT,this.mouseR>0&&(n=this.saveMouseR/this.mouseR);else if(e.ctrlKey)r=this.mouseT-this.saveMouseT;else if(e.shiftKey){let e=a/100;n=Math.pow(1+Math.abs(e)/2,e>0?1:-1)}else i=fh.degToRad(s),o=fh.degToRad(a);this.controller.adjustCamera(o,i,r,n),this.savePointer()}}}mouseout(e){this.hover.hide(),this.pointerPressedAndInDiv=!1}mouseup(e){if(this.getPointer(e),e.preventDefault(),this.isDraggingCentralAtom){if(null!==this.iAtomHover){let e=this.soupView.getICenteredAtom();this.iAtomHover!==e&&this.controller.makeDistance(this.iAtomHover,e)}this.lineElement.hide(),this.isDraggingCentralAtom=!1}this.isClickInitiated&&this.click(e),mh(e.touches)&&this.hover.hide(),this.pointerPressedAndInDiv=!1}mousewheel(e){if(console.log("SoupWidget.mousewheel",this.isMouseWheel),!this.isMouseWheel)return;if(this.isGesture)return;let t;e.preventDefault(),t=mh(e.wheelDelta)?e.wheelDelta/480:-e.detail/24,e.ctrlKey&&(t/=2,t*=-1);let n=Math.pow(1+Math.abs(t)/2,t>0?1:-1);this.controller.adjustCamera(0,0,0,n)}gesturestart(e){e.preventDefault(),this.isGesture=!0,this.lastPinchRotation=0,this.lastScale=e.scale*e.scale}gesturechange(e){e.preventDefault(),this.controller.adjustCamera(0,0,fh.degToRad(2*e.rotation-this.lastPinchRotation),this.lastScale/(e.scale*e.scale)),this.lastPinchRotation=2*e.rotation,this.lastScale=e.scale*e.scale}gestureend(e){e.preventDefault(),this.isGesture=!1,this.iAtomFirstPressed=null,this.iResFirstPressed=null,null!==this.isClickInitiated&&(clearTimeout(this.isClickInitiated),this.isClickInitiated=null),this.pointerPressedAndInDiv=!1}}n("f21a");let Mp={divTag:"",backgroundColor:0,viewId:"",viewHeight:170,isViewTextShown:!1,isSequenceBar:!0,isResidueSelector:!0,isLegend:!1,isEditable:!0,animateState:"none",isGrid:!1,bCutoff:.5,isPlayable:!1,maxUpdateStep:50,msPerStep:17,maxWaitStep:30,isToolbarOnTop:!1,isToolbarOn:!1,isTextOverlay:!0,isMouseWheel:!0};class Tp{constructor(e){this.params=s.a.cloneDeep(Mp),s.a.assign(this.params,e),console.log("EmbedJolecule.constructor",this.params),this.isProcessing={flag:!1},this.divTag=this.params.divTag,this.div=i()(this.params.divTag),this.divId=this.div.attr("id"),this.div[0].oncontextmenu=s.a.noop,this.soup=new kd,this.soupView=new Zh(this.soup),this.controller=new Jh(this.soupView),this.soupView.animateState=this.params.animateState,this.soupView.maxUpdateStep=this.params.maxUpdateStep,this.soupView.msPerStep=this.params.msPerStep,this.soupView.maxWaitStep=this.params.maxWaitStep,null!==this.params.bCutoff&&(this.soup.grid.bCutoff=this.params.bCutoff),this.widget={},this.createDivs();let t=()=>this.resize();i()(window).resize(t),window.onorientationchange=t,t()}async asyncAddDataServer(e){while(this.isProcessing.flag)await _h(100);console.log("EmbedJolecule.asyncAddDataServer",e),this.isProcessing.flag=!0,await this.soupWidget.asyncSetMesssage("Loading structure...");let t=e=>this.soupWidget.asyncSetMesssage(e);await new Promise(n=>{e.getProteinData(async e=>{await this.controller.asyncLoadProteinData(e,t),n()})}),this.soupWidget.buildScene(),this.resize(),this.controller.zoomOut(),s.a.isNil(this.soupView.dataServer)&&(await this.soupWidget.asyncSetMesssage("Preparing views..."),this.soupWidget.dataServer=e,await new Promise(t=>{e.getViews((e,n)=>{this.controller.loadViewsFromViewDicts(e),n&&(this.params.viewId=n);let r=this.params.viewId in this.soupView.savedViewsByViewId;r&&this.controller.setTargetViewByViewId(this.params.viewId),t()})}),this.soupView.isUpdateObservers=!0),this.soupWidget.cleanupMessage(),this.isProcessing.flag=!1,console.log("EmbedJolecule.asyncAddDataServer finished")}clear(){while(this.soupWidget.soup.structureIds.length>0)this.soupWidget.deleteStructure(0)}createDivs(){this.div.css({display:"flex","flex-direction":"column"}),this.headerDiv=i()("<div>").addClass("jolecule-embed-header").css({display:"flex","flex-wrap":"wrap","flex-direction":"row"}),this.div.append(this.headerDiv),this.bodyDiv=i()("<div>").attr("id",this.divId+"-jolecule-soup-display").addClass("jolecule-embed-body").css({flex:"1 1",position:"relative"}),this.div.append(this.bodyDiv),this.soupWidget=new Ep(this.soupView,`#${this.divId}-jolecule-soup-display`,this.controller,this.params.isGrid,this.params.backgroundColor,this.params.isMouseWheel),this.footerDiv=i()("<div>").addClass("jolecule-embed-footer").css({display:"flex","flex-wrap":"wrap","flex-direction":"row"}),this.div.append(this.footerDiv),this.sequenceBarDiv=i()("<div>").attr("id",this.divId+"-sequence-widget").css({width:"100%"}),this.params.isToolbarOnTop?this.footerDiv.append(this.sequenceBarDiv):this.headerDiv.append(this.sequenceBarDiv),this.params.isSequenceBar&&(this.widget.sequence=new rp.SequenceWidget(`#${this.divId}-sequence-widget`,this.soupWidget)),this.params.isGrid&&(this.widget.grid=new rp.GridControlWidget(this.soupWidget)),this.widget.colorLegend=new rp.ColorLegendWidget(this.soupWidget),this.widget.colorLegend.isShow=this.params.isLegend,this.widget.selection=new rp.SelectionWidget(this.soupWidget),this.params.isToolbarOnTop?this.toolbarDiv=this.headerDiv:(this.toolbarDiv=this.footerDiv,this.widget.selection.offset.y=5,this.widget.colorLegend.offset.y=5);let e=this.params.isPlayable||this.params.isEditable||this.params.isExtraEditable;e&&(this.toolbarDiv.css({display:"flex","flex-wrap":"wrap","flex-direction":"row"}).addClass("jolecule-embed-toolbar"),this.params.isToolbarOn&&(this.widget.toolbar=new rp.ToggleToolbarWidget(this,this.soupWidget.divTag,".jolecule-embed-toolbar",!1,this.params.isToolbarOnTop)),this.toolbarDiv.append(gh("?","jolecule-button",()=>{rp.openAboutDialog(this.soupWidget.div)})),this.params.isPlayable&&(this.toolbarDiv.append(i()(`<div id="${this.divId}-rotate">`)),this.widget.rotate=new rp.ToggleAnimateWidget(this.soupWidget,`#${this.divId}-rotate`,"rotate","&orarr;"),this.toolbarDiv.append(i()(`<div id="${this.divId}-rock">`)),this.widget.rotate=new rp.ToggleAnimateWidget(this.soupWidget,`#${this.divId}-rock`,"rock","&hArr;"),this.toolbarDiv.append(gh("<","jolecule-button",()=>{this.controller.setTargetToPrevView()})),this.toolbarDiv.append(i()(`<div id="${this.divId}-loop">`)),this.widget.loop=new rp.ToggleAnimateWidget(this.soupWidget,`#${this.divId}-loop`,"loop","Play"),this.toolbarDiv.append(gh(">","jolecule-button",()=>{this.controller.setTargetToNextView()})),this.params.isTextOverlay&&(this.toolbarDiv.append(i()(`<div id="${this.divId}-hud">`)),this.widget.hud=new rp.HudTextWidget(this.soupWidget,`#${this.divId}-hud`))),this.params.isEditable&&(this.params.isResidueSelector&&(this.toolbarDiv.append(i()("<div>").attr("id",this.divId+"-res-selector").addClass("jolecule-button").css({"padding-top":"6px",height:"24px","box-sizing":"content-box"})),this.widget.residueSelect=new rp.ResidueSelectorWidget(this.soupWidget,`#${this.divId}-res-selector`)),this.toolbarDiv.append(i()("<div>").attr("id",this.divId+"-clipping-plane").addClass("jolecule-button").css({flex:"1 1 80px",display:"flex","flex-diretion":"row","justify-content":"center","max-width":"40%"})),this.widget.clippingPlane=new rp.ClippingPlaneWidget(this.soupWidget,`#${this.divId}-clipping-plane`)),this.params.isEditable&&(this.toolbarDiv.append(gh("Zoom","jolecule-button",()=>{this.controller.zoomToSelection()})),this.toolbarDiv.append(gh("Clear","jolecule-button",()=>{this.controller.clear()})).append(gh("Sidechains","jolecule-button",()=>{this.controller.toggleSelectedSidechains()})).append(gh("Neighbors","jolecule-button",()=>{this.controller.toggleResidueNeighbors()})).append(i()("<div>").attr("id",this.divId+"-menu").addClass("jolecule-button")),this.widget.graphicsMenu=new rp.GraphicsMenuWidget(this.soupWidget,`#${this.divId}-menu`,!this.params.isToolbarOnTop)),this.headerDiv.contents().length>0&&this.headerDiv.css({"border-bottom":"2px solid #AAA"}),this.footerDiv.contents().length>0&&this.footerDiv.css({"border-top":"2px solid #AAA"}))}resize(){this.soupWidget.resize()}}n("d6ec");class Cp{constructor(e){this.params=e,this.div=i()("<div>").addClass("jolecule-view"),this.makeEditDiv(),this.makeShowDiv()}saveChange(){console.log("ViewPiece.saveChange");let e=this.editTextArea.val();this.editDiv.hide(),this.showDiv.show(),this.params.saveChange(e),window.keyboardLock=!1}startEdit(){this.params.pick(),this.editTextArea.text(this.params.view.text),this.editDiv.show(),this.showDiv.hide();let e=this.editTextArea.find("textarea");setTimeout((function(){e.focus()}),100),window.keyboardLock=!0}discardChange(){this.editDiv.hide(),this.showDiv.show(),window.keyboardLock=!1}makeEditDiv(){this.editTextArea=i()("<textarea>").addClass("jolecule-view-text").css("width","100%").css("height","5em").click(s.a.noop),this.editDiv=i()("<div>").css("width","100%").click(s.a.noop).append(this.editTextArea).append(gh("save","jolecule-small-button",e=>{this.saveChange()})).append(" &nbsp; ").append(gh("discard","jolecule-small-button",e=>{this.discardChange()})).hide(),this.div.append(this.editDiv)}makeShowDiv(){let e=this.params.view,t=gh("edit","jolecule-small-button",()=>{this.startEdit()});this.showTextDiv=i()("<div>").addClass("jolecule-button").css("height","auto").css("padding","0").css("background-color","#BBB").css("text-align","left").on("click touch",e=>{"A"===e.target.tagName?window.location.href=e.target.href:(e.preventDefault(),this.params.pick())}),this.showDiv=i()("<div>").css("width","100%").append(this.showTextDiv);let n=this.params.isEditable&&!e.lock&&"view:000000"!==e.id;n&&(this.showTextDiv.css("margin-bottom","7px"),this.showDiv.append(t),mh(this.params.swapUp)&&this.showDiv.append(" ").append(gh("up","jolecule-small-button",()=>{this.params.swapUp()})),mh(this.params.swapUp)&&this.showDiv.append(" ").append(gh("down","jolecule-small-button",()=>{this.params.swapDown()})),mh(this.params.deleteView)&&this.showDiv.append(i()("<div>").css("float","right").append(gh("delete","jolecule-small-button",()=>{console.log("ViewPiece.deleteButton"),this.params.deleteView()})))),this.div.append(this.showDiv)}}class Pp{constructor(e,t,n){this.divTag=e,this.soupWidget=t,this.soupView=t.soupView,this.controller=t.controller,this.isEditable=n,this.viewPiece={},this.subheaderDiv=i()("<div>").addClass("jolecule-sub-header").append("SAVED VIEWS &nbsp;"),this.div=i()(this.divTag).append(this.subheaderDiv).append(i()('<div id="jolecule-views">')),this.isEditable&&this.subheaderDiv.append(gh("Save","jolecule-button",()=>{this.saveCurrentView()}))}saveViewsToDataServer(e){console.log("ViewPanelList.saveViewsToDataServer"),this.soupWidget.dataServer.saveViews(this.controller.getViewDicts(),e)}update(){for(let r in this.viewPiece)r in this.soupView.savedViewsByViewId||(this.viewPiece[r].div.remove(),delete this.viewPiece[r]);let e=this.soupView.savedViews.length,t=this.soupView.iLastViewSelected;t>=this.soupView.savedViews.length&&(t=0,this.soupView.iLastViewSelected=t);let n=null;t<this.soupView.savedViews.length&&(n=this.soupView.savedViews[t].id);for(let r=0;r<e;r++){let t=this.soupView.savedViews[r],i=t.id;t.id in this.viewPiece||this.insertNewViewDiv(t.id),n===i?(this.viewPiece[i].div.removeClass("jolecule-unselected-box"),this.viewPiece[i].div.addClass("jolecule-selected-box")):(this.viewPiece[i].div.removeClass("jolecule-selected-box"),this.viewPiece[i].div.addClass("jolecule-unselected-box"));let o=this.viewPiece[i],s=t.order+1+"/"+e+": "+t.text;t.creator&&(s+=` <span class="jolecule-author">${t.creator}</span>`),s!==o.showTextDiv.html()&&o.showTextDiv.html(s)}if(n&&history.pushState){let e="?view_id="+n;"view:000000"===n&&(e="");let t=window.location.protocol+"//"+window.location.host+window.location.pathname+e;window.history.pushState({path:t},"",t)}}setTargetByViewId(e){this.controller.setTargetViewByViewId(e),this.update()}gotoPrevView(){this.controller.setTargetToPrevView(),this.update()}gotoNextView(){this.controller.setTargetToNextView(),this.update()}removeView(e){console.log("ViewPanelList.removeView"),this.viewPiece[e].div.css("background-color","lightgray"),this.soupWidget.dataServer.deleteView(e,()=>{this.controller.deleteView(e),this.update()})}swapViews(e,t){let n=this.soupView.savedViews[e].id,r=this.soupView.savedViews[t].id,i=this.viewPiece[n].div,o=this.viewPiece[r].div;this.controller.swapViews(e,t),i.css("background-color","lightgray"),o.css("background-color","lightgray"),this.saveViewsToDataServer(()=>{o.insertBefore(i),this.update(),i.css("background-color",""),o.css("background-color","")})}swapUp(e){let t=this.soupView.getIViewFromViewId(e);t<2||this.swapViews(t-1,t)}swapDown(e){let t=this.soupView.getIViewFromViewId(e);t>this.soupView.savedViews.length-2||this.swapViews(t,t+1)}makeViewDiv(e){let t=this.soupView.savedViewsByViewId[e];return this.viewPiece[e]=new Cp({view:t,isEditable:this.isEditable,deleteView:()=>{this.removeView(e)},saveChange:n=>{const r=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi;while(r.test(n))n=n.replace(r,"");t.text=n,this.viewPiece[e].div.css("background-color","lightgray"),this.saveViewsToDataServer(()=>{this.viewPiece[e].div.css("background-color",""),this.soupView.isChanged=!0,this.update()})},pick:()=>{this.setTargetByViewId(e)},swapUp:()=>{this.swapUp(e)},swapDown:()=>{this.swapDown(e)}}),this.viewPiece[e].div}makeAllViews(){for(let e=0;e<this.soupView.savedViews.length;e+=1){let t=this.soupView.savedViews[e].id,n=this.makeViewDiv(t);i()("#jolecule-views").append(n)}}insertNewViewDiv(e){let t=this.makeViewDiv(e);if(0===this.soupView.iLastViewSelected||this.soupView.iLastViewSelected===this.soupView.savedViews.length-1)i()("#jolecule-views").append(t);else{let e=this.soupView.iLastViewSelected-1,n=this.soupView.savedViews[e].id,r=this.viewPiece[n].div;t.insertAfter(r)}}saveCurrentView(){console.log("ViewPanelList.saveCurrentView");let e=this.controller.saveCurrentView();this.insertNewViewDiv(e),this.update();let t=this.viewPiece[e].div;t.css("background-color","lightgray"),this.saveViewsToDataServer(()=>{console.log("ViewPieceList.saveCurrentView success"),t.css("background-color",""),i()("#jolecule-views").stop().scrollTo(t,1e3,{offset:{top:-80}})})}}function Rp(e){let t=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))}class Lp{constructor(e,t,n){if(this.viewsDisplayTag=t,this.params={divTag:e,backgroundColor:13421772,viewId:"",viewHeight:170,isViewTextShown:!1,isSequenceBar:!0,isEditable:!0,isGrid:!0,bCutoff:.5,isPlayable:!1},mh(n)&&(this.params=s.a.assign(this.params,n)),!this.params.viewId){let e=Rp("view_id");e&&(this.params.viewId=e,console.log("FullPageJolecule.constructor viewId="+this.params.viewId))}this.embedJolecule=new Tp(this.params),this.embedJolecule.soupWidget.addObserver(this),document.oncontextmenu=s.a.noop,document.onkeydown=e=>{this.onkeydown(e)}}clear(){this.embedJolecule.clear()}async asyncAddDataServer(e){console.log("FullPageWidget.asyncAddDataServer"),await this.embedJolecule.asyncAddDataServer(e),this.viewPanelList||(this.soupView=this.embedJolecule.soupView,this.controller=this.embedJolecule.controller,this.soupWidget=this.embedJolecule.soupWidget,this.viewPanelList=new Pp(this.viewsDisplayTag,this.soupWidget,this.params.isEditable),this.viewPanelList.makeAllViews()),this.viewPanelList.update(),this.embedJolecule.resize()}update(){s.a.isUndefined(this.viewPanelList)||this.viewPanelList.update()}onkeydown(e){if(!window.keyboardLock){let t=String.fromCharCode(e.keyCode).toUpperCase();if("V"===t)this.viewPanelList.saveCurrentView();else if("K"===t||37===e.keyCode)this.controller.setTargetToPrevResidue();else if("J"===t||39===e.keyCode)this.controller.setTargetToNextResidue();else if(38===e.keyCode)this.viewPanelList.gotoPrevView();else if(" "===t||40===e.keyCode)this.viewPanelList.gotoNextView();else if("S"===t)this.controller.toggleShowOption("sphere");else if("B"===t)this.controller.toggleShowOption("backbone");else if("R"===t)this.controller.toggleShowOption("ribbon");else if("L"===t)this.controller.toggleShowOption("ligands");else if("W"===t)this.controller.toggleShowOption("water");else if("T"===t)this.controller.toggleShowOption("transparent");else if("E"===t){let e=this.soupWidget.soupView.iLastViewSelected;if(e>0){let t=this.soupWidget.soupView.savedViews[e].id;this.viewPanelList.viewPiece[t].startEdit()}}else if("N"===t)this.controller.toggleResidueNeighbors();else if("C"===t)this.controller.toggleSelectedSidechains();else if("X"===t){let e=this.soupView.getICenteredAtom();if(e>=0){let t=this.soupView.soup.getAtomProxy(e);this.controller.selectResidue(t.iRes)}}else if("A"===t)e.metaKey?(this.controller.selectAllSidechains(!0),e.preventDefault()):this.soupWidget.atomLabelDialog();else if(27===e.keyCode)this.controller.clear();else if("Z"===t||13===e.keyCode)this.controller.zoomToSelection();else{let e=parseInt(t)-1;if((e||0===e)&&e<this.soupView.savedViews.length){let t=this.soupView.savedViews[e].id;this.viewPanelList.setTargetByViewId(t)}}}}}function Op(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),n=parseInt(t[1],16)/255,r=parseInt(t[2],16)/255,i=parseInt(t[3],16)/255;return new ni(n,r,i)}function Dp(e){return/^\d+$/.test(e)}function Ip(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),n=parseInt(t[1],16),r=parseInt(t[2],16),i=parseInt(t[3],16);return`rgb(${n}, ${r}, ${i})`}function kp(e,t){if(!e)return[];if(!t)return e.split("").map((function(e,t){return t}));let n=[];for(let r=0;r<e.length;r+=1)e.substring(r,r+t.length)===t&&n.push(r);return n}const Np="\n  FY FW LI LM IM ST AG QE ND KR\n  FL FM FH IV YH YW SC HQ QN DE\n  FI FV LV LP LY LW IT IY IW MV \n  MY MW VP SA SN SQ PT PA TA TN \n  HN HW QK QD NE",Fp={};for(let qp of Np.split(/\s+/)){Fp[qp]=1;let e=qp.charAt(1)+qp.charAt(0);Fp[e]=1}function Vp(e,t){return e===t?"identical":s.a.has(Fp,e+t)?"conserved":"nonconserved"}class zp{reload(e,t){this.data=e,this.selectSeqId=this.data.sequences[0].primary_accession,this.pdbId=this.data.pdb_id,this.selectSeq="",console.log("AquariaAlignment.reload",this.data,this.pdbId,this.selectSeqId),this.alignEntries=[];for(let n of this.data.alignment.split(";")){let e=n.split(","),t=s.a.head(e).split(":"),[r,i,o,,a]=s.a.take(t,5);if(s.a.isNil(o))continue;let[l,u,c]=s.a.last(e).split(":"),h={pdbId:r,pdbChain:i,resNumPdbStart:o,resNumPdbEnd:a,seqId:l,resNumSeqStart:u,resNumSeqEnd:c};for(let n of s.a.keys(h))Dp(h[n])&&(h[n]=parseInt(h[n]));this.alignEntries.push(h)}this.setEmbedJolecule(t)}mapSeqResToPdbResOfChain(e,t,n){for(let r of this.alignEntries)if(t>=r.resNumSeqStart&&t<=r.resNumSeqEnd&&n===r.pdbChain){let e=t-r.resNumSeqStart,n=r.resNumPdbStart+e;return[r.pdbId,r.pdbChain,n]}return null}mapSeqResToPdbResList(e){let t=[];for(let n of this.alignEntries)if(e>=n.resNumSeqStart&&e<=n.resNumSeqEnd){let r=e-n.resNumSeqStart,i=n.resNumPdbStart+r;t.push([n.pdbId,n.pdbChain,i])}return t}mapPdbResOfChainToSeqRes(e,t){for(let n of this.alignEntries)if(e===n.pdbChain&&t>=n.resNumPdbStart&&t<=n.resNumPdbEnd){let e=this.getISeqFromSeqId(n.seqId),r=this.data.common_names[e];r||(r=null);let i=t-n.resNumPdbStart,o=n.resNumSeqStart+i,s=this.data.sequences[e].sequence[o-1];return[r,o,s]}return[null,null,null]}getChainsThatMapToSeqId(e){let t=[];for(let n of s.a.range(this.data.pdb_chain.length))this.data.sequences[n].primary_accession===e&&t.push(this.data.pdb_chain[n]);return t}getISeqFromSeqId(e){let t=this.data.sequences;for(let n of s.a.range(t.length)){if(t[n].primary_accession===e)return n;let r=this.data.pdb_id+"-"+this.data.pdb_chain[n];if(r===e)return n}return null}mapSeqResToPdbResColorEntry(e,t,n){let r=this.getChainsThatMapToSeqId(e),i=[];for(let o of this.mapSeqResToPdbResList(t)){let[e,t,a]=o;s.a.includes(r,t)&&i.push({pdbId:e,chain:t,resNum:a,color:Ip(n)})}return i}colorSoup(e){e.setSecondaryStructureColorResidues();let t=[];for(let r of s.a.range(this.data.sequences.length))s.a.isNil(this.data.sequences[r].primary_accession)||t.push(this.data.pdb_chain[r]);let n=e.getResidueProxy();for(let r=0;r<e.getResidueCount();r+=1){n.iRes=r;let e=n.chain,i=n.resNum,o=s.a.get(fd,n.resType,"."),[,a,l]=this.mapPdbResOfChainToSeqRes(e,i);s.a.isNil(a)?n.customColor="#999999":s.a.includes(t,n.chain)?"conserved"===Vp(l,o)?n.customColor="#586C7C":"nonconserved"===Vp(l,o)&&(n.customColor="#4D4D4D"):n.customColor="#999999"}e.colorResidues()}setColorLegend(e){e.default(),e.colorEntries.push({color:"#586C7C",label:"Conserved"}),e.colorEntries.push({color:"#4D4D4D",label:"Nonconserved"}),e.rebuild()}setFullSequence(e){let t=e.soup;e.charEntries.length=0,e.nChar=0;let n=this.data.pdb_id,r=this.data.pdb_chain;for(let i=0;i<r.length;i+=1){let o=r[i],a=this.data.sequences[i].sequence,l=this.data.sequences[i].primary_accession,u=this.data.common_names[i];s.a.isNil(l)&&(l=""),console.log("AquariaAlignment.setFullSequence",i,l,u);for(let r=0;r<a.length;r+=1){if(0===r)for(let t of s.a.range(e.nPadChar)){let r=null;0===t&&(r="",u&&(r+=u+", "),r+=n+"-"+o);let i={iStructure:0,chain:o,c:"",startLabel:r,ss:""};e.charEntries.push(i)}let i=a[r],c=r+1,h=this.mapSeqResToPdbResOfChain(l,c,o),d="";if(u&&(d=`Sequence: ${u} ${i}${c}<br>`),s.a.isNil(h)){let t={iStructure:0,chain:o,c:i,startLabel:null,ss:".",label:d+"Structure: [No match]",resNum:r+1};e.charEntries.push(t)}else{let[n,o,a]=h,l=t.findFirstResidue(o,a);if(s.a.isNil(l)){let t={chain:o,iStructure:0,c:i,startLabel:null,ss:".",label:d+"Structure: [No match]",resNum:r+1};e.charEntries.push(t)}else{let t=s.a.get(fd,l.resType,"."),u={chain:o,iStructure:l.iStructure,c:i,startLabel:null,iRes:l.iRes,ss:l.ss,label:`${d}Structure: ${n}-${o} ${t}${a}`,resNum:r+1};e.charEntries.push(u)}}}}e.nChar=e.charEntries.length}colorFromFeatures(e,t,n,r){let i=e.soupView.soup,o=i.getResidueProxy();for(let s=0;s<i.getResidueCount();s+=1)o.iRes=s,o.customColor=Op("#999999");for(let a of t){let e=parseInt(a.Residue);for(let t of this.mapSeqResToPdbResColorEntry(n,e,a.Color)){let e=i.findFirstResidue(t.chain,t.resNum);s.a.isNil(e)||(e.customColor=t.color)}}i.colorResidues(),e.soupView.isUpdateColors=!0,e.soupView.isChanged=!0,this.setFeatureColorLegend(e.widget.colorLegend,t,r)}setFeatureColorLegend(e,t,n){this.features=t;let r=[];for(let i of t){let e=s.a.find(r,e=>e.color===i.Color);e?e.label.push(i.Name):r.push({color:i.Color,label:[i.Name]})}for(let i of r){i.label=s.a.uniq(i.label),i.label=s.a.join(i.label,", ");let e=50;i.label.length>e&&(i.label=i.label.substring(0,e-3)+"...")}e.colorEntries.length=0;for(let i of r)e.colorEntries.push(i);e.title=n,e.rebuild()}colorFromConservation(e){e.soupView.isUpdateObservers=!0,e.soupView.isUpdateColors=!0,e.soupView.isChanged=!0,this.colorSoup(e.soup),this.setColorLegend(e.widget.colorLegend)}selectNewChain(e,t,n,r){console.log("AquariaAlignment.selectNewChain [overriddeable]",e,t,n,r)}setPopup(e){let t=e.soup;e.soupWidget.popupText=e=>{let n=this.data.pdb_id,r=t.getAtomProxy(e),i=r.iRes,o=t.getResidueProxy(i),[a,l,u]=this.mapPdbResOfChainToSeqRes(o.chain,o.resNum),c=s.a.get(fd,o.resType,"."),h=`Structure: ${n}-${o.chain} ${c}${o.resNum} <br>Atom: ${r.atomType}`;if(s.a.isNil(l))h="Sequence: [No match]<br>"+h;else if(h=a?`Sequence: ${a} ${u}${l} <br>`+h:"Sequence: [No match]<br>"+h,this.features)for(let t of this.features)t.Residue===l&&(h+="<br>Feature: "+t.Name,t.Description&&(t.Name&&(h+=" - "),h+=""+t.Description));return h}}getSelectionText(){if(s.a.isNil(this.embedJolecule))return"";let e=this.embedJolecule.soup,t=e.getResidueProxy(),n=[],r=null,i={},o=null,a=null,l=null,u=null;for(let h=0;h<e.getResidueCount();h+=1)if(t.iRes=h,t.selected){let[c,h,d]=this.mapPdbResOfChainToSeqRes(t.chain,t.resNum);if(null===r||r!==t.chain){i={pdbChain:e.structureIds[t.iStructure]+"-"+t.chain,seqName:c,firstPdbRes:null,firstSeqRes:null,pdbResRanges:[],seqResRanges:[]},n.push(i);let o=s.a.get(fd,t.resType,".");i.firstPdbRes=o+t.resNum,i.firstSeqRes=d+h,r=t.chain}null===o?(o=t.resNum,a=o,l=h,u=l):(a=t.resNum,u=h)}else null!==o&&(i.pdbResRanges.push([o,a]),i.seqResRanges.push([l,u])),o=null;let c="";if(this.selectSeq&&(c+=`SEQUENCE: "${this.selectSeq}" <br>`),n.length>0)for(let[h,d]of n.entries()){if(d.pdbResRanges.length>0){c+=d.pdbChain+": ";let e=d.pdbResRanges[0],t=e[0]===e[1];if(1===d.pdbResRanges.length&&t)c+=d.firstPdbRes;else for(let[n,r]of s.a.toPairs(d.pdbResRanges))n>0&&(c+=", "),r[0]===r[1]?c+=r[0]:c+=` ${r[0]}-${r[1]}`;c+="<br>"}if(d.seqName&&d.seqResRanges.length>0){c+=d.seqName+": ";let e=d.seqResRanges[0],t=e[0]===e[1];if(1===d.seqResRanges.length&&t)c+=d.firstSeqRes;else for(let[n,r]of s.a.toPairs(d.seqResRanges))n>0&&(c+=", "),r[0]===r[1]?c+=r[0]:c+=` ${r[0]}-${r[1]}`;c+="<br>"}}return c}copyToClipboard(){let e="",t=this.embedJolecule.soup,n=this.data.pdb_chain,r=this.data.pdb_id;for(let i=0;i<n.length;i+=1){let o=n[i],a=this.data.sequences[i].sequence,l=this.data.sequences[i].primary_accession,u=this.data.common_names[i],c=`${r}-${o}`,h=c+"_SELECTED";s.a.isNil(l)&&(l=""),s.a.isNil(u)&&(u="SEQUENCE");let d="",p="";for(let e=0;e<a.length;e+=1){let n=e+1,r=this.mapSeqResToPdbResOfChain(l,n,o),i="-",a="-";if(!s.a.isNil(r)){let[,e,n]=r,o=t.findFirstResidue(e,n);s.a.isNil(o)||(i=s.a.get(fd,o.resType,"-"),o.selected&&(a=i))}d+=i,p+=a}let f=[{name:u,seq:a},{name:c,seq:d},{name:h,seq:p}],m=s.a.max(s.a.map(f,e=>e.name.length)),g=s.a.max(s.a.map(f,e=>e.seq.length)),v=50,y=Math.ceil(g/v),x="";for(let e=0;e<y;e+=1){for(let t=0;t<f.length;t+=1){let n=f[t];x+=s.a.padEnd(n.name,m)+" ",x+=n.seq.substring(e*v,(e+1)*v),x+="\n"}x+="\n"}e+=x}return console.log("AquariaAlignment.copyToClipboard"),console.log(e),Ah(e),e}selectNextChar(e){this.selectSeq+=e;let t=this.embedJolecule.soup;this.embedJolecule.controller.clearSelectedResidues();let n=this.data.pdb_chain,r=this.selectSeq.length;for(let i=0;i<n.length;i+=1){let e=n[i],o=this.data.sequences[i].sequence,a=this.data.sequences[i].primary_accession;s.a.isNil(a)&&(a="");for(let n of kp(o,this.selectSeq))for(let i=n;i<n+r;i+=1){let n=this.mapSeqResToPdbResOfChain(a,i+1,e);if(!s.a.isNil(n)){let[,e,r]=n,i=t.findFirstResidue(e,r);s.a.isNil(i)||this.embedJolecule.controller.setResidueSelect(i.iRes,!0)}}}this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.timeoutId=null,this.selectSeq="",this.embedJolecule.soupView.isUpdateObservers=!0,this.embedJolecule.soupView.isChanged=!0,console.log("AquariaAlignment.selectNextChar settimeout cancel")},4e3)}setSelectionPanel(e){let t=e.widget.selection;t.getText=()=>this.getSelectionText()}setEmbedJolecule(e){e.soupView.setMode("chain"),e.soupWidget.isCrossHairs=!1,e.soupWidget.crossHairs.visible=!1,e.soupView.setMode("chain"),this.setFullSequence(e.widget.sequence),e.widget.sequence.update();for(let[t,n]of this.data.sequences.entries())if(!s.a.isNil(n.primary_accession)){let n=this.data.pdb_chain[t];console.log("AquariaAlignment.setEmbedJolecule",n),e.controller.selectChain(0,n);break}s.a.isNil(e.soupWidget.isAquariaTracking)&&(e.soupWidget.addObserver(this),e.soupWidget.isAquariaTracking=!0,this.embedJolecule=e),this.colorFromConservation(e),this.setPopup(e),this.setSelectionPanel(e)}update(){let e=this.embedJolecule.soup.getIStructureAndChain();if(s.a.isNil(e))this.selectNewChain(null,null,null,null);else{let t=s.a.findIndex(this.data.pdb_chain,t=>t===e.chain);if(t>=0){this.selectSeqId=this.data.sequences[t].primary_accession;let n=this.data.common_names[t],r=this.embedJolecule.soup.structureIds[e.iStructure];this.selectNewChain(this.selectSeqId,n,r,e.chain)}else console.log("AquariaAlignment.update error, chain not found in alignment:",e.chain,this.data.pdb_chain,this.data)}}}function Up(e){return new Tp(s.a.merge(Mp,e))}function jp(...e){return new Lp(...e)}let Bp={pdbId:"",userId:"",isDisableSaveViews:!0,saveViewsUrl:"",isLoadViews:!1,biounit:0,viewId:""};function Hp(e){return e=s.a.merge(Bp,e),console.log("makePdbDataServer",e),Gp(e.pdbId,e.userId,e.isDisableSaveViews,e.saveViewsUrl,e.isLoadViews,e.biounit,e.viewId)}function Gp(e,t=null,n=!1,r="",o=!0,s=0,a=""){return{pdbId:e,getProteinData:function(t){let n;n=4===e.length?s?`https://files.rcsb.org/download/${e}.pdb${s}`:`https://files.rcsb.org/download/${e}.pdb`:`${r}/pdb/${e}.txt`,i.a.get(n).done(r=>{let i={pdbId:e,pdbText:r};console.log(`makeDataServer.getProteinData success ${n} biounit:${s}`),t(i)}).fail(()=>{console.log(`makeDataServer.getProteinData fail ${n} biounit:${s}`),t({pdbId:e,pdbText:""})})},getViews:function(n){if(!o)return void n([]);let s=`${r}/pdb/${e}.views.json`;t&&(s+="?user_id="+t),i.a.getJSON(s).done(e=>{console.log("makeDataServer.getViews",s,e),n(e,a)}).fail(()=>{console.log("makeDataServer.getViews fail",s),n([])})},saveViews:function(e,t){n?t():i.a.post(r+"/save/views",JSON.stringify(e)).done(()=>{console.log("makeDataServer.saveViews success","/save/views",e),t(!0)}).fail(()=>{console.log("makeDataServer.saveViews fail","/save/views",e),t(!1)})},deleteView:function(t,o){n?o():i.a.post(r+"/delete/view",JSON.stringify({pdbId:e,viewId:t})).done(()=>{console.log("makeDataServer.deleteView success",t),o(!0)}).fail(()=>{console.log("makeDataServer.deleteView fail",t),o(!1)})}}}},"5cc6":function(e,t,n){var r=n("74e8");r("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"5cf5":function(e,t,n){"use strict";e.exports=function(e,t,n){var r=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d="errs__"+i,p=e.util.copy(e),f="";p.level++;var m="valid"+p.level,g="i"+i,v=p.dataLevel=e.dataLevel+1,y="data"+v,x=e.baseId,b=e.opts.strictKeywords?"object"==typeof s&&Object.keys(s).length>0:e.util.schemaHasRules(s,e.RULES.all);if(r+="var "+d+" = errors;var "+h+";",b){var w=e.compositeRule;e.compositeRule=p.compositeRule=!0,p.schema=s,p.schemaPath=a,p.errSchemaPath=l,r+=" var "+m+" = false; for (var "+g+" = 0; "+g+" < "+c+".length; "+g+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers,!0);var _=c+"["+g+"]";p.dataPathArr[v]=g;var A=e.validate(p);p.baseId=x,e.util.varOccurences(A,y)<2?r+=" "+e.util.varReplace(A,y,_)+" ":r+=" var "+y+" = "+_+"; "+A+" ",r+=" if ("+m+") break; }  ",e.compositeRule=p.compositeRule=w,r+=" "+f+" if (!"+m+") {"}else r+=" if ("+c+".length == 0) {";var S=S||[];S.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(r+=" , message: 'should contain a valid item' "),e.opts.verbose&&(r+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var E=r;return r=S.pop(),!e.compositeRule&&u?e.async?r+=" throw new ValidationError(["+E+"]); ":r+=" validate.errors = ["+E+"]; return false; ":r+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } else { ",b&&(r+="  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; } "),e.opts.allErrors&&(r+=" } "),r}},"5cf7":function(e,t,n){"use strict";function r(e){var t=this;if(t instanceof r||(t=new r),t.tail=null,t.head=null,t.length=0,e&&"function"===typeof e.forEach)e.forEach((function(e){t.push(e)}));else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)t.push(arguments[n]);return t}function i(e,t,n){var r=t===e.head?new a(n,null,t,e):new a(n,t,t.next,e);return null===r.next&&(e.tail=r),null===r.prev&&(e.head=r),e.length++,r}function o(e,t){e.tail=new a(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function s(e,t){e.head=new a(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function a(e,t,n,r){if(!(this instanceof a))return new a(e,t,n,r);this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}e.exports=r,r.Node=a,r.create=r,r.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t},r.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},r.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},r.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)o(this,arguments[e]);return this.length},r.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)s(this,arguments[e]);return this.length},r.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},r.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},r.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,r=0;null!==n;r++)e.call(t,n.value,r,this),n=n.next},r.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,r=this.length-1;null!==n;r--)e.call(t,n.value,r,this),n=n.prev},r.prototype.get=function(e){for(var t=0,n=this.head;null!==n&&t<e;t++)n=n.next;if(t===e&&null!==n)return n.value},r.prototype.getReverse=function(e){for(var t=0,n=this.tail;null!==n&&t<e;t++)n=n.prev;if(t===e&&null!==n)return n.value},r.prototype.map=function(e,t){t=t||this;for(var n=new r,i=this.head;null!==i;)n.push(e.call(t,i.value,this)),i=i.next;return n},r.prototype.mapReverse=function(e,t){t=t||this;for(var n=new r,i=this.tail;null!==i;)n.push(e.call(t,i.value,this)),i=i.prev;return n},r.prototype.reduce=function(e,t){var n,r=this.head;if(arguments.length>1)n=t;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var i=0;null!==r;i++)n=e(n,r.value,i),r=r.next;return n},r.prototype.reduceReverse=function(e,t){var n,r=this.tail;if(arguments.length>1)n=t;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var i=this.length-1;null!==r;i--)n=e(n,r.value,i),r=r.prev;return n},r.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;null!==n;t++)e[t]=n.value,n=n.next;return e},r.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;null!==n;t++)e[t]=n.value,n=n.prev;return e},r.prototype.slice=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,o=this.head;null!==o&&i<e;i++)o=o.next;for(;null!==o&&i<t;i++,o=o.next)n.push(o.value);return n},r.prototype.sliceReverse=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var n=new r;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,o=this.tail;null!==o&&i>t;i--)o=o.prev;for(;null!==o&&i>e;i--,o=o.prev)n.push(o.value);return n},r.prototype.splice=function(e,t){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var n=0,r=this.head;null!==r&&n<e;n++)r=r.next;var o=[];for(n=0;r&&n<t;n++)o.push(r.value),r=this.removeNode(r);null===r&&(r=this.tail),r!==this.head&&r!==this.tail&&(r=r.prev);for(n=2;n<arguments.length;n++)r=i(this,r,arguments[n]);return o},r.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=t,this.tail=e,this};try{n("1f03")(r)}catch(l){}},"5f96":function(e,t,n){"use strict";var r=n("ebb5"),i=r.aTypedArray,o=r.exportTypedArrayMethod,s=[].join;o("join",(function(e){return s.apply(i(this),arguments)}))},"60bd":function(e,t,n){"use strict";var r=n("da84"),i=n("ebb5"),o=n("e260"),s=n("b622"),a=s("iterator"),l=r.Uint8Array,u=o.values,c=o.keys,h=o.entries,d=i.aTypedArray,p=i.exportTypedArrayMethod,f=l&&l.prototype[a],m=!!f&&("values"==f.name||void 0==f.name),g=function(){return u.call(d(this))};p("entries",(function(){return h.call(d(this))})),p("keys",(function(){return c.call(d(this))})),p("values",g,!m),p(a,g,!m)},"60f5":function(e,t,n){"use strict";e.exports=function(e,t,n){var r=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d="errs__"+i,p=e.util.copy(e),f="";p.level++;var m="valid"+p.level,g=s.every((function(t){return e.opts.strictKeywords?"object"==typeof t&&Object.keys(t).length>0:e.util.schemaHasRules(t,e.RULES.all)}));if(g){var v=p.baseId;r+=" var "+d+" = errors; var "+h+" = false;  ";var y=e.compositeRule;e.compositeRule=p.compositeRule=!0;var x=s;if(x){var b,w=-1,_=x.length-1;while(w<_)b=x[w+=1],p.schema=b,p.schemaPath=a+"["+w+"]",p.errSchemaPath=l+"/"+w,r+="  "+e.validate(p)+" ",p.baseId=v,r+=" "+h+" = "+h+" || "+m+"; if (!"+h+") { ",f+="}"}e.compositeRule=p.compositeRule=y,r+=" "+f+" if (!"+h+") {   var err =   ",!1!==e.createErrors?(r+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: {} ",!1!==e.opts.messages&&(r+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(r+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(e.async?r+=" throw new ValidationError(vErrors); ":r+=" validate.errors = vErrors; return false; "),r+=" } else {  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; } ",e.opts.allErrors&&(r+=" } ")}else u&&(r+=" if (true) { ");return r}},6125:function(e,t,n){var r=n("1212"),i=n("b838"),o=n("a49e"),s=n("cae0"),a=n("7aec"),l=n("89ed"),u=n("a49d");u.alea=r,u.xor128=i,u.xorwow=o,u.xorshift7=s,u.xor4096=a,u.tychei=l,e.exports=u},"621a":function(e,t,n){"use strict";var r=n("da84"),i=n("83ab"),o=n("a981"),s=n("9112"),a=n("e2cc"),l=n("d039"),u=n("19aa"),c=n("a691"),h=n("50c4"),d=n("0b25"),p=n("77a7"),f=n("e163"),m=n("d2bb"),g=n("241c").f,v=n("9bf2").f,y=n("81d5"),x=n("d44e"),b=n("69f3"),w=b.get,_=b.set,A="ArrayBuffer",S="DataView",E="prototype",M="Wrong length",T="Wrong index",C=r[A],P=C,R=r[S],L=R&&R[E],O=Object.prototype,D=r.RangeError,I=p.pack,k=p.unpack,N=function(e){return[255&e]},F=function(e){return[255&e,e>>8&255]},V=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},z=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},U=function(e){return I(e,23,4)},j=function(e){return I(e,52,8)},B=function(e,t){v(e[E],t,{get:function(){return w(this)[t]}})},H=function(e,t,n,r){var i=d(n),o=w(e);if(i+t>o.byteLength)throw D(T);var s=w(o.buffer).bytes,a=i+o.byteOffset,l=s.slice(a,a+t);return r?l:l.reverse()},G=function(e,t,n,r,i,o){var s=d(n),a=w(e);if(s+t>a.byteLength)throw D(T);for(var l=w(a.buffer).bytes,u=s+a.byteOffset,c=r(+i),h=0;h<t;h++)l[u+h]=c[o?h:t-h-1]};if(o){if(!l((function(){C(1)}))||!l((function(){new C(-1)}))||l((function(){return new C,new C(1.5),new C(NaN),C.name!=A}))){P=function(e){return u(this,P),new C(d(e))};for(var q,W=P[E]=C[E],$=g(C),X=0;$.length>X;)(q=$[X++])in P||s(P,q,C[q]);W.constructor=P}m&&f(L)!==O&&m(L,O);var Y=new R(new P(2)),Z=L.setInt8;Y.setInt8(0,2147483648),Y.setInt8(1,2147483649),!Y.getInt8(0)&&Y.getInt8(1)||a(L,{setInt8:function(e,t){Z.call(this,e,t<<24>>24)},setUint8:function(e,t){Z.call(this,e,t<<24>>24)}},{unsafe:!0})}else P=function(e){u(this,P,A);var t=d(e);_(this,{bytes:y.call(new Array(t),0),byteLength:t}),i||(this.byteLength=t)},R=function(e,t,n){u(this,R,S),u(e,P,S);var r=w(e).byteLength,o=c(t);if(o<0||o>r)throw D("Wrong offset");if(n=void 0===n?r-o:h(n),o+n>r)throw D(M);_(this,{buffer:e,byteLength:n,byteOffset:o}),i||(this.buffer=e,this.byteLength=n,this.byteOffset=o)},i&&(B(P,"byteLength"),B(R,"buffer"),B(R,"byteLength"),B(R,"byteOffset")),a(R[E],{getInt8:function(e){return H(this,1,e)[0]<<24>>24},getUint8:function(e){return H(this,1,e)[0]},getInt16:function(e){var t=H(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=H(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return z(H(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return z(H(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return k(H(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return k(H(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){G(this,1,e,N,t)},setUint8:function(e,t){G(this,1,e,N,t)},setInt16:function(e,t){G(this,2,e,F,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){G(this,2,e,F,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){G(this,4,e,V,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){G(this,4,e,V,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){G(this,4,e,U,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){G(this,8,e,j,t,arguments.length>2?arguments[2]:void 0)}});x(P,A),x(R,S),e.exports={ArrayBuffer:P,DataView:R}},"62e4":function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},6374:function(e,t,n){n("a4d3"),n("e01a"),n("d28b"),n("d3b7"),n("3ca3"),n("ddb0");var r=n("6613");function i(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){l=!0,s=e},f:function(){try{a||null==n["return"]||n["return"]()}finally{if(l)throw s}}}}e.exports=i},6376:function(e,t,n){"use strict";e.exports={$ref:n("6ef8"),allOf:n("ea07"),anyOf:n("60f5"),$comment:n("5c3d"),const:n("0302"),contains:n("5cf5"),dependencies:n("b920"),enum:n("e8c2"),format:n("00ad"),if:n("dd93"),items:n("798e"),maximum:n("bf8d"),minimum:n("bf8d"),maxItems:n("da3b"),minItems:n("da3b"),maxLength:n("9906"),minLength:n("9906"),maxProperties:n("77ea"),minProperties:n("77ea"),multipleOf:n("a931"),not:n("00f5"),oneOf:n("4db1"),pattern:n("714b"),properties:n("bd5b"),propertyNames:n("6d63"),required:n("b7e6"),uniqueItems:n("d30e"),validate:n("d508")}},"649e":function(e,t,n){"use strict";var r=n("ebb5"),i=n("b727").some,o=r.aTypedArray,s=r.exportTypedArrayMethod;s("some",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},6613:function(e,t,n){n("a630"),n("fb6a"),n("b0c0"),n("d3b7"),n("25f0"),n("3ca3");var r=n("5a43");function i(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}e.exports=i},"66c0":function(e,t,n){"use strict";var r=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];e.exports=function(e,t){for(var n=0;n<t.length;n++){e=JSON.parse(JSON.stringify(e));var i,o=t[n].split("/"),s=e;for(i=1;i<o.length;i++)s=s[o[i]];for(i=0;i<r.length;i++){var a=r[i],l=s[a];l&&(s[a]={anyOf:[l,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]})}}return e}},"694b":function(e,t,n){"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,i,o;if(Array.isArray(t)){if(r=t.length,r!=n.length)return!1;for(i=r;0!==i--;)if(!e(t[i],n[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(o=Object.keys(t),r=o.length,r!==Object.keys(n).length)return!1;for(i=r;0!==i--;)if(!Object.prototype.hasOwnProperty.call(n,o[i]))return!1;for(i=r;0!==i--;){var s=o[i];if(!e(t[s],n[s]))return!1}return!0}return t!==t&&n!==n}},"6c57":function(e,t,n){var r=n("23e7"),i=n("da84");r({global:!0},{globalThis:i})},"6d63":function(e,t,n){"use strict";e.exports=function(e,t,n){var r=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="errs__"+i,d=e.util.copy(e),p="";d.level++;var f="valid"+d.level;if(r+="var "+h+" = errors;",e.opts.strictKeywords?"object"==typeof s&&Object.keys(s).length>0:e.util.schemaHasRules(s,e.RULES.all)){d.schema=s,d.schemaPath=a,d.errSchemaPath=l;var m="key"+i,g="idx"+i,v="i"+i,y="' + "+m+" + '",x=d.dataLevel=e.dataLevel+1,b="data"+x,w="dataProperties"+i,_=e.opts.ownProperties,A=e.baseId;_&&(r+=" var "+w+" = undefined; "),r+=_?" "+w+" = "+w+" || Object.keys("+c+"); for (var "+g+"=0; "+g+"<"+w+".length; "+g+"++) { var "+m+" = "+w+"["+g+"]; ":" for (var "+m+" in "+c+") { ",r+=" var startErrs"+i+" = errors; ";var S=m,E=e.compositeRule;e.compositeRule=d.compositeRule=!0;var M=e.validate(d);d.baseId=A,e.util.varOccurences(M,b)<2?r+=" "+e.util.varReplace(M,b,S)+" ":r+=" var "+b+" = "+S+"; "+M+" ",e.compositeRule=d.compositeRule=E,r+=" if (!"+f+") { for (var "+v+"=startErrs"+i+"; "+v+"<errors; "+v+"++) { vErrors["+v+"].propertyName = "+m+"; }   var err =   ",!1!==e.createErrors?(r+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { propertyName: '"+y+"' } ",!1!==e.opts.messages&&(r+=" , message: 'property name \\'"+y+"\\' is invalid' "),e.opts.verbose&&(r+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(e.async?r+=" throw new ValidationError(vErrors); ":r+=" validate.errors = vErrors; return false; "),u&&(r+=" break; "),r+=" } }"}return u&&(r+=" "+p+" if ("+h+" == errors) {"),r}},"6e76":function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"http://json-schema.org/draft-07/schema#","title":"Core schema meta-schema","definitions":{"schemaArray":{"type":"array","minItems":1,"items":{"$ref":"#"}},"nonNegativeInteger":{"type":"integer","minimum":0},"nonNegativeIntegerDefault0":{"allOf":[{"$ref":"#/definitions/nonNegativeInteger"},{"default":0}]},"simpleTypes":{"enum":["array","boolean","integer","null","number","object","string"]},"stringArray":{"type":"array","items":{"type":"string"},"uniqueItems":true,"default":[]}},"type":["object","boolean"],"properties":{"$id":{"type":"string","format":"uri-reference"},"$schema":{"type":"string","format":"uri"},"$ref":{"type":"string","format":"uri-reference"},"$comment":{"type":"string"},"title":{"type":"string"},"description":{"type":"string"},"default":true,"readOnly":{"type":"boolean","default":false},"examples":{"type":"array","items":true},"multipleOf":{"type":"number","exclusiveMinimum":0},"maximum":{"type":"number"},"exclusiveMaximum":{"type":"number"},"minimum":{"type":"number"},"exclusiveMinimum":{"type":"number"},"maxLength":{"$ref":"#/definitions/nonNegativeInteger"},"minLength":{"$ref":"#/definitions/nonNegativeIntegerDefault0"},"pattern":{"type":"string","format":"regex"},"additionalItems":{"$ref":"#"},"items":{"anyOf":[{"$ref":"#"},{"$ref":"#/definitions/schemaArray"}],"default":true},"maxItems":{"$ref":"#/definitions/nonNegativeInteger"},"minItems":{"$ref":"#/definitions/nonNegativeIntegerDefault0"},"uniqueItems":{"type":"boolean","default":false},"contains":{"$ref":"#"},"maxProperties":{"$ref":"#/definitions/nonNegativeInteger"},"minProperties":{"$ref":"#/definitions/nonNegativeIntegerDefault0"},"required":{"$ref":"#/definitions/stringArray"},"additionalProperties":{"$ref":"#"},"definitions":{"type":"object","additionalProperties":{"$ref":"#"},"default":{}},"properties":{"type":"object","additionalProperties":{"$ref":"#"},"default":{}},"patternProperties":{"type":"object","additionalProperties":{"$ref":"#"},"propertyNames":{"format":"regex"},"default":{}},"dependencies":{"type":"object","additionalProperties":{"anyOf":[{"$ref":"#"},{"$ref":"#/definitions/stringArray"}]}},"propertyNames":{"$ref":"#"},"const":true,"enum":{"type":"array","items":true,"minItems":1,"uniqueItems":true},"type":{"anyOf":[{"$ref":"#/definitions/simpleTypes"},{"type":"array","items":{"$ref":"#/definitions/simpleTypes"},"minItems":1,"uniqueItems":true}]},"format":{"type":"string"},"contentMediaType":{"type":"string"},"contentEncoding":{"type":"string"},"if":{"$ref":"#"},"then":{"$ref":"#"},"else":{"$ref":"#"},"allOf":{"$ref":"#/definitions/schemaArray"},"anyOf":{"$ref":"#/definitions/schemaArray"},"oneOf":{"$ref":"#/definitions/schemaArray"},"not":{"$ref":"#"}},"default":true}')},"6ef8":function(e,t,n){"use strict";e.exports=function(e,t,n){var r,i,o=" ",s=e.level,a=e.dataLevel,l=e.schema[t],u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(a||""),d="valid"+s;if("#"==l||"#/"==l)e.isRoot?(r=e.async,i="validate"):(r=!0===e.root.schema.$async,i="root.refVal[0]");else{var p=e.resolveRef(e.baseId,l,e.isRoot);if(void 0===p){var f=e.MissingRefError.message(e.baseId,l);if("fail"==e.opts.missingRefs){e.logger.error(f);var m=m||[];m.push(o),o="",!1!==e.createErrors?(o+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { ref: '"+e.util.escapeQuotes(l)+"' } ",!1!==e.opts.messages&&(o+=" , message: 'can\\'t resolve reference "+e.util.escapeQuotes(l)+"' "),e.opts.verbose&&(o+=" , schema: "+e.util.toQuotedString(l)+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),o+=" } "):o+=" {} ";var g=o;o=m.pop(),!e.compositeRule&&c?e.async?o+=" throw new ValidationError(["+g+"]); ":o+=" validate.errors = ["+g+"]; return false; ":o+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c&&(o+=" if (false) { ")}else{if("ignore"!=e.opts.missingRefs)throw new e.MissingRefError(e.baseId,l,f);e.logger.warn(f),c&&(o+=" if (true) { ")}}else if(p.inline){var v=e.util.copy(e);v.level++;var y="valid"+v.level;v.schema=p.schema,v.schemaPath="",v.errSchemaPath=l;var x=e.validate(v).replace(/validate\.schema/g,p.code);o+=" "+x+" ",c&&(o+=" if ("+y+") { ")}else r=!0===p.$async||e.async&&!1!==p.$async,i=p.code}if(i){m=m||[];m.push(o),o="",e.opts.passContext?o+=" "+i+".call(this, ":o+=" "+i+"( ",o+=" "+h+", (dataPath || '')",'""'!=e.errorPath&&(o+=" + "+e.errorPath);var b=a?"data"+(a-1||""):"parentData",w=a?e.dataPathArr[a]:"parentDataProperty";o+=" , "+b+" , "+w+", rootData)  ";var _=o;if(o=m.pop(),r){if(!e.async)throw new Error("async schema referenced by sync schema");c&&(o+=" var "+d+"; "),o+=" try { await "+_+"; ",c&&(o+=" "+d+" = true; "),o+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",c&&(o+=" "+d+" = false; "),o+=" } ",c&&(o+=" if ("+d+") { ")}else o+=" if (!"+_+") { if (vErrors === null) vErrors = "+i+".errors; else vErrors = vErrors.concat("+i+".errors); errors = vErrors.length; } ",c&&(o+=" else { ")}return o}},7037:function(e,t,n){function r(t){return"function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?e.exports=r=function(e){return typeof e}:e.exports=r=function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(t)}n("a4d3"),n("e01a"),n("d28b"),n("d3b7"),n("3ca3"),n("ddb0"),e.exports=r},7039:function(e,t,n){var r=n("23e7"),i=n("d039"),o=n("057f").f,s=i((function(){return!Object.getOwnPropertyNames(1)}));r({target:"Object",stat:!0,forced:s},{getOwnPropertyNames:o})},"714b":function(e,t,n){"use strict";e.exports=function(e,t,n){var r,i=" ",o=e.level,s=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(s||""),d=e.opts.$data&&a&&a.$data;d?(i+=" var schema"+o+" = "+e.util.getData(a.$data,s,e.dataPathArr)+"; ",r="schema"+o):r=a;var p=d?"(new RegExp("+r+"))":e.usePattern(a);i+="if ( ",d&&(i+=" ("+r+" !== undefined && typeof "+r+" != 'string') || "),i+=" !"+p+".test("+h+") ) {   ";var f=f||[];f.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { pattern:  ",i+=d?""+r:""+e.util.toQuotedString(a),i+="  } ",!1!==e.opts.messages&&(i+=" , message: 'should match pattern \"",i+=d?"' + "+r+" + '":""+e.util.escapeQuotes(a),i+="\"' "),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+l:""+e.util.toQuotedString(a),i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var m=i;return i=f.pop(),!e.compositeRule&&c?e.async?i+=" throw new ValidationError(["+m+"]); ":i+=" validate.errors = ["+m+"]; return false; ":i+=" var err = "+m+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",c&&(i+=" else { "),i}},7236:function(e,t,n){"use strict";e.exports=function(e,t,n){var r,i,o=" ",s=e.level,a=e.dataLevel,l=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,h=!e.opts.allErrors,d="data"+(a||""),p="valid"+s,f="errs__"+s,m=e.opts.$data&&l&&l.$data;m?(o+=" var schema"+s+" = "+e.util.getData(l.$data,a,e.dataPathArr)+"; ",i="schema"+s):i=l;var g,v,y,x,b,w=this,_="definition"+s,A=w.definition,S="";if(m&&A.$data){b="keywordValidate"+s;var E=A.validateSchema;o+=" var "+_+" = RULES.custom['"+t+"'].definition; var "+b+" = "+_+".validate;"}else{if(x=e.useCustomRule(w,l,e.schema,e),!x)return;i="validate.schema"+u,b=x.code,g=A.compile,v=A.inline,y=A.macro}var M=b+".errors",T="i"+s,C="ruleErr"+s,P=A.async;if(P&&!e.async)throw new Error("async keyword in sync schema");if(v||y||(o+=M+" = null;"),o+="var "+f+" = errors;var "+p+";",m&&A.$data&&(S+="}",o+=" if ("+i+" === undefined) { "+p+" = true; } else { ",E&&(S+="}",o+=" "+p+" = "+_+".validateSchema("+i+"); if ("+p+") { ")),v)A.statements?o+=" "+x.validate+" ":o+=" "+p+" = "+x.validate+"; ";else if(y){var R=e.util.copy(e);S="";R.level++;var L="valid"+R.level;R.schema=x.validate,R.schemaPath="";var O=e.compositeRule;e.compositeRule=R.compositeRule=!0;var D=e.validate(R).replace(/validate\.schema/g,b);e.compositeRule=R.compositeRule=O,o+=" "+D}else{var I=I||[];I.push(o),o="",o+="  "+b+".call( ",e.opts.passContext?o+="this":o+="self",g||!1===A.schema?o+=" , "+d+" ":o+=" , "+i+" , "+d+" , validate.schema"+e.schemaPath+" ",o+=" , (dataPath || '')",'""'!=e.errorPath&&(o+=" + "+e.errorPath);var k=a?"data"+(a-1||""):"parentData",N=a?e.dataPathArr[a]:"parentDataProperty";o+=" , "+k+" , "+N+" , rootData )  ";var F=o;o=I.pop(),!1===A.errors?(o+=" "+p+" = ",P&&(o+="await "),o+=F+"; "):P?(M="customErrors"+s,o+=" var "+M+" = null; try { "+p+" = await "+F+"; } catch (e) { "+p+" = false; if (e instanceof ValidationError) "+M+" = e.errors; else throw e; } "):o+=" "+M+" = null; "+p+" = "+F+"; "}if(A.modifying&&(o+=" if ("+k+") "+d+" = "+k+"["+N+"];"),o+=""+S,A.valid)h&&(o+=" if (true) { ");else{o+=" if ( ",void 0===A.valid?(o+=" !",o+=y?""+L:""+p):o+=" "+!A.valid+" ",o+=") { ",r=w.keyword;I=I||[];I.push(o),o="";I=I||[];I.push(o),o="",!1!==e.createErrors?(o+=" { keyword: '"+(r||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+w.keyword+"' } ",!1!==e.opts.messages&&(o+=" , message: 'should pass \""+w.keyword+"\" keyword validation' "),e.opts.verbose&&(o+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),o+=" } "):o+=" {} ";var V=o;o=I.pop(),!e.compositeRule&&h?e.async?o+=" throw new ValidationError(["+V+"]); ":o+=" validate.errors = ["+V+"]; return false; ":o+=" var err = "+V+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";var z=o;o=I.pop(),v?A.errors?"full"!=A.errors&&(o+="  for (var "+T+"="+f+"; "+T+"<errors; "+T+"++) { var "+C+" = vErrors["+T+"]; if ("+C+".dataPath === undefined) "+C+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+C+".schemaPath === undefined) { "+C+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(o+=" "+C+".schema = "+i+"; "+C+".data = "+d+"; "),o+=" } "):!1===A.errors?o+=" "+z+" ":(o+=" if ("+f+" == errors) { "+z+" } else {  for (var "+T+"="+f+"; "+T+"<errors; "+T+"++) { var "+C+" = vErrors["+T+"]; if ("+C+".dataPath === undefined) "+C+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+C+".schemaPath === undefined) { "+C+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(o+=" "+C+".schema = "+i+"; "+C+".data = "+d+"; "),o+=" } } "):y?(o+="   var err =   ",!1!==e.createErrors?(o+=" { keyword: '"+(r||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+w.keyword+"' } ",!1!==e.opts.messages&&(o+=" , message: 'should pass \""+w.keyword+"\" keyword validation' "),e.opts.verbose&&(o+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),o+=" } "):o+=" {} ",o+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&h&&(e.async?o+=" throw new ValidationError(vErrors); ":o+=" validate.errors = vErrors; return false; ")):!1===A.errors?o+=" "+z+" ":(o+=" if (Array.isArray("+M+")) { if (vErrors === null) vErrors = "+M+"; else vErrors = vErrors.concat("+M+"); errors = vErrors.length;  for (var "+T+"="+f+"; "+T+"<errors; "+T+"++) { var "+C+" = vErrors["+T+"]; if ("+C+".dataPath === undefined) "+C+".dataPath = (dataPath || '') + "+e.errorPath+";  "+C+'.schemaPath = "'+c+'";  ',e.opts.verbose&&(o+=" "+C+".schema = "+i+"; "+C+".data = "+d+"; "),o+=" } } else { "+z+" } "),o+=" } ",h&&(o+=" else { ")}return o}},"72f7":function(e,t,n){"use strict";var r=n("ebb5").exportTypedArrayMethod,i=n("d039"),o=n("da84"),s=o.Uint8Array,a=s&&s.prototype||{},l=[].toString,u=[].join;i((function(){l.call({})}))&&(l=function(){return u.call(this)});var c=a.toString!=l;r("toString",l,c)},"735e":function(e,t,n){"use strict";var r=n("ebb5"),i=n("81d5"),o=r.aTypedArray,s=r.exportTypedArrayMethod;s("fill",(function(e){return i.apply(o(this),arguments)}))},"74d0":function(e,t,n){n("1f8f");var r=n("9052"),i=r.vec3,o=r.mat3,s=r.mat4,a=(n("17fb"),e.exports=function(e,t){this.finger=e,this._center=null,this._matrix=null,this.type=t.type,this.prevJoint=t.prevJoint,this.nextJoint=t.nextJoint,this.width=t.width;var n=new Array(3);i.sub(n,t.nextJoint,t.prevJoint),this.length=i.length(n),this.basis=t.basis});a.prototype.left=function(){return this._left||(this._left=o.determinant(this.basis[0].concat(this.basis[1]).concat(this.basis[2]))<0),this._left},a.prototype.matrix=function(){if(this._matrix)return this._matrix;var e=this.basis,t=this._matrix=s.create();return t[0]=e[0][0],t[1]=e[0][1],t[2]=e[0][2],t[4]=e[1][0],t[5]=e[1][1],t[6]=e[1][2],t[8]=e[2][0],t[9]=e[2][1],t[10]=e[2][2],t[3]=this.center()[0],t[7]=this.center()[1],t[11]=this.center()[2],this.left()&&(t[0]*=-1,t[1]*=-1,t[2]*=-1),this._matrix},a.prototype.lerp=function(e,t){i.lerp(e,this.prevJoint,this.nextJoint,t)},a.prototype.center=function(){if(this._center)return this._center;var e=i.create();return this.lerp(e,.5),this._center=e,e},a.prototype.direction=function(){return[-1*this.basis[2][0],-1*this.basis[2][1],-1*this.basis[2][2]]}},"74e8":function(e,t,n){"use strict";var r=n("23e7"),i=n("da84"),o=n("83ab"),s=n("8aa7"),a=n("ebb5"),l=n("621a"),u=n("19aa"),c=n("5c6c"),h=n("9112"),d=n("50c4"),p=n("0b25"),f=n("182d"),m=n("c04e"),g=n("5135"),v=n("f5df"),y=n("861d"),x=n("7c73"),b=n("d2bb"),w=n("241c").f,_=n("a078"),A=n("b727").forEach,S=n("2626"),E=n("9bf2"),M=n("06cf"),T=n("69f3"),C=n("7156"),P=T.get,R=T.set,L=E.f,O=M.f,D=Math.round,I=i.RangeError,k=l.ArrayBuffer,N=l.DataView,F=a.NATIVE_ARRAY_BUFFER_VIEWS,V=a.TYPED_ARRAY_TAG,z=a.TypedArray,U=a.TypedArrayPrototype,j=a.aTypedArrayConstructor,B=a.isTypedArray,H="BYTES_PER_ELEMENT",G="Wrong length",q=function(e,t){var n=0,r=t.length,i=new(j(e))(r);while(r>n)i[n]=t[n++];return i},W=function(e,t){L(e,t,{get:function(){return P(this)[t]}})},$=function(e){var t;return e instanceof k||"ArrayBuffer"==(t=v(e))||"SharedArrayBuffer"==t},X=function(e,t){return B(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Y=function(e,t){return X(e,t=m(t,!0))?c(2,e[t]):O(e,t)},Z=function(e,t,n){return!(X(e,t=m(t,!0))&&y(n)&&g(n,"value"))||g(n,"get")||g(n,"set")||n.configurable||g(n,"writable")&&!n.writable||g(n,"enumerable")&&!n.enumerable?L(e,t,n):(e[t]=n.value,e)};o?(F||(M.f=Y,E.f=Z,W(U,"buffer"),W(U,"byteOffset"),W(U,"byteLength"),W(U,"length")),r({target:"Object",stat:!0,forced:!F},{getOwnPropertyDescriptor:Y,defineProperty:Z}),e.exports=function(e,t,n){var o=e.match(/\d+$/)[0]/8,a=e+(n?"Clamped":"")+"Array",l="get"+e,c="set"+e,m=i[a],g=m,v=g&&g.prototype,E={},M=function(e,t){var n=P(e);return n.view[l](t*o+n.byteOffset,!0)},T=function(e,t,r){var i=P(e);n&&(r=(r=D(r))<0?0:r>255?255:255&r),i.view[c](t*o+i.byteOffset,r,!0)},O=function(e,t){L(e,t,{get:function(){return M(this,t)},set:function(e){return T(this,t,e)},enumerable:!0})};F?s&&(g=t((function(e,t,n,r){return u(e,g,a),C(function(){return y(t)?$(t)?void 0!==r?new m(t,f(n,o),r):void 0!==n?new m(t,f(n,o)):new m(t):B(t)?q(g,t):_.call(g,t):new m(p(t))}(),e,g)})),b&&b(g,z),A(w(m),(function(e){e in g||h(g,e,m[e])})),g.prototype=v):(g=t((function(e,t,n,r){u(e,g,a);var i,s,l,c=0,h=0;if(y(t)){if(!$(t))return B(t)?q(g,t):_.call(g,t);i=t,h=f(n,o);var m=t.byteLength;if(void 0===r){if(m%o)throw I(G);if(s=m-h,s<0)throw I(G)}else if(s=d(r)*o,s+h>m)throw I(G);l=s/o}else l=p(t),s=l*o,i=new k(s);R(e,{buffer:i,byteOffset:h,byteLength:s,length:l,view:new N(i)});while(c<l)O(e,c++)})),b&&b(g,z),v=g.prototype=x(U)),v.constructor!==g&&h(v,"constructor",g),V&&h(v,V,a),E[a]=g,r({global:!0,forced:g!=m,sham:!F},E),H in g||h(g,H,o),H in v||h(v,H,o),S(a)}):e.exports=function(){}},"775e":function(e,t,n){"use strict";e.exports=function(e){var t,n=0,r=e.length,i=0;while(i<r)n++,t=e.charCodeAt(i++),t>=55296&&t<=56319&&i<r&&(t=e.charCodeAt(i),56320==(64512&t)&&i++);return n}},"77a7":function(e,t){var n=1/0,r=Math.abs,i=Math.pow,o=Math.floor,s=Math.log,a=Math.LN2,l=function(e,t,l){var u,c,h,d=new Array(l),p=8*l-t-1,f=(1<<p)-1,m=f>>1,g=23===t?i(2,-24)-i(2,-77):0,v=e<0||0===e&&1/e<0?1:0,y=0;for(e=r(e),e!=e||e===n?(c=e!=e?1:0,u=f):(u=o(s(e)/a),e*(h=i(2,-u))<1&&(u--,h*=2),e+=u+m>=1?g/h:g*i(2,1-m),e*h>=2&&(u++,h/=2),u+m>=f?(c=0,u=f):u+m>=1?(c=(e*h-1)*i(2,t),u+=m):(c=e*i(2,m-1)*i(2,t),u=0));t>=8;d[y++]=255&c,c/=256,t-=8);for(u=u<<t|c,p+=t;p>0;d[y++]=255&u,u/=256,p-=8);return d[--y]|=128*v,d},u=function(e,t){var r,o=e.length,s=8*o-t-1,a=(1<<s)-1,l=a>>1,u=s-7,c=o-1,h=e[c--],d=127&h;for(h>>=7;u>0;d=256*d+e[c],c--,u-=8);for(r=d&(1<<-u)-1,d>>=-u,u+=t;u>0;r=256*r+e[c],c--,u-=8);if(0===d)d=1-l;else{if(d===a)return r?NaN:h?-n:n;r+=i(2,t),d-=l}return(h?-1:1)*r*i(2,d-t)};e.exports={pack:l,unpack:u}},"77ea":function(e,t,n){"use strict";e.exports=function(e,t,n){var r,i=" ",o=e.level,s=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(s||""),d=e.opts.$data&&a&&a.$data;if(d?(i+=" var schema"+o+" = "+e.util.getData(a.$data,s,e.dataPathArr)+"; ",r="schema"+o):r=a,!d&&"number"!=typeof a)throw new Error(t+" must be number");var p="maxProperties"==t?">":"<";i+="if ( ",d&&(i+=" ("+r+" !== undefined && typeof "+r+" != 'number') || "),i+=" Object.keys("+h+").length "+p+" "+r+") { ";var f=t,m=m||[];m.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(f||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+r+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have ",i+="maxProperties"==t?"more":"fewer",i+=" than ",i+=d?"' + "+r+" + '":""+a,i+=" properties' "),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+l:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var g=i;return i=m.pop(),!e.compositeRule&&c?e.async?i+=" throw new ValidationError(["+g+"]); ":i+=" validate.errors = ["+g+"]; return false; ":i+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",c&&(i+=" else { "),i}},"783b":function(e,t,n){"use strict";var r=n("8d02"),i=n("a971"),o=n("ea9c"),s=n("ba00"),a=n("f71e"),l=n("9fe4"),u=n("c17c"),c=n("66c0"),h=n("fbda");e.exports=v,v.prototype.validate=y,v.prototype.compile=x,v.prototype.addSchema=b,v.prototype.addMetaSchema=w,v.prototype.validateSchema=_,v.prototype.getSchema=S,v.prototype.removeSchema=T,v.prototype.addFormat=N,v.prototype.errorsText=k,v.prototype._addSchema=P,v.prototype._compile=R,v.prototype.compileAsync=n("b1a8");var d=n("fff2");v.prototype.addKeyword=d.add,v.prototype.getKeyword=d.get,v.prototype.removeKeyword=d.remove,v.prototype.validateKeyword=d.validate;var p=n("899a");v.ValidationError=p.Validation,v.MissingRefError=p.MissingRef,v.$dataMetaSchema=c;var f="http://json-schema.org/draft-07/schema",m=["removeAdditional","useDefaults","coerceTypes","strictDefaults"],g=["/properties"];function v(e){if(!(this instanceof v))return new v(e);e=this._opts=h.copy(e)||{},H(this),this._schemas={},this._refs={},this._fragments={},this._formats=l(e.format),this._cache=e.cache||new o,this._loadingSchemas={},this._compilations=[],this.RULES=u(),this._getId=L(e),e.loopRequired=e.loopRequired||1/0,"property"==e.errorDataPath&&(e._errorDataPathProperty=!0),void 0===e.serialize&&(e.serialize=a),this._metaOpts=B(this),e.formats&&z(this),e.keywords&&U(this),F(this),"object"==typeof e.meta&&this.addMetaSchema(e.meta),e.nullable&&this.addKeyword("nullable",{metaSchema:{type:"boolean"}}),V(this)}function y(e,t){var n;if("string"==typeof e){if(n=this.getSchema(e),!n)throw new Error('no schema with key or ref "'+e+'"')}else{var r=this._addSchema(e);n=r.validate||this._compile(r)}var i=n(t);return!0!==n.$async&&(this.errors=n.errors),i}function x(e,t){var n=this._addSchema(e,void 0,t);return n.validate||this._compile(n)}function b(e,t,n,r){if(Array.isArray(e)){for(var o=0;o<e.length;o++)this.addSchema(e[o],void 0,n,r);return this}var s=this._getId(e);if(void 0!==s&&"string"!=typeof s)throw new Error("schema id must be string");return t=i.normalizeId(t||s),j(this,t),this._schemas[t]=this._addSchema(e,n,r,!0),this}function w(e,t,n){return this.addSchema(e,t,n,!0),this}function _(e,t){var n=e.$schema;if(void 0!==n&&"string"!=typeof n)throw new Error("$schema must be a string");if(n=n||this._opts.defaultMeta||A(this),!n)return this.logger.warn("meta-schema not available"),this.errors=null,!0;var r=this.validate(n,e);if(!r&&t){var i="schema is invalid: "+this.errorsText();if("log"!=this._opts.validateSchema)throw new Error(i);this.logger.error(i)}return r}function A(e){var t=e._opts.meta;return e._opts.defaultMeta="object"==typeof t?e._getId(t)||t:e.getSchema(f)?f:void 0,e._opts.defaultMeta}function S(e){var t=M(this,e);switch(typeof t){case"object":return t.validate||this._compile(t);case"string":return this.getSchema(t);case"undefined":return E(this,e)}}function E(e,t){var n=i.schema.call(e,{schema:{}},t);if(n){var o=n.schema,a=n.root,l=n.baseId,u=r.call(e,o,a,void 0,l);return e._fragments[t]=new s({ref:t,fragment:!0,schema:o,root:a,baseId:l,validate:u}),u}}function M(e,t){return t=i.normalizeId(t),e._schemas[t]||e._refs[t]||e._fragments[t]}function T(e){if(e instanceof RegExp)return C(this,this._schemas,e),C(this,this._refs,e),this;switch(typeof e){case"undefined":return C(this,this._schemas),C(this,this._refs),this._cache.clear(),this;case"string":var t=M(this,e);return t&&this._cache.del(t.cacheKey),delete this._schemas[e],delete this._refs[e],this;case"object":var n=this._opts.serialize,r=n?n(e):e;this._cache.del(r);var o=this._getId(e);o&&(o=i.normalizeId(o),delete this._schemas[o],delete this._refs[o])}return this}function C(e,t,n){for(var r in t){var i=t[r];i.meta||n&&!n.test(r)||(e._cache.del(i.cacheKey),delete t[r])}}function P(e,t,n,r){if("object"!=typeof e&&"boolean"!=typeof e)throw new Error("schema should be object or boolean");var o=this._opts.serialize,a=o?o(e):e,l=this._cache.get(a);if(l)return l;r=r||!1!==this._opts.addUsedSchema;var u=i.normalizeId(this._getId(e));u&&r&&j(this,u);var c,h=!1!==this._opts.validateSchema&&!t;h&&!(c=u&&u==i.normalizeId(e.$schema))&&this.validateSchema(e,!0);var d=i.ids.call(this,e),p=new s({id:u,schema:e,localRefs:d,cacheKey:a,meta:n});return"#"!=u[0]&&r&&(this._refs[u]=p),this._cache.put(a,p),h&&c&&this.validateSchema(e,!0),p}function R(e,t){if(e.compiling)return e.validate=o,o.schema=e.schema,o.errors=null,o.root=t||o,!0===e.schema.$async&&(o.$async=!0),o;var n,i;e.compiling=!0,e.meta&&(n=this._opts,this._opts=this._metaOpts);try{i=r.call(this,e.schema,t,e.localRefs)}catch(s){throw delete e.validate,s}finally{e.compiling=!1,e.meta&&(this._opts=n)}return e.validate=i,e.refs=i.refs,e.refVal=i.refVal,e.root=i.root,i;function o(){var t=e.validate,n=t.apply(this,arguments);return o.errors=t.errors,n}}function L(e){switch(e.schemaId){case"auto":return I;case"id":return O;default:return D}}function O(e){return e.$id&&this.logger.warn("schema $id ignored",e.$id),e.id}function D(e){return e.id&&this.logger.warn("schema id ignored",e.id),e.$id}function I(e){if(e.$id&&e.id&&e.$id!=e.id)throw new Error("schema $id is different from id");return e.$id||e.id}function k(e,t){if(e=e||this.errors,!e)return"No errors";t=t||{};for(var n=void 0===t.separator?", ":t.separator,r=void 0===t.dataVar?"data":t.dataVar,i="",o=0;o<e.length;o++){var s=e[o];s&&(i+=r+s.dataPath+" "+s.message+n)}return i.slice(0,-n.length)}function N(e,t){return"string"==typeof t&&(t=new RegExp(t)),this._formats[e]=t,this}function F(e){var t;if(e._opts.$data&&(t=n("46c0"),e.addMetaSchema(t,t.$id,!0)),!1!==e._opts.meta){var r=n("6e76");e._opts.$data&&(r=c(r,g)),e.addMetaSchema(r,f,!0),e._refs["http://json-schema.org/schema"]=f}}function V(e){var t=e._opts.schemas;if(t)if(Array.isArray(t))e.addSchema(t);else for(var n in t)e.addSchema(t[n],n)}function z(e){for(var t in e._opts.formats){var n=e._opts.formats[t];e.addFormat(t,n)}}function U(e){for(var t in e._opts.keywords){var n=e._opts.keywords[t];e.addKeyword(t,n)}}function j(e,t){if(e._schemas[t]||e._refs[t])throw new Error('schema with key or id "'+t+'" already exists')}function B(e){for(var t=h.copy(e._opts),n=0;n<m.length;n++)delete t[m[n]];return t}function H(e){var t=e._opts.logger;if(!1===t)e.logger={log:G,warn:G,error:G};else{if(void 0===t&&(t=console),!("object"==typeof t&&t.log&&t.warn&&t.error))throw new Error("logger must implement log, warn and error methods");e.logger=t}}function G(){}},7976:function(e,t,n){"use strict";var r=n("6e76");e.exports={$id:"https://github.com/ajv-validator/ajv/blob/master/lib/definition_schema.js",definitions:{simpleTypes:r.definitions.simpleTypes},type:"object",dependencies:{schema:["validate"],$data:["validate"],statements:["inline"],valid:{not:{required:["macro"]}}},properties:{type:r.properties.type,schema:{type:"boolean"},statements:{type:"boolean"},dependencies:{type:"array",items:{type:"string"}},metaSchema:{type:"object"},modifying:{type:"boolean"},valid:{type:"boolean"},$data:{type:"boolean"},async:{type:"boolean"},errors:{anyOf:[{type:"boolean"},{const:"full"}]}}}},"798e":function(e,t,n){"use strict";e.exports=function(e,t,n){var r=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d="errs__"+i,p=e.util.copy(e),f="";p.level++;var m="valid"+p.level,g="i"+i,v=p.dataLevel=e.dataLevel+1,y="data"+v,x=e.baseId;if(r+="var "+d+" = errors;var "+h+";",Array.isArray(s)){var b=e.schema.additionalItems;if(!1===b){r+=" "+h+" = "+c+".length <= "+s.length+"; ";var w=l;l=e.errSchemaPath+"/additionalItems",r+="  if (!"+h+") {   ";var _=_||[];_.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { limit: "+s.length+" } ",!1!==e.opts.messages&&(r+=" , message: 'should NOT have more than "+s.length+" items' "),e.opts.verbose&&(r+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var A=r;r=_.pop(),!e.compositeRule&&u?e.async?r+=" throw new ValidationError(["+A+"]); ":r+=" validate.errors = ["+A+"]; return false; ":r+=" var err = "+A+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } ",l=w,u&&(f+="}",r+=" else { ")}var S=s;if(S){var E,M=-1,T=S.length-1;while(M<T)if(E=S[M+=1],e.opts.strictKeywords?"object"==typeof E&&Object.keys(E).length>0:e.util.schemaHasRules(E,e.RULES.all)){r+=" "+m+" = true; if ("+c+".length > "+M+") { ";var C=c+"["+M+"]";p.schema=E,p.schemaPath=a+"["+M+"]",p.errSchemaPath=l+"/"+M,p.errorPath=e.util.getPathExpr(e.errorPath,M,e.opts.jsonPointers,!0),p.dataPathArr[v]=M;var P=e.validate(p);p.baseId=x,e.util.varOccurences(P,y)<2?r+=" "+e.util.varReplace(P,y,C)+" ":r+=" var "+y+" = "+C+"; "+P+" ",r+=" }  ",u&&(r+=" if ("+m+") { ",f+="}")}}if("object"==typeof b&&(e.opts.strictKeywords?"object"==typeof b&&Object.keys(b).length>0:e.util.schemaHasRules(b,e.RULES.all))){p.schema=b,p.schemaPath=e.schemaPath+".additionalItems",p.errSchemaPath=e.errSchemaPath+"/additionalItems",r+=" "+m+" = true; if ("+c+".length > "+s.length+") {  for (var "+g+" = "+s.length+"; "+g+" < "+c+".length; "+g+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers,!0);C=c+"["+g+"]";p.dataPathArr[v]=g;P=e.validate(p);p.baseId=x,e.util.varOccurences(P,y)<2?r+=" "+e.util.varReplace(P,y,C)+" ":r+=" var "+y+" = "+C+"; "+P+" ",u&&(r+=" if (!"+m+") break; "),r+=" } }  ",u&&(r+=" if ("+m+") { ",f+="}")}}else if(e.opts.strictKeywords?"object"==typeof s&&Object.keys(s).length>0:e.util.schemaHasRules(s,e.RULES.all)){p.schema=s,p.schemaPath=a,p.errSchemaPath=l,r+="  for (var "+g+" = 0; "+g+" < "+c+".length; "+g+"++) { ",p.errorPath=e.util.getPathExpr(e.errorPath,g,e.opts.jsonPointers,!0);C=c+"["+g+"]";p.dataPathArr[v]=g;P=e.validate(p);p.baseId=x,e.util.varOccurences(P,y)<2?r+=" "+e.util.varReplace(P,y,C)+" ":r+=" var "+y+" = "+C+"; "+P+" ",u&&(r+=" if (!"+m+") break; "),r+=" }"}return u&&(r+=" "+f+" if ("+d+" == errors) {"),r}},"7aec":function(e,t,n){(function(e){var r;(function(e,i,o){function s(e){var t=this;function n(e,t){var n,r,i,o,s,a=[],l=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,l=Math.max(l,t.length)),i=0,o=-32;o<l;++o)t&&(r^=t.charCodeAt((o+32)%t.length)),0===o&&(s=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(s=s+1640531527|0,n=a[127&o]^=r+s,i=0==n?i+1:0);for(i>=128&&(a[127&(t&&t.length||0)]=-1),i=127,o=512;o>0;--o)r=a[i+34&127],n=a[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,a[i]=r^n;e.w=s,e.X=a,e.i=i}t.next=function(){var e,n,r=t.w,i=t.X,o=t.i;return t.w=r=r+1640531527|0,n=i[o+34&127],e=i[o=o+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=i[o]=n^e,t.i=o,n+(r^r>>>16)|0},n(t,e)}function a(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function l(e,t){null==e&&(e=+new Date);var n=new s(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,r=(e+t)/(1<<21)}while(0===r);return r},i.int32=n.next,i.quick=i,r&&(r.X&&a(r,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=l:n("07d6")&&n("3c35")?(r=function(){return l}.call(t,n,t,i),void 0===r||(i.exports=r)):this.xor4096=l})(0,e,n("07d6"))}).call(this,n("62e4")(e))},"808a":function(e,t,n){var r=n("16c3"),i=n("1f8f"),o=n("a3b3").createGesture,s=n("9052"),a=s.mat3,l=s.vec3,u=n("df2a"),c=n("5915"),h=n("17fb"),d=e.exports=function(e){if(this.valid=!0,this.id=e.id,this.timestamp=e.timestamp,this.hands=[],this.handsMap={},this.pointables=[],this.tools=[],this.fingers=[],e.interactionBox&&(this.interactionBox=new u(e.interactionBox)),this.gestures=[],this.pointablesMap={},this._translation=e.t,this._rotation=h.flatten(e.r),this._scaleFactor=e.s,this.data=e,this.type="frame",this.currentFrameRate=e.currentFrameRate,e.gestures)for(var t=0,n=e.gestures.length;t!=n;t++)this.gestures.push(o(e.gestures[t]));this.postprocessData(e)};d.prototype.postprocessData=function(e){e||(e=this.data);for(var t=0,n=e.hands.length;t!=n;t++){var o=new r(e.hands[t]);o.frame=this,this.hands.push(o),this.handsMap[o.id]=o}e.pointables=h.sortBy(e.pointables,(function(e){return e.id}));for(var s=0,a=e.pointables.length;s!=a;s++){var l=e.pointables[s],u=l.dipPosition?new c(l):new i(l);u.frame=this,this.addPointable(u)}},d.prototype.addPointable=function(e){if(this.pointables.push(e),this.pointablesMap[e.id]=e,(e.tool?this.tools:this.fingers).push(e),void 0!==e.handId&&this.handsMap.hasOwnProperty(e.handId)){var t=this.handsMap[e.handId];switch(t.pointables.push(e),(e.tool?t.tools:t.fingers).push(e),e.type){case 0:t.thumb=e;break;case 1:t.indexFinger=e;break;case 2:t.middleFinger=e;break;case 3:t.ringFinger=e;break;case 4:t.pinky=e;break}}},d.prototype.tool=function(e){var t=this.pointable(e);return t.tool?t:i.Invalid},d.prototype.pointable=function(e){return this.pointablesMap[e]||i.Invalid},d.prototype.finger=function(e){var t=this.pointable(e);return t.tool?i.Invalid:t},d.prototype.hand=function(e){return this.handsMap[e]||r.Invalid},d.prototype.rotationAngle=function(e,t){if(!this.valid||!e.valid)return 0;var n=this.rotationMatrix(e),r=.5*(n[0]+n[4]+n[8]-1),i=Math.acos(r);if(i=isNaN(i)?0:i,void 0!==t){var o=this.rotationAxis(e);i*=l.dot(o,l.normalize(l.create(),t))}return i},d.prototype.rotationAxis=function(e){return this.valid&&e.valid?l.normalize(l.create(),[this._rotation[7]-e._rotation[5],this._rotation[2]-e._rotation[6],this._rotation[3]-e._rotation[1]]):l.create()},d.prototype.rotationMatrix=function(e){if(!this.valid||!e.valid)return a.create();var t=a.transpose(a.create(),this._rotation);return a.multiply(a.create(),e._rotation,t)},d.prototype.scaleFactor=function(e){return this.valid&&e.valid?Math.exp(this._scaleFactor-e._scaleFactor):1},d.prototype.translation=function(e){return this.valid&&e.valid?l.subtract(l.create(),this._translation,e._translation):l.create()},d.prototype.toString=function(){var e="Frame [ id:"+this.id+" | timestamp:"+this.timestamp+" | Hand count:("+this.hands.length+") | Pointable count:("+this.pointables.length+")";return this.gestures&&(e+=" | Gesture count:("+this.gestures.length+")"),e+=" ]",e},d.prototype.dump=function(){var e="";e+="Frame Info:<br/>",e+=this.toString(),e+="<br/><br/>Hands:<br/>";for(var t=0,n=this.hands.length;t!=n;t++)e+="  "+this.hands[t].toString()+"<br/>";e+="<br/><br/>Pointables:<br/>";for(var r=0,i=this.pointables.length;r!=i;r++)e+="  "+this.pointables[r].toString()+"<br/>";if(this.gestures){e+="<br/><br/>Gestures:<br/>";for(var o=0,s=this.gestures.length;o!=s;o++)e+="  "+this.gestures[o].toString()+"<br/>"}return e+="<br/><br/>Raw JSON:<br/>",e+=JSON.stringify(this.data),e},d.Invalid={valid:!1,hands:[],fingers:[],tools:[],gestures:[],pointables:[],pointable:function(){return i.Invalid},finger:function(){return i.Invalid},hand:function(){return r.Invalid},toString:function(){return"invalid frame"},dump:function(){return this.toString()},rotationAngle:function(){return 0},rotationMatrix:function(){return a.create()},rotationAxis:function(){return l.create()},scaleFactor:function(){return 1},translation:function(){return l.create()}}},"81d5":function(e,t,n){"use strict";var r=n("7b0b"),i=n("23cb"),o=n("50c4");e.exports=function(e){var t=r(this),n=o(t.length),s=arguments.length,a=i(s>1?arguments[1]:void 0,n),l=s>2?arguments[2]:void 0,u=void 0===l?n:i(l,n);while(u>a)t[a++]=e;return t}},"82f8":function(e,t,n){"use strict";var r=n("ebb5"),i=n("4d64").includes,o=r.aTypedArray,s=r.exportTypedArrayMethod;s("includes",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},"84c3":function(e,t,n){var r=n("74e8");r("Uint16",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},"899a":function(e,t,n){"use strict";var r=n("a971");function i(e){this.message="validation failed",this.errors=e,this.ajv=this.validation=!0}function o(e,t,n){this.message=n||o.message(e,t),this.missingRef=r.url(e,t),this.missingSchema=r.normalizeId(r.fullPath(this.missingRef))}function s(e){return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}e.exports={Validation:s(i),MissingRef:s(o)},o.message=function(e,t){return"can't resolve reference "+t+" from id "+e}},"89a9":function(e,t,n){"use strict";var r=e.exports=function(e,t,n){"function"==typeof t&&(n=t,t={}),n=t.cb||n;var r="function"==typeof n?n:n.pre||function(){},o=n.post||function(){};i(t,r,o,e,"",e)};function i(e,t,n,s,a,l,u,c,h,d){if(s&&"object"==typeof s&&!Array.isArray(s)){for(var p in t(s,a,l,u,c,h,d),s){var f=s[p];if(Array.isArray(f)){if(p in r.arrayKeywords)for(var m=0;m<f.length;m++)i(e,t,n,f[m],a+"/"+p+"/"+m,l,a,p,s,m)}else if(p in r.propsKeywords){if(f&&"object"==typeof f)for(var g in f)i(e,t,n,f[g],a+"/"+p+"/"+o(g),l,a,p,s,g)}else(p in r.keywords||e.allKeys&&!(p in r.skipKeywords))&&i(e,t,n,f,a+"/"+p,l,a,p,s)}n(s,a,l,u,c,h,d)}}function o(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}r.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0},r.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},r.propsKeywords={definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},r.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0}},"89ed":function(e,t,n){(function(e){var r;(function(e,i,o){function s(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function l(e,t){var n=new s(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,r=(e+t)/(1<<21)}while(0===r);return r},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&a(r,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=l:n("07d6")&&n("3c35")?(r=function(){return l}.call(t,n,t,i),void 0===r||(i.exports=r)):this.tychei=l})(0,e,n("07d6"))}).call(this,n("62e4")(e))},"8aa7":function(e,t,n){var r=n("da84"),i=n("d039"),o=n("1c7e"),s=n("ebb5").NATIVE_ARRAY_BUFFER_VIEWS,a=r.ArrayBuffer,l=r.Int8Array;e.exports=!s||!i((function(){l(1)}))||!i((function(){new l(-1)}))||!o((function(e){new l,new l(null),new l(1.5),new l(e)}),!0)||i((function(){return 1!==new l(new a(2),1,void 0).length}))},"8b78":function(e,t,n){},"8d02":function(e,t,n){"use strict";var r=n("a971"),i=n("fbda"),o=n("899a"),s=n("f71e"),a=n("d508"),l=i.ucs2length,u=n("694b"),c=o.Validation;function h(e,t,n,f){var b=this,w=this._opts,_=[void 0],A={},S=[],E={},M=[],T={},C=[];t=t||{schema:e,refVal:_,refs:A};var P=d.call(this,e,t,f),R=this._compilations[P.index];if(P.compiling)return R.callValidate=k;var L=this._formats,O=this.RULES;try{var D=N(e,t,n,f);R.validate=D;var I=R.callValidate;return I&&(I.schema=D.schema,I.errors=null,I.refs=D.refs,I.refVal=D.refVal,I.root=D.root,I.$async=D.$async,w.sourceCode&&(I.source=D.source)),D}finally{p.call(this,e,t,f)}function k(){var e=R.validate,t=e.apply(this,arguments);return k.errors=e.errors,t}function N(e,n,s,d){var p=!n||n&&n.schema==e;if(n.schema!=t.schema)return h.call(b,e,n,s,d);var f,E=!0===e.$async,T=a({isTop:!0,schema:e,isRoot:p,baseId:d,root:n,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:o.MissingRef,RULES:O,validate:a,util:i,resolve:r,resolveRef:F,usePattern:B,useDefault:H,useCustomRule:G,opts:w,formats:L,logger:b.logger,self:b});T=x(_,v)+x(S,m)+x(M,g)+x(C,y)+T,w.processCode&&(T=w.processCode(T,e));try{var P=new Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",T);f=P(b,O,L,t,_,M,C,u,l,c),_[0]=f}catch(R){throw b.logger.error("Error compiling schema, function code:",T),R}return f.schema=e,f.errors=null,f.refs=A,f.refVal=_,f.root=p?f:n,E&&(f.$async=!0),!0===w.sourceCode&&(f.source={code:T,patterns:S,defaults:M}),f}function F(e,i,o){i=r.url(e,i);var s,a,l=A[i];if(void 0!==l)return s=_[l],a="refVal["+l+"]",j(s,a);if(!o&&t.refs){var u=t.refs[i];if(void 0!==u)return s=t.refVal[u],a=V(i,s),j(s,a)}a=V(i);var c=r.call(b,N,t,i);if(void 0===c){var d=n&&n[i];d&&(c=r.inlineRef(d,w.inlineRefs)?d:h.call(b,d,t,n,e))}if(void 0!==c)return U(i,c),j(c,a);z(i)}function V(e,t){var n=_.length;return _[n]=t,A[e]=n,"refVal"+n}function z(e){delete A[e]}function U(e,t){var n=A[e];_[n]=t}function j(e,t){return"object"==typeof e||"boolean"==typeof e?{code:t,schema:e,inline:!0}:{code:t,$async:e&&!!e.$async}}function B(e){var t=E[e];return void 0===t&&(t=E[e]=S.length,S[t]=e),"pattern"+t}function H(e){switch(typeof e){case"boolean":case"number":return""+e;case"string":return i.toQuotedString(e);case"object":if(null===e)return"null";var t=s(e),n=T[t];return void 0===n&&(n=T[t]=M.length,M[n]=e),"default"+n}}function G(e,t,n,r){if(!1!==b._opts.validateSchema){var i=e.definition.dependencies;if(i&&!i.every((function(e){return Object.prototype.hasOwnProperty.call(n,e)})))throw new Error("parent schema must have all required keywords: "+i.join(","));var o=e.definition.validateSchema;if(o){var s=o(t);if(!s){var a="keyword schema is invalid: "+b.errorsText(o.errors);if("log"!=b._opts.validateSchema)throw new Error(a);b.logger.error(a)}}}var l,u=e.definition.compile,c=e.definition.inline,h=e.definition.macro;if(u)l=u.call(b,t,n,r);else if(h)l=h.call(b,t,n,r),!1!==w.validateSchema&&b.validateSchema(l,!0);else if(c)l=c.call(b,r,e.keyword,t,n);else if(l=e.definition.validate,!l)return;if(void 0===l)throw new Error('custom keyword "'+e.keyword+'"failed to compile');var d=C.length;return C[d]=l,{code:"customRule"+d,validate:l}}}function d(e,t,n){var r=f.call(this,e,t,n);return r>=0?{index:r,compiling:!0}:(r=this._compilations.length,this._compilations[r]={schema:e,root:t,baseId:n},{index:r,compiling:!1})}function p(e,t,n){var r=f.call(this,e,t,n);r>=0&&this._compilations.splice(r,1)}function f(e,t,n){for(var r=0;r<this._compilations.length;r++){var i=this._compilations[r];if(i.schema==e&&i.root==t&&i.baseId==n)return r}return-1}function m(e,t){return"var pattern"+e+" = new RegExp("+i.toQuotedString(t[e])+");"}function g(e){return"var default"+e+" = defaults["+e+"];"}function v(e,t){return void 0===t[e]?"":"var refVal"+e+" = refVal["+e+"];"}function y(e){return"var customRule"+e+" = customRules["+e+"];"}function x(e,t){if(!e.length)return"";for(var n="",r=0;r<e.length;r++)n+=t(r,e);return n}e.exports=h},9052:function(e,t,n){(function(e){"use strict";var n={};n.exports=t,function(e){if(!t)var t=1e-6;if(!n)var n="undefined"!==typeof Float32Array?Float32Array:Array;if(!r)var r=Math.random;var i={setMatrixArrayType:function(e){n=e}};"undefined"!==typeof e&&(e.glMatrix=i);var o=Math.PI/180;i.toRadian=function(e){return e*o};var s={create:function(){var e=new n(2);return e[0]=0,e[1]=0,e},clone:function(e){var t=new n(2);return t[0]=e[0],t[1]=e[1],t},fromValues:function(e,t){var r=new n(2);return r[0]=e,r[1]=t,r},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},set:function(e,t,n){return e[0]=t,e[1]=n,e},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},subtract:function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}};s.sub=s.subtract,s.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e},s.mul=s.multiply,s.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e},s.div=s.divide,s.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},s.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},s.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},s.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e},s.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)},s.dist=s.distance,s.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r},s.sqrDist=s.squaredDistance,s.length=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},s.len=s.length,s.squaredLength=function(e){var t=e[0],n=e[1];return t*t+n*n},s.sqrLen=s.squaredLength,s.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},s.normalize=function(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e},s.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},s.cross=function(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e},s.lerp=function(e,t,n,r){var i=t[0],o=t[1];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e},s.random=function(e,t){t=t||1;var n=2*r()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},s.transformMat2=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e},s.transformMat2d=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[2]*i+n[4],e[1]=n[1]*r+n[3]*i+n[5],e},s.transformMat3=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[3]*i+n[6],e[1]=n[1]*r+n[4]*i+n[7],e},s.transformMat4=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e},s.forEach=function(){var e=s.create();return function(t,n,r,i,o,s){var a,l;for(n||(n=2),r||(r=0),l=i?Math.min(i*n+r,t.length):t.length,a=r;a<l;a+=n)e[0]=t[a],e[1]=t[a+1],o(e,e,s),t[a]=e[0],t[a+1]=e[1];return t}}(),s.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},"undefined"!==typeof e&&(e.vec2=s);var a={create:function(){var e=new n(3);return e[0]=0,e[1]=0,e[2]=0,e},clone:function(e){var t=new n(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},fromValues:function(e,t,r){var i=new n(3);return i[0]=e,i[1]=t,i[2]=r,i},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},subtract:function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}};a.sub=a.subtract,a.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e},a.mul=a.multiply,a.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},a.div=a.divide,a.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},a.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},a.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},a.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},a.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)},a.dist=a.distance,a.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i},a.sqrDist=a.squaredDistance,a.length=function(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)},a.len=a.length,a.squaredLength=function(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r},a.sqrLen=a.squaredLength,a.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},a.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e},a.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},a.cross=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=n[0],a=n[1],l=n[2];return e[0]=i*l-o*a,e[1]=o*s-r*l,e[2]=r*a-i*s,e},a.lerp=function(e,t,n,r){var i=t[0],o=t[1],s=t[2];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=s+r*(n[2]-s),e},a.random=function(e,t){t=t||1;var n=2*r()*Math.PI,i=2*r()-1,o=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*o,e[1]=Math.sin(n)*o,e[2]=i*t,e},a.transformMat4=function(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12],e[1]=n[1]*r+n[5]*i+n[9]*o+n[13],e[2]=n[2]*r+n[6]*i+n[10]*o+n[14],e},a.transformMat3=function(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e},a.transformQuat=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=n[0],a=n[1],l=n[2],u=n[3],c=u*r+a*o-l*i,h=u*i+l*r-s*o,d=u*o+s*i-a*r,p=-s*r-a*i-l*o;return e[0]=c*u+p*-s+h*-l-d*-a,e[1]=h*u+p*-a+d*-s-c*-l,e[2]=d*u+p*-l+c*-a-h*-s,e},a.rotateX=function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},a.rotateY=function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},a.rotateZ=function(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},a.forEach=function(){var e=a.create();return function(t,n,r,i,o,s){var a,l;for(n||(n=3),r||(r=0),l=i?Math.min(i*n+r,t.length):t.length,a=r;a<l;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],o(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}}(),a.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},"undefined"!==typeof e&&(e.vec3=a);var l={create:function(){var e=new n(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},clone:function(e){var t=new n(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},fromValues:function(e,t,r,i){var o=new n(4);return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},set:function(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},subtract:function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}};l.sub=l.subtract,l.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e},l.mul=l.multiply,l.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e},l.div=l.divide,l.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},l.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},l.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},l.scaleAndAdd=function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},l.distance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+o*o)},l.dist=l.distance,l.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],o=t[3]-e[3];return n*n+r*r+i*i+o*o},l.sqrDist=l.squaredDistance,l.length=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)},l.len=l.length,l.squaredLength=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i},l.sqrLen=l.squaredLength,l.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},l.normalize=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=n*n+r*r+i*i+o*o;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s),e},l.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},l.lerp=function(e,t,n,r){var i=t[0],o=t[1],s=t[2],a=t[3];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=s+r*(n[2]-s),e[3]=a+r*(n[3]-a),e},l.random=function(e,t){return t=t||1,e[0]=r(),e[1]=r(),e[2]=r(),e[3]=r(),l.normalize(e,e),l.scale(e,e,t),e},l.transformMat4=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*s,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*s,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*s,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*s,e},l.transformQuat=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=n[0],a=n[1],l=n[2],u=n[3],c=u*r+a*o-l*i,h=u*i+l*r-s*o,d=u*o+s*i-a*r,p=-s*r-a*i-l*o;return e[0]=c*u+p*-s+h*-l-d*-a,e[1]=h*u+p*-a+d*-s-c*-l,e[2]=d*u+p*-l+c*-a-h*-s,e},l.forEach=function(){var e=l.create();return function(t,n,r,i,o,s){var a,l;for(n||(n=4),r||(r=0),l=i?Math.min(i*n+r,t.length):t.length,a=r;a<l;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],o(e,e,s),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}(),l.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},"undefined"!==typeof e&&(e.vec4=l);var u={create:function(){var e=new n(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},clone:function(e){var t=new n(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},transpose:function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},invert:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=n*o-i*r;return s?(s=1/s,e[0]=o*s,e[1]=-r*s,e[2]=-i*s,e[3]=n*s,e):null},adjoint:function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},multiply:function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=n[0],l=n[1],u=n[2],c=n[3];return e[0]=r*a+o*l,e[1]=i*a+s*l,e[2]=r*u+o*c,e[3]=i*u+s*c,e}};u.mul=u.multiply,u.rotate=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=r*l+o*a,e[1]=i*l+s*a,e[2]=r*-a+o*l,e[3]=i*-a+s*l,e},u.scale=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=n[0],l=n[1];return e[0]=r*a,e[1]=i*a,e[2]=o*l,e[3]=s*l,e},u.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},u.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},u.LDU=function(e,t,n,r){return e[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-e[2]*n[1],[e,t,n]},"undefined"!==typeof e&&(e.mat2=u);var c={create:function(){var e=new n(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},clone:function(e){var t=new n(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},invert:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=n*o-r*i;return l?(l=1/l,e[0]=o*l,e[1]=-r*l,e[2]=-i*l,e[3]=n*l,e[4]=(i*a-o*s)*l,e[5]=(r*s-n*a)*l,e):null},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],u=n[0],c=n[1],h=n[2],d=n[3],p=n[4],f=n[5];return e[0]=r*u+o*c,e[1]=i*u+s*c,e[2]=r*h+o*d,e[3]=i*h+s*d,e[4]=r*p+o*f+a,e[5]=i*p+s*f+l,e}};c.mul=c.multiply,c.rotate=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],u=Math.sin(n),c=Math.cos(n);return e[0]=r*c+o*u,e[1]=i*c+s*u,e[2]=r*-u+o*c,e[3]=i*-u+s*c,e[4]=a,e[5]=l,e},c.scale=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],u=n[0],c=n[1];return e[0]=r*u,e[1]=i*u,e[2]=o*c,e[3]=s*c,e[4]=a,e[5]=l,e},c.translate=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],u=n[0],c=n[1];return e[0]=r,e[1]=i,e[2]=o,e[3]=s,e[4]=r*u+o*c+a,e[5]=i*u+s*c+l,e},c.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},c.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},"undefined"!==typeof e&&(e.mat2d=c);var h={create:function(){var e=new n(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat4:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},clone:function(e){var t=new n(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},transpose:function(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},invert:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],u=t[7],c=t[8],h=c*s-a*u,d=-c*o+a*l,p=u*o-s*l,f=n*h+r*d+i*p;return f?(f=1/f,e[0]=h*f,e[1]=(-c*r+i*u)*f,e[2]=(a*r-i*s)*f,e[3]=d*f,e[4]=(c*n-i*l)*f,e[5]=(-a*n+i*o)*f,e[6]=p*f,e[7]=(-u*n+r*l)*f,e[8]=(s*n-r*o)*f,e):null},adjoint:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],u=t[7],c=t[8];return e[0]=s*c-a*u,e[1]=i*u-r*c,e[2]=r*a-i*s,e[3]=a*l-o*c,e[4]=n*c-i*l,e[5]=i*o-n*a,e[6]=o*u-s*l,e[7]=r*l-n*u,e[8]=n*s-r*o,e},determinant:function(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],u=e[8];return t*(u*o-s*l)+n*(-u*i+s*a)+r*(l*i-o*a)},multiply:function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=n[0],p=n[1],f=n[2],m=n[3],g=n[4],v=n[5],y=n[6],x=n[7],b=n[8];return e[0]=d*r+p*s+f*u,e[1]=d*i+p*a+f*c,e[2]=d*o+p*l+f*h,e[3]=m*r+g*s+v*u,e[4]=m*i+g*a+v*c,e[5]=m*o+g*l+v*h,e[6]=y*r+x*s+b*u,e[7]=y*i+x*a+b*c,e[8]=y*o+x*l+b*h,e}};h.mul=h.multiply,h.translate=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=n[0],p=n[1];return e[0]=r,e[1]=i,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=d*r+p*s+u,e[7]=d*i+p*a+c,e[8]=d*o+p*l+h,e},h.rotate=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=Math.sin(n),p=Math.cos(n);return e[0]=p*r+d*s,e[1]=p*i+d*a,e[2]=p*o+d*l,e[3]=p*s-d*r,e[4]=p*a-d*i,e[5]=p*l-d*o,e[6]=u,e[7]=c,e[8]=h,e},h.scale=function(e,t,n){var r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},h.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},h.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=n+n,a=r+r,l=i+i,u=n*s,c=r*s,h=r*a,d=i*s,p=i*a,f=i*l,m=o*s,g=o*a,v=o*l;return e[0]=1-h-f,e[3]=c-v,e[6]=d+g,e[1]=c+v,e[4]=1-u-f,e[7]=p-m,e[2]=d-g,e[5]=p+m,e[8]=1-u-h,e},h.normalFromMat4=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],v=t[15],y=n*a-r*s,x=n*l-i*s,b=n*u-o*s,w=r*l-i*a,_=r*u-o*a,A=i*u-o*l,S=c*m-h*f,E=c*g-d*f,M=c*v-p*f,T=h*g-d*m,C=h*v-p*m,P=d*v-p*g,R=y*P-x*C+b*T+w*M-_*E+A*S;return R?(R=1/R,e[0]=(a*P-l*C+u*T)*R,e[1]=(l*M-s*P-u*E)*R,e[2]=(s*C-a*M+u*S)*R,e[3]=(i*C-r*P-o*T)*R,e[4]=(n*P-i*M+o*E)*R,e[5]=(r*M-n*C-o*S)*R,e[6]=(m*A-g*_+v*w)*R,e[7]=(g*b-f*A-v*x)*R,e[8]=(f*_-m*b+v*y)*R,e):null},h.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},h.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},"undefined"!==typeof e&&(e.mat3=h);var d={create:function(){var e=new n(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},clone:function(e){var t=new n(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},transpose:function(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=i,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],v=t[15],y=n*a-r*s,x=n*l-i*s,b=n*u-o*s,w=r*l-i*a,_=r*u-o*a,A=i*u-o*l,S=c*m-h*f,E=c*g-d*f,M=c*v-p*f,T=h*g-d*m,C=h*v-p*m,P=d*v-p*g,R=y*P-x*C+b*T+w*M-_*E+A*S;return R?(R=1/R,e[0]=(a*P-l*C+u*T)*R,e[1]=(i*C-r*P-o*T)*R,e[2]=(m*A-g*_+v*w)*R,e[3]=(d*_-h*A-p*w)*R,e[4]=(l*M-s*P-u*E)*R,e[5]=(n*P-i*M+o*E)*R,e[6]=(g*b-f*A-v*x)*R,e[7]=(c*A-d*b+p*x)*R,e[8]=(s*C-a*M+u*S)*R,e[9]=(r*M-n*C-o*S)*R,e[10]=(f*_-m*b+v*y)*R,e[11]=(h*b-c*_-p*y)*R,e[12]=(a*E-s*T-l*S)*R,e[13]=(n*T-r*E+i*S)*R,e[14]=(m*x-f*w-g*y)*R,e[15]=(c*w-h*x+d*y)*R,e):null},adjoint:function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=t[4],a=t[5],l=t[6],u=t[7],c=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],v=t[15];return e[0]=a*(d*v-p*g)-h*(l*v-u*g)+m*(l*p-u*d),e[1]=-(r*(d*v-p*g)-h*(i*v-o*g)+m*(i*p-o*d)),e[2]=r*(l*v-u*g)-a*(i*v-o*g)+m*(i*u-o*l),e[3]=-(r*(l*p-u*d)-a*(i*p-o*d)+h*(i*u-o*l)),e[4]=-(s*(d*v-p*g)-c*(l*v-u*g)+f*(l*p-u*d)),e[5]=n*(d*v-p*g)-c*(i*v-o*g)+f*(i*p-o*d),e[6]=-(n*(l*v-u*g)-s*(i*v-o*g)+f*(i*u-o*l)),e[7]=n*(l*p-u*d)-s*(i*p-o*d)+c*(i*u-o*l),e[8]=s*(h*v-p*m)-c*(a*v-u*m)+f*(a*p-u*h),e[9]=-(n*(h*v-p*m)-c*(r*v-o*m)+f*(r*p-o*h)),e[10]=n*(a*v-u*m)-s*(r*v-o*m)+f*(r*u-o*a),e[11]=-(n*(a*p-u*h)-s*(r*p-o*h)+c*(r*u-o*a)),e[12]=-(s*(h*g-d*m)-c*(a*g-l*m)+f*(a*d-l*h)),e[13]=n*(h*g-d*m)-c*(r*g-i*m)+f*(r*d-i*h),e[14]=-(n*(a*g-l*m)-s*(r*g-i*m)+f*(r*l-i*a)),e[15]=n*(a*d-l*h)-s*(r*d-i*h)+c*(r*l-i*a),e},determinant:function(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=t*s-n*o,y=t*a-r*o,x=t*l-i*o,b=n*a-r*s,w=n*l-i*s,_=r*l-i*a,A=u*f-c*p,S=u*m-h*p,E=u*g-d*p,M=c*m-h*f,T=c*g-d*f,C=h*g-d*m;return v*C-y*T+x*M+b*E-w*S+_*A},multiply:function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],v=t[14],y=t[15],x=n[0],b=n[1],w=n[2],_=n[3];return e[0]=x*r+b*a+w*h+_*m,e[1]=x*i+b*l+w*d+_*g,e[2]=x*o+b*u+w*p+_*v,e[3]=x*s+b*c+w*f+_*y,x=n[4],b=n[5],w=n[6],_=n[7],e[4]=x*r+b*a+w*h+_*m,e[5]=x*i+b*l+w*d+_*g,e[6]=x*o+b*u+w*p+_*v,e[7]=x*s+b*c+w*f+_*y,x=n[8],b=n[9],w=n[10],_=n[11],e[8]=x*r+b*a+w*h+_*m,e[9]=x*i+b*l+w*d+_*g,e[10]=x*o+b*u+w*p+_*v,e[11]=x*s+b*c+w*f+_*y,x=n[12],b=n[13],w=n[14],_=n[15],e[12]=x*r+b*a+w*h+_*m,e[13]=x*i+b*l+w*d+_*g,e[14]=x*o+b*u+w*p+_*v,e[15]=x*s+b*c+w*f+_*y,e}};d.mul=d.multiply,d.translate=function(e,t,n){var r,i,o,s,a,l,u,c,h,d,p,f,m=n[0],g=n[1],v=n[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*v+t[12],e[13]=t[1]*m+t[5]*g+t[9]*v+t[13],e[14]=t[2]*m+t[6]*g+t[10]*v+t[14],e[15]=t[3]*m+t[7]*g+t[11]*v+t[15]):(r=t[0],i=t[1],o=t[2],s=t[3],a=t[4],l=t[5],u=t[6],c=t[7],h=t[8],d=t[9],p=t[10],f=t[11],e[0]=r,e[1]=i,e[2]=o,e[3]=s,e[4]=a,e[5]=l,e[6]=u,e[7]=c,e[8]=h,e[9]=d,e[10]=p,e[11]=f,e[12]=r*m+a*g+h*v+t[12],e[13]=i*m+l*g+d*v+t[13],e[14]=o*m+u*g+p*v+t[14],e[15]=s*m+c*g+f*v+t[15]),e},d.scale=function(e,t,n){var r=n[0],i=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},d.rotate=function(e,n,r,i){var o,s,a,l,u,c,h,d,p,f,m,g,v,y,x,b,w,_,A,S,E,M,T,C,P=i[0],R=i[1],L=i[2],O=Math.sqrt(P*P+R*R+L*L);return Math.abs(O)<t?null:(O=1/O,P*=O,R*=O,L*=O,o=Math.sin(r),s=Math.cos(r),a=1-s,l=n[0],u=n[1],c=n[2],h=n[3],d=n[4],p=n[5],f=n[6],m=n[7],g=n[8],v=n[9],y=n[10],x=n[11],b=P*P*a+s,w=R*P*a+L*o,_=L*P*a-R*o,A=P*R*a-L*o,S=R*R*a+s,E=L*R*a+P*o,M=P*L*a+R*o,T=R*L*a-P*o,C=L*L*a+s,e[0]=l*b+d*w+g*_,e[1]=u*b+p*w+v*_,e[2]=c*b+f*w+y*_,e[3]=h*b+m*w+x*_,e[4]=l*A+d*S+g*E,e[5]=u*A+p*S+v*E,e[6]=c*A+f*S+y*E,e[7]=h*A+m*S+x*E,e[8]=l*M+d*T+g*C,e[9]=u*M+p*T+v*C,e[10]=c*M+f*T+y*C,e[11]=h*M+m*T+x*C,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e)},d.rotateX=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],s=t[5],a=t[6],l=t[7],u=t[8],c=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+u*r,e[5]=s*i+c*r,e[6]=a*i+h*r,e[7]=l*i+d*r,e[8]=u*i-o*r,e[9]=c*i-s*r,e[10]=h*i-a*r,e[11]=d*i-l*r,e},d.rotateY=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],u=t[8],c=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-u*r,e[1]=s*i-c*r,e[2]=a*i-h*r,e[3]=l*i-d*r,e[8]=o*r+u*i,e[9]=s*r+c*i,e[10]=a*r+h*i,e[11]=l*r+d*i,e},d.rotateZ=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],s=t[1],a=t[2],l=t[3],u=t[4],c=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+u*r,e[1]=s*i+c*r,e[2]=a*i+h*r,e[3]=l*i+d*r,e[4]=u*i-o*r,e[5]=c*i-s*r,e[6]=h*i-a*r,e[7]=d*i-l*r,e},d.fromRotationTranslation=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=r+r,l=i+i,u=o+o,c=r*a,h=r*l,d=r*u,p=i*l,f=i*u,m=o*u,g=s*a,v=s*l,y=s*u;return e[0]=1-(p+m),e[1]=h+y,e[2]=d-v,e[3]=0,e[4]=h-y,e[5]=1-(c+m),e[6]=f+g,e[7]=0,e[8]=d+v,e[9]=f-g,e[10]=1-(c+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},d.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=n+n,a=r+r,l=i+i,u=n*s,c=r*s,h=r*a,d=i*s,p=i*a,f=i*l,m=o*s,g=o*a,v=o*l;return e[0]=1-h-f,e[1]=c+v,e[2]=d-g,e[3]=0,e[4]=c-v,e[5]=1-u-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-u-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},d.frustum=function(e,t,n,r,i,o,s){var a=1/(n-t),l=1/(i-r),u=1/(o-s);return e[0]=2*o*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*l,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(i+r)*l,e[10]=(s+o)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*u,e[15]=0,e},d.perspective=function(e,t,n,r,i){var o=1/Math.tan(t/2),s=1/(r-i);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(i+r)*s,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*i*r*s,e[15]=0,e},d.ortho=function(e,t,n,r,i,o,s){var a=1/(t-n),l=1/(r-i),u=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+n)*a,e[13]=(i+r)*l,e[14]=(s+o)*u,e[15]=1,e},d.lookAt=function(e,n,r,i){var o,s,a,l,u,c,h,p,f,m,g=n[0],v=n[1],y=n[2],x=i[0],b=i[1],w=i[2],_=r[0],A=r[1],S=r[2];return Math.abs(g-_)<t&&Math.abs(v-A)<t&&Math.abs(y-S)<t?d.identity(e):(h=g-_,p=v-A,f=y-S,m=1/Math.sqrt(h*h+p*p+f*f),h*=m,p*=m,f*=m,o=b*f-w*p,s=w*h-x*f,a=x*p-b*h,m=Math.sqrt(o*o+s*s+a*a),m?(m=1/m,o*=m,s*=m,a*=m):(o=0,s=0,a=0),l=p*a-f*s,u=f*o-h*a,c=h*s-p*o,m=Math.sqrt(l*l+u*u+c*c),m?(m=1/m,l*=m,u*=m,c*=m):(l=0,u=0,c=0),e[0]=o,e[1]=l,e[2]=h,e[3]=0,e[4]=s,e[5]=u,e[6]=p,e[7]=0,e[8]=a,e[9]=c,e[10]=f,e[11]=0,e[12]=-(o*g+s*v+a*y),e[13]=-(l*g+u*v+c*y),e[14]=-(h*g+p*v+f*y),e[15]=1,e)},d.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},d.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},"undefined"!==typeof e&&(e.mat4=d);var p={create:function(){var e=new n(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}};p.rotationTo=function(){var e=a.create(),t=a.fromValues(1,0,0),n=a.fromValues(0,1,0);return function(r,i,o){var s=a.dot(i,o);return s<-.999999?(a.cross(e,t,i),a.length(e)<1e-6&&a.cross(e,n,i),a.normalize(e,e),p.setAxisAngle(r,e,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(a.cross(e,i,o),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+s,p.normalize(r,r))}}(),p.setAxes=function(){var e=h.create();return function(t,n,r,i){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],p.normalize(t,p.fromMat3(t,e))}}(),p.clone=l.clone,p.fromValues=l.fromValues,p.copy=l.copy,p.set=l.set,p.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},p.setAxisAngle=function(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e},p.add=l.add,p.multiply=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=t[3],a=n[0],l=n[1],u=n[2],c=n[3];return e[0]=r*c+s*a+i*u-o*l,e[1]=i*c+s*l+o*a-r*u,e[2]=o*c+s*u+r*l-i*a,e[3]=s*c-r*a-i*l-o*u,e},p.mul=p.multiply,p.scale=l.scale,p.rotateX=function(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=r*l+s*a,e[1]=i*l+o*a,e[2]=o*l-i*a,e[3]=s*l-r*a,e},p.rotateY=function(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=r*l-o*a,e[1]=i*l+s*a,e[2]=o*l+r*a,e[3]=s*l-i*a,e},p.rotateZ=function(e,t,n){n*=.5;var r=t[0],i=t[1],o=t[2],s=t[3],a=Math.sin(n),l=Math.cos(n);return e[0]=r*l+i*a,e[1]=i*l-r*a,e[2]=o*l+s*a,e[3]=s*l-o*a,e},p.calculateW=function(e,t){var n=t[0],r=t[1],i=t[2];return e[0]=n,e[1]=r,e[2]=i,e[3]=-Math.sqrt(Math.abs(1-n*n-r*r-i*i)),e},p.dot=l.dot,p.lerp=l.lerp,p.slerp=function(e,t,n,r){var i,o,s,a,l,u=t[0],c=t[1],h=t[2],d=t[3],p=n[0],f=n[1],m=n[2],g=n[3];return o=u*p+c*f+h*m+d*g,o<0&&(o=-o,p=-p,f=-f,m=-m,g=-g),1-o>1e-6?(i=Math.acos(o),s=Math.sin(i),a=Math.sin((1-r)*i)/s,l=Math.sin(r*i)/s):(a=1-r,l=r),e[0]=a*u+l*p,e[1]=a*c+l*f,e[2]=a*h+l*m,e[3]=a*d+l*g,e},p.invert=function(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],s=n*n+r*r+i*i+o*o,a=s?1/s:0;return e[0]=-n*a,e[1]=-r*a,e[2]=-i*a,e[3]=o*a,e},p.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},p.length=l.length,p.len=p.length,p.squaredLength=l.squaredLength,p.sqrLen=p.squaredLength,p.normalize=l.normalize,p.fromMat3=function(e,t){var n,r=t[0]+t[4]+t[8];if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[7]-t[5])*n,e[1]=(t[2]-t[6])*n,e[2]=(t[3]-t[1])*n;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);var o=(i+1)%3,s=(i+2)%3;n=Math.sqrt(t[3*i+i]-t[3*o+o]-t[3*s+s]+1),e[i]=.5*n,n=.5/n,e[3]=(t[3*s+o]-t[3*o+s])*n,e[o]=(t[3*o+i]+t[3*i+o])*n,e[s]=(t[3*s+i]+t[3*i+s])*n}return e},p.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},"undefined"!==typeof e&&(e.quat=p)}(n.exports)})()},9091:function(e,t,n){
/*!
 * Sizzle CSS Selector Engine
 *  Copyright 2011, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
(function(){var t=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,n="sizcache"+(Math.random()+"").replace(".",""),r=0,i=Object.prototype.toString,o=!1,s=!0,a=/\\/g,l=/\r\n/g,u=/\W/;[0,0].sort((function(){return s=!1,0}));var c=function(e,n,r,o){r=r||[],n=n||document;var s=n;if(1!==n.nodeType&&9!==n.nodeType)return[];if(!e||"string"!==typeof e)return r;var a,l,u,h,f,m,g,v,x=!0,b=c.isXML(n),_=[],A=e;do{if(t.exec(""),a=t.exec(A),a&&(A=a[3],_.push(a[1]),a[2])){h=a[3];break}}while(a);if(_.length>1&&p.exec(e))if(2===_.length&&d.relative[_[0]])l=w(_[0]+_[1],n,o);else{l=d.relative[_[0]]?[n]:c(_.shift(),n);while(_.length)e=_.shift(),d.relative[e]&&(e+=_.shift()),l=w(e,l,o)}else if(!o&&_.length>1&&9===n.nodeType&&!b&&d.match.ID.test(_[0])&&!d.match.ID.test(_[_.length-1])&&(f=c.find(_.shift(),n,b),n=f.expr?c.filter(f.expr,f.set)[0]:f.set[0]),n){f=o?{expr:_.pop(),set:y(o)}:c.find(_.pop(),1!==_.length||"~"!==_[0]&&"+"!==_[0]||!n.parentNode?n:n.parentNode,b),l=f.expr?c.filter(f.expr,f.set):f.set,_.length>0?u=y(l):x=!1;while(_.length)m=_.pop(),g=m,d.relative[m]?g=_.pop():m="",null==g&&(g=n),d.relative[m](u,g,b)}else u=_=[];if(u||(u=l),u||c.error(m||e),"[object Array]"===i.call(u))if(x)if(n&&1===n.nodeType)for(v=0;null!=u[v];v++)u[v]&&(!0===u[v]||1===u[v].nodeType&&c.contains(n,u[v]))&&r.push(l[v]);else for(v=0;null!=u[v];v++)u[v]&&1===u[v].nodeType&&r.push(l[v]);else r.push.apply(r,u);else y(u,r);return h&&(c(h,s,r,o),c.uniqueSort(r)),r};c.uniqueSort=function(e){if(g&&(o=s,e.sort(g),o))for(var t=1;t<e.length;t++)e[t]===e[t-1]&&e.splice(t--,1);return e},c.matches=function(e,t){return c(e,null,null,t)},c.matchesSelector=function(e,t){return c(t,null,null,[e]).length>0},c.find=function(e,t,n){var r,i,o,s,l,u;if(!e)return[];for(i=0,o=d.order.length;i<o;i++)if(l=d.order[i],(s=d.leftMatch[l].exec(e))&&(u=s[1],s.splice(1,1),"\\"!==u.substr(u.length-1)&&(s[1]=(s[1]||"").replace(a,""),r=d.find[l](s,t,n),null!=r))){e=e.replace(d.match[l],"");break}return r||(r="undefined"!==typeof t.getElementsByTagName?t.getElementsByTagName("*"):[]),{set:r,expr:e}},c.filter=function(e,t,n,r){var i,o,s,a,l,u,h,p,f,m=e,g=[],v=t,y=t&&t[0]&&c.isXML(t[0]);while(e&&t.length){for(s in d.filter)if(null!=(i=d.leftMatch[s].exec(e))&&i[2]){if(u=d.filter[s],h=i[1],o=!1,i.splice(1,1),"\\"===h.substr(h.length-1))continue;if(v===g&&(g=[]),d.preFilter[s])if(i=d.preFilter[s](i,v,n,g,r,y),i){if(!0===i)continue}else o=a=!0;if(i)for(p=0;null!=(l=v[p]);p++)l&&(a=u(l,i,p,v),f=r^a,n&&null!=a?f?o=!0:v[p]=!1:f&&(g.push(l),o=!0));if(void 0!==a){if(n||(v=g),e=e.replace(d.match[s],""),!o)return[];break}}if(e===m){if(null!=o)break;c.error(e)}m=e}return v},c.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)};var h=c.getText=function(e){var t,n,r=e.nodeType,i="";if(r){if(1===r||9===r||11===r){if("string"===typeof e.textContent)return e.textContent;if("string"===typeof e.innerText)return e.innerText.replace(l,"");for(e=e.firstChild;e;e=e.nextSibling)i+=h(e)}else if(3===r||4===r)return e.nodeValue}else for(t=0;n=e[t];t++)8!==n.nodeType&&(i+=h(n));return i},d=c.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{class:"className",for:"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")},type:function(e){return e.getAttribute("type")}},relative:{"+":function(e,t){var n="string"===typeof t,r=n&&!u.test(t),i=n&&!r;r&&(t=t.toLowerCase());for(var o,s=0,a=e.length;s<a;s++)if(o=e[s]){while((o=o.previousSibling)&&1!==o.nodeType);e[s]=i||o&&o.nodeName.toLowerCase()===t?o||!1:o===t}i&&c.filter(t,e,!0)},">":function(e,t){var n,r="string"===typeof t,i=0,o=e.length;if(r&&!u.test(t)){for(t=t.toLowerCase();i<o;i++)if(n=e[i],n){var s=n.parentNode;e[i]=s.nodeName.toLowerCase()===t&&s}}else{for(;i<o;i++)n=e[i],n&&(e[i]=r?n.parentNode:n.parentNode===t);r&&c.filter(t,e,!0)}},"":function(e,t,n){var i,o=r++,s=b;"string"!==typeof t||u.test(t)||(t=t.toLowerCase(),i=t,s=x),s("parentNode",t,o,e,i,n)},"~":function(e,t,n){var i,o=r++,s=b;"string"!==typeof t||u.test(t)||(t=t.toLowerCase(),i=t,s=x),s("previousSibling",t,o,e,i,n)}},find:{ID:function(e,t,n){if("undefined"!==typeof t.getElementById&&!n){var r=t.getElementById(e[1]);return r&&r.parentNode?[r]:[]}},NAME:function(e,t){if("undefined"!==typeof t.getElementsByName){for(var n=[],r=t.getElementsByName(e[1]),i=0,o=r.length;i<o;i++)r[i].getAttribute("name")===e[1]&&n.push(r[i]);return 0===n.length?null:n}},TAG:function(e,t){if("undefined"!==typeof t.getElementsByTagName)return t.getElementsByTagName(e[1])}},preFilter:{CLASS:function(e,t,n,r,i,o){if(e=" "+e[1].replace(a,"")+" ",o)return e;for(var s,l=0;null!=(s=t[l]);l++)s&&(i^(s.className&&(" "+s.className+" ").replace(/[\t\n\r]/g," ").indexOf(e)>=0)?n||r.push(s):n&&(t[l]=!1));return!1},ID:function(e){return e[1].replace(a,"")},TAG:function(e,t){return e[1].replace(a,"").toLowerCase()},CHILD:function(e){if("nth"===e[1]){e[2]||c.error(e[0]),e[2]=e[2].replace(/^\+|\s*/g,"");var t=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(("even"===e[2]?"2n":"odd"===e[2]&&"2n+1")||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=t[1]+(t[2]||1)-0,e[3]=t[3]-0}else e[2]&&c.error(e[0]);return e[0]=r++,e},ATTR:function(e,t,n,r,i,o){var s=e[1]=e[1].replace(a,"");return!o&&d.attrMap[s]&&(e[1]=d.attrMap[s]),e[4]=(e[4]||e[5]||"").replace(a,""),"~="===e[2]&&(e[4]=" "+e[4]+" "),e},PSEUDO:function(e,n,r,i,o){if("not"===e[1]){if(!((t.exec(e[3])||"").length>1||/^\w/.test(e[3]))){var s=c.filter(e[3],n,r,!0^o);return r||i.push.apply(i,s),!1}e[3]=c(e[3],null,null,n)}else if(d.match.POS.test(e[0])||d.match.CHILD.test(e[0]))return!0;return e},POS:function(e){return e.unshift(!0),e}},filters:{enabled:function(e){return!1===e.disabled&&"hidden"!==e.type},disabled:function(e){return!0===e.disabled},checked:function(e){return!0===e.checked},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},parent:function(e){return!!e.firstChild},empty:function(e){return!e.firstChild},has:function(e,t,n){return!!c(n[3],e).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){var t=e.getAttribute("type"),n=e.type;return"input"===e.nodeName.toLowerCase()&&"text"===n&&(t===n||null===t)},radio:function(e){return"input"===e.nodeName.toLowerCase()&&"radio"===e.type},checkbox:function(e){return"input"===e.nodeName.toLowerCase()&&"checkbox"===e.type},file:function(e){return"input"===e.nodeName.toLowerCase()&&"file"===e.type},password:function(e){return"input"===e.nodeName.toLowerCase()&&"password"===e.type},submit:function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&"submit"===e.type},image:function(e){return"input"===e.nodeName.toLowerCase()&&"image"===e.type},reset:function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&"reset"===e.type},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)},focus:function(e){return e===e.ownerDocument.activeElement}},setFilters:{first:function(e,t){return 0===t},last:function(e,t,n,r){return t===r.length-1},even:function(e,t){return t%2===0},odd:function(e,t){return t%2===1},lt:function(e,t,n){return t<n[3]-0},gt:function(e,t,n){return t>n[3]-0},nth:function(e,t,n){return n[3]-0===t},eq:function(e,t,n){return n[3]-0===t}},filter:{PSEUDO:function(e,t,n,r){var i=t[1],o=d.filters[i];if(o)return o(e,n,t,r);if("contains"===i)return(e.textContent||e.innerText||h([e])||"").indexOf(t[3])>=0;if("not"===i){for(var s=t[3],a=0,l=s.length;a<l;a++)if(s[a]===e)return!1;return!0}c.error(i)},CHILD:function(e,t){var r,i,o,s,a,l,u=t[1],c=e;switch(u){case"only":case"first":while(c=c.previousSibling)if(1===c.nodeType)return!1;if("first"===u)return!0;c=e;case"last":while(c=c.nextSibling)if(1===c.nodeType)return!1;return!0;case"nth":if(r=t[2],i=t[3],1===r&&0===i)return!0;if(o=t[0],s=e.parentNode,s&&(s[n]!==o||!e.nodeIndex)){for(a=0,c=s.firstChild;c;c=c.nextSibling)1===c.nodeType&&(c.nodeIndex=++a);s[n]=o}return l=e.nodeIndex-i,0===r?0===l:l%r===0&&l/r>=0}},ID:function(e,t){return 1===e.nodeType&&e.getAttribute("id")===t},TAG:function(e,t){return"*"===t&&1===e.nodeType||!!e.nodeName&&e.nodeName.toLowerCase()===t},CLASS:function(e,t){return(" "+(e.className||e.getAttribute("class"))+" ").indexOf(t)>-1},ATTR:function(e,t){var n=t[1],r=c.attr?c.attr(e,n):d.attrHandle[n]?d.attrHandle[n](e):null!=e[n]?e[n]:e.getAttribute(n),i=r+"",o=t[2],s=t[4];return null==r?"!="===o:!o&&c.attr?null!=r:"="===o?i===s:"*="===o?i.indexOf(s)>=0:"~="===o?(" "+i+" ").indexOf(s)>=0:s?"!="===o?i!==s:"^="===o?0===i.indexOf(s):"$="===o?i.substr(i.length-s.length)===s:"|="===o&&(i===s||i.substr(0,s.length+1)===s+"-"):i&&!1!==r},POS:function(e,t,n,r){var i=t[2],o=d.setFilters[i];if(o)return o(e,n,t,r)}}},p=d.match.POS,f=function(e,t){return"\\"+(t-0+1)};for(var m in d.match)d.match[m]=new RegExp(d.match[m].source+/(?![^\[]*\])(?![^\(]*\))/.source),d.leftMatch[m]=new RegExp(/(^(?:.|\r|\n)*?)/.source+d.match[m].source.replace(/\\(\d+)/g,f));d.match.globalPOS=p;var g,v,y=function(e,t){return e=Array.prototype.slice.call(e,0),t?(t.push.apply(t,e),t):e};try{Array.prototype.slice.call(document.documentElement.childNodes,0)[0].nodeType}catch(_){y=function(e,t){var n=0,r=t||[];if("[object Array]"===i.call(e))Array.prototype.push.apply(r,e);else if("number"===typeof e.length)for(var o=e.length;n<o;n++)r.push(e[n]);else for(;e[n];n++)r.push(e[n]);return r}}function x(e,t,r,i,o,s){for(var a=0,l=i.length;a<l;a++){var u=i[a];if(u){var c=!1;u=u[e];while(u){if(u[n]===r){c=i[u.sizset];break}if(1!==u.nodeType||s||(u[n]=r,u.sizset=a),u.nodeName.toLowerCase()===t){c=u;break}u=u[e]}i[a]=c}}}function b(e,t,r,i,o,s){for(var a=0,l=i.length;a<l;a++){var u=i[a];if(u){var h=!1;u=u[e];while(u){if(u[n]===r){h=i[u.sizset];break}if(1===u.nodeType)if(s||(u[n]=r,u.sizset=a),"string"!==typeof t){if(u===t){h=!0;break}}else if(c.filter(t,[u]).length>0){h=u;break}u=u[e]}i[a]=h}}}document.documentElement.compareDocumentPosition?g=function(e,t){return e===t?(o=!0,0):e.compareDocumentPosition&&t.compareDocumentPosition?4&e.compareDocumentPosition(t)?-1:1:e.compareDocumentPosition?-1:1}:(g=function(e,t){if(e===t)return o=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var n,r,i=[],s=[],a=e.parentNode,l=t.parentNode,u=a;if(a===l)return v(e,t);if(!a)return-1;if(!l)return 1;while(u)i.unshift(u),u=u.parentNode;u=l;while(u)s.unshift(u),u=u.parentNode;n=i.length,r=s.length;for(var c=0;c<n&&c<r;c++)if(i[c]!==s[c])return v(i[c],s[c]);return c===n?v(e,s[c],-1):v(i[c],t,1)},v=function(e,t,n){if(e===t)return n;var r=e.nextSibling;while(r){if(r===t)return-1;r=r.nextSibling}return 1}),function(){var e=document.createElement("div"),t="script"+(new Date).getTime(),n=document.documentElement;e.innerHTML="<a name='"+t+"'/>",n.insertBefore(e,n.firstChild),document.getElementById(t)&&(d.find.ID=function(e,t,n){if("undefined"!==typeof t.getElementById&&!n){var r=t.getElementById(e[1]);return r?r.id===e[1]||"undefined"!==typeof r.getAttributeNode&&r.getAttributeNode("id").nodeValue===e[1]?[r]:void 0:[]}},d.filter.ID=function(e,t){var n="undefined"!==typeof e.getAttributeNode&&e.getAttributeNode("id");return 1===e.nodeType&&n&&n.nodeValue===t}),n.removeChild(e),n=e=null}(),function(){var e=document.createElement("div");e.appendChild(document.createComment("")),e.getElementsByTagName("*").length>0&&(d.find.TAG=function(e,t){var n=t.getElementsByTagName(e[1]);if("*"===e[1]){for(var r=[],i=0;n[i];i++)1===n[i].nodeType&&r.push(n[i]);n=r}return n}),e.innerHTML="<a href='#'></a>",e.firstChild&&"undefined"!==typeof e.firstChild.getAttribute&&"#"!==e.firstChild.getAttribute("href")&&(d.attrHandle.href=function(e){return e.getAttribute("href",2)}),e=null}(),document.querySelectorAll&&function(){var e=c,t=document.createElement("div"),n="__sizzle__";if(t.innerHTML="<p class='TEST'></p>",!t.querySelectorAll||0!==t.querySelectorAll(".TEST").length){for(var r in c=function(t,r,i,o){if(r=r||document,!o&&!c.isXML(r)){var s=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(t);if(s&&(1===r.nodeType||9===r.nodeType)){if(s[1])return y(r.getElementsByTagName(t),i);if(s[2]&&d.find.CLASS&&r.getElementsByClassName)return y(r.getElementsByClassName(s[2]),i)}if(9===r.nodeType){if("body"===t&&r.body)return y([r.body],i);if(s&&s[3]){var a=r.getElementById(s[3]);if(!a||!a.parentNode)return y([],i);if(a.id===s[3])return y([a],i)}try{return y(r.querySelectorAll(t),i)}catch(m){}}else if(1===r.nodeType&&"object"!==r.nodeName.toLowerCase()){var l=r,u=r.getAttribute("id"),h=u||n,p=r.parentNode,f=/^\s*[+~]/.test(t);u?h=h.replace(/'/g,"\\$&"):r.setAttribute("id",h),f&&p&&(r=r.parentNode);try{if(!f||p)return y(r.querySelectorAll("[id='"+h+"'] "+t),i)}catch(g){}finally{u||l.removeAttribute("id")}}}return e(t,r,i,o)},e)c[r]=e[r];t=null}}(),function(){var e=document.documentElement,t=e.matchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.msMatchesSelector;if(t){var n=!t.call(document.createElement("div"),"div"),r=!1;try{t.call(document.documentElement,"[test!='']:sizzle")}catch(i){r=!0}c.matchesSelector=function(e,i){if(i=i.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']"),!c.isXML(e))try{if(r||!d.match.PSEUDO.test(i)&&!/!=/.test(i)){var o=t.call(e,i);if(o||!n||e.document&&11!==e.document.nodeType)return o}}catch(_){}return c(i,null,null,[e]).length>0}}}(),function(){var e=document.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>",e.getElementsByClassName&&0!==e.getElementsByClassName("e").length&&(e.lastChild.className="e",1!==e.getElementsByClassName("e").length&&(d.order.splice(1,0,"CLASS"),d.find.CLASS=function(e,t,n){if("undefined"!==typeof t.getElementsByClassName&&!n)return t.getElementsByClassName(e[1])},e=null))}(),document.documentElement.contains?c.contains=function(e,t){return e!==t&&(!e.contains||e.contains(t))}:document.documentElement.compareDocumentPosition?c.contains=function(e,t){return!!(16&e.compareDocumentPosition(t))}:c.contains=function(){return!1},c.isXML=function(e){var t=(e?e.ownerDocument||e:0).documentElement;return!!t&&"HTML"!==t.nodeName};var w=function(e,t,n){var r,i=[],o="",s=t.nodeType?[t]:t;while(r=d.match.PSEUDO.exec(e))o+=r[0],e=e.replace(d.match.PSEUDO,"");e=d.relative[e]?e+"*":e;for(var a=0,l=s.length;a<l;a++)c(e,s[a],i,n);return c.filter(o,i)};e.exports?e.exports=c:window.Sizzle=c})()},"91dd":function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,o){t=t||"&",n=n||"=";var s={};if("string"!==typeof e||0===e.length)return s;var a=/\+/g;e=e.split(t);var l=1e3;o&&"number"===typeof o.maxKeys&&(l=o.maxKeys);var u=e.length;l>0&&u>l&&(u=l);for(var c=0;c<u;++c){var h,d,p,f,m=e[c].replace(a,"%20"),g=m.indexOf(n);g>=0?(h=m.substr(0,g),d=m.substr(g+1)):(h=m,d=""),p=decodeURIComponent(h),f=decodeURIComponent(d),r(s,p)?i(s[p])?s[p].push(f):s[p]=[s[p],f]:s[p]=f}return s};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},"956e":function(e,t,n){var r=n("d0ea").chooseProtocol,i=n("faa1").EventEmitter,o=n("17fb"),s=e.exports=function(e){this.opts=o.defaults(e||{},{host:"127.0.0.1",enableGestures:!1,scheme:this.getScheme(),port:this.getPort(),background:!1,optimizeHMD:!1,requestProtocolVersion:s.defaultProtocolVersion}),this.host=this.opts.host,this.port=this.opts.port,this.scheme=this.opts.scheme,this.protocolVersionVerified=!1,this.background=null,this.optimizeHMD=null,this.on("ready",(function(){this.enableGestures(this.opts.enableGestures),this.setBackground(this.opts.background),this.setOptimizeHMD(this.opts.optimizeHMD),this.opts.optimizeHMD?console.log("Optimized for head mounted display usage."):console.log("Optimized for desktop usage.")}))};s.defaultProtocolVersion=6,s.prototype.getUrl=function(){return this.scheme+"//"+this.host+":"+this.port+"/v"+this.opts.requestProtocolVersion+".json"},s.prototype.getScheme=function(){return"ws:"},s.prototype.getPort=function(){return 6437},s.prototype.setBackground=function(e){this.opts.background=e,this.protocol&&this.protocol.sendBackground&&this.background!==this.opts.background&&(this.background=this.opts.background,this.protocol.sendBackground(this,this.opts.background))},s.prototype.setOptimizeHMD=function(e){this.opts.optimizeHMD=e,this.protocol&&this.protocol.sendOptimizeHMD&&this.optimizeHMD!==this.opts.optimizeHMD&&(this.optimizeHMD=this.opts.optimizeHMD,this.protocol.sendOptimizeHMD(this,this.opts.optimizeHMD))},s.prototype.handleOpen=function(){this.connected||(this.connected=!0,this.emit("connect"))},s.prototype.enableGestures=function(e){this.gesturesEnabled=!!e,this.send(this.protocol.encode({enableGestures:this.gesturesEnabled}))},s.prototype.handleClose=function(e,t){this.connected&&(this.disconnect(),1001===e&&this.opts.requestProtocolVersion>1&&(this.protocolVersionVerified?this.protocolVersionVerified=!1:this.opts.requestProtocolVersion--),this.startReconnection())},s.prototype.startReconnection=function(){var e=this;this.reconnectionTimer||(this.reconnectionTimer=setInterval((function(){e.reconnect()}),500))},s.prototype.stopReconnection=function(){this.reconnectionTimer=clearInterval(this.reconnectionTimer)},s.prototype.disconnect=function(e){if(e||this.stopReconnection(),this.socket)return this.socket.close(),delete this.socket,delete this.protocol,delete this.background,delete this.optimizeHMD,delete this.focusedState,this.connected&&(this.connected=!1,this.emit("disconnect")),!0},s.prototype.reconnect=function(){this.connected?this.stopReconnection():(this.disconnect(!0),this.connect())},s.prototype.handleData=function(e){var t,n=JSON.parse(e);void 0===this.protocol?(t=this.protocol=r(n),this.protocolVersionVerified=!0,this.emit("ready")):t=this.protocol(n),this.emit(t.type,t)},s.prototype.connect=function(){if(!this.socket)return this.socket=this.setupSocket(),!0},s.prototype.send=function(e){this.socket.send(e)},s.prototype.reportFocus=function(e){this.connected&&this.focusedState!==e&&(this.focusedState=e,this.emit(this.focusedState?"focus":"blur"),this.protocol&&this.protocol.sendFocused&&this.protocol.sendFocused(this,this.focusedState))},o.extend(s.prototype,i.prototype)},"95bf":function(e,t,n){"use strict";(function(e){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var s=function(e,t){return e.matches?e.matches(t):e.msMatchesSelector?e.msMatchesSelector(t):e.webkitMatchesSelector?e.webkitMatchesSelector(t):null},a=function(e,t){var n=e;while(n&&1===n.nodeType){if(s(n,t))return n;n=n.parentNode}return null},l=function(e,t){return e.closest?e.closest(t):a(e,t)},u=function(e){return Boolean(e&&"function"===typeof e.then)},c=function e(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=i.search,s=i.autoSelect,a=void 0!==s&&s,c=i.setValue,h=void 0===c?function(){}:c,d=i.setAttribute,p=void 0===d?function(){}:d,f=i.onUpdate,m=void 0===f?function(){}:f,g=i.onSubmit,v=void 0===g?function(){}:g,y=i.onShow,x=void 0===y?function(){}:y,b=i.onHide,w=void 0===b?function(){}:b,_=i.onLoading,A=void 0===_?function(){}:_,S=i.onLoaded,E=void 0===S?function(){}:S;n(this,e),r(this,"value",""),r(this,"searchCounter",0),r(this,"results",[]),r(this,"selectedIndex",-1),r(this,"handleInput",(function(e){var n=e.target.value;t.updateResults(n),t.value=n})),r(this,"handleKeyDown",(function(e){var n=e.key;switch(n){case"Up":case"Down":case"ArrowUp":case"ArrowDown":var r="ArrowUp"===n||"Up"===n?t.selectedIndex-1:t.selectedIndex+1;e.preventDefault(),t.handleArrows(r);break;case"Tab":t.selectResult();break;case"Enter":var i=t.results[t.selectedIndex];t.selectResult(),t.onSubmit(i);break;case"Esc":case"Escape":t.hideResults(),t.setValue();break;default:return}})),r(this,"handleFocus",(function(e){var n=e.target.value;t.updateResults(n),t.value=n})),r(this,"handleBlur",(function(){t.hideResults()})),r(this,"handleResultMouseDown",(function(e){e.preventDefault()})),r(this,"handleResultClick",(function(e){var n=e.target,r=l(n,"[data-result-index]");if(r){t.selectedIndex=parseInt(r.dataset.resultIndex,10);var i=t.results[t.selectedIndex];t.selectResult(),t.onSubmit(i)}})),r(this,"handleArrows",(function(e){var n=t.results.length;t.selectedIndex=(e%n+n)%n,t.onUpdate(t.results,t.selectedIndex)})),r(this,"selectResult",(function(){var e=t.results[t.selectedIndex];e&&t.setValue(e),t.hideResults()})),r(this,"updateResults",(function(e){var n=++t.searchCounter;t.onLoading(),t.search(e).then((function(e){n===t.searchCounter&&(t.results=e,t.onLoaded(),0!==t.results.length?(t.selectedIndex=t.autoSelect?0:-1,t.onUpdate(t.results,t.selectedIndex),t.showResults()):t.hideResults())}))})),r(this,"showResults",(function(){t.setAttribute("aria-expanded",!0),t.onShow()})),r(this,"hideResults",(function(){t.selectedIndex=-1,t.results=[],t.setAttribute("aria-expanded",!1),t.setAttribute("aria-activedescendant",""),t.onUpdate(t.results,t.selectedIndex),t.onHide()})),r(this,"checkSelectedResultVisible",(function(e){var n=e.querySelector('[data-result-index="'.concat(t.selectedIndex,'"]'));if(n){var r=e.getBoundingClientRect(),i=n.getBoundingClientRect();i.top<r.top?e.scrollTop-=r.top-i.top:i.bottom>r.bottom&&(e.scrollTop+=i.bottom-r.bottom)}})),this.search=u(o)?o:function(e){return Promise.resolve(o(e))},this.autoSelect=a,this.setValue=h,this.setAttribute=p,this.onUpdate=m,this.onSubmit=v,this.onShow=x,this.onHide=w,this.onLoading=A,this.onLoaded=E},h=0,d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"".concat(e).concat(++h)},p=function(e,t){var n=e.getBoundingClientRect(),r=t.getBoundingClientRect(),i=n.bottom+r.height>window.innerHeight&&window.innerHeight-n.bottom<n.top&&window.pageYOffset+n.top-r.height>0;return i?"above":"below"},f=function(e,t,n){var r;return function(){var i=this,o=arguments,s=function(){r=null,n||e.apply(i,o)},a=n&&!r;clearTimeout(r),r=setTimeout(s,t),a&&e.apply(i,o)}},m={name:"Autocomplete",inheritAttrs:!1,props:{search:{type:Function,required:!0},baseClass:{type:String,default:"autocomplete"},autoSelect:{type:Boolean,default:!1},getResultValue:{type:Function,default:function(e){return e}},defaultValue:{type:String,default:""},debounceTime:{type:Number,default:0}},data:function(){var e=new c({search:this.search,autoSelect:this.autoSelect,setValue:this.setValue,onUpdate:this.handleUpdate,onSubmit:this.handleSubmit,onShow:this.handleShow,onHide:this.handleHide,onLoading:this.handleLoading,onLoaded:this.handleLoaded});return this.debounceTime>0&&(e.handleInput=f(e.handleInput,this.debounceTime)),{core:e,value:this.defaultValue,resultListId:d("".concat(this.baseClass,"-result-list-")),results:[],selectedIndex:-1,expanded:!1,loading:!1,position:"below",resetPosition:!0}},computed:{rootProps:function(){return{class:this.baseClass,style:{position:"relative"},"data-expanded":this.expanded,"data-loading":this.loading,"data-position":this.position}},inputProps:function(){return o({class:"".concat(this.baseClass,"-input"),value:this.value,role:"combobox",autocomplete:"off",autocapitalize:"off",autocorrect:"off",spellcheck:"false","aria-autocomplete":"list","aria-haspopup":"listbox","aria-owns":this.resultListId,"aria-expanded":this.expanded?"true":"false","aria-activedescendant":this.selectedIndex>-1?this.resultProps[this.selectedIndex].id:""},this.$attrs)},inputListeners:function(){return{input:this.handleInput,keydown:this.core.handleKeyDown,focus:this.core.handleFocus,blur:this.core.handleBlur}},resultListProps:function(){var e="below"===this.position?"top":"bottom";return{id:this.resultListId,class:"".concat(this.baseClass,"-result-list"),role:"listbox",style:r({position:"absolute",zIndex:1,width:"100%",visibility:this.expanded?"visible":"hidden",pointerEvents:this.expanded?"auto":"none"},e,"100%")}},resultListListeners:function(){return{mousedown:this.core.handleResultMouseDown,click:this.core.handleResultClick}},resultProps:function(){var e=this;return this.results.map((function(t,n){return o({id:"".concat(e.baseClass,"-result-").concat(n),class:"".concat(e.baseClass,"-result"),"data-result-index":n,role:"option"},e.selectedIndex===n?{"aria-selected":"true"}:{})}))}},mounted:function(){document.body.addEventListener("click",this.handleDocumentClick)},beforeDestroy:function(){document.body.removeEventListener("click",this.handleDocumentClick)},updated:function(){this.$refs.input&&this.$refs.resultList&&(this.resetPosition&&this.results.length>0&&(this.resetPosition=!1,this.position=p(this.$refs.input,this.$refs.resultList)),this.core.checkSelectedResultVisible(this.$refs.resultList))},methods:{setValue:function(e){this.value=e?this.getResultValue(e):""},handleUpdate:function(e,t){this.results=e,this.selectedIndex=t,this.$emit("update",e,t)},handleShow:function(){this.expanded=!0},handleHide:function(){this.expanded=!1,this.resetPosition=!0},handleLoading:function(){this.loading=!0},handleLoaded:function(){this.loading=!1},handleInput:function(e){this.value=e.target.value,this.core.handleInput(e)},handleSubmit:function(e){this.$emit("submit",e)},handleDocumentClick:function(e){this.$refs.root.contains(e.target)||this.core.hideResults()}}};function g(e,t,n,r,i,o,s,a,l,u){"boolean"!==typeof s&&(l=a,a=s,s=!1);const c="function"===typeof n?n.options:n;let h;if(e&&e.render&&(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,i&&(c.functional=!0)),r&&(c._scopeId=r),o?(h=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,l(e)),e&&e._registeredComponents&&e._registeredComponents.add(o)},c._ssrRegister=h):t&&(h=s?function(e){t.call(this,u(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,a(e))}),h)if(c.functional){const e=c.render;c.render=function(t,n){return h.call(n),e(t,n)}}else{const e=c.beforeCreate;c.beforeCreate=e?[].concat(e,h):[h]}return n}const v=m;var y=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"root"},[e._t("default",[n("div",e._b({},"div",e.rootProps,!1),[n("input",e._g(e._b({ref:"input",on:{input:e.handleInput,keydown:e.core.handleKeyDown,focus:e.core.handleFocus,blur:e.core.handleBlur}},"input",e.inputProps,!1),e.$listeners)),e._v(" "),n("ul",e._g(e._b({ref:"resultList"},"ul",e.resultListProps,!1),e.resultListListeners),[e._l(e.results,(function(t,r){return[e._t("result",[n("li",e._b({key:e.resultProps[r].id},"li",e.resultProps[r],!1),[e._v("\n              "+e._s(e.getResultValue(t))+"\n            ")])],{result:t,props:e.resultProps[r]})]}))],2)])],{rootProps:e.rootProps,inputProps:e.inputProps,inputListeners:e.inputListeners,resultListProps:e.resultListProps,resultListListeners:e.resultListListeners,results:e.results,resultProps:e.resultProps})],2)},x=[];const b=void 0,w=void 0,_=void 0,A=!1,S=g({render:y,staticRenderFns:x},b,v,w,A,_,!1,void 0,void 0,void 0);function E(e){E.installed||(E.installed=!0,e.component("Autocomplete",S))}var M,T={install:E};"undefined"!==typeof window?M=window.Vue:"undefined"!==typeof e&&(M=e.Vue),M&&M.use(T),S.install=E,t["a"]=S}).call(this,n("c8ba"))},9871:function(e,t){var n=e.exports=function(e){this.pos=0,this._buf=[],this.size=e};n.prototype.get=function(e){if(void 0==e&&(e=0),!(e>=this.size)&&!(e>=this._buf.length))return this._buf[(this.pos-e-1)%this.size]},n.prototype.push=function(e){return this._buf[this.pos%this.size]=e,this.pos++}},9906:function(e,t,n){"use strict";e.exports=function(e,t,n){var r,i=" ",o=e.level,s=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(s||""),d=e.opts.$data&&a&&a.$data;if(d?(i+=" var schema"+o+" = "+e.util.getData(a.$data,s,e.dataPathArr)+"; ",r="schema"+o):r=a,!d&&"number"!=typeof a)throw new Error(t+" must be number");var p="maxLength"==t?">":"<";i+="if ( ",d&&(i+=" ("+r+" !== undefined && typeof "+r+" != 'number') || "),!1===e.opts.unicode?i+=" "+h+".length ":i+=" ucs2length("+h+") ",i+=" "+p+" "+r+") { ";var f=t,m=m||[];m.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(f||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+r+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT be ",i+="maxLength"==t?"longer":"shorter",i+=" than ",i+=d?"' + "+r+" + '":""+a,i+=" characters' "),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+l:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var g=i;return i=m.pop(),!e.compositeRule&&c?e.async?i+=" throw new ValidationError(["+g+"]); ":i+=" validate.errors = ["+g+"]; return false; ":i+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",c&&(i+=" else { "),i}},"9a8c":function(e,t,n){"use strict";var r=n("ebb5"),i=n("145e"),o=r.aTypedArray,s=r.exportTypedArrayMethod;s("copyWithin",(function(e,t){return i.call(o(this),e,t,arguments.length>2?arguments[2]:void 0)}))},"9bdf":function(e,t,n){var r=n("3ce1"),i=n("1739"),o=100,s=30,a=1e-5,l=function(e){this.gestureDispatcher=e,this.lastX=-1,this.lastY=-1};l.prototype.start=function(){var e=this;return this.controller=r.loop({enableGestures:!1},(function(t){return e.onFrame(t)})),e},l.prototype.limitRotation=function(e){return e*=o,e=Math.max(-s,e),e=Math.min(s,e),Math.abs(e)<a&&(e=0),e},l.prototype.axisAngle=function(e){var t=[e[5]-e[7],e[6]-e[2],e[1]-e[3]],n=r.vec3.len(t),i=.5*(e[0]+e[4]+e[8]-1),o=Math.atan2(n,i);return-1e-6<n&&n<1e-6?(t=[0,0,0],o=0,[t,o]):(r.vec3.scale(t,t,1/n),[t,o])},l.prototype.getBasis=function(e){var t=e.hands[0],n=t.direction,i=t.palmNormal,o=r.vec3.create();r.vec3.cross(o,n,i);var s=[].concat(n).concat(i);return s[6]=o[0],s[7]=o[1],s[8]=o[2],s},l.prototype.onFrame=function(e){var t=this;if(1==e.hands.length){if(e.fingers.length>3){var n=this.controller.frame(1);if(n&&n.hands.length>0){t.lastY=-1,t.lastX=-1;var o=e.hands[0],s=o.translation(n);t.gestureDispatcher.triggerPan(s[0],-s[1]),t.gestureDispatcher.triggerZoom(-s[2]);var l=t.getBasis(e),u=t.getBasis(n);r.mat3.transpose(u,u);var c=r.mat3.create();r.mat3.multiply(c,l,u);var h=t.axisAngle(c);r.vec3.scale(h[0],h[0],h[1]),(Math.abs(h[0][0])>a||Math.abs(h[0][1])>a||Math.abs(h[0][2])>a)&&t.gestureDispatcher.triggerRotate(this.limitRotation(h[0][0]),this.limitRotation(h[0][1]),this.limitRotation(h[0][2]))}}else if(e.fingers.length>0)try{var d=e.fingers[0],p=i(d),f=d.tipVelocity.getZ[2],m=Math.abs(f),g=p.getY(),v=p.getX();if(m>50&&-1!=t.lastY){var y=2500/(m*m);v=(p.x-t.lastX)*y+t.lastX,g=(p.y-t.lastY)*y+t.lastY}t.lastY=g,t.lastX=v,!isNaN(v)&&isNaN(g)}catch(x){console.log("error occurred when pointing: "+x)}else t.lastY=-1,t.lastX=-1;e.gestures&&e.gestures.forEach((function(e){switch(e.type){case"swipe":t.gestureDispatcher.reset();break;case"screenTap":t.gestureDispatcher.selectMouseCursor(),setTimeout(t.gestureDispatcher.zoomToSelection,100);break;case"keyTap":t.gestureDispatcher.zoomToSelection();break;default:console.log("Unknown gesture type: "+e.type);break}}))}},e.exports=l},"9e12":function(e,t,n){var r;
/** @license
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license
 * Author: Miller Medeiros
 * Version: 1.0.0 - Build: 268 (2012/11/29 05:48 PM)
 */(function(i){function o(e,t,n,r,i){this._listener=t,this._isOnce=n,this.context=r,this._signal=e,this._priority=i||0}function s(e,t){if("function"!==typeof e)throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",t))}function a(){this._bindings=[],this._prevParams=null;var e=this;this.dispatch=function(){a.prototype.dispatch.apply(e,arguments)}}o.prototype={active:!0,params:null,execute:function(e){var t,n;return this.active&&this._listener&&(n=this.params?this.params.concat(e):e,t=this._listener.apply(this.context,n),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},a.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(e,t,n,r){var i,s=this._indexOfListener(e,n);if(-1!==s){if(i=this._bindings[s],i.isOnce()!==t)throw new Error("You cannot add"+(t?"":"Once")+"() then add"+(t?"Once":"")+"() the same listener without removing the relationship first.")}else i=new o(this,e,t,n,r),this._addBinding(i);return this.memorize&&this._prevParams&&i.execute(this._prevParams),i},_addBinding:function(e){var t=this._bindings.length;do{--t}while(this._bindings[t]&&e._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,e)},_indexOfListener:function(e,t){var n,r=this._bindings.length;while(r--)if(n=this._bindings[r],n._listener===e&&n.context===t)return r;return-1},has:function(e,t){return-1!==this._indexOfListener(e,t)},add:function(e,t,n){return s(e,"add"),this._registerListener(e,!1,t,n)},addOnce:function(e,t,n){return s(e,"addOnce"),this._registerListener(e,!0,t,n)},remove:function(e,t){s(e,"remove");var n=this._indexOfListener(e,t);return-1!==n&&(this._bindings[n]._destroy(),this._bindings.splice(n,1)),e},removeAll:function(){var e=this._bindings.length;while(e--)this._bindings[e]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(e){if(this.active){var t,n=Array.prototype.slice.call(arguments),r=this._bindings.length;if(this.memorize&&(this._prevParams=n),r){t=this._bindings.slice(),this._shouldPropagate=!0;do{r--}while(t[r]&&this._shouldPropagate&&!1!==t[r].execute(n))}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var l=a;l.Signal=a,r=function(){return l}.call(t,n,t,e),void 0===r||(e.exports=r)})()},"9fe4":function(e,t,n){"use strict";var r=n("fbda"),i=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,o=[0,31,28,31,30,31,30,31,31,30,31,30,31],s=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,a=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,l=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,u=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,c=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,h=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-?)*(?:[0-9KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[KSa-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,d=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,p=/^(?:\/(?:[^~/]|~0|~1)*)*$/,f=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,m=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/;function g(e){return e="full"==e?"full":"fast",r.copy(g[e])}function v(e){return e%4===0&&(e%100!==0||e%400===0)}function y(e){var t=e.match(i);if(!t)return!1;var n=+t[1],r=+t[2],s=+t[3];return r>=1&&r<=12&&s>=1&&s<=(2==r&&v(n)?29:o[r])}function x(e,t){var n=e.match(s);if(!n)return!1;var r=n[1],i=n[2],o=n[3],a=n[5];return(r<=23&&i<=59&&o<=59||23==r&&59==i&&60==o)&&(!t||a)}e.exports=g,g.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,uri:/^(?:[a-z][a-z0-9+-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":c,url:h,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:a,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:E,uuid:d,"json-pointer":p,"json-pointer-uri-fragment":f,"relative-json-pointer":m},g.full={date:y,time:x,"date-time":w,uri:A,"uri-reference":u,"uri-template":c,url:h,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:a,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:E,uuid:d,"json-pointer":p,"json-pointer-uri-fragment":f,"relative-json-pointer":m};var b=/t|\s/i;function w(e){var t=e.split(b);return 2==t.length&&y(t[0])&&x(t[1],!0)}var _=/\/|:/;function A(e){return _.test(e)&&l.test(e)}var S=/[^\\]\\Z/;function E(e){if(S.test(e))return!1;try{return new RegExp(e),!0}catch(t){return!1}}},a078:function(e,t,n){var r=n("7b0b"),i=n("50c4"),o=n("35a1"),s=n("e95a"),a=n("0366"),l=n("ebb5").aTypedArrayConstructor;e.exports=function(e){var t,n,u,c,h,d,p=r(e),f=arguments.length,m=f>1?arguments[1]:void 0,g=void 0!==m,v=o(p);if(void 0!=v&&!s(v)){h=v.call(p),d=h.next,p=[];while(!(c=d.call(h)).done)p.push(c.value)}for(g&&f>2&&(m=a(m,arguments[2],2)),n=i(p.length),u=new(l(this))(n),t=0;n>t;t++)u[t]=g?m(p[t],t):p[t];return u}},a3b3:function(e,t,n){var r=n("9052"),i=r.vec3,o=n("faa1").EventEmitter,s=n("17fb"),a=(t.createGesture=function(e){var t;switch(e.type){case"circle":t=new l(e);break;case"swipe":t=new u(e);break;case"screenTap":t=new c(e);break;case"keyTap":t=new h(e);break;default:throw"unknown gesture type"}return t.id=e.id,t.handIds=e.handIds.slice(),t.pointableIds=e.pointableIds.slice(),t.duration=e.duration,t.state=e.state,t.type=e.type,t},t.gestureListener=function(e,t){var n={},r={};e.on("gesture",(function(e,i){if(e.type==t){if(("start"==e.state||"stop"==e.state)&&void 0===r[e.id]){var o=new a(e,i);r[e.id]=o,s.each(n,(function(e,t){o.on(t,e)}))}r[e.id].update(e,i),"stop"==e.state&&delete r[e.id]}}));var i={start:function(e){return n["start"]=e,i},stop:function(e){return n["stop"]=e,i},complete:function(e){return n["stop"]=e,i},update:function(e){return n["update"]=e,i}};return i},t.Gesture=function(e,t){this.gestures=[e],this.frames=[t]});a.prototype.update=function(e,t){this.lastGesture=e,this.lastFrame=t,this.gestures.push(e),this.frames.push(t),this.emit(e.state,this)},a.prototype.translation=function(){return i.subtract(i.create(),this.lastGesture.startPosition,this.lastGesture.position)},s.extend(a.prototype,o.prototype);var l=function(e){this.center=e.center,this.normal=e.normal,this.progress=e.progress,this.radius=e.radius};l.prototype.toString=function(){return"CircleGesture ["+JSON.stringify(this)+"]"};var u=function(e){this.startPosition=e.startPosition,this.position=e.position,this.direction=e.direction,this.speed=e.speed};u.prototype.toString=function(){return"SwipeGesture ["+JSON.stringify(this)+"]"};var c=function(e){this.position=e.position,this.direction=e.direction,this.progress=e.progress};c.prototype.toString=function(){return"ScreenTapGesture ["+JSON.stringify(this)+"]"};var h=function(e){this.position=e.position,this.direction=e.direction,this.progress=e.progress};h.prototype.toString=function(){return"KeyTapGesture ["+JSON.stringify(this)+"]"}},a434:function(e,t,n){"use strict";var r=n("23e7"),i=n("23cb"),o=n("a691"),s=n("50c4"),a=n("7b0b"),l=n("65f0"),u=n("8418"),c=n("1dde"),h=n("ae40"),d=c("splice"),p=h("splice",{ACCESSORS:!0,0:0,1:2}),f=Math.max,m=Math.min,g=9007199254740991,v="Maximum allowed length exceeded";r({target:"Array",proto:!0,forced:!d||!p},{splice:function(e,t){var n,r,c,h,d,p,y=a(this),x=s(y.length),b=i(e,x),w=arguments.length;if(0===w?n=r=0:1===w?(n=0,r=x-b):(n=w-2,r=m(f(o(t),0),x-b)),x+n-r>g)throw TypeError(v);for(c=l(y,r),h=0;h<r;h++)d=b+h,d in y&&u(c,h,y[d]);if(c.length=r,n<r){for(h=b;h<x-r;h++)d=h+r,p=h+n,d in y?y[p]=y[d]:delete y[p];for(h=x;h>x-r+n;h--)delete y[h-1]}else if(n>r)for(h=x-r;h>b;h--)d=h+r-1,p=h+n-1,d in y?y[p]=y[d]:delete y[p];for(h=0;h<n;h++)y[h+b]=arguments[h+2];return y.length=x-r+n,c}})},a49d:function(e,t,n){var r;(function(i,o,s){var a,l=256,u=6,c=52,h="random",d=s.pow(l,u),p=s.pow(2,c),f=2*p,m=l-1;function g(e,t,n){var r=[];t=1==t?{entropy:!0}:t||{};var i=b(x(t.entropy?[e,_(o)]:null==e?w():e,3),r),a=new v(r),c=function(){var e=a.g(u),t=d,n=0;while(e<p)e=(e+n)*l,t*=l,n=a.g(1);while(e>=f)e/=2,t/=2,n>>>=1;return(e+n)/t};return c.int32=function(){return 0|a.g(4)},c.quick=function(){return a.g(4)/4294967296},c.double=c,b(_(a.S),o),(t.pass||n||function(e,t,n,r){return r&&(r.S&&y(r,a),e.state=function(){return y(a,{})}),n?(s[h]=e,t):e})(c,i,"global"in t?t.global:this==s,t.state)}function v(e){var t,n=e.length,r=this,i=0,o=r.i=r.j=0,s=r.S=[];n||(e=[n++]);while(i<l)s[i]=i++;for(i=0;i<l;i++)s[i]=s[o=m&o+e[i%n]+(t=s[i])],s[o]=t;(r.g=function(e){var t,n=0,i=r.i,o=r.j,s=r.S;while(e--)t=s[i=m&i+1],n=n*l+s[m&(s[i]=s[o=m&o+t])+(s[o]=t)];return r.i=i,r.j=o,n})(l)}function y(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function x(e,t){var n,r=[],i=typeof e;if(t&&"object"==i)for(n in e)try{r.push(x(e[n],t-1))}catch(o){}return r.length?r:"string"==i?e:e+"\0"}function b(e,t){var n,r=e+"",i=0;while(i<r.length)t[m&i]=m&(n^=19*t[m&i])+r.charCodeAt(i++);return _(t)}function w(){try{var e;return a&&(e=a.randomBytes)?e=e(l):(e=new Uint8Array(l),(i.crypto||i.msCrypto).getRandomValues(e)),_(e)}catch(r){var t=i.navigator,n=t&&t.plugins;return[+new Date,i,n,i.screen,_(o)]}}function _(e){return String.fromCharCode.apply(0,e)}if(b(s.random(),o),e.exports){e.exports=g;try{a=n(1)}catch(A){}}else r=function(){return g}.call(t,n,t,e),void 0===r||(e.exports=r)})("undefined"!==typeof self?self:this,[],Math)},a49e:function(e,t,n){(function(e){var r;(function(e,i,o){function s(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function l(e,t){var n=new s(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,r=(e+t)/(1<<21)}while(0===r);return r},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&a(r,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=l:n("07d6")&&n("3c35")?(r=function(){return l}.call(t,n,t,i),void 0===r||(i.exports=r)):this.xorwow=l})(0,e,n("07d6"))}).call(this,n("62e4")(e))},a931:function(e,t,n){"use strict";e.exports=function(e,t,n){var r,i=" ",o=e.level,s=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(s||""),d=e.opts.$data&&a&&a.$data;if(d?(i+=" var schema"+o+" = "+e.util.getData(a.$data,s,e.dataPathArr)+"; ",r="schema"+o):r=a,!d&&"number"!=typeof a)throw new Error(t+" must be number");i+="var division"+o+";if (",d&&(i+=" "+r+" !== undefined && ( typeof "+r+" != 'number' || "),i+=" (division"+o+" = "+h+" / "+r+", ",e.opts.multipleOfPrecision?i+=" Math.abs(Math.round(division"+o+") - division"+o+") > 1e-"+e.opts.multipleOfPrecision+" ":i+=" division"+o+" !== parseInt(division"+o+") ",i+=" ) ",d&&(i+="  )  "),i+=" ) {   ";var p=p||[];p.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { multipleOf: "+r+" } ",!1!==e.opts.messages&&(i+=" , message: 'should be multiple of ",i+=d?"' + "+r:r+"'"),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+l:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var f=i;return i=p.pop(),!e.compositeRule&&c?e.async?i+=" throw new ValidationError(["+f+"]); ":i+=" validate.errors = ["+f+"]; return false; ":i+=" var err = "+f+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",c&&(i+=" else { "),i}},a971:function(e,t,n){"use strict";var r=n("4e14"),i=n("694b"),o=n("fbda"),s=n("ba00"),a=n("89a9");function l(e,t,n){var r=this._refs[n];if("string"==typeof r){if(!this._refs[r])return l.call(this,e,t,r);r=this._refs[r]}if(r=r||this._schemas[n],r instanceof s)return f(r.schema,this._opts.inlineRefs)?r.schema:r.validate||this._compile(r);var i,o,a,c=u.call(this,t,n);return c&&(i=c.schema,t=c.root,a=c.baseId),i instanceof s?o=i.validate||e.call(this,i.schema,t,void 0,a):void 0!==i&&(o=f(i,this._opts.inlineRefs)?i:e.call(this,i,t,void 0,a)),o}function u(e,t){var n=r.parse(t),i=y(n),o=v(this._getId(e.schema));if(0===Object.keys(e.schema).length||i!==o){var a=b(i),l=this._refs[a];if("string"==typeof l)return c.call(this,e,l,n);if(l instanceof s)l.validate||this._compile(l),e=l;else{if(l=this._schemas[a],!(l instanceof s))return;if(l.validate||this._compile(l),a==b(t))return{schema:l,root:e,baseId:o};e=l}if(!e.schema)return;o=v(this._getId(e.schema))}return d.call(this,n,o,e.schema,e)}function c(e,t,n){var r=u.call(this,e,t);if(r){var i=r.schema,o=r.baseId;e=r.root;var s=this._getId(i);return s&&(o=w(o,s)),d.call(this,n,o,i,e)}}e.exports=l,l.normalizeId=b,l.fullPath=v,l.url=w,l.ids=_,l.inlineRef=f,l.schema=u;var h=o.toHash(["properties","patternProperties","enum","dependencies","definitions"]);function d(e,t,n,r){if(e.fragment=e.fragment||"","/"==e.fragment.slice(0,1)){for(var i=e.fragment.split("/"),s=1;s<i.length;s++){var a=i[s];if(a){if(a=o.unescapeFragment(a),n=n[a],void 0===n)break;var l;if(!h[a]&&(l=this._getId(n),l&&(t=w(t,l)),n.$ref)){var c=w(t,n.$ref),d=u.call(this,r,c);d&&(n=d.schema,r=d.root,t=d.baseId)}}}return void 0!==n&&n!==r.schema?{schema:n,root:r,baseId:t}:void 0}}var p=o.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]);function f(e,t){return!1!==t&&(void 0===t||!0===t?m(e):t?g(e)<=t:void 0)}function m(e){var t;if(Array.isArray(e)){for(var n=0;n<e.length;n++)if(t=e[n],"object"==typeof t&&!m(t))return!1}else for(var r in e){if("$ref"==r)return!1;if(t=e[r],"object"==typeof t&&!m(t))return!1}return!0}function g(e){var t,n=0;if(Array.isArray(e)){for(var r=0;r<e.length;r++)if(t=e[r],"object"==typeof t&&(n+=g(t)),n==1/0)return 1/0}else for(var i in e){if("$ref"==i)return 1/0;if(p[i])n++;else if(t=e[i],"object"==typeof t&&(n+=g(t)+1),n==1/0)return 1/0}return n}function v(e,t){!1!==t&&(e=b(e));var n=r.parse(e);return y(n)}function y(e){return r.serialize(e).split("#")[0]+"#"}var x=/#\/?$/;function b(e){return e?e.replace(x,""):""}function w(e,t){return t=b(t),r.resolve(e,t)}function _(e){var t=b(this._getId(e)),n={"":t},s={"":v(t,!1)},l={},u=this;return a(e,{allKeys:!0},(function(e,t,a,c,h,d,p){if(""!==t){var f=u._getId(e),m=n[c],g=s[c]+"/"+h;if(void 0!==p&&(g+="/"+("number"==typeof p?p:o.escapeFragment(p))),"string"==typeof f){f=m=b(m?r.resolve(m,f):f);var v=u._refs[f];if("string"==typeof v&&(v=u._refs[v]),v&&v.schema){if(!i(e,v.schema))throw new Error('id "'+f+'" resolves to more than one schema')}else if(f!=b(g))if("#"==f[0]){if(l[f]&&!i(e,l[f]))throw new Error('id "'+f+'" resolves to more than one schema');l[f]=e}else u._refs[f]=g}n[t]=m,s[t]=g}})),l}},a975:function(e,t,n){"use strict";var r=n("ebb5"),i=n("b727").every,o=r.aTypedArray,s=r.exportTypedArrayMethod;s("every",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},a981:function(e,t){e.exports="undefined"!==typeof ArrayBuffer&&"undefined"!==typeof DataView},aaad:function(e,t,n){(function(t){var r=n("808a"),i=n("16c3"),o=n("1f8f"),s=n("5915"),a=n("9871"),l=n("d419"),u=n("faa1").EventEmitter,c=n("a3b3").gestureListener,h=n("32ce"),d=n("17fb"),p=e.exports=function(e){var i="undefined"!==typeof t&&t.versions&&t.versions.node,o=this;e=d.defaults(e||{},{inNode:i}),this.inNode=e.inNode,e=d.defaults(e||{},{frameEventName:this.useAnimationLoop()?"animationFrame":"deviceFrame",suppressAnimationLoop:!this.useAnimationLoop(),loopWhileDisconnected:!0,useAllPlugins:!1,checkVersion:!0}),this.animationFrameRequested=!1,this.onAnimationFrame=function(e){o.lastConnectionFrame.valid&&o.emit("animationFrame",o.lastConnectionFrame),o.emit("frameEnd",e),o.loopWhileDisconnected&&(!1!==o.connection.focusedState||o.connection.opts.background)?window.requestAnimationFrame(o.onAnimationFrame):o.animationFrameRequested=!1},this.suppressAnimationLoop=e.suppressAnimationLoop,this.loopWhileDisconnected=e.loopWhileDisconnected,this.frameEventName=e.frameEventName,this.useAllPlugins=e.useAllPlugins,this.history=new a(200),this.lastFrame=r.Invalid,this.lastValidFrame=r.Invalid,this.lastConnectionFrame=r.Invalid,this.accumulatedGestures=[],this.checkVersion=e.checkVersion,void 0===e.connectionType?this.connectionType=this.inBrowser()?n("e303"):n("4511"):this.connectionType=e.connectionType,this.connection=new this.connectionType(e),this.streamingCount=0,this.devices={},this.plugins={},this._pluginPipelineSteps={},this._pluginExtendedMethods={},e.useAllPlugins&&this.useRegisteredPlugins(),this.setupFrameEvents(e),this.setupConnectionEvents(),this.startAnimationLoop()};p.prototype.gesture=function(e,t){var n=c(this,e);return void 0!==t&&n.stop(t),n},p.prototype.setBackground=function(e){return this.connection.setBackground(e),this},p.prototype.setOptimizeHMD=function(e){return this.connection.setOptimizeHMD(e),this},p.prototype.inBrowser=function(){return!this.inNode},p.prototype.useAnimationLoop=function(){return this.inBrowser()&&!this.inBackgroundPage()},p.prototype.inBackgroundPage=function(){return"undefined"!==typeof chrome&&chrome.extension&&chrome.extension.getBackgroundPage&&chrome.extension.getBackgroundPage()===window},p.prototype.connect=function(){return this.connection.connect(),this},p.prototype.streaming=function(){return this.streamingCount>0},p.prototype.connected=function(){return!!this.connection.connected},p.prototype.startAnimationLoop=function(){this.suppressAnimationLoop||this.animationFrameRequested||(this.animationFrameRequested=!0,window.requestAnimationFrame(this.onAnimationFrame))},p.prototype.disconnect=function(){return this.connection.disconnect(),this},p.prototype.frame=function(e){return this.history.get(e)||r.Invalid},p.prototype.loop=function(e){return e&&("function"===typeof e?this.on(this.frameEventName,e):this.setupFrameEvents(e)),this.connect()},p.prototype.addStep=function(e){this.pipeline||(this.pipeline=new l(this)),this.pipeline.addStep(e)},p.prototype.processFrame=function(e){e.gestures&&(this.accumulatedGestures=this.accumulatedGestures.concat(e.gestures)),this.lastConnectionFrame=e,this.startAnimationLoop(),this.emit("deviceFrame",e)},p.prototype.processFinishedFrame=function(e){if(this.lastFrame=e,e.valid&&(this.lastValidFrame=e),e.controller=this,e.historyIdx=this.history.push(e),e.gestures){e.gestures=this.accumulatedGestures,this.accumulatedGestures=[];for(var t=0;t!=e.gestures.length;t++)this.emit("gesture",e.gestures[t],e)}this.pipeline&&(e=this.pipeline.run(e),e||(e=r.Invalid)),this.emit("frame",e),this.emitHandEvents(e)},p.prototype.emitHandEvents=function(e){for(var t=0;t<e.hands.length;t++)this.emit("hand",e.hands[t])},p.prototype.setupFrameEvents=function(e){e.frame&&this.on("frame",e.frame),e.hand&&this.on("hand",e.hand)},p.prototype.setupConnectionEvents=function(){var e=this;this.connection.on("frame",(function(t){e.processFrame(t)})),this.on(this.frameEventName,(function(t){e.processFinishedFrame(t)}));var t=function(){if(e.connection.opts.requestProtocolVersion<5&&0==e.streamingCount){e.streamingCount=1;var n={attached:!0,streaming:!0,type:"unknown",id:"Lx00000000000"};e.devices[n.id]=n,e.emit("deviceAttached",n),e.emit("deviceStreaming",n),e.emit("streamingStarted",n),e.connection.removeListener("frame",t)}},n=function(){if(e.streamingCount>0){for(var t in e.devices)e.emit("deviceStopped",e.devices[t]),e.emit("deviceRemoved",e.devices[t]);for(var t in e.emit("streamingStopped",e.devices[t]),e.streamingCount=0,e.devices)delete e.devices[t]}};this.connection.on("focus",(function(){e.loopWhileDisconnected&&e.startAnimationLoop(),e.emit("focus")})),this.connection.on("blur",(function(){e.emit("blur")})),this.connection.on("protocol",(function(t){t.on("beforeFrameCreated",(function(t){e.emit("beforeFrameCreated",t)})),t.on("afterFrameCreated",(function(t,n){e.emit("afterFrameCreated",t,n)})),e.emit("protocol",t)})),this.connection.on("ready",(function(){e.checkVersion&&!e.inNode&&e.checkOutOfDate(),e.emit("ready")})),this.connection.on("connect",(function(){e.emit("connect"),e.connection.removeListener("frame",t),e.connection.on("frame",t)})),this.connection.on("disconnect",(function(){e.emit("disconnect"),n()})),this.connection.on("deviceConnect",(function(r){r.state?(e.emit("deviceConnected"),e.connection.removeListener("frame",t),e.connection.on("frame",t)):(e.emit("deviceDisconnected"),n())})),this.connection.on("deviceEvent",(function(t){var n=t.state,r=e.devices[n.id],i={};for(var o in n)r&&r.hasOwnProperty(o)&&r[o]==n[o]||(i[o]=!0);e.devices[n.id]=n,i.attached&&e.emit(n.attached?"deviceAttached":"deviceRemoved",n),i.streaming&&(n.streaming?(e.streamingCount++,e.emit("deviceStreaming",n),1==e.streamingCount&&e.emit("streamingStarted",n),i.attached||e.emit("deviceConnected")):i.attached&&n.attached||(e.streamingCount--,e.emit("deviceStopped",n),0==e.streamingCount&&e.emit("streamingStopped",n),e.emit("deviceDisconnected")))})),this.on("newListener",(function(e,t){"deviceConnected"!=e&&"deviceDisconnected"!=e||console.warn(e+" events are depricated.  Consider using 'streamingStarted/streamingStopped' or 'deviceStreaming/deviceStopped' instead")}))},p.prototype.checkOutOfDate=function(){console.assert(this.connection&&this.connection.protocol);var e=this.connection.protocol.serviceVersion,t=this.connection.protocol.version,n=this.connectionType.defaultProtocolVersion;return n>t&&(console.warn("Your Protocol Version is v"+t+", this app was designed for v"+n),h.warnOutOfDate({sV:e,pV:t}),!0)},p._pluginFactories={},p.plugin=function(e,t){return this._pluginFactories[e]&&console.warn('Plugin "'+e+'" already registered'),this._pluginFactories[e]=t},p.plugins=function(){return d.keys(this._pluginFactories)};var f=function(e,t,n){-1!=["beforeFrameCreated","afterFrameCreated"].indexOf(t)?this.on(t,n):(this.pipeline||(this.pipeline=new l(this)),this._pluginPipelineSteps[e]||(this._pluginPipelineSteps[e]=[]),this._pluginPipelineSteps[e].push(this.pipeline.addWrappedStep(t,n)))},m=function(e,t,n){var a;switch(this._pluginExtendedMethods[e]||(this._pluginExtendedMethods[e]=[]),t){case"frame":a=r;break;case"hand":a=i;break;case"pointable":a=o,d.extend(s.prototype,n),d.extend(s.Invalid,n);break;case"finger":a=s;break;default:throw e+' specifies invalid object type "'+t+'" for prototypical extension'}d.extend(a.prototype,n),d.extend(a.Invalid,n),this._pluginExtendedMethods[e].push([a,n])};p.prototype.use=function(e,t){var n,r,i,o;if(r="function"==typeof e?e:p._pluginFactories[e],!r)throw"Leap Plugin "+e+" not found.";if(t||(t={}),this.plugins[e])return d.extend(this.plugins[e],t),this;for(i in this.plugins[e]=t,o=r.call(this,t),o)n=o[i],"function"===typeof n?f.call(this,e,i,n):m.call(this,e,i,n);return this},p.prototype.stopUsing=function(e){var t,n,r=this._pluginPipelineSteps[e],i=this._pluginExtendedMethods[e],o=0;if(this.plugins[e]){if(r)for(o=0;o<r.length;o++)this.pipeline.removeStep(r[o]);if(i)for(o=0;o<i.length;o++)for(var s in t=i[o][0],n=i[o][1],n)delete t.prototype[s],delete t.Invalid[s];return delete this.plugins[e],this}},p.prototype.useRegisteredPlugins=function(){for(var e in p._pluginFactories)this.use(e)},d.extend(p.prototype,u.prototype)}).call(this,n("4362"))},ace4:function(e,t,n){"use strict";var r=n("23e7"),i=n("d039"),o=n("621a"),s=n("825a"),a=n("23cb"),l=n("50c4"),u=n("4840"),c=o.ArrayBuffer,h=o.DataView,d=c.prototype.slice,p=i((function(){return!new c(2).slice(1,void 0).byteLength}));r({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:p},{slice:function(e,t){if(void 0!==d&&void 0===t)return d.call(s(this),e);var n=s(this).byteLength,r=a(e,n),i=a(void 0===t?n:t,n),o=new(u(this,c))(l(i-r)),p=new h(this),f=new h(o),m=0;while(r<i)f.setUint8(m++,p.getUint8(r++));return o}})},b1a8:function(e,t,n){"use strict";var r=n("899a").MissingRef;function i(e,t,n){var o=this;if("function"!=typeof this._opts.loadSchema)throw new Error("options.loadSchema should be a function");"function"==typeof t&&(n=t,t=void 0);var s=a(e).then((function(){var n=o._addSchema(e,void 0,t);return n.validate||l(n)}));return n&&s.then((function(e){n(null,e)}),n),s;function a(e){var t=e.$schema;return t&&!o.getSchema(t)?i.call(o,{$ref:t},!0):Promise.resolve()}function l(e){try{return o._compile(e)}catch(i){if(i instanceof r)return n(i);throw i}function n(n){var r=n.missingSchema;if(u(r))throw new Error("Schema "+r+" is loaded but "+n.missingRef+" cannot be resolved");var i=o._loadingSchemas[r];return i||(i=o._loadingSchemas[r]=o._opts.loadSchema(r),i.then(s,s)),i.then((function(e){if(!u(r))return a(e).then((function(){u(r)||o.addSchema(e,r,void 0,t)}))})).then((function(){return l(e)}));function s(){delete o._loadingSchemas[r]}function u(e){return o._refs[e]||o._schemas[e]}}}}e.exports=i},b383:function(e,t,n){"use strict";t.decode=t.parse=n("91dd"),t.encode=t.stringify=n("e099")},b39a:function(e,t,n){"use strict";var r=n("da84"),i=n("ebb5"),o=n("d039"),s=r.Int8Array,a=i.aTypedArray,l=i.exportTypedArrayMethod,u=[].toLocaleString,c=[].slice,h=!!s&&o((function(){u.call(new s(1))})),d=o((function(){return[1,2].toLocaleString()!=new s([1,2]).toLocaleString()}))||!o((function(){s.prototype.toLocaleString.call([1,2])}));l("toLocaleString",(function(){return u.apply(h?c.call(a(this)):a(this),arguments)}),d)},b7e6:function(e,t,n){"use strict";e.exports=function(e,t,n){var r=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d=e.opts.$data&&s&&s.$data;d&&(r+=" var schema"+i+" = "+e.util.getData(s.$data,o,e.dataPathArr)+"; ");var p="schema"+i;if(!d)if(s.length<e.opts.loopRequired&&e.schema.properties&&Object.keys(e.schema.properties).length){var f=[],m=s;if(m){var g,v=-1,y=m.length-1;while(v<y){g=m[v+=1];var x=e.schema.properties[g];x&&(e.opts.strictKeywords?"object"==typeof x&&Object.keys(x).length>0:e.util.schemaHasRules(x,e.RULES.all))||(f[f.length]=g)}}}else f=s;if(d||f.length){var b=e.errorPath,w=d||f.length>=e.opts.loopRequired,_=e.opts.ownProperties;if(u)if(r+=" var missing"+i+"; ",w){d||(r+=" var "+p+" = validate.schema"+a+"; ");var A="i"+i,S="schema"+i+"["+A+"]",E="' + "+S+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(b,S,e.opts.jsonPointers)),r+=" var "+h+" = true; ",d&&(r+=" if (schema"+i+" === undefined) "+h+" = true; else if (!Array.isArray(schema"+i+")) "+h+" = false; else {"),r+=" for (var "+A+" = 0; "+A+" < "+p+".length; "+A+"++) { "+h+" = "+c+"["+p+"["+A+"]] !== undefined ",_&&(r+=" &&   Object.prototype.hasOwnProperty.call("+c+", "+p+"["+A+"]) "),r+="; if (!"+h+") break; } ",d&&(r+="  }  "),r+="  if (!"+h+") {   ";var M=M||[];M.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+E+"' } ",!1!==e.opts.messages&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+E+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var T=r;r=M.pop(),!e.compositeRule&&u?e.async?r+=" throw new ValidationError(["+T+"]); ":r+=" validate.errors = ["+T+"]; return false; ":r+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } else { "}else{r+=" if ( ";var C=f;if(C){A=-1;var P=C.length-1;while(A<P){D=C[A+=1],A&&(r+=" || ");var R=e.util.getProperty(D),L=c+R;r+=" ( ( "+L+" === undefined ",_&&(r+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(D)+"') "),r+=") && (missing"+i+" = "+e.util.toQuotedString(e.opts.jsonPointers?D:R)+") ) "}}r+=") {  ";S="missing"+i,E="' + "+S+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(b,S,!0):b+" + "+S);M=M||[];M.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+E+"' } ",!1!==e.opts.messages&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+E+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";T=r;r=M.pop(),!e.compositeRule&&u?e.async?r+=" throw new ValidationError(["+T+"]); ":r+=" validate.errors = ["+T+"]; return false; ":r+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } else { "}else if(w){d||(r+=" var "+p+" = validate.schema"+a+"; ");A="i"+i,S="schema"+i+"["+A+"]",E="' + "+S+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(b,S,e.opts.jsonPointers)),d&&(r+=" if ("+p+" && !Array.isArray("+p+")) {  var err =   ",!1!==e.createErrors?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+E+"' } ",!1!==e.opts.messages&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+E+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+p+" !== undefined) { "),r+=" for (var "+A+" = 0; "+A+" < "+p+".length; "+A+"++) { if ("+c+"["+p+"["+A+"]] === undefined ",_&&(r+=" || ! Object.prototype.hasOwnProperty.call("+c+", "+p+"["+A+"]) "),r+=") {  var err =   ",!1!==e.createErrors?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+E+"' } ",!1!==e.opts.messages&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+E+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",d&&(r+="  }  ")}else{var O=f;if(O){var D,I=-1,k=O.length-1;while(I<k){D=O[I+=1];R=e.util.getProperty(D),E=e.util.escapeQuotes(D),L=c+R;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(b,D,e.opts.jsonPointers)),r+=" if ( "+L+" === undefined ",_&&(r+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(D)+"') "),r+=") {  var err =   ",!1!==e.createErrors?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+E+"' } ",!1!==e.opts.messages&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+E+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}}e.errorPath=b}else u&&(r+=" if (true) {");return r}},b838:function(e,t,n){(function(e){var r;(function(e,i,o){function s(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function l(e,t){var n=new s(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,r=(e+t)/(1<<21)}while(0===r);return r},i.int32=n.next,i.quick=i,r&&("object"==typeof r&&a(r,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=l:n("07d6")&&n("3c35")?(r=function(){return l}.call(t,n,t,i),void 0===r||(i.exports=r)):this.xor128=l})(0,e,n("07d6"))}).call(this,n("62e4")(e))},b920:function(e,t,n){"use strict";e.exports=function(e,t,n){var r=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="errs__"+i,d=e.util.copy(e),p="";d.level++;var f="valid"+d.level,m={},g={},v=e.opts.ownProperties;for(w in s)if("__proto__"!=w){var y=s[w],x=Array.isArray(y)?g:m;x[w]=y}r+="var "+h+" = errors;";var b=e.errorPath;for(var w in r+="var missing"+i+";",g)if(x=g[w],x.length){if(r+=" if ( "+c+e.util.getProperty(w)+" !== undefined ",v&&(r+=" && Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(w)+"') "),u){r+=" && ( ";var _=x;if(_){var A=-1,S=_.length-1;while(A<S){O=_[A+=1],A&&(r+=" || ");var E=e.util.getProperty(O),M=c+E;r+=" ( ( "+M+" === undefined ",v&&(r+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(O)+"') "),r+=") && (missing"+i+" = "+e.util.toQuotedString(e.opts.jsonPointers?O:E)+") ) "}}r+=")) {  ";var T="missing"+i,C="' + "+T+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(b,T,!0):b+" + "+T);var P=P||[];P.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { property: '"+e.util.escapeQuotes(w)+"', missingProperty: '"+C+"', depsCount: "+x.length+", deps: '"+e.util.escapeQuotes(1==x.length?x[0]:x.join(", "))+"' } ",!1!==e.opts.messages&&(r+=" , message: 'should have ",1==x.length?r+="property "+e.util.escapeQuotes(x[0]):r+="properties "+e.util.escapeQuotes(x.join(", ")),r+=" when property "+e.util.escapeQuotes(w)+" is present' "),e.opts.verbose&&(r+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var R=r;r=P.pop(),!e.compositeRule&&u?e.async?r+=" throw new ValidationError(["+R+"]); ":r+=" validate.errors = ["+R+"]; return false; ":r+=" var err = "+R+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{r+=" ) { ";var L=x;if(L){var O,D=-1,I=L.length-1;while(D<I){O=L[D+=1];E=e.util.getProperty(O),C=e.util.escapeQuotes(O),M=c+E;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(b,O,e.opts.jsonPointers)),r+=" if ( "+M+" === undefined ",v&&(r+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(O)+"') "),r+=") {  var err =   ",!1!==e.createErrors?(r+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { property: '"+e.util.escapeQuotes(w)+"', missingProperty: '"+C+"', depsCount: "+x.length+", deps: '"+e.util.escapeQuotes(1==x.length?x[0]:x.join(", "))+"' } ",!1!==e.opts.messages&&(r+=" , message: 'should have ",1==x.length?r+="property "+e.util.escapeQuotes(x[0]):r+="properties "+e.util.escapeQuotes(x.join(", ")),r+=" when property "+e.util.escapeQuotes(w)+" is present' "),e.opts.verbose&&(r+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}}r+=" }   ",u&&(p+="}",r+=" else { ")}e.errorPath=b;var k=d.baseId;for(var w in m){y=m[w];(e.opts.strictKeywords?"object"==typeof y&&Object.keys(y).length>0:e.util.schemaHasRules(y,e.RULES.all))&&(r+=" "+f+" = true; if ( "+c+e.util.getProperty(w)+" !== undefined ",v&&(r+=" && Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(w)+"') "),r+=") { ",d.schema=y,d.schemaPath=a+e.util.getProperty(w),d.errSchemaPath=l+"/"+e.util.escapeFragment(w),r+="  "+e.validate(d)+" ",d.baseId=k,r+=" }  ",u&&(r+=" if ("+f+") { ",p+="}"))}return u&&(r+="   "+p+" if ("+h+" == errors) {"),r}},ba00:function(e,t,n){"use strict";var r=n("fbda");function i(e){r.copy(e,this)}e.exports=i},bd5b:function(e,t,n){"use strict";e.exports=function(e,t,n){var r=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="errs__"+i,d=e.util.copy(e),p="";d.level++;var f="valid"+d.level,m="key"+i,g="idx"+i,v=d.dataLevel=e.dataLevel+1,y="data"+v,x="dataProperties"+i,b=Object.keys(s||{}).filter(D),w=e.schema.patternProperties||{},_=Object.keys(w).filter(D),A=e.schema.additionalProperties,S=b.length||_.length,E=!1===A,M="object"==typeof A&&Object.keys(A).length,T=e.opts.removeAdditional,C=E||M||T,P=e.opts.ownProperties,R=e.baseId,L=e.schema.required;if(L&&(!e.opts.$data||!L.$data)&&L.length<e.opts.loopRequired)var O=e.util.toHash(L);function D(e){return"__proto__"!==e}if(r+="var "+h+" = errors;var "+f+" = true;",P&&(r+=" var "+x+" = undefined;"),C){if(r+=P?" "+x+" = "+x+" || Object.keys("+c+"); for (var "+g+"=0; "+g+"<"+x+".length; "+g+"++) { var "+m+" = "+x+"["+g+"]; ":" for (var "+m+" in "+c+") { ",S){if(r+=" var isAdditional"+i+" = !(false ",b.length)if(b.length>8)r+=" || validate.schema"+a+".hasOwnProperty("+m+") ";else{var I=b;if(I){var k=-1,N=I.length-1;while(k<N)Z=I[k+=1],r+=" || "+m+" == "+e.util.toQuotedString(Z)+" "}}if(_.length){var F=_;if(F){var V=-1,z=F.length-1;while(V<z)oe=F[V+=1],r+=" || "+e.usePattern(oe)+".test("+m+") "}}r+=" ); if (isAdditional"+i+") { "}if("all"==T)r+=" delete "+c+"["+m+"]; ";else{var U=e.errorPath,j="' + "+m+" + '";if(e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers)),E)if(T)r+=" delete "+c+"["+m+"]; ";else{r+=" "+f+" = false; ";var B=l;l=e.errSchemaPath+"/additionalProperties";var H=H||[];H.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { additionalProperty: '"+j+"' } ",!1!==e.opts.messages&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is an invalid additional property":r+="should NOT have additional properties",r+="' "),e.opts.verbose&&(r+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var G=r;r=H.pop(),!e.compositeRule&&u?e.async?r+=" throw new ValidationError(["+G+"]); ":r+=" validate.errors = ["+G+"]; return false; ":r+=" var err = "+G+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l=B,u&&(r+=" break; ")}else if(M)if("failing"==T){r+=" var "+h+" = errors;  ";var q=e.compositeRule;e.compositeRule=d.compositeRule=!0,d.schema=A,d.schemaPath=e.schemaPath+".additionalProperties",d.errSchemaPath=e.errSchemaPath+"/additionalProperties",d.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers);var W=c+"["+m+"]";d.dataPathArr[v]=m;var $=e.validate(d);d.baseId=R,e.util.varOccurences($,y)<2?r+=" "+e.util.varReplace($,y,W)+" ":r+=" var "+y+" = "+W+"; "+$+" ",r+=" if (!"+f+") { errors = "+h+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+c+"["+m+"]; }  ",e.compositeRule=d.compositeRule=q}else{d.schema=A,d.schemaPath=e.schemaPath+".additionalProperties",d.errSchemaPath=e.errSchemaPath+"/additionalProperties",d.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers);W=c+"["+m+"]";d.dataPathArr[v]=m;$=e.validate(d);d.baseId=R,e.util.varOccurences($,y)<2?r+=" "+e.util.varReplace($,y,W)+" ":r+=" var "+y+" = "+W+"; "+$+" ",u&&(r+=" if (!"+f+") break; ")}e.errorPath=U}S&&(r+=" } "),r+=" }  ",u&&(r+=" if ("+f+") { ",p+="}")}var X=e.opts.useDefaults&&!e.compositeRule;if(b.length){var Y=b;if(Y){var Z,J=-1,Q=Y.length-1;while(J<Q){Z=Y[J+=1];var K=s[Z];if(e.opts.strictKeywords?"object"==typeof K&&Object.keys(K).length>0:e.util.schemaHasRules(K,e.RULES.all)){var ee=e.util.getProperty(Z),te=(W=c+ee,X&&void 0!==K.default);d.schema=K,d.schemaPath=a+ee,d.errSchemaPath=l+"/"+e.util.escapeFragment(Z),d.errorPath=e.util.getPath(e.errorPath,Z,e.opts.jsonPointers),d.dataPathArr[v]=e.util.toQuotedString(Z);$=e.validate(d);if(d.baseId=R,e.util.varOccurences($,y)<2){$=e.util.varReplace($,y,W);var ne=W}else{ne=y;r+=" var "+y+" = "+W+"; "}if(te)r+=" "+$+" ";else{if(O&&O[Z]){r+=" if ( "+ne+" === undefined ",P&&(r+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(Z)+"') "),r+=") { "+f+" = false; ";U=e.errorPath,B=l;var re=e.util.escapeQuotes(Z);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(U,Z,e.opts.jsonPointers)),l=e.errSchemaPath+"/required";H=H||[];H.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { missingProperty: '"+re+"' } ",!1!==e.opts.messages&&(r+=" , message: '",e.opts._errorDataPathProperty?r+="is a required property":r+="should have required property \\'"+re+"\\'",r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";G=r;r=H.pop(),!e.compositeRule&&u?e.async?r+=" throw new ValidationError(["+G+"]); ":r+=" validate.errors = ["+G+"]; return false; ":r+=" var err = "+G+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l=B,e.errorPath=U,r+=" } else { "}else u?(r+=" if ( "+ne+" === undefined ",P&&(r+=" || ! Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(Z)+"') "),r+=") { "+f+" = true; } else { "):(r+=" if ("+ne+" !== undefined ",P&&(r+=" &&   Object.prototype.hasOwnProperty.call("+c+", '"+e.util.escapeQuotes(Z)+"') "),r+=" ) { ");r+=" "+$+" } "}}u&&(r+=" if ("+f+") { ",p+="}")}}}if(_.length){var ie=_;if(ie){var oe,se=-1,ae=ie.length-1;while(se<ae){oe=ie[se+=1];K=w[oe];if(e.opts.strictKeywords?"object"==typeof K&&Object.keys(K).length>0:e.util.schemaHasRules(K,e.RULES.all)){d.schema=K,d.schemaPath=e.schemaPath+".patternProperties"+e.util.getProperty(oe),d.errSchemaPath=e.errSchemaPath+"/patternProperties/"+e.util.escapeFragment(oe),r+=P?" "+x+" = "+x+" || Object.keys("+c+"); for (var "+g+"=0; "+g+"<"+x+".length; "+g+"++) { var "+m+" = "+x+"["+g+"]; ":" for (var "+m+" in "+c+") { ",r+=" if ("+e.usePattern(oe)+".test("+m+")) { ",d.errorPath=e.util.getPathExpr(e.errorPath,m,e.opts.jsonPointers);W=c+"["+m+"]";d.dataPathArr[v]=m;$=e.validate(d);d.baseId=R,e.util.varOccurences($,y)<2?r+=" "+e.util.varReplace($,y,W)+" ":r+=" var "+y+" = "+W+"; "+$+" ",u&&(r+=" if (!"+f+") break; "),r+=" } ",u&&(r+=" else "+f+" = true; "),r+=" }  ",u&&(r+=" if ("+f+") { ",p+="}")}}}}return u&&(r+=" "+p+" if ("+h+" == errors) {"),r}},bee2:function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}n.d(t,"a",(function(){return i}))},bf8d:function(e,t,n){"use strict";e.exports=function(e,t,n){var r,i=" ",o=e.level,s=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(s||""),d=e.opts.$data&&a&&a.$data;d?(i+=" var schema"+o+" = "+e.util.getData(a.$data,s,e.dataPathArr)+"; ",r="schema"+o):r=a;var p="maximum"==t,f=p?"exclusiveMaximum":"exclusiveMinimum",m=e.schema[f],g=e.opts.$data&&m&&m.$data,v=p?"<":">",y=p?">":"<",x=void 0;if(!d&&"number"!=typeof a&&void 0!==a)throw new Error(t+" must be number");if(!g&&void 0!==m&&"number"!=typeof m&&"boolean"!=typeof m)throw new Error(f+" must be number or boolean");if(g){var b=e.util.getData(m.$data,s,e.dataPathArr),w="exclusive"+o,_="exclType"+o,A="exclIsNumber"+o,S="op"+o,E="' + "+S+" + '";i+=" var schemaExcl"+o+" = "+b+"; ",b="schemaExcl"+o,i+=" var "+w+"; var "+_+" = typeof "+b+"; if ("+_+" != 'boolean' && "+_+" != 'undefined' && "+_+" != 'number') { ";x=f;var M=M||[];M.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(x||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: {} ",!1!==e.opts.messages&&(i+=" , message: '"+f+" should be boolean' "),e.opts.verbose&&(i+=" , schema: validate.schema"+l+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var T=i;i=M.pop(),!e.compositeRule&&c?e.async?i+=" throw new ValidationError(["+T+"]); ":i+=" validate.errors = ["+T+"]; return false; ":i+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else if ( ",d&&(i+=" ("+r+" !== undefined && typeof "+r+" != 'number') || "),i+=" "+_+" == 'number' ? ( ("+w+" = "+r+" === undefined || "+b+" "+v+"= "+r+") ? "+h+" "+y+"= "+b+" : "+h+" "+y+" "+r+" ) : ( ("+w+" = "+b+" === true) ? "+h+" "+y+"= "+r+" : "+h+" "+y+" "+r+" ) || "+h+" !== "+h+") { var op"+o+" = "+w+" ? '"+v+"' : '"+v+"='; ",void 0===a&&(x=f,u=e.errSchemaPath+"/"+f,r=b,d=g)}else{A="number"==typeof m,E=v;if(A&&d){S="'"+E+"'";i+=" if ( ",d&&(i+=" ("+r+" !== undefined && typeof "+r+" != 'number') || "),i+=" ( "+r+" === undefined || "+m+" "+v+"= "+r+" ? "+h+" "+y+"= "+m+" : "+h+" "+y+" "+r+" ) || "+h+" !== "+h+") { "}else{A&&void 0===a?(w=!0,x=f,u=e.errSchemaPath+"/"+f,r=m,y+="="):(A&&(r=Math[p?"min":"max"](m,a)),m===(!A||r)?(w=!0,x=f,u=e.errSchemaPath+"/"+f,y+="="):(w=!1,E+="="));S="'"+E+"'";i+=" if ( ",d&&(i+=" ("+r+" !== undefined && typeof "+r+" != 'number') || "),i+=" "+h+" "+y+" "+r+" || "+h+" !== "+h+") { "}}x=x||t;M=M||[];M.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(x||"_limit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { comparison: "+S+", limit: "+r+", exclusive: "+w+" } ",!1!==e.opts.messages&&(i+=" , message: 'should be "+E+" ",i+=d?"' + "+r:r+"'"),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+l:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";T=i;return i=M.pop(),!e.compositeRule&&c?e.async?i+=" throw new ValidationError(["+T+"]); ":i+=" validate.errors = ["+T+"]; return false; ":i+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",c&&(i+=" else { "),i}},c17c:function(e,t,n){"use strict";var r=n("6376"),i=n("fbda").toHash;e.exports=function(){var e=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf","if"]}],t=["type","$comment"],n=["$schema","$id","id","$data","$async","title","description","default","definitions","examples","readOnly","writeOnly","contentMediaType","contentEncoding","additionalItems","then","else"],o=["number","integer","string","array","object","boolean","null"];return e.all=i(t),e.types=i(o),e.forEach((function(n){n.rules=n.rules.map((function(n){var i;if("object"==typeof n){var o=Object.keys(n)[0];i=n[o],n=o,i.forEach((function(n){t.push(n),e.all[n]=!0}))}t.push(n);var s=e.all[n]={keyword:n,code:r[n],implements:i};return s})),e.all.$comment={keyword:"$comment",code:r.$comment},n.type&&(e.types[n.type]=n)})),e.keywords=i(t.concat(n)),e.custom={},e}},c1ac:function(e,t,n){"use strict";var r=n("ebb5"),i=n("b727").filter,o=n("4840"),s=r.aTypedArray,a=r.aTypedArrayConstructor,l=r.exportTypedArrayMethod;l("filter",(function(e){var t=i(s(this),e,arguments.length>1?arguments[1]:void 0),n=o(this,this.constructor),r=0,l=t.length,u=new(a(n))(l);while(l>r)u[r]=t[r++];return u}))},ca91:function(e,t,n){"use strict";var r=n("ebb5"),i=n("d58f").left,o=r.aTypedArray,s=r.exportTypedArrayMethod;s("reduce",(function(e){return i(o(this),e,arguments.length,arguments.length>1?arguments[1]:void 0)}))},cae0:function(e,t,n){(function(e){var r;(function(e,i,o){function s(e){var t=this;function n(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;while(r.length<8)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],e^=e>>>7,n=e^e<<24,e=r[i+1&7],n^=e^e>>>10,e=r[i+3&7],n^=e^e>>>3,e=r[i+4&7],n^=e^e<<7,e=r[i+7&7],e^=e<<13,n^=e^e<<9,r[i]=n,t.i=i+1&7,n},n(t,e)}function a(e,t){return t.x=e.x.slice(),t.i=e.i,t}function l(e,t){null==e&&(e=+new Date);var n=new s(e),r=t&&t.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,r=(e+t)/(1<<21)}while(0===r);return r},i.int32=n.next,i.quick=i,r&&(r.x&&a(r,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=l:n("07d6")&&n("3c35")?(r=function(){return l}.call(t,n,t,i),void 0===r||(i.exports=r)):this.xorshift7=l})(0,e,n("07d6"))}).call(this,n("62e4")(e))},cb27:function(module,exports,__webpack_require__){"use strict";(function(global){var numeric=exports;"undefined"!==typeof global&&(global.numeric=numeric),numeric.version="1.2.6",numeric.bench=function(e,t){var n,r,i,o;"undefined"===typeof t&&(t=15),i=.5,n=new Date;while(1){for(i*=2,o=i;o>3;o-=4)e(),e(),e(),e();while(o>0)e(),o--;if(r=new Date,r-n>t)break}for(o=i;o>3;o-=4)e(),e(),e(),e();while(o>0)e(),o--;return r=new Date,1e3*(3*i-1)/(r-n)},numeric._myIndexOf=function(e){var t,n=this.length;for(t=0;t<n;++t)if(this[t]===e)return t;return-1},numeric.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:numeric._myIndexOf,numeric.Function=Function,numeric.precision=4,numeric.largeArray=50,numeric.prettyPrint=function(e){function t(e){if(0===e)return"0";if(isNaN(e))return"NaN";if(e<0)return"-"+t(-e);if(isFinite(e)){var n=Math.floor(Math.log(e)/Math.log(10)),r=e/Math.pow(10,n),i=r.toPrecision(numeric.precision);return 10===parseFloat(i)&&(n++,r=1,i=r.toPrecision(numeric.precision)),parseFloat(i).toString()+"e"+n.toString()}return"Infinity"}var n=[];function r(e){var i;if("undefined"===typeof e)return n.push(Array(numeric.precision+8).join(" ")),!1;if("string"===typeof e)return n.push('"'+e+'"'),!1;if("boolean"===typeof e)return n.push(e.toString()),!1;if("number"===typeof e){var o=t(e),s=e.toPrecision(numeric.precision),a=parseFloat(e.toString()).toString(),l=[o,s,a,parseFloat(s).toString(),parseFloat(a).toString()];for(i=1;i<l.length;i++)l[i].length<o.length&&(o=l[i]);return n.push(Array(numeric.precision+8-o.length).join(" ")+o),!1}if(null===e)return n.push("null"),!1;if("function"===typeof e){n.push(e.toString());var u=!1;for(i in e)e.hasOwnProperty(i)&&(u?n.push(",\n"):n.push("\n{"),u=!0,n.push(i),n.push(": \n"),r(e[i]));return u&&n.push("}\n"),!0}if(e instanceof Array){if(e.length>numeric.largeArray)return n.push("...Large Array..."),!0;u=!1;for(n.push("["),i=0;i<e.length;i++)i>0&&(n.push(","),u&&n.push("\n ")),u=r(e[i]);return n.push("]"),!0}n.push("{");u=!1;for(i in e)e.hasOwnProperty(i)&&(u&&n.push(",\n"),u=!0,n.push(i),n.push(": \n"),r(e[i]));return n.push("}"),!0}return r(e),n.join("")},numeric.parseDate=function(e){function t(e){if("string"===typeof e)return Date.parse(e.replace(/-/g,"/"));if(!(e instanceof Array))throw new Error("parseDate: parameter must be arrays of strings");var n,r=[];for(n=0;n<e.length;n++)r[n]=t(e[n]);return r}return t(e)},numeric.parseFloat=function(e){function t(e){if("string"===typeof e)return parseFloat(e);if(!(e instanceof Array))throw new Error("parseFloat: parameter must be arrays of strings");var n,r=[];for(n=0;n<e.length;n++)r[n]=t(e[n]);return r}return t(e)},numeric.parseCSV=function(e){var t,n,r=e.split("\n"),i=[],o=/(([^'",]*)|('[^']*')|("[^"]*")),/g,s=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,a=function(e){return e.substr(0,e.length-1)},l=0;for(n=0;n<r.length;n++){var u,c=(r[n]+",").match(o);if(c.length>0){for(i[l]=[],t=0;t<c.length;t++)u=a(c[t]),s.test(u)?i[l][t]=parseFloat(u):i[l][t]=u;l++}}return i},numeric.toCSV=function(e){var t,n,r,i,o,s=numeric.dim(e);for(r=s[0],s[1],o=[],t=0;t<r;t++){for(i=[],n=0;n<r;n++)i[n]=e[t][n].toString();o[t]=i.join(", ")}return o.join("\n")+"\n"},numeric.getURL=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),t},numeric.imageURL=function(e){function t(e){var t,n,r,i,o,s,a,l,u=e.length,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h="";for(t=0;t<u;t+=3)n=e[t],r=e[t+1],i=e[t+2],o=n>>2,s=((3&n)<<4)+(r>>4),a=((15&r)<<2)+(i>>6),l=63&i,t+1>=u?a=l=64:t+2>=u&&(l=64),h+=c.charAt(o)+c.charAt(s)+c.charAt(a)+c.charAt(l);return h}function n(e,t,n){"undefined"===typeof t&&(t=0),"undefined"===typeof n&&(n=e.length);var r,i=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],o=-1,s=0;e.length;for(r=t;r<n;r++)s=255&(o^e[r]),o=o>>>8^i[s];return-1^o}var r,i,o,s,a,l,u,c,h,d,p=e[0].length,f=e[0][0].length,m=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,f>>24&255,f>>16&255,f>>8&255,255&f,p>>24&255,p>>16&255,p>>8&255,255&p,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];for(d=n(m,12,29),m[29]=d>>24&255,m[30]=d>>16&255,m[31]=d>>8&255,m[32]=255&d,r=1,i=0,u=0;u<p;u++){for(u<p-1?m.push(0):m.push(1),a=3*f+1+(0===u)&255,l=3*f+1+(0===u)>>8&255,m.push(a),m.push(l),m.push(255&~a),m.push(255&~l),0===u&&m.push(0),c=0;c<f;c++)for(o=0;o<3;o++)a=e[o][u][c],a=a>255?255:a<0?0:Math.round(a),r=(r+a)%65521,i=(i+r)%65521,m.push(a);m.push(0)}return h=(i<<16)+r,m.push(h>>24&255),m.push(h>>16&255),m.push(h>>8&255),m.push(255&h),s=m.length-41,m[33]=s>>24&255,m[34]=s>>16&255,m[35]=s>>8&255,m[36]=255&s,d=n(m,37),m.push(d>>24&255),m.push(d>>16&255),m.push(d>>8&255),m.push(255&d),m.push(0),m.push(0),m.push(0),m.push(0),m.push(73),m.push(69),m.push(78),m.push(68),m.push(174),m.push(66),m.push(96),m.push(130),"data:image/png;base64,"+t(m)},numeric._dim=function(e){var t=[];while("object"===typeof e)t.push(e.length),e=e[0];return t},numeric.dim=function(e){var t,n;return"object"===typeof e?(t=e[0],"object"===typeof t?(n=t[0],"object"===typeof n?numeric._dim(e):[e.length,t.length]):[e.length]):[]},numeric.mapreduce=function(e,t){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+t+';\nif(typeof x === "number") { var xi = x; '+e+'; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    '+e+";\n    xi = x[i-1];\n    "+e+";\n}\nif(i === 0) {\n    xi = x[i];\n    "+e+"\n}\nreturn accum;")},numeric.mapreduce2=function(e,t){return Function("x","var n = x.length;\nvar i,xi;\n"+t+";\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    "+e+";\n}\nreturn accum;")},numeric.same=function e(t,n){var r,i;if(!(t instanceof Array)||!(n instanceof Array))return!1;if(i=t.length,i!==n.length)return!1;for(r=0;r<i;r++)if(t[r]!==n[r]){if("object"!==typeof t[r])return!1;if(!e(t[r],n[r]))return!1}return!0},numeric.rep=function(e,t,n){"undefined"===typeof n&&(n=0);var r,i=e[n],o=Array(i);if(n===e.length-1){for(r=i-2;r>=0;r-=2)o[r+1]=t,o[r]=t;return-1===r&&(o[0]=t),o}for(r=i-1;r>=0;r--)o[r]=numeric.rep(e,t,n+1);return o},numeric.dotMMsmall=function(e,t){var n,r,i,o,s,a,l,u,c,h,d;for(o=e.length,s=t.length,a=t[0].length,l=Array(o),n=o-1;n>=0;n--){for(u=Array(a),c=e[n],i=a-1;i>=0;i--){for(h=c[s-1]*t[s-1][i],r=s-2;r>=1;r-=2)d=r-1,h+=c[r]*t[r][i]+c[d]*t[d][i];0===r&&(h+=c[0]*t[0][i]),u[i]=h}l[n]=u}return l},numeric._getCol=function(e,t,n){var r,i=e.length;for(r=i-1;r>0;--r)n[r]=e[r][t],--r,n[r]=e[r][t];0===r&&(n[0]=e[0][t])},numeric.dotMMbig=function(e,t){var n,r,i,o=numeric._getCol,s=t.length,a=Array(s),l=e.length,u=t[0].length,c=new Array(l),h=numeric.dotVV;for(--s,--l,r=l;-1!==r;--r)c[r]=Array(u);for(--u,r=u;-1!==r;--r)for(o(t,r,a),i=l;-1!==i;--i)0,n=e[i],c[i][r]=h(n,a);return c},numeric.dotMV=function(e,t){var n,r=e.length,i=(t.length,Array(r)),o=numeric.dotVV;for(n=r-1;n>=0;n--)i[n]=o(e[n],t);return i},numeric.dotVM=function(e,t){var n,r,i,o,s,a,l;for(i=e.length,o=t[0].length,s=Array(o),r=o-1;r>=0;r--){for(a=e[i-1]*t[i-1][r],n=i-2;n>=1;n-=2)l=n-1,a+=e[n]*t[n][r]+e[l]*t[l][r];0===n&&(a+=e[0]*t[0][r]),s[r]=a}return s},numeric.dotVV=function(e,t){var n,r,i=e.length,o=e[i-1]*t[i-1];for(n=i-2;n>=1;n-=2)r=n-1,o+=e[n]*t[n]+e[r]*t[r];return 0===n&&(o+=e[0]*t[0]),o},numeric.dot=function(e,t){var n=numeric.dim;switch(1e3*n(e).length+n(t).length){case 2002:return t.length<10?numeric.dotMMsmall(e,t):numeric.dotMMbig(e,t);case 2001:return numeric.dotMV(e,t);case 1002:return numeric.dotVM(e,t);case 1001:return numeric.dotVV(e,t);case 1e3:return numeric.mulVS(e,t);case 1:return numeric.mulSV(e,t);case 0:return e*t;default:throw new Error("numeric.dot only works on vectors and matrices")}},numeric.diag=function(e){var t,n,r,i,o=e.length,s=Array(o);for(t=o-1;t>=0;t--){for(i=Array(o),n=t+2,r=o-1;r>=n;r-=2)i[r]=0,i[r-1]=0;for(r>t&&(i[r]=0),i[t]=e[t],r=t-1;r>=1;r-=2)i[r]=0,i[r-1]=0;0===r&&(i[0]=0),s[t]=i}return s},numeric.getDiag=function(e){var t,n=Math.min(e.length,e[0].length),r=Array(n);for(t=n-1;t>=1;--t)r[t]=e[t][t],--t,r[t]=e[t][t];return 0===t&&(r[0]=e[0][0]),r},numeric.identity=function(e){return numeric.diag(numeric.rep([e],1))},numeric.pointwise=function(e,t,n){"undefined"===typeof n&&(n="");var r,i,o=[],s=/\[i\]$/,a="",l=!1;for(r=0;r<e.length;r++)s.test(e[r])?(i=e[r].substring(0,e[r].length-3),a=i):i=e[r],"ret"===i&&(l=!0),o.push(i);return o[e.length]="_s",o[e.length+1]="_k",o[e.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+a+');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i'+(l?"":", ret = Array(_n)")+";\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+e.join(",")+",_s,_k+1);\n    return ret;\n}\n"+n+"\nfor(i=_n-1;i!==-1;--i) {\n    "+t+"\n}\nreturn ret;",Function.apply(null,o)},numeric.pointwise2=function(e,t,n){"undefined"===typeof n&&(n="");var r,i,o=[],s=/\[i\]$/,a="",l=!1;for(r=0;r<e.length;r++)s.test(e[r])?(i=e[r].substring(0,e[r].length-3),a=i):i=e[r],"ret"===i&&(l=!0),o.push(i);return o[e.length]="var _n = "+a+".length;\nvar i"+(l?"":", ret = Array(_n)")+";\n"+n+"\nfor(i=_n-1;i!==-1;--i) {\n"+t+"\n}\nreturn ret;",Function.apply(null,o)},numeric._biforeach=function e(t,n,r,i,o){if(i!==r.length-1){var s,a=r[i];for(s=a-1;s>=0;s--)e("object"===typeof t?t[s]:t,"object"===typeof n?n[s]:n,r,i+1,o)}else o(t,n)},numeric._biforeach2=function e(t,n,r,i,o){if(i===r.length-1)return o(t,n);var s,a=r[i],l=Array(a);for(s=a-1;s>=0;--s)l[s]=e("object"===typeof t?t[s]:t,"object"===typeof n?n[s]:n,r,i+1,o);return l},numeric._foreach=function e(t,n,r,i){if(r!==n.length-1){var o,s=n[r];for(o=s-1;o>=0;o--)e(t[o],n,r+1,i)}else i(t)},numeric._foreach2=function e(t,n,r,i){if(r===n.length-1)return i(t);var o,s=n[r],a=Array(s);for(o=s-1;o>=0;o--)a[o]=e(t[o],n,r+1,i);return a},numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"},numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="},numeric.mathfuns=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan","isNaN","isFinite"],numeric.mathfuns2=["atan2","pow","max","min"],numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""},numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]},function(){var e,t;for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],numeric.ops2[t]=t;for(e in numeric.ops2)if(numeric.ops2.hasOwnProperty(e)){t=numeric.ops2[e];var n,r,i="";-1!==numeric.myIndexOf.call(numeric.mathfuns2,e)?(i="var "+t+" = Math."+t+";\n",n=function(e,n,r){return e+" = "+t+"("+n+","+r+")"},r=function(e,n){return e+" = "+t+"("+e+","+n+")"}):(n=function(e,n,r){return e+" = "+n+" "+t+" "+r},r=numeric.opseq.hasOwnProperty(e+"eq")?function(e,n){return e+" "+t+"= "+n}:function(e,n){return e+" = "+e+" "+t+" "+n}),numeric[e+"VV"]=numeric.pointwise2(["x[i]","y[i]"],n("ret[i]","x[i]","y[i]"),i),numeric[e+"SV"]=numeric.pointwise2(["x","y[i]"],n("ret[i]","x","y[i]"),i),numeric[e+"VS"]=numeric.pointwise2(["x[i]","y"],n("ret[i]","x[i]","y"),i),numeric[e]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+e+"VV, VS = numeric."+e+"VS, SV = numeric."+e+'SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === "object") {\n      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else '+r("x","y")+"\n}\nreturn x;\n"),numeric[t]=numeric[e],numeric[e+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],r("ret[i]","x[i]"),i),numeric[e+"eqS"]=numeric.pointwise2(["ret[i]","x"],r("ret[i]","x"),i),numeric[e+"eq"]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+e+"eqV, S = numeric."+e+'eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n')}for(e=0;e<numeric.mathfuns2.length;++e)t=numeric.mathfuns2[e],delete numeric.ops2[t];for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],numeric.ops1[t]=t;for(e in numeric.ops1)numeric.ops1.hasOwnProperty(e)&&(i="",t=numeric.ops1[e],-1!==numeric.myIndexOf.call(numeric.mathfuns,e)&&Math.hasOwnProperty(t)&&(i="var "+t+" = Math."+t+";\n"),numeric[e+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+t+"(ret[i]);",i),numeric[e+"eq"]=Function("x",'if(typeof x !== "object") return '+t+"x\nvar i;\nvar V = numeric."+e+"eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n"),numeric[e+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+t+"(x[i]);",i),numeric[e]=Function("x",'if(typeof x !== "object") return '+t+"(x)\nvar i;\nvar V = numeric."+e+"V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n"));for(e=0;e<numeric.mathfuns.length;++e)t=numeric.mathfuns[e],delete numeric.ops1[t];for(e in numeric.mapreducers)numeric.mapreducers.hasOwnProperty(e)&&(t=numeric.mapreducers[e],numeric[e+"V"]=numeric.mapreduce2(t[0],t[1]),numeric[e]=Function("x","s","k",t[1]+'if(typeof x !== "object") {    xi = x;\n'+t[0]+';\n    return accum;\n}if(typeof s === "undefined") s = numeric.dim(x);\nif(typeof k === "undefined") k = 0;\nif(k === s.length-1) return numeric.'+e+"V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n"+t[0]+";\n}\nreturn accum;\n"))}(),numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;"),numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;"),numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;"),numeric.trunc=function(e,t){return"object"===typeof e?"object"===typeof t?numeric.truncVV(e,t):numeric.truncVS(e,t):"object"===typeof t?numeric.truncSV(e,t):Math.round(e/t)*t},numeric.inv=function(e){var t,n,r,i,o,s,a,l=numeric.dim(e),u=Math.abs,c=l[0],h=l[1],d=numeric.clone(e),p=numeric.identity(c);for(s=0;s<h;++s){var f=-1,m=-1;for(o=s;o!==c;++o)a=u(d[o][s]),a>m&&(f=o,m=a);for(n=d[f],d[f]=d[s],d[s]=n,i=p[f],p[f]=p[s],p[s]=i,e=n[s],a=s;a!==h;++a)n[a]/=e;for(a=h-1;-1!==a;--a)i[a]/=e;for(o=c-1;-1!==o;--o)if(o!==s){for(t=d[o],r=p[o],e=t[s],a=s+1;a!==h;++a)t[a]-=n[a]*e;for(a=h-1;a>0;--a)r[a]-=i[a]*e,--a,r[a]-=i[a]*e;0===a&&(r[0]-=i[0]*e)}}return p},numeric.det=function(e){var t=numeric.dim(e);if(2!==t.length||t[0]!==t[1])throw new Error("numeric: det() only works on square matrices");var n,r,i,o,s,a,l,u,c=t[0],h=1,d=numeric.clone(e);for(r=0;r<c-1;r++){for(i=r,n=r+1;n<c;n++)Math.abs(d[n][r])>Math.abs(d[i][r])&&(i=n);for(i!==r&&(l=d[i],d[i]=d[r],d[r]=l,h*=-1),o=d[r],n=r+1;n<c;n++){for(s=d[n],a=s[r]/o[r],i=r+1;i<c-1;i+=2)u=i+1,s[i]-=o[i]*a,s[u]-=o[u]*a;i!==c&&(s[i]-=o[i]*a)}if(0===o[r])return 0;h*=o[r]}return h*d[r][r]},numeric.transpose=function(e){var t,n,r,i,o,s=e.length,a=e[0].length,l=Array(a);for(n=0;n<a;n++)l[n]=Array(s);for(t=s-1;t>=1;t-=2){for(i=e[t],r=e[t-1],n=a-1;n>=1;--n)o=l[n],o[t]=i[n],o[t-1]=r[n],--n,o=l[n],o[t]=i[n],o[t-1]=r[n];0===n&&(o=l[0],o[t]=i[0],o[t-1]=r[0])}if(0===t){for(r=e[0],n=a-1;n>=1;--n)l[n][0]=r[n],--n,l[n][0]=r[n];0===n&&(l[0][0]=r[0])}return l},numeric.negtranspose=function(e){var t,n,r,i,o,s=e.length,a=e[0].length,l=Array(a);for(n=0;n<a;n++)l[n]=Array(s);for(t=s-1;t>=1;t-=2){for(i=e[t],r=e[t-1],n=a-1;n>=1;--n)o=l[n],o[t]=-i[n],o[t-1]=-r[n],--n,o=l[n],o[t]=-i[n],o[t-1]=-r[n];0===n&&(o=l[0],o[t]=-i[0],o[t-1]=-r[0])}if(0===t){for(r=e[0],n=a-1;n>=1;--n)l[n][0]=-r[n],--n,l[n][0]=-r[n];0===n&&(l[0][0]=-r[0])}return l},numeric._random=function e(t,n){var r,i,o=t[n],s=Array(o);if(n===t.length-1){for(i=Math.random,r=o-1;r>=1;r-=2)s[r]=i(),s[r-1]=i();return 0===r&&(s[0]=i()),s}for(r=o-1;r>=0;r--)s[r]=e(t,n+1);return s},numeric.random=function(e){return numeric._random(e,0)},numeric.norm2=function(e){return Math.sqrt(numeric.norm2Squared(e))},numeric.linspace=function(e,t,n){if("undefined"===typeof n&&(n=Math.max(Math.round(t-e)+1,1)),n<2)return 1===n?[e]:[];var r,i=Array(n);for(n--,r=n;r>=0;r--)i[r]=(r*t+(n-r)*e)/n;return i},numeric.getBlock=function(e,t,n){var r=numeric.dim(e);function i(e,o){var s,a=t[o],l=n[o]-a,u=Array(l);if(o===r.length-1){for(s=l;s>=0;s--)u[s]=e[s+a];return u}for(s=l;s>=0;s--)u[s]=i(e[s+a],o+1);return u}return i(e,0)},numeric.setBlock=function(e,t,n,r){var i=numeric.dim(e);function o(e,r,s){var a,l=t[s],u=n[s]-l;if(s===i.length-1)for(a=u;a>=0;a--)e[a+l]=r[a];for(a=u;a>=0;a--)o(e[a+l],r[a],s+1)}return o(e,r,0),e},numeric.getRange=function(e,t,n){var r,i,o,s,a=t.length,l=n.length,u=Array(a);for(r=a-1;-1!==r;--r)for(u[r]=Array(l),o=u[r],s=e[t[r]],i=l-1;-1!==i;--i)o[i]=s[n[i]];return u},numeric.blockMatrix=function(e){var t=numeric.dim(e);if(t.length<4)return numeric.blockMatrix([e]);var n,r,i,o,s,a=t[0],l=t[1];for(n=0,r=0,i=0;i<a;++i)n+=e[i][0].length;for(o=0;o<l;++o)r+=e[0][o][0].length;var u=Array(n);for(i=0;i<n;++i)u[i]=Array(r);var c,h,d,p,f,m=0;for(i=0;i<a;++i){for(c=r,o=l-1;-1!==o;--o)for(s=e[i][o],c-=s[0].length,d=s.length-1;-1!==d;--d)for(f=s[d],h=u[m+d],p=f.length-1;-1!==p;--p)h[c+p]=f[p];m+=e[i][0].length}return u},numeric.tensor=function(e,t){if("number"===typeof e||"number"===typeof t)return numeric.mul(e,t);var n=numeric.dim(e),r=numeric.dim(t);if(1!==n.length||1!==r.length)throw new Error("numeric: tensor product is only defined for vectors");var i,o,s,a,l=n[0],u=r[0],c=Array(l);for(o=l-1;o>=0;o--){for(i=Array(u),a=e[o],s=u-1;s>=3;--s)i[s]=a*t[s],--s,i[s]=a*t[s],--s,i[s]=a*t[s],--s,i[s]=a*t[s];while(s>=0)i[s]=a*t[s],--s;c[o]=i}return c},numeric.T=function(e,t){this.x=e,this.y=t},numeric.t=function(e,t){return new numeric.T(e,t)},numeric.Tbinop=function(e,t,n,r,i){var o;numeric.indexOf;if("string"!==typeof i)for(o in i="",numeric)numeric.hasOwnProperty(o)&&(e.indexOf(o)>=0||t.indexOf(o)>=0||n.indexOf(o)>=0||r.indexOf(o)>=0)&&o.length>1&&(i+="var "+o+" = numeric."+o+";\n");return Function(["y"],"var x = this;\nif(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+i+"\nif(x.y) {  if(y.y) {    return new numeric.T("+r+");\n  }\n  return new numeric.T("+n+");\n}\nif(y.y) {\n  return new numeric.T("+t+");\n}\nreturn new numeric.T("+e+");\n")},numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)"),numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)"),numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))"),numeric.T.prototype.reciprocal=function(){var e=numeric.mul,t=numeric.div;if(this.y){var n=numeric.add(e(this.x,this.x),e(this.y,this.y));return new numeric.T(t(this.x,n),t(numeric.neg(this.y),n))}return new T(t(1,this.x))},numeric.T.prototype.div=function(e){if(e instanceof numeric.T||(e=new numeric.T(e)),e.y)return this.mul(e.reciprocal());var t=numeric.div;return this.y?new numeric.T(t(this.x,e.x),t(this.y,e.x)):new numeric.T(t(this.x,e.x))},numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))"),numeric.T.prototype.transpose=function(){var e=numeric.transpose,t=this.x,n=this.y;return n?new numeric.T(e(t),e(n)):new numeric.T(e(t))},numeric.T.prototype.transjugate=function(){var e=numeric.transpose,t=this.x,n=this.y;return n?new numeric.T(e(t),numeric.negtranspose(n)):new numeric.T(e(t))},numeric.Tunop=function(e,t,n){return"string"!==typeof n&&(n=""),Function("var x = this;\n"+n+"\nif(x.y) {  "+t+";\n}\n"+e+";\n")},numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;"),numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));"),numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;"),numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));"),numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);"),numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;"),numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\nreturn new numeric.T(numeric.log(r.x),theta.x);"),numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\nreturn Math.sqrt(f(x.x)+f(x.y));"),numeric.T.prototype.inv=function(){var e=this;if("undefined"===typeof e.y)return new numeric.T(numeric.inv(e.x));var t,n,r,i,o,s,a,l,u,c,h,d,p,f,m,g,v,y,x=e.x.length,b=numeric.identity(x),w=numeric.rep([x,x],0),_=numeric.clone(e.x),A=numeric.clone(e.y);for(u=0;u<x;u++){for(f=_[u][u],m=A[u][u],d=f*f+m*m,h=u,c=u+1;c<x;c++)f=_[c][u],m=A[c][u],p=f*f+m*m,p>d&&(h=c,d=p);for(h!==u&&(y=_[u],_[u]=_[h],_[h]=y,y=A[u],A[u]=A[h],A[h]=y,y=b[u],b[u]=b[h],b[h]=y,y=w[u],w[u]=w[h],w[h]=y),t=_[u],n=A[u],o=b[u],s=w[u],f=t[u],m=n[u],c=u+1;c<x;c++)g=t[c],v=n[c],t[c]=(g*f+v*m)/d,n[c]=(v*f-g*m)/d;for(c=0;c<x;c++)g=o[c],v=s[c],o[c]=(g*f+v*m)/d,s[c]=(v*f-g*m)/d;for(c=u+1;c<x;c++){for(r=_[c],i=A[c],a=b[c],l=w[c],f=r[u],m=i[u],h=u+1;h<x;h++)g=t[h],v=n[h],r[h]-=g*f-v*m,i[h]-=v*f+g*m;for(h=0;h<x;h++)g=o[h],v=s[h],a[h]-=g*f-v*m,l[h]-=v*f+g*m}}for(u=x-1;u>0;u--)for(o=b[u],s=w[u],c=u-1;c>=0;c--)for(a=b[c],l=w[c],f=_[c][u],m=A[c][u],h=x-1;h>=0;h--)g=o[h],v=s[h],a[h]-=f*g-m*v,l[h]-=f*v+m*g;return new numeric.T(b,w)},numeric.T.prototype.get=function(e){var t,n=this.x,r=this.y,i=0,o=e.length;if(r){while(i<o)t=e[i],n=n[t],r=r[t],i++;return new numeric.T(n,r)}while(i<o)t=e[i],n=n[t],i++;return new numeric.T(n)},numeric.T.prototype.set=function(e,t){var n,r=this.x,i=this.y,o=0,s=e.length,a=t.x,l=t.y;if(0===s)return l?this.y=l:i&&(this.y=void 0),this.x=r,this;if(l){i||(i=numeric.rep(numeric.dim(r),0),this.y=i);while(o<s-1)n=e[o],r=r[n],i=i[n],o++;return n=e[o],r[n]=a,i[n]=l,this}if(i){while(o<s-1)n=e[o],r=r[n],i=i[n],o++;return n=e[o],r[n]=a,i[n]=a instanceof Array?numeric.rep(numeric.dim(a),0):0,this}while(o<s-1)n=e[o],r=r[n],o++;return n=e[o],r[n]=a,this},numeric.T.prototype.getRows=function(e,t){var n,r,i=t-e+1,o=Array(i),s=this.x,a=this.y;for(n=e;n<=t;n++)o[n-e]=s[n];if(a){for(r=Array(i),n=e;n<=t;n++)r[n-e]=a[n];return new numeric.T(o,r)}return new numeric.T(o)},numeric.T.prototype.setRows=function(e,t,n){var r,i=this.x,o=this.y,s=n.x,a=n.y;for(r=e;r<=t;r++)i[r]=s[r-e];if(a)for(o||(o=numeric.rep(numeric.dim(i),0),this.y=o),r=e;r<=t;r++)o[r]=a[r-e];else if(o)for(r=e;r<=t;r++)o[r]=numeric.rep([s[r-e].length],0);return this},numeric.T.prototype.getRow=function(e){var t=this.x,n=this.y;return n?new numeric.T(t[e],n[e]):new numeric.T(t[e])},numeric.T.prototype.setRow=function(e,t){var n=this.x,r=this.y,i=t.x,o=t.y;return n[e]=i,o?(r||(r=numeric.rep(numeric.dim(n),0),this.y=r),r[e]=o):r&&(r=numeric.rep([i.length],0)),this},numeric.T.prototype.getBlock=function(e,t){var n=this.x,r=this.y,i=numeric.getBlock;return r?new numeric.T(i(n,e,t),i(r,e,t)):new numeric.T(i(n,e,t))},numeric.T.prototype.setBlock=function(e,t,n){n instanceof numeric.T||(n=new numeric.T(n));var r=this.x,i=this.y,o=numeric.setBlock,s=n.x,a=n.y;if(a)return i||(this.y=numeric.rep(numeric.dim(this),0),i=this.y),o(r,e,t,s),o(i,e,t,a),this;o(r,e,t,s),i&&o(i,e,t,numeric.rep(numeric.dim(s),0))},numeric.T.rep=function(e,t){var n=numeric.T;t instanceof n||(t=new n(t));var r=t.x,i=t.y,o=numeric.rep;return i?new n(o(e,r),o(e,i)):new n(o(e,r))},numeric.T.diag=function(e){e instanceof numeric.T||(e=new numeric.T(e));var t=e.x,n=e.y,r=numeric.diag;return n?new numeric.T(r(t),r(n)):new numeric.T(r(t))},numeric.T.eig=function(){if(this.y)throw new Error("eig: not implemented for complex matrices.");return numeric.eig(this.x)},numeric.T.identity=function(e){return new numeric.T(numeric.identity(e))},numeric.T.prototype.getDiag=function(){var e=numeric,t=this.x,n=this.y;return n?new e.T(e.getDiag(t),e.getDiag(n)):new e.T(e.getDiag(t))},numeric.house=function(e){var t=numeric.clone(e),n=e[0]>=0?1:-1,r=n*numeric.norm2(e);t[0]+=r;var i=numeric.norm2(t);if(0===i)throw new Error("eig: internal error");return numeric.div(t,i)},numeric.toUpperHessenberg=function(e){var t=numeric.dim(e);if(2!==t.length||t[0]!==t[1])throw new Error("numeric: toUpperHessenberg() only works on square matrices");var n,r,i,o,s,a,l,u,c,h,d=t[0],p=numeric.clone(e),f=numeric.identity(d);for(r=0;r<d-2;r++){for(o=Array(d-r-1),n=r+1;n<d;n++)o[n-r-1]=p[n][r];if(numeric.norm2(o)>0){for(s=numeric.house(o),a=numeric.getBlock(p,[r+1,r],[d-1,d-1]),l=numeric.tensor(s,numeric.dot(s,a)),n=r+1;n<d;n++)for(u=p[n],c=l[n-r-1],i=r;i<d;i++)u[i]-=2*c[i-r];for(a=numeric.getBlock(p,[0,r+1],[d-1,d-1]),l=numeric.tensor(numeric.dot(a,s),s),n=0;n<d;n++)for(u=p[n],c=l[n],i=r+1;i<d;i++)u[i]-=2*c[i-r-1];for(a=Array(d-r-1),n=r+1;n<d;n++)a[n-r-1]=f[n];for(l=numeric.tensor(s,numeric.dot(s,a)),n=r+1;n<d;n++)for(h=f[n],c=l[n-r-1],i=0;i<d;i++)h[i]-=2*c[i]}}return{H:p,Q:f}},numeric.epsilon=2220446049250313e-31,numeric.QRFrancis=function(e,t){"undefined"===typeof t&&(t=1e4),e=numeric.clone(e);numeric.clone(e);var n,r,i,o,s,a,l,u,c,h,d,p,f,m,g,v,y,x,b=numeric.dim(e),w=b[0],_=numeric.identity(w);if(w<3)return{Q:_,B:[[0,w-1]]};var A=numeric.epsilon;for(x=0;x<t;x++){for(v=0;v<w-1;v++)if(Math.abs(e[v+1][v])<A*(Math.abs(e[v][v])+Math.abs(e[v+1][v+1]))){var S=numeric.QRFrancis(numeric.getBlock(e,[0,0],[v,v]),t),E=numeric.QRFrancis(numeric.getBlock(e,[v+1,v+1],[w-1,w-1]),t);for(p=Array(v+1),g=0;g<=v;g++)p[g]=_[g];for(f=numeric.dot(S.Q,p),g=0;g<=v;g++)_[g]=f[g];for(p=Array(w-v-1),g=v+1;g<w;g++)p[g-v-1]=_[g];for(f=numeric.dot(E.Q,p),g=v+1;g<w;g++)_[g]=f[g-v-1];return{Q:_,B:S.B.concat(numeric.add(E.B,v+1))}}var M,T,C;if(i=e[w-2][w-2],o=e[w-2][w-1],s=e[w-1][w-2],a=e[w-1][w-1],u=i+a,l=i*a-o*s,c=numeric.getBlock(e,[0,0],[2,2]),u*u>=4*l)M=.5*(u+Math.sqrt(u*u-4*l)),T=.5*(u-Math.sqrt(u*u-4*l)),c=numeric.add(numeric.sub(numeric.dot(c,c),numeric.mul(c,M+T)),numeric.diag(numeric.rep([3],M*T)));else c=numeric.add(numeric.sub(numeric.dot(c,c),numeric.mul(c,u)),numeric.diag(numeric.rep([3],l)));for(n=[c[0][0],c[1][0],c[2][0]],r=numeric.house(n),p=[e[0],e[1],e[2]],f=numeric.tensor(r,numeric.dot(r,p)),g=0;g<3;g++)for(d=e[g],m=f[g],y=0;y<w;y++)d[y]-=2*m[y];for(p=numeric.getBlock(e,[0,0],[w-1,2]),f=numeric.tensor(numeric.dot(p,r),r),g=0;g<w;g++)for(d=e[g],m=f[g],y=0;y<3;y++)d[y]-=2*m[y];for(p=[_[0],_[1],_[2]],f=numeric.tensor(r,numeric.dot(r,p)),g=0;g<3;g++)for(h=_[g],m=f[g],y=0;y<w;y++)h[y]-=2*m[y];for(v=0;v<w-2;v++){for(y=v;y<=v+1;y++)if(Math.abs(e[y+1][y])<A*(Math.abs(e[y][y])+Math.abs(e[y+1][y+1]))){S=numeric.QRFrancis(numeric.getBlock(e,[0,0],[y,y]),t),E=numeric.QRFrancis(numeric.getBlock(e,[y+1,y+1],[w-1,w-1]),t);for(p=Array(y+1),g=0;g<=y;g++)p[g]=_[g];for(f=numeric.dot(S.Q,p),g=0;g<=y;g++)_[g]=f[g];for(p=Array(w-y-1),g=y+1;g<w;g++)p[g-y-1]=_[g];for(f=numeric.dot(E.Q,p),g=y+1;g<w;g++)_[g]=f[g-y-1];return{Q:_,B:S.B.concat(numeric.add(E.B,y+1))}}for(C=Math.min(w-1,v+3),n=Array(C-v),g=v+1;g<=C;g++)n[g-v-1]=e[g][v];for(r=numeric.house(n),p=numeric.getBlock(e,[v+1,v],[C,w-1]),f=numeric.tensor(r,numeric.dot(r,p)),g=v+1;g<=C;g++)for(d=e[g],m=f[g-v-1],y=v;y<w;y++)d[y]-=2*m[y-v];for(p=numeric.getBlock(e,[0,v+1],[w-1,C]),f=numeric.tensor(numeric.dot(p,r),r),g=0;g<w;g++)for(d=e[g],m=f[g],y=v+1;y<=C;y++)d[y]-=2*m[y-v-1];for(p=Array(C-v),g=v+1;g<=C;g++)p[g-v-1]=_[g];for(f=numeric.tensor(r,numeric.dot(r,p)),g=v+1;g<=C;g++)for(h=_[g],m=f[g-v-1],y=0;y<w;y++)h[y]-=2*m[y]}}throw new Error("numeric: eigenvalue iteration does not converge -- increase maxiter?")},numeric.eig=function(e,t){var n,r,i,o,s,a,l,u,c,h,d,p,f,m,g,v,y,x=numeric.toUpperHessenberg(e),b=numeric.QRFrancis(x.H,t),w=numeric.T,_=e.length,A=b.B,S=numeric.dot(b.Q,numeric.dot(x.H,numeric.transpose(b.Q))),E=new w(numeric.dot(b.Q,x.Q)),M=A.length,T=Math.sqrt;for(r=0;r<M;r++)if(n=A[r][0],n===A[r][1]);else{if(o=n+1,s=S[n][n],a=S[n][o],l=S[o][n],u=S[o][o],0===a&&0===l)continue;c=-s-u,h=s*u-a*l,d=c*c-4*h,d>=0?(p=c<0?-.5*(c-T(d)):-.5*(c+T(d)),v=(s-p)*(s-p)+a*a,y=l*l+(u-p)*(u-p),v>y?(v=T(v),m=(s-p)/v,g=a/v):(y=T(y),m=l/y,g=(u-p)/y),i=new w([[g,-m],[m,g]]),E.setRows(n,o,i.dot(E.getRows(n,o)))):(p=-.5*c,f=.5*T(-d),v=(s-p)*(s-p)+a*a,y=l*l+(u-p)*(u-p),v>y?(v=T(v+f*f),m=(s-p)/v,g=a/v,p=0,f/=v):(y=T(y+f*f),m=l/y,g=(u-p)/y,p=f/y,f=0),i=new w([[g,-m],[m,g]],[[p,f],[f,-p]]),E.setRows(n,o,i.dot(E.getRows(n,o))))}var C=E.dot(e).dot(E.transjugate()),P=(_=e.length,numeric.T.identity(_));for(o=0;o<_;o++)if(o>0)for(r=o-1;r>=0;r--){var R=C.get([r,r]),L=C.get([o,o]);numeric.neq(R.x,L.x)||numeric.neq(R.y,L.y)?(p=C.getRow(r).getBlock([r],[o-1]),f=P.getRow(o).getBlock([r],[o-1]),P.set([o,r],C.get([r,o]).neg().sub(p.dot(f)).div(R.sub(L)))):P.setRow(o,P.getRow(r))}for(o=0;o<_;o++)p=P.getRow(o),P.setRow(o,p.div(p.norm2()));return P=P.transpose(),P=E.transjugate().dot(P),{lambda:C.getDiag(),E:P}},numeric.ccsSparse=function(e){var t,n,r,i=e.length,o=[];for(n=i-1;-1!==n;--n)for(r in t=e[n],t){r=parseInt(r);while(r>=o.length)o[o.length]=0;0!==t[r]&&o[r]++}var s=o.length,a=Array(s+1);for(a[0]=0,n=0;n<s;++n)a[n+1]=a[n]+o[n];var l=Array(a[s]),u=Array(a[s]);for(n=i-1;-1!==n;--n)for(r in t=e[n],t)0!==t[r]&&(o[r]--,l[a[r]+o[r]]=n,u[a[r]+o[r]]=t[r]);return[a,l,u]},numeric.ccsFull=function(e){var t,n,r,i,o=e[0],s=e[1],a=e[2],l=numeric.ccsDim(e),u=l[0],c=l[1],h=numeric.rep([u,c],0);for(t=0;t<c;t++)for(r=o[t],i=o[t+1],n=r;n<i;++n)h[s[n]][t]=a[n];return h},numeric.ccsTSolve=function(e,t,n,r,i){var o,s,a,l,u,c,h,d=e[0],p=e[1],f=e[2],m=d.length-1,g=Math.max,v=0;function y(e){var t;if(0===n[e]){for(n[e]=1,t=d[e];t<d[e+1];++t)y(p[t]);i[v]=e,++v}}for("undefined"===typeof r&&(n=numeric.rep([m],0)),"undefined"===typeof r&&(r=numeric.linspace(0,n.length-1)),"undefined"===typeof i&&(i=[]),o=r.length-1;-1!==o;--o)y(r[o]);for(i.length=v,o=i.length-1;-1!==o;--o)n[i[o]]=0;for(o=r.length-1;-1!==o;--o)s=r[o],n[s]=t[s];for(o=i.length-1;-1!==o;--o){for(s=i[o],a=d[s],l=g(d[s+1],a),u=a;u!==l;++u)if(p[u]===s){n[s]/=f[u];break}for(h=n[s],u=a;u!==l;++u)c=p[u],c!==s&&(n[c]-=h*f[u])}return n},numeric.ccsDFS=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS.prototype.dfs=function(e,t,n,r,i,o){var s,a,l,u=0,c=i.length,h=this.k,d=this.k1,p=this.j;if(0===r[e]){r[e]=1,p[0]=e,h[0]=a=t[e],d[0]=l=t[e+1];while(1)if(a>=l){if(i[c]=p[u],0===u)return;++c,--u,a=h[u],l=d[u]}else s=o[n[a]],0===r[s]?(r[s]=1,h[u]=a,++u,p[u]=s,a=t[s],d[u]=l=t[s+1]):++a}},numeric.ccsLPSolve=function(e,t,n,r,i,o,s){var a,l,u,c,h,d,p,f,m,g=e[0],v=e[1],y=e[2],x=(g.length,t[0]),b=t[1],w=t[2];for(l=x[i],u=x[i+1],r.length=0,a=l;a<u;++a)s.dfs(o[b[a]],g,v,n,r,o);for(a=r.length-1;-1!==a;--a)n[r[a]]=0;for(a=l;a!==u;++a)c=o[b[a]],n[c]=w[a];for(a=r.length-1;-1!==a;--a){for(c=r[a],h=g[c],d=g[c+1],p=h;p<d;++p)if(o[v[p]]===c){n[c]/=y[p];break}for(m=n[c],p=h;p<d;++p)f=o[v[p]],f!==c&&(n[f]-=m*y[p])}return n},numeric.ccsLUP1=function(e,t){var n,r,i,o,s,a,l,u=e[0].length-1,c=[numeric.rep([u+1],0),[],[]],h=[numeric.rep([u+1],0),[],[]],d=c[0],p=c[1],f=c[2],m=h[0],g=h[1],v=h[2],y=numeric.rep([u],0),x=numeric.rep([u],0),b=numeric.ccsLPSolve,w=(Math.max,Math.abs),_=numeric.linspace(0,u-1),A=numeric.linspace(0,u-1),S=new numeric.ccsDFS(u);for("undefined"===typeof t&&(t=1),n=0;n<u;++n){for(b(c,e,y,x,n,A,S),o=-1,s=-1,r=x.length-1;-1!==r;--r)i=x[r],i<=n||(a=w(y[i]),a>o&&(s=i,o=a));for(w(y[n])<t*o&&(r=_[n],o=_[s],_[n]=o,A[o]=n,_[s]=r,A[r]=s,o=y[n],y[n]=y[s],y[s]=o),o=d[n],s=m[n],l=y[n],p[o]=_[n],f[o]=1,++o,r=x.length-1;-1!==r;--r)i=x[r],a=y[i],x[r]=0,y[i]=0,i<=n?(g[s]=i,v[s]=a,++s):(p[o]=_[i],f[o]=a/l,++o);d[n+1]=o,m[n+1]=s}for(r=p.length-1;-1!==r;--r)p[r]=A[p[r]];return{L:c,U:h,P:_,Pinv:A}},numeric.ccsDFS0=function(e){this.k=Array(e),this.k1=Array(e),this.j=Array(e)},numeric.ccsDFS0.prototype.dfs=function(e,t,n,r,i,o,s){var a,l,u,c=0,h=i.length,d=this.k,p=this.k1,f=this.j;if(0===r[e]){r[e]=1,f[0]=e,d[0]=l=t[o[e]],p[0]=u=t[o[e]+1];while(1){if(isNaN(l))throw new Error("Ow!");if(l>=u){if(i[h]=o[f[c]],0===c)return;++h,--c,l=d[c],u=p[c]}else a=n[l],0===r[a]?(r[a]=1,d[c]=l,++c,f[c]=a,a=o[a],l=t[a],p[c]=u=t[a+1]):++l}}},numeric.ccsLPSolve0=function(e,t,n,r,i,o,s,a){var l,u,c,h,d,p,f,m,g,v=e[0],y=e[1],x=e[2],b=(v.length,t[0]),w=t[1],_=t[2];for(u=b[i],c=b[i+1],r.length=0,l=u;l<c;++l)a.dfs(w[l],v,y,n,r,o,s);for(l=r.length-1;-1!==l;--l)h=r[l],n[s[h]]=0;for(l=u;l!==c;++l)h=w[l],n[h]=_[l];for(l=r.length-1;-1!==l;--l){for(h=r[l],m=s[h],d=v[h],p=v[h+1],f=d;f<p;++f)if(y[f]===m){n[m]/=x[f];break}for(g=n[m],f=d;f<p;++f)n[y[f]]-=g*x[f];n[m]=g}},numeric.ccsLUP0=function(e,t){var n,r,i,o,s,a,l,u=e[0].length-1,c=[numeric.rep([u+1],0),[],[]],h=[numeric.rep([u+1],0),[],[]],d=c[0],p=c[1],f=c[2],m=h[0],g=h[1],v=h[2],y=numeric.rep([u],0),x=numeric.rep([u],0),b=numeric.ccsLPSolve0,w=(Math.max,Math.abs),_=numeric.linspace(0,u-1),A=numeric.linspace(0,u-1),S=new numeric.ccsDFS0(u);for("undefined"===typeof t&&(t=1),n=0;n<u;++n){for(b(c,e,y,x,n,A,_,S),o=-1,s=-1,r=x.length-1;-1!==r;--r)i=x[r],i<=n||(a=w(y[_[i]]),a>o&&(s=i,o=a));for(w(y[_[n]])<t*o&&(r=_[n],o=_[s],_[n]=o,A[o]=n,_[s]=r,A[r]=s),o=d[n],s=m[n],l=y[_[n]],p[o]=_[n],f[o]=1,++o,r=x.length-1;-1!==r;--r)i=x[r],a=y[_[i]],x[r]=0,y[_[i]]=0,i<=n?(g[s]=i,v[s]=a,++s):(p[o]=_[i],f[o]=a/l,++o);d[n+1]=o,m[n+1]=s}for(r=p.length-1;-1!==r;--r)p[r]=A[p[r]];return{L:c,U:h,P:_,Pinv:A}},numeric.ccsLUP=numeric.ccsLUP0,numeric.ccsDim=function(e){return[numeric.sup(e[1])+1,e[0].length-1]},numeric.ccsGetBlock=function(e,t,n){var r=numeric.ccsDim(e),i=r[0],o=r[1];"undefined"===typeof t?t=numeric.linspace(0,i-1):"number"===typeof t&&(t=[t]),"undefined"===typeof n?n=numeric.linspace(0,o-1):"number"===typeof n&&(n=[n]);var s,a,l,u,c,h=t.length,d=n.length,p=numeric.rep([o],0),f=[],m=[],g=[p,f,m],v=e[0],y=e[1],x=e[2],b=numeric.rep([i],0),w=0,_=numeric.rep([i],0);for(a=0;a<d;++a){u=n[a];var A=v[u],S=v[u+1];for(s=A;s<S;++s)l=y[s],_[l]=1,b[l]=x[s];for(s=0;s<h;++s)c=t[s],_[c]&&(f[w]=s,m[w]=b[t[s]],++w);for(s=A;s<S;++s)l=y[s],_[l]=0;p[a+1]=w}return g},numeric.ccsDot=function(e,t){var n,r,i,o,s,a,l,u,c,h,d,p=e[0],f=e[1],m=e[2],g=t[0],v=t[1],y=t[2],x=numeric.ccsDim(e),b=numeric.ccsDim(t),w=x[0],_=(x[1],b[1]),A=numeric.rep([w],0),S=numeric.rep([w],0),E=Array(w),M=numeric.rep([_],0),T=[],C=[],P=[M,T,C];for(i=0;i!==_;++i){for(o=g[i],s=g[i+1],c=0,r=o;r<s;++r)for(h=v[r],d=y[r],a=p[h],l=p[h+1],n=a;n<l;++n)u=f[n],0===S[u]&&(E[c]=u,S[u]=1,c+=1),A[u]=A[u]+m[n]*d;for(o=M[i],s=o+c,M[i+1]=s,r=c-1;-1!==r;--r)d=o+r,n=E[r],T[d]=n,C[d]=A[n],S[n]=0,A[n]=0;M[i+1]=M[i]+c}return P},numeric.ccsLUPSolve=function(e,t){var n=e.L,r=e.U,i=(e.P,t[0]),o=!1;"object"!==typeof i&&(t=[[0,t.length],numeric.linspace(0,t.length-1),t],i=t[0],o=!0);var s,a,l,u,c,h,d=t[1],p=t[2],f=n[0].length-1,m=i.length-1,g=numeric.rep([f],0),v=Array(f),y=numeric.rep([f],0),x=Array(f),b=numeric.rep([m+1],0),w=[],_=[],A=numeric.ccsTSolve,S=0;for(s=0;s<m;++s){for(c=0,l=i[s],u=i[s+1],a=l;a<u;++a)h=e.Pinv[d[a]],x[c]=h,y[h]=p[a],++c;for(x.length=c,A(n,y,g,x,v),a=x.length-1;-1!==a;--a)y[x[a]]=0;if(A(r,g,y,v,x),o)return y;for(a=v.length-1;-1!==a;--a)g[v[a]]=0;for(a=x.length-1;-1!==a;--a)h=x[a],w[S]=h,_[S]=y[h],y[h]=0,++S;b[s+1]=S}return[b,w,_]},numeric.ccsbinop=function(e,t){return"undefined"===typeof t&&(t=""),Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\nvar Yi = Y[0], Yj = Y[1], Yv = Y[2];\nvar n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\nvar Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\nvar x = numeric.rep([m],0),y = numeric.rep([m],0);\nvar xk,yk,zk;\nvar i,j,j0,j1,k,p=0;\n"+t+"for(i=0;i<n;++i) {\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Xj[j];\n    x[k] = 1;\n    Zj[p] = k;\n    ++p;\n  }\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Yj[j];\n    y[k] = Yv[j];\n    if(x[k] === 0) {\n      Zj[p] = k;\n      ++p;\n    }\n  }\n  Zi[i+1] = p;\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n  j0 = Zi[i]; j1 = Zi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Zj[j];\n    xk = x[k];\n    yk = y[k];\n"+e+"\n    Zv[j] = zk;\n  }\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n}\nreturn [Zi,Zj,Zv];")},function(){var k,A,B,C;for(k in numeric.ops2)A=isFinite(eval("1"+numeric.ops2[k]+"0"))?"[Y[0],Y[1],numeric."+k+"(X,Y[2])]":"NaN",B=isFinite(eval("0"+numeric.ops2[k]+"1"))?"[X[0],X[1],numeric."+k+"(X[2],Y)]":"NaN",C=isFinite(eval("1"+numeric.ops2[k]+"0"))&&isFinite(eval("0"+numeric.ops2[k]+"1"))?"numeric.ccs"+k+"MM(X,Y)":"NaN",numeric["ccs"+k+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[k]+"yk;"),numeric["ccs"+k]=Function("X","Y",'if(typeof X === "number") return '+A+';\nif(typeof Y === "number") return '+B+";\nreturn "+C+";\n")}(),numeric.ccsScatter=function(e){var t,n=e[0],r=e[1],i=e[2],o=numeric.sup(r)+1,s=n.length,a=numeric.rep([o],0),l=Array(s),u=Array(s),c=numeric.rep([o],0);for(t=0;t<s;++t)c[r[t]]++;for(t=0;t<o;++t)a[t+1]=a[t]+c[t];var h,d,p=a.slice(0);for(t=0;t<s;++t)d=r[t],h=p[d],l[h]=n[t],u[h]=i[t],p[d]=p[d]+1;return[a,l,u]},numeric.ccsGather=function(e){var t,n,r,i,o,s=e[0],a=e[1],l=e[2],u=s.length-1,c=a.length,h=Array(c),d=Array(c),p=Array(c);for(o=0,t=0;t<u;++t)for(r=s[t],i=s[t+1],n=r;n!==i;++n)d[o]=t,h[o]=a[n],p[o]=l[n],++o;return[h,d,p]},numeric.sdim=function e(t,n,r){if("undefined"===typeof n&&(n=[]),"object"!==typeof t)return n;var i;for(i in"undefined"===typeof r&&(r=0),r in n||(n[r]=0),t.length>n[r]&&(n[r]=t.length),t)t.hasOwnProperty(i)&&e(t[i],n,r+1);return n},numeric.sclone=function e(t,n,r){"undefined"===typeof n&&(n=0),"undefined"===typeof r&&(r=numeric.sdim(t).length);var i,o=Array(t.length);if(n===r-1){for(i in t)t.hasOwnProperty(i)&&(o[i]=t[i]);return o}for(i in t)t.hasOwnProperty(i)&&(o[i]=e(t[i],n+1,r));return o},numeric.sdiag=function(e){var t,n,r=e.length,i=Array(r);for(t=r-1;t>=1;t-=2)n=t-1,i[t]=[],i[t][t]=e[t],i[n]=[],i[n][n]=e[n];return 0===t&&(i[0]=[],i[0][0]=e[t]),i},numeric.sidentity=function(e){return numeric.sdiag(numeric.rep([e],1))},numeric.stranspose=function(e){var t,n,r,i=[];e.length;for(t in e)if(e.hasOwnProperty(t))for(n in r=e[t],r)r.hasOwnProperty(n)&&("object"!==typeof i[n]&&(i[n]=[]),i[n][t]=r[n]);return i},numeric.sLUP=function(e,t){throw new Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.")},numeric.sdotMM=function(e,t){var n,r,i,o,s,a,l,u=e.length,c=(t.length,numeric.stranspose(t)),h=c.length,d=Array(u);for(i=u-1;i>=0;i--){for(l=[],n=e[i],s=h-1;s>=0;s--){for(o in a=0,r=c[s],n)n.hasOwnProperty(o)&&o in r&&(a+=n[o]*r[o]);a&&(l[s]=a)}d[i]=l}return d},numeric.sdotMV=function(e,t){var n,r,i,o,s=e.length,a=Array(s);for(r=s-1;r>=0;r--){for(i in n=e[r],o=0,n)n.hasOwnProperty(i)&&t[i]&&(o+=n[i]*t[i]);o&&(a[r]=o)}return a},numeric.sdotVM=function(e,t){var n,r,i,o,s=[];for(n in e)if(e.hasOwnProperty(n))for(r in i=t[n],o=e[n],i)i.hasOwnProperty(r)&&(s[r]||(s[r]=0),s[r]+=o*i[r]);return s},numeric.sdotVV=function(e,t){var n,r=0;for(n in e)e[n]&&t[n]&&(r+=e[n]*t[n]);return r},numeric.sdot=function(e,t){var n=numeric.sdim(e).length,r=numeric.sdim(t).length,i=1e3*n+r;switch(i){case 0:return e*t;case 1001:return numeric.sdotVV(e,t);case 2001:return numeric.sdotMV(e,t);case 1002:return numeric.sdotVM(e,t);case 2002:return numeric.sdotMM(e,t);default:throw new Error("numeric.sdot not implemented for tensors of order "+n+" and "+r)}},numeric.sscatter=function(e){var t,n,r,i,o=e[0].length,s=e.length,a=[];for(n=o-1;n>=0;--n)if(e[s-1][n]){for(i=a,r=0;r<s-2;r++)t=e[r][n],i[t]||(i[t]=[]),i=i[t];i[e[r][n]]=e[r+1][n]}return a},numeric.sgather=function e(t,n,r){var i,o,s;for(o in"undefined"===typeof n&&(n=[]),"undefined"===typeof r&&(r=[]),i=r.length,t)if(t.hasOwnProperty(o))if(r[i]=parseInt(o),s=t[o],"number"===typeof s){if(s){if(0===n.length)for(o=i+1;o>=0;--o)n[o]=[];for(o=i;o>=0;--o)n[o].push(r[o]);n[i+1].push(s)}}else e(s,n,r);return r.length>i&&r.pop(),n},numeric.cLU=function(e){var t,n,r,i,o,s,a=e[0],l=e[1],u=e[2],c=a.length,h=0;for(t=0;t<c;t++)a[t]>h&&(h=a[t]);h++;var d,p=Array(h),f=Array(h),m=numeric.rep([h],1/0),g=numeric.rep([h],-1/0);for(r=0;r<c;r++)t=a[r],n=l[r],n<m[t]&&(m[t]=n),n>g[t]&&(g[t]=n);for(t=0;t<h-1;t++)g[t]>g[t+1]&&(g[t+1]=g[t]);for(t=h-1;t>=1;t--)m[t]<m[t-1]&&(m[t-1]=m[t]);for(t=0;t<h;t++)f[t]=numeric.rep([g[t]-m[t]+1],0),p[t]=numeric.rep([t-m[t]],0),t-m[t]+1,g[t]-t+1;for(r=0;r<c;r++)t=a[r],f[t][l[r]-m[t]]=u[r];for(t=0;t<h-1;t++)for(i=t-m[t],x=f[t],n=t+1;m[n]<=t&&n<h;n++)if(o=t-m[n],s=g[t]-t,b=f[n],d=b[o]/x[i],d){for(r=1;r<=s;r++)b[r+o]-=d*x[r+i];p[n][t-m[n]]=d}var v,y,x=[],b=[],w=[],_=[],A=[],S=[];for(c=0,v=0,t=0;t<h;t++){for(i=m[t],o=g[t],y=f[t],n=t;n<=o;n++)y[n-i]&&(x[c]=t,b[c]=n,w[c]=y[n-i],c++);for(y=p[t],n=i;n<t;n++)y[n-i]&&(_[v]=t,A[v]=n,S[v]=y[n-i],v++);_[v]=t,A[v]=t,S[v]=1,v++}return{U:[x,b,w],L:[_,A,S]}},numeric.cLUsolve=function(e,t){var n,r,i=e.L,o=e.U,s=numeric.clone(t),a=i[0],l=i[1],u=i[2],c=o[0],h=o[1],d=o[2],p=c.length,f=(a.length,s.length);for(r=0,n=0;n<f;n++){while(l[r]<n)s[n]-=u[r]*s[l[r]],r++;r++}for(r=p-1,n=f-1;n>=0;n--){while(h[r]>n)s[n]-=d[r]*s[h[r]],r--;s[n]/=d[r],r--}return s},numeric.cgrid=function(e,t){"number"===typeof e&&(e=[e,e]);var n,r,i,o=numeric.rep(e,-1);if("function"!==typeof t)switch(t){case"L":t=function(t,n){return t>=e[0]/2||n<e[1]/2};break;default:t=function(e,t){return!0};break}for(i=0,n=1;n<e[0]-1;n++)for(r=1;r<e[1]-1;r++)t(n,r)&&(o[n][r]=i,i++);return o},numeric.cdelsq=function(e){var t,n,r,i,o,s=[[-1,0],[0,-1],[0,1],[1,0]],a=numeric.dim(e),l=a[0],u=a[1],c=[],h=[],d=[];for(t=1;t<l-1;t++)for(n=1;n<u-1;n++)if(!(e[t][n]<0)){for(r=0;r<4;r++)i=t+s[r][0],o=n+s[r][1],e[i][o]<0||(c.push(e[t][n]),h.push(e[i][o]),d.push(-1));c.push(e[t][n]),h.push(e[t][n]),d.push(4)}return[c,h,d]},numeric.cdotMV=function(e,t){var n,r,i,o=e[0],s=e[1],a=e[2],l=o.length;for(i=0,r=0;r<l;r++)o[r]>i&&(i=o[r]);for(i++,n=numeric.rep([i],0),r=0;r<l;r++)n[o[r]]+=a[r]*t[s[r]];return n},numeric.Spline=function(e,t,n,r,i){this.x=e,this.yl=t,this.yr=n,this.kl=r,this.kr=i},numeric.Spline.prototype._at=function(e,t){var n,r,i,o=this.x,s=this.yl,a=this.yr,l=this.kl,u=this.kr,c=numeric.add,h=numeric.sub,d=numeric.mul;n=h(d(l[t],o[t+1]-o[t]),h(a[t+1],s[t])),r=c(d(u[t+1],o[t]-o[t+1]),h(a[t+1],s[t])),i=(e-o[t])/(o[t+1]-o[t]);var p=i*(1-i);return c(c(c(d(1-i,s[t]),d(i,a[t+1])),d(n,p*(1-i))),d(r,p*i))},numeric.Spline.prototype.at=function(e){if("number"===typeof e){var t,n,r,i=this.x,o=i.length,s=Math.floor;t=0,n=o-1;while(n-t>1)r=s((t+n)/2),i[r]<=e?t=r:n=r;return this._at(e,t)}o=e.length;var a,l=Array(o);for(a=o-1;-1!==a;--a)l[a]=this.at(e[a]);return l},numeric.Spline.prototype.diff=function(){var e,t,n,r=this.x,i=this.yl,o=this.yr,s=this.kl,a=this.kr,l=i.length,u=s,c=a,h=Array(l),d=Array(l),p=numeric.add,f=numeric.mul,m=numeric.div,g=numeric.sub;for(e=l-1;-1!==e;--e)t=r[e+1]-r[e],n=g(o[e+1],i[e]),h[e]=m(p(f(n,6),f(s[e],-4*t),f(a[e+1],-2*t)),t*t),d[e+1]=m(p(f(n,-6),f(s[e],2*t),f(a[e+1],4*t)),t*t);return new numeric.Spline(r,u,c,h,d)},numeric.Spline.prototype.roots=function(){function e(e){return e*e}var t=[],n=this.x,r=this.yl,i=this.yr,o=this.kl,s=this.kr;"number"===typeof r[0]&&(r=[r],i=[i],o=[o],s=[s]);var a,l,u,c,h,d,p,f,m,g,v,y,x,b,w,_,A,S,E,M,T,C,P,R=r.length,L=n.length-1,O=(t=Array(R),Math.sqrt);for(a=0;a!==R;++a){for(c=r[a],h=i[a],d=o[a],p=s[a],f=[],l=0;l!==L;l++){for(l>0&&h[l]*c[l]<0&&f.push(n[l]),_=n[l+1]-n[l],n[l],v=c[l],y=h[l+1],m=d[l]/_,g=p[l+1]/_,w=e(m-g+3*(v-y))+12*g*v,x=g+3*v+2*m-3*y,b=3*(g+m+2*(v-y)),w<=0?(S=x/b,A=S>n[l]&&S<n[l+1]?[n[l],S,n[l+1]]:[n[l],n[l+1]]):(S=(x-O(w))/b,E=(x+O(w))/b,A=[n[l]],S>n[l]&&S<n[l+1]&&A.push(S),E>n[l]&&E<n[l+1]&&A.push(E),A.push(n[l+1])),T=A[0],S=this._at(T,l),u=0;u<A.length-1;u++)if(C=A[u+1],E=this._at(C,l),0!==S)if(0===E||S*E>0)T=C,S=E;else{var D=0;while(1){if(P=(S*C-E*T)/(S-E),P<=T||P>=C)break;if(M=this._at(P,l),M*E>0)C=P,E=M,-1===D&&(S*=.5),D=-1;else{if(!(M*S>0))break;T=P,S=M,1===D&&(E*=.5),D=1}}f.push(P),T=A[u+1],S=this._at(T,l)}else f.push(T),T=C,S=E;0===E&&f.push(C)}t[a]=f}return"number"===typeof this.yl[0]?t[0]:t},numeric.spline=function(e,t,n,r){var i,o=e.length,s=[],a=[],l=[],u=numeric.sub,c=numeric.mul,h=numeric.add;for(i=o-2;i>=0;i--)a[i]=e[i+1]-e[i],l[i]=u(t[i+1],t[i]);"string"!==typeof n&&"string"!==typeof r||(n=r="periodic");var d=[[],[],[]];switch(typeof n){case"undefined":s[0]=c(3/(a[0]*a[0]),l[0]),d[0].push(0,0),d[1].push(0,1),d[2].push(2/a[0],1/a[0]);break;case"string":s[0]=h(c(3/(a[o-2]*a[o-2]),l[o-2]),c(3/(a[0]*a[0]),l[0])),d[0].push(0,0,0),d[1].push(o-2,0,1),d[2].push(1/a[o-2],2/a[o-2]+2/a[0],1/a[0]);break;default:s[0]=n,d[0].push(0),d[1].push(0),d[2].push(1);break}for(i=1;i<o-1;i++)s[i]=h(c(3/(a[i-1]*a[i-1]),l[i-1]),c(3/(a[i]*a[i]),l[i])),d[0].push(i,i,i),d[1].push(i-1,i,i+1),d[2].push(1/a[i-1],2/a[i-1]+2/a[i],1/a[i]);switch(typeof r){case"undefined":s[o-1]=c(3/(a[o-2]*a[o-2]),l[o-2]),d[0].push(o-1,o-1),d[1].push(o-2,o-1),d[2].push(1/a[o-2],2/a[o-2]);break;case"string":d[1][d[1].length-1]=0;break;default:s[o-1]=r,d[0].push(o-1),d[1].push(o-1),d[2].push(1);break}s="number"!==typeof s[0]?numeric.transpose(s):[s];var p=Array(s.length);if("string"===typeof n)for(i=p.length-1;-1!==i;--i)p[i]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(d)),s[i]),p[i][o-1]=p[i][0];else for(i=p.length-1;-1!==i;--i)p[i]=numeric.cLUsolve(numeric.cLU(d),s[i]);return p="number"===typeof t[0]?p[0]:numeric.transpose(p),new numeric.Spline(e,t,t,p,p)},numeric.fftpow2=function e(t,n){var r=t.length;if(1!==r){var i,o,s=Math.cos,a=Math.sin,l=Array(r/2),u=Array(r/2),c=Array(r/2),h=Array(r/2);for(o=r/2,i=r-1;-1!==i;--i)--o,c[o]=t[i],h[o]=n[i],--i,l[o]=t[i],u[o]=n[i];e(l,u),e(c,h),o=r/2;var d,p,f,m=-6.283185307179586/r;for(i=r-1;-1!==i;--i)--o,-1===o&&(o=r/2-1),d=m*i,p=s(d),f=a(d),t[i]=l[o]+p*c[o]-f*h[o],n[i]=u[o]+p*h[o]+f*c[o]}},numeric._ifftpow2=function e(t,n){var r=t.length;if(1!==r){var i,o,s=Math.cos,a=Math.sin,l=Array(r/2),u=Array(r/2),c=Array(r/2),h=Array(r/2);for(o=r/2,i=r-1;-1!==i;--i)--o,c[o]=t[i],h[o]=n[i],--i,l[o]=t[i],u[o]=n[i];e(l,u),e(c,h),o=r/2;var d,p,f,m=6.283185307179586/r;for(i=r-1;-1!==i;--i)--o,-1===o&&(o=r/2-1),d=m*i,p=s(d),f=a(d),t[i]=l[o]+p*c[o]-f*h[o],n[i]=u[o]+p*h[o]+f*c[o]}},numeric.ifftpow2=function(e,t){numeric._ifftpow2(e,t),numeric.diveq(e,e.length),numeric.diveq(t,t.length)},numeric.convpow2=function(e,t,n,r){numeric.fftpow2(e,t),numeric.fftpow2(n,r);var i,o,s,a,l,u=e.length;for(i=u-1;-1!==i;--i)o=e[i],a=t[i],s=n[i],l=r[i],e[i]=o*s-a*l,t[i]=o*l+a*s;numeric.ifftpow2(e,t)},numeric.T.prototype.fft=function(){var e,t,n=this.x,r=this.y,i=n.length,o=Math.log,s=o(2),a=Math.ceil(o(2*i-1)/s),l=Math.pow(2,a),u=numeric.rep([l],0),c=numeric.rep([l],0),h=Math.cos,d=Math.sin,p=-3.141592653589793/i,f=numeric.rep([l],0),m=numeric.rep([l],0);Math.floor(i/2);for(e=0;e<i;e++)f[e]=n[e];if("undefined"!==typeof r)for(e=0;e<i;e++)m[e]=r[e];for(u[0]=1,e=1;e<=l/2;e++)t=p*e*e,u[e]=h(t),c[e]=d(t),u[l-e]=h(t),c[l-e]=d(t);var g=new numeric.T(f,m),v=new numeric.T(u,c);return g=g.mul(v),numeric.convpow2(g.x,g.y,numeric.clone(v.x),numeric.neg(v.y)),g=g.mul(v),g.x.length=i,g.y.length=i,g},numeric.T.prototype.ifft=function(){var e,t,n=this.x,r=this.y,i=n.length,o=Math.log,s=o(2),a=Math.ceil(o(2*i-1)/s),l=Math.pow(2,a),u=numeric.rep([l],0),c=numeric.rep([l],0),h=Math.cos,d=Math.sin,p=3.141592653589793/i,f=numeric.rep([l],0),m=numeric.rep([l],0);Math.floor(i/2);for(e=0;e<i;e++)f[e]=n[e];if("undefined"!==typeof r)for(e=0;e<i;e++)m[e]=r[e];for(u[0]=1,e=1;e<=l/2;e++)t=p*e*e,u[e]=h(t),c[e]=d(t),u[l-e]=h(t),c[l-e]=d(t);var g=new numeric.T(f,m),v=new numeric.T(u,c);return g=g.mul(v),numeric.convpow2(g.x,g.y,numeric.clone(v.x),numeric.neg(v.y)),g=g.mul(v),g.x.length=i,g.y.length=i,g.div(i)},numeric.gradient=function(e,t){var n=t.length,r=e(t);if(isNaN(r))throw new Error("gradient: f(x) is a NaN!");var i,o,s,a,l,u,c,h,d,p,f=Math.max,m=numeric.clone(t),g=Array(n),v=(numeric.div,numeric.sub,f=Math.max,.001),y=Math.abs,x=Math.min,b=0;for(i=0;i<n;i++){var w=f(1e-6*r,1e-8);while(1){if(++b,b>20)throw new Error("Numerical gradient fails");if(m[i]=t[i]+w,o=e(m),m[i]=t[i]-w,s=e(m),m[i]=t[i],isNaN(o)||isNaN(s))w/=16;else{if(g[i]=(o-s)/(2*w),l=t[i]-w,u=t[i],c=t[i]+w,h=(o-r)/w,d=(r-s)/w,p=f(y(g[i]),y(r),y(o),y(s),y(l),y(u),y(c),1e-8),a=x(f(y(h-g[i]),y(d-g[i]),y(h-d))/p,w/p),!(a>v))break;w/=16}}}return g},numeric.uncmin=function(e,t,n,r,i,o,s){var a=numeric.gradient;"undefined"===typeof s&&(s={}),"undefined"===typeof n&&(n=1e-8),"undefined"===typeof r&&(r=function(t){return a(e,t)}),"undefined"===typeof i&&(i=1e3),t=numeric.clone(t);var l,u,c=t.length,h=e(t);if(isNaN(h))throw new Error("uncmin: f(x0) is a NaN!");var d=Math.max,p=numeric.norm2;n=d(n,numeric.epsilon);var f,m,g,v,y,x,b,w,_,A,S=s.Hinv||numeric.identity(c),E=numeric.dot,M=(numeric.inv,numeric.sub),T=numeric.add,C=numeric.tensor,P=numeric.div,R=numeric.mul,L=numeric.all,O=numeric.isFinite,D=numeric.neg,I=0,k="";m=r(t);while(I<i){if("function"===typeof o&&o(I,t,h,m,S)){k="Callback returned true";break}if(!L(O(m))){k="Gradient has Infinity or NaN";break}if(f=D(E(S,m)),!L(O(f))){k="Search direction has Infinity or NaN";break}if(A=p(f),A<n){k="Newton step smaller than tol";break}_=1,u=E(m,f),y=t;while(I<i){if(_*A<n)break;if(v=R(f,_),y=T(t,v),l=e(y),!(l-h>=.1*_*u||isNaN(l)))break;_*=.5,++I}if(_*A<n){k="Line search step size smaller than tol";break}if(I===i){k="maxit reached during line search";break}g=r(y),x=M(g,m),w=E(x,v),b=E(S,x),S=M(T(S,R((w+E(x,b))/(w*w),C(v,v))),P(T(C(b,v),C(v,b)),w)),t=y,h=l,m=g,++I}return{solution:t,f:h,gradient:m,invHessian:S,iterations:I,message:k}},numeric.Dopri=function(e,t,n,r,i,o,s){this.x=e,this.y=t,this.f=n,this.ymid=r,this.iterations=i,this.events=s,this.message=o},numeric.Dopri.prototype._at=function(e,t){function n(e){return e*e}var r,i,o,s,a,l,u,c,h,d,p=this,f=p.x,m=p.y,g=p.f,v=p.ymid,y=(f.length,Math.floor,.5),x=numeric.add,b=numeric.mul,w=numeric.sub;return r=f[t],i=f[t+1],s=m[t],a=m[t+1],u=i-r,o=r+y*u,l=v[t],c=w(g[t],b(s,1/(r-o)+2/(r-i))),h=w(g[t+1],b(a,1/(i-o)+2/(i-r))),d=[n(e-i)*(e-o)/n(r-i)/(r-o),n(e-r)*n(e-i)/n(r-o)/n(i-o),n(e-r)*(e-o)/n(i-r)/(i-o),(e-r)*n(e-i)*(e-o)/n(r-i)/(r-o),(e-i)*n(e-r)*(e-o)/n(r-i)/(i-o)],x(x(x(x(b(s,d[0]),b(l,d[1])),b(a,d[2])),b(c,d[3])),b(h,d[4]))},numeric.Dopri.prototype.at=function(e){var t,n,r,i=Math.floor;if("number"!==typeof e){var o=e.length,s=Array(o);for(t=o-1;-1!==t;--t)s[t]=this.at(e[t]);return s}var a=this.x;t=0,n=a.length-1;while(n-t>1)r=i(.5*(t+n)),a[r]<=e?t=r:n=r;return this._at(e,t)},numeric.dopri=function(e,t,n,r,i,o,s){"undefined"===typeof i&&(i=1e-6),"undefined"===typeof o&&(o=1e3);var a,l,u,c,h,d,p,f,m,g,v,y,x,b=[e],w=[n],_=[r(e,n)],A=[],S=.2,E=[3/40,9/40],M=[44/45,-56/15,32/9],T=[19372/6561,-25360/2187,64448/6561,-212/729],C=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],P=[35/384,0,500/1113,125/192,-2187/6784,11/84],R=[.10013431883002395,0,.3918321794184259,-.02982460176594817,.05893268337240795,-.04497888809104361,5618549.5/235043384],L=[.2,.3,.8,8/9,1,1],O=[-71/57600,0,71/16695,-71/1920,17253/339200,-22/525,1/40],D=0,I=(t-e)/10,k=0,N=numeric.add,F=numeric.mul,V=(Math.max,Math.min),z=Math.abs,U=numeric.norminf,j=Math.pow,B=numeric.any,H=numeric.lt,G=numeric.and,q=(numeric.sub,new numeric.Dopri(b,w,_,A,-1,""));"function"===typeof s&&(v=s(e,n));while(e<t&&k<o)if(++k,e+I>t&&(I=t-e),a=r(e+L[0]*I,N(n,F(S*I,_[D]))),l=r(e+L[1]*I,N(N(n,F(E[0]*I,_[D])),F(E[1]*I,a))),u=r(e+L[2]*I,N(N(N(n,F(M[0]*I,_[D])),F(M[1]*I,a)),F(M[2]*I,l))),c=r(e+L[3]*I,N(N(N(N(n,F(T[0]*I,_[D])),F(T[1]*I,a)),F(T[2]*I,l)),F(T[3]*I,u))),h=r(e+L[4]*I,N(N(N(N(N(n,F(C[0]*I,_[D])),F(C[1]*I,a)),F(C[2]*I,l)),F(C[3]*I,u)),F(C[4]*I,c))),m=N(N(N(N(N(n,F(_[D],I*P[0])),F(l,I*P[2])),F(u,I*P[3])),F(c,I*P[4])),F(h,I*P[5])),d=r(e+I,m),p=N(N(N(N(N(F(_[D],I*O[0]),F(l,I*O[2])),F(u,I*O[3])),F(c,I*O[4])),F(h,I*O[5])),F(d,I*O[6])),g="number"===typeof p?z(p):U(p),g>i){if(I=.2*I*j(i/g,.25),e+I===e){q.msg="Step size became too small";break}}else{if(A[D]=N(N(N(N(N(N(n,F(_[D],I*R[0])),F(l,I*R[2])),F(u,I*R[3])),F(c,I*R[4])),F(h,I*R[5])),F(d,I*R[6])),++D,b[D]=e+I,w[D]=m,_[D]=d,"function"===typeof s){var W,$,X=e,Y=e+.5*I;if(y=s(Y,A[D-1]),x=G(H(v,0),H(0,y)),B(x)||(X=Y,Y=e+I,v=y,y=s(Y,m),x=G(H(v,0),H(0,y))),B(x)){var Z,J,Q=0,K=1,ee=1;while(1){if("number"===typeof v)$=(ee*y*X-K*v*Y)/(ee*y-K*v);else for($=Y,f=v.length-1;-1!==f;--f)v[f]<0&&y[f]>0&&($=V($,(ee*y[f]*X-K*v[f]*Y)/(ee*y[f]-K*v[f])));if($<=X||$>=Y)break;W=q._at($,D-1),J=s($,W),Z=G(H(v,0),H(0,J)),B(Z)?(Y=$,y=J,x=Z,ee=1,-1===Q?K*=.5:K=1,Q=-1):(X=$,v=J,K=1,1===Q?ee*=.5:ee=1,Q=1)}return m=q._at(.5*(e+$),D-1),q.f[D]=r($,W),q.x[D]=$,q.y[D]=W,q.ymid[D-1]=m,q.events=x,q.iterations=k,q}}e+=I,n=m,v=y,I=V(.8*I*j(i/g,.25),4*I)}return q.iterations=k,q},numeric.LU=function(e,t){t=t||!1;var n,r,i,o,s,a,l,u,c,h=Math.abs,d=e.length,p=d-1,f=new Array(d);for(t||(e=numeric.clone(e)),i=0;i<d;++i){for(l=i,a=e[i],c=h(a[i]),r=i+1;r<d;++r)o=h(e[r][i]),c<o&&(c=o,l=r);for(f[i]=l,l!=i&&(e[i]=e[l],e[l]=a,a=e[i]),s=a[i],n=i+1;n<d;++n)e[n][i]/=s;for(n=i+1;n<d;++n){for(u=e[n],r=i+1;r<p;++r)u[r]-=u[i]*a[r],++r,u[r]-=u[i]*a[r];r===p&&(u[r]-=u[i]*a[r])}}return{LU:e,P:f}},numeric.LUsolve=function(e,t){var n,r,i,o,s,a=e.LU,l=a.length,u=numeric.clone(t),c=e.P;for(n=l-1;-1!==n;--n)u[n]=t[n];for(n=0;n<l;++n)for(i=c[n],c[n]!==n&&(s=u[n],u[n]=u[i],u[i]=s),o=a[n],r=0;r<n;++r)u[n]-=u[r]*o[r];for(n=l-1;n>=0;--n){for(o=a[n],r=n+1;r<l;++r)u[n]-=u[r]*o[r];u[n]/=o[n]}return u},numeric.solve=function(e,t,n){return numeric.LUsolve(numeric.LU(e,n),t)},numeric.echelonize=function(e){var t,n,r,i,o,s,a,l,u=numeric.dim(e),c=u[0],h=u[1],d=numeric.identity(c),p=Array(c),f=Math.abs,m=numeric.diveq;for(e=numeric.clone(e),t=0;t<c;++t){for(r=0,o=e[t],s=d[t],n=1;n<h;++n)f(o[r])<f(o[n])&&(r=n);for(p[t]=r,m(s,o[r]),m(o,o[r]),n=0;n<c;++n)if(n!==t){for(a=e[n],l=a[r],i=h-1;-1!==i;--i)a[i]-=o[i]*l;for(a=d[n],i=c-1;-1!==i;--i)a[i]-=s[i]*l}}return{I:d,A:e,P:p}},numeric.__solveLP=function(e,t,n,r,i,o,s){var a,l,u,c,h=numeric.sum,d=(numeric.log,numeric.mul),p=numeric.sub,f=numeric.dot,m=numeric.div,g=numeric.add,v=e.length,y=n.length,x=!1,b=0,w=1,_=(numeric.transpose(t),numeric.svd,numeric.transpose),A=(numeric.leq,Math.sqrt),S=Math.abs,E=(numeric.muleq,numeric.norminf,numeric.any,Math.min),M=numeric.all,T=numeric.gt,C=Array(v),P=Array(y),R=(numeric.rep([y],1),numeric.solve),L=p(n,f(t,o)),O=f(e,e);for(u=b;u<i;++u){var D,I;for(D=y-1;-1!==D;--D)P[D]=m(t[D],L[D]);var k=_(P);for(D=v-1;-1!==D;--D)C[D]=h(k[D]);w=.25*S(O/f(e,C));var N=100*A(O/f(C,C));for((!isFinite(w)||w>N)&&(w=N),c=g(e,d(w,C)),l=f(k,P),D=v-1;-1!==D;--D)l[D][D]+=1;I=R(l,m(c,w),!0);var F=m(L,f(t,I)),V=1;for(D=y-1;-1!==D;--D)F[D]<0&&(V=E(V,-.999*F[D]));if(a=p(o,d(I,V)),L=p(n,f(t,a)),!M(T(L,0)))return{solution:o,message:"",iterations:u};if(o=a,w<r)return{solution:a,message:"",iterations:u};if(s){var z=f(e,c),U=f(t,c);for(x=!0,D=y-1;-1!==D;--D)if(z*U[D]<0){x=!1;break}}else x=!(o[v-1]>=0);if(x)return{solution:a,message:"Unbounded",iterations:u}}return{solution:o,message:"maximum iteration count exceeded",iterations:u}},numeric._solveLP=function(e,t,n,r,i){var o=e.length,s=n.length,a=(numeric.sum,numeric.log,numeric.mul,numeric.sub),l=numeric.dot,u=(numeric.div,numeric.add,numeric.rep([o],0).concat([1])),c=numeric.rep([s,1],-1),h=numeric.blockMatrix([[t,c]]),d=n,p=numeric.rep([o],0).concat(Math.max(0,numeric.sup(numeric.neg(n)))+1),f=numeric.__solveLP(u,h,d,r,i,p,!1),m=numeric.clone(f.solution);m.length=o;var g=numeric.inf(a(n,l(t,m)));if(g<0)return{solution:NaN,message:"Infeasible",iterations:f.iterations};var v=numeric.__solveLP(e,t,n,r,i-f.iterations,m,!0);return v.iterations+=f.iterations,v},numeric.solveLP=function(e,t,n,r,i,o,s){if("undefined"===typeof s&&(s=1e3),"undefined"===typeof o&&(o=numeric.epsilon),"undefined"===typeof r)return numeric._solveLP(e,t,n,o,s);var a,l=r.length,u=r[0].length,c=t.length,h=numeric.echelonize(r),d=numeric.rep([u],0),p=h.P,f=[];for(a=p.length-1;-1!==a;--a)d[p[a]]=1;for(a=u-1;-1!==a;--a)0===d[a]&&f.push(a);var m=numeric.getRange,g=numeric.linspace(0,l-1),v=numeric.linspace(0,c-1),y=m(r,g,f),x=m(t,v,p),b=m(t,v,f),w=numeric.dot,_=numeric.sub,A=w(x,h.I),S=_(b,w(A,y)),E=_(n,w(A,i)),M=Array(p.length),T=Array(f.length);for(a=p.length-1;-1!==a;--a)M[a]=e[p[a]];for(a=f.length-1;-1!==a;--a)T[a]=e[f[a]];var C=_(T,w(M,w(h.I,y))),P=numeric._solveLP(C,S,E,o,s),R=P.solution;if(R!==R)return P;var L=w(h.I,_(i,w(y,R))),O=Array(e.length);for(a=p.length-1;-1!==a;--a)O[p[a]]=L[a];for(a=f.length-1;-1!==a;--a)O[f[a]]=R[a];return{solution:O,message:P.message,iterations:P.iterations}},numeric.MPStoLP=function(e){e instanceof String&&e.split("\n");var t,n,r,i,o=0,s=["Initial state","NAME","ROWS","COLUMNS","RHS","BOUNDS","ENDATA"],a=e.length,l=0,u={},c=[],h=0,d={},p=0,f=[],m=[],g=[];function v(n){throw new Error("MPStoLP: "+n+"\nLine "+t+": "+e[t]+"\nCurrent state: "+s[o]+"\n")}for(t=0;t<a;++t){r=e[t];var y=r.match(/\S*/g),x=[];for(n=0;n<y.length;++n)""!==y[n]&&x.push(y[n]);if(0!==x.length){for(n=0;n<s.length;++n)if(r.substr(0,s[n].length)===s[n])break;if(n<s.length){if(o=n,1===n&&(i=x[1]),6===n)return{name:i,c:f,A:numeric.transpose(m),b:g,rows:u,vars:d}}else switch(o){case 0:case 1:v("Unexpected line");case 2:switch(x[0]){case"N":0===l?l=x[1]:v("Two or more N rows");break;case"L":u[x[1]]=h,c[h]=1,g[h]=0,++h;break;case"G":u[x[1]]=h,c[h]=-1,g[h]=0,++h;break;case"E":u[x[1]]=h,c[h]=0,g[h]=0,++h;break;default:v("Parse error "+numeric.prettyPrint(x))}break;case 3:d.hasOwnProperty(x[0])||(d[x[0]]=p,f[p]=0,m[p]=numeric.rep([h],0),++p);var b=d[x[0]];for(n=1;n<x.length;n+=2)if(x[n]!==l){var w=u[x[n]];m[b][w]=(c[w]<0?-1:1)*parseFloat(x[n+1])}else f[b]=parseFloat(x[n+1]);break;case 4:for(n=1;n<x.length;n+=2)g[u[x[n]]]=(c[u[x[n]]]<0?-1:1)*parseFloat(x[n+1]);break;case 5:break;case 6:v("Internal error")}}}v("Reached end of file without ENDATA")},numeric.seedrandom={pow:Math.pow,random:Math.random},function(e,t,n,r,i,o,s){function a(e){var t,r,i=this,o=e.length,s=0,a=i.i=i.j=i.m=0;i.S=[],i.c=[],o||(e=[o++]);while(s<n)i.S[s]=s++;for(s=0;s<n;s++)t=i.S[s],a=c(a+t+e[s%o]),r=i.S[a],i.S[s]=r,i.S[a]=t;i.g=function(e){var t=i.S,r=c(i.i+1),o=t[r],s=c(i.j+o),a=t[s];t[r]=a,t[s]=o;var l=t[c(o+a)];while(--e)r=c(r+1),o=t[r],s=c(s+o),a=t[s],t[r]=a,t[s]=o,l=l*n+t[c(o+a)];return i.i=r,i.j=s,l},i.g(n)}function l(e,t,n,r,i){if(n=[],i=typeof e,t&&"object"==i)for(r in e)if(r.indexOf("S")<5)try{n.push(l(e[r],t-1))}catch(o){}return n.length?n:e+("string"!=i?"\0":"")}function u(e,t,n,r){for(e+="",n=0,r=0;r<e.length;r++)t[c(r)]=c((n^=19*t[c(r)])+e.charCodeAt(r));for(r in e="",t)e+=String.fromCharCode(t[r]);return e}function c(e){return e&n-1}t["seedrandom"]=function(c,h){var d,p=[];return c=u(l(h?[c,e]:arguments.length?c:[(new Date).getTime(),e,window],3),p),d=new a(p),u(d.S,e),t["random"]=function(){var e=d.g(r),t=s,a=0;while(e<i)e=(e+a)*n,t*=n,a=d.g(1);while(e>=o)e/=2,t/=2,a>>>=1;return(e+a)/t},c},s=t.pow(n,r),i=t.pow(2,i),o=2*i,u(t.random(),e)}([],numeric.seedrandom,256,6,52),function(e){function t(e){if("object"!==typeof e)return e;var n,r=[],i=e.length;for(n=0;n<i;n++)r[n+1]=t(e[n]);return r}function n(e){if("object"!==typeof e)return e;var t,r=[],i=e.length;for(t=1;t<i;t++)r[t-1]=n(e[t]);return r}function r(e,t,n){var r,i,o,s,a;for(o=1;o<=n;o+=1){for(e[o][o]=1/e[o][o],a=-e[o][o],r=1;r<o;r+=1)e[r][o]=a*e[r][o];if(s=o+1,n<s)break;for(i=s;i<=n;i+=1)for(a=e[o][i],e[o][i]=0,r=1;r<=o;r+=1)e[r][i]=e[r][i]+a*e[r][o]}}function i(e,t,n,r){var i,o,s,a;for(o=1;o<=n;o+=1){for(a=0,i=1;i<o;i+=1)a+=e[i][o]*r[i];r[o]=(r[o]-a)/e[o][o]}for(s=1;s<=n;s+=1)for(o=n+1-s,r[o]=r[o]/e[o][o],a=-r[o],i=1;i<o;i+=1)r[i]=r[i]+a*e[i][o]}function o(e,t,n,r){var i,o,s,a,l,u;for(o=1;o<=n;o+=1){if(r[1]=o,u=0,s=o-1,s<1){if(u=e[o][o]-u,u<=0)break;e[o][o]=Math.sqrt(u)}else{for(a=1;a<=s;a+=1){for(l=e[a][o],i=1;i<a;i+=1)l-=e[i][o]*e[i][a];l/=e[a][a],e[a][o]=l,u+=l*l}if(u=e[o][o]-u,u<=0)break;e[o][o]=Math.sqrt(u)}r[1]=0}}function s(e,t,n,s,a,l,u,c,h,d,p,f,m,g,v,y){var x,b,w,_,A,S,E,M,T,C,P,R,L,O,D,I,k,N,F,V,z,U,j,B,H,G,q;L=Math.min(s,d),w=2*s+L*(L+5)/2+2*d+1,B=1e-60;do{B+=B,H=1+.1*B,G=1+.2*B}while(H<=1||G<=1);for(x=1;x<=s;x+=1)v[x]=t[x];for(x=s+1;x<=w;x+=1)v[x]=0;for(x=1;x<=d;x+=1)f[x]=0;if(A=[],0===y[1]){if(o(e,n,s,A),0!==A[1])return void(y[1]=2);i(e,n,s,t),r(e,n,s)}else{for(b=1;b<=s;b+=1)for(a[b]=0,x=1;x<=b;x+=1)a[b]=a[b]+e[x][b]*t[x];for(b=1;b<=s;b+=1)for(t[b]=0,x=b;x<=s;x+=1)t[b]=t[b]+e[b][x]*a[x]}for(l[1]=0,b=1;b<=s;b+=1)for(a[b]=t[b],l[1]=l[1]+v[b]*a[b],v[b]=0,x=b+1;x<=s;x+=1)e[x][b]=0;for(l[1]=-l[1]/2,y[1]=0,E=s,M=E+s,P=M+L,T=P+L+1,C=T+L*(L+1)/2,O=C+d,x=1;x<=d;x+=1){for(I=0,b=1;b<=s;b+=1)I+=u[b][x]*u[b][x];v[O+x]=Math.sqrt(I)}function W(){for(g[1]=g[1]+1,w=C,x=1;x<=d;x+=1){for(w+=1,I=-c[x],b=1;b<=s;b+=1)I+=u[b][x]*a[b];if(Math.abs(I)<B&&(I=0),x>p)v[w]=I;else if(v[w]=-Math.abs(I),I>0){for(b=1;b<=s;b+=1)u[b][x]=-u[b][x];c[x]=-c[x]}}for(x=1;x<=m;x+=1)v[C+f[x]]=0;for(R=0,D=0,x=1;x<=d;x+=1)v[C+x]<D*v[O+x]&&(R=x,D=v[C+x]/v[O+x]);return 0===R?999:0}function $(){for(x=1;x<=s;x+=1){for(I=0,b=1;b<=s;b+=1)I+=e[b][x]*u[b][R];v[x]=I}for(_=E,x=1;x<=s;x+=1)v[_+x]=0;for(b=m+1;b<=s;b+=1)for(x=1;x<=s;x+=1)v[_+x]=v[_+x]+e[x][b]*v[b];for(U=!0,x=m;x>=1;x-=1){for(I=v[x],w=T+x*(x+3)/2,_=w-x,b=x+1;b<=m;b+=1)I-=v[w]*v[M+b],w+=b;if(I/=v[_],v[M+x]=I,f[x]<p)break;if(I<0)break;U=!1,S=x}if(!U)for(k=v[P+S]/v[M+S],x=1;x<=m;x+=1){if(f[x]<p)break;if(v[M+x]<0)break;D=v[P+x]/v[M+x],D<k&&(k=D,S=x)}for(I=0,x=E+1;x<=E+s;x+=1)I+=v[x]*v[x];if(Math.abs(I)<=B){if(U)return y[1]=1,999;for(x=1;x<=m;x+=1)v[P+x]=v[P+x]-k*v[M+x];return v[P+m+1]=v[P+m+1]+k,700}for(I=0,x=1;x<=s;x+=1)I+=v[E+x]*u[x][R];for(N=-v[C+R]/I,j=!0,U||k<N&&(N=k,j=!1),x=1;x<=s;x+=1)a[x]=a[x]+N*v[E+x],Math.abs(a[x])<B&&(a[x]=0);for(l[1]=l[1]+N*I*(N/2+v[P+m+1]),x=1;x<=m;x+=1)v[P+x]=v[P+x]-N*v[M+x];if(v[P+m+1]=v[P+m+1]+N,!j){for(I=-c[R],b=1;b<=s;b+=1)I+=a[b]*u[b][R];if(R>p)v[C+R]=I;else if(v[C+R]=-Math.abs(I),I>0){for(b=1;b<=s;b+=1)u[b][R]=-u[b][R];c[R]=-c[R]}return 700}for(m+=1,f[m]=R,w=T+(m-1)*m/2+1,x=1;x<=m-1;x+=1)v[w]=v[x],w+=1;if(m===s)v[w]=v[s];else{for(x=s;x>=m+1;x-=1){if(0===v[x])break;if(F=Math.max(Math.abs(v[x-1]),Math.abs(v[x])),V=Math.min(Math.abs(v[x-1]),Math.abs(v[x])),D=v[x-1]>=0?Math.abs(F*Math.sqrt(1+V*V/(F*F))):-Math.abs(F*Math.sqrt(1+V*V/(F*F))),F=v[x-1]/D,V=v[x]/D,1===F)break;if(0===F)for(v[x-1]=V*D,b=1;b<=s;b+=1)D=e[b][x-1],e[b][x-1]=e[b][x],e[b][x]=D;else for(v[x-1]=D,z=V/(1+F),b=1;b<=s;b+=1)D=F*e[b][x-1]+V*e[b][x],e[b][x]=z*(e[b][x-1]+D)-e[b][x],e[b][x-1]=D}v[w]=v[m]}return 0}function X(){if(w=T+S*(S+1)/2+1,_=w+S,0===v[_])return 798;if(F=Math.max(Math.abs(v[_-1]),Math.abs(v[_])),V=Math.min(Math.abs(v[_-1]),Math.abs(v[_])),D=v[_-1]>=0?Math.abs(F*Math.sqrt(1+V*V/(F*F))):-Math.abs(F*Math.sqrt(1+V*V/(F*F))),F=v[_-1]/D,V=v[_]/D,1===F)return 798;if(0===F){for(x=S+1;x<=m;x+=1)D=v[_-1],v[_-1]=v[_],v[_]=D,_+=x;for(x=1;x<=s;x+=1)D=e[x][S],e[x][S]=e[x][S+1],e[x][S+1]=D}else{for(z=V/(1+F),x=S+1;x<=m;x+=1)D=F*v[_-1]+V*v[_],v[_]=z*(v[_-1]+D)-v[_],v[_-1]=D,_+=x;for(x=1;x<=s;x+=1)D=F*e[x][S]+V*e[x][S+1],e[x][S+1]=z*(e[x][S]+D)-e[x][S+1],e[x][S]=D}return 0}function Y(){for(_=w-S,x=1;x<=S;x+=1)v[_]=v[w],w+=1,_+=1;return v[P+S]=v[P+S+1],f[S]=f[S+1],S+=1,S<m?797:0}function Z(){return v[P+m]=v[P+m+1],v[P+m+1]=0,f[m]=0,m-=1,g[2]=g[2]+1,0}m=0,g[1]=0,g[2]=0,q=0;while(1){if(q=W(),999===q)return;while(1){if(q=$(),0===q)break;if(999===q)return;if(700===q)if(S===m)Z();else{while(1)if(X(),q=Y(),797!==q)break;Z()}}}}function a(e,r,i,o,a,l){e=t(e),r=t(r),i=t(i);var u,c,h,d,p,f,m=[],g=[],v=[],y=[],x=[];if(a=a||0,l=l?t(l):[void 0,0],o=o?t(o):[],c=e.length-1,h=i[1].length-1,!o)for(u=1;u<=h;u+=1)o[u]=0;for(u=1;u<=h;u+=1)g[u]=0;for(d=0,p=Math.min(c,h),u=1;u<=c;u+=1)v[u]=0;for(m[1]=0,u=1;u<=2*c+p*(p+5)/2+2*h+1;u+=1)y[u]=0;for(u=1;u<=2;u+=1)x[u]=0;return s(e,r,c,c,v,m,i,o,c,h,a,g,d,x,y,l),f="",1===l[1]&&(f="constraints are inconsistent, no solution!"),2===l[1]&&(f="matrix D in quadratic function is not positive definite!"),{solution:n(v),value:n(m),unconstrained_solution:n(r),iterations:n(x),iact:n(g),message:f}}e.solveQP=a}(numeric),numeric.svd=function(e){var t,n=numeric.epsilon,r=1e-64/n,i=50,o=0,s=0,a=0,l=0,u=0,c=numeric.clone(e),h=c.length,d=c[0].length;if(h<d)throw"Need more rows than columns";var p=new Array(d),f=new Array(d);for(s=0;s<d;s++)p[s]=f[s]=0;var m=numeric.rep([d,d],0);function g(e,t){return e=Math.abs(e),t=Math.abs(t),e>t?e*Math.sqrt(1+t*t/e/e):0==t?e:t*Math.sqrt(1+e*e/t/t)}var v=0,y=0,x=0,b=0,w=0,_=0,A=0;for(s=0;s<d;s++){for(p[s]=y,A=0,u=s+1,a=s;a<h;a++)A+=c[a][s]*c[a][s];if(A<=r)y=0;else for(v=c[s][s],y=Math.sqrt(A),v>=0&&(y=-y),x=v*y-A,c[s][s]=v-y,a=u;a<d;a++){for(A=0,l=s;l<h;l++)A+=c[l][s]*c[l][a];for(v=A/x,l=s;l<h;l++)c[l][a]+=v*c[l][s]}for(f[s]=y,A=0,a=u;a<d;a++)A+=c[s][a]*c[s][a];if(A<=r)y=0;else{for(v=c[s][s+1],y=Math.sqrt(A),v>=0&&(y=-y),x=v*y-A,c[s][s+1]=v-y,a=u;a<d;a++)p[a]=c[s][a]/x;for(a=u;a<h;a++){for(A=0,l=u;l<d;l++)A+=c[a][l]*c[s][l];for(l=u;l<d;l++)c[a][l]+=A*p[l]}}w=Math.abs(f[s])+Math.abs(p[s]),w>b&&(b=w)}for(s=d-1;-1!=s;s+=-1){if(0!=y){for(x=y*c[s][s+1],a=u;a<d;a++)m[a][s]=c[s][a]/x;for(a=u;a<d;a++){for(A=0,l=u;l<d;l++)A+=c[s][l]*m[l][a];for(l=u;l<d;l++)m[l][a]+=A*m[l][s]}}for(a=u;a<d;a++)m[s][a]=0,m[a][s]=0;m[s][s]=1,y=p[s],u=s}for(s=d-1;-1!=s;s+=-1){for(u=s+1,y=f[s],a=u;a<d;a++)c[s][a]=0;if(0!=y){for(x=c[s][s]*y,a=u;a<d;a++){for(A=0,l=u;l<h;l++)A+=c[l][s]*c[l][a];for(v=A/x,l=s;l<h;l++)c[l][a]+=v*c[l][s]}for(a=s;a<h;a++)c[a][s]=c[a][s]/y}else for(a=s;a<h;a++)c[a][s]=0;c[s][s]+=1}for(n*=b,l=d-1;-1!=l;l+=-1)for(var S=0;S<i;S++){var E=!1;for(u=l;-1!=u;u+=-1){if(Math.abs(p[u])<=n){E=!0;break}if(Math.abs(f[u-1])<=n)break}if(!E){o=0,A=1;var M=u-1;for(s=u;s<l+1;s++){if(v=A*p[s],p[s]=o*p[s],Math.abs(v)<=n)break;for(y=f[s],x=g(v,y),f[s]=x,o=y/x,A=-v/x,a=0;a<h;a++)w=c[a][M],_=c[a][s],c[a][M]=w*o+_*A,c[a][s]=-w*A+_*o}}if(_=f[l],u==l){if(_<0)for(f[l]=-_,a=0;a<d;a++)m[a][l]=-m[a][l];break}if(S>=i-1)throw"Error: no convergence.";for(b=f[u],w=f[l-1],y=p[l-1],x=p[l],v=((w-_)*(w+_)+(y-x)*(y+x))/(2*x*w),y=g(v,1),v=v<0?((b-_)*(b+_)+x*(w/(v-y)-x))/b:((b-_)*(b+_)+x*(w/(v+y)-x))/b,o=1,A=1,s=u+1;s<l+1;s++){for(y=p[s],w=f[s],x=A*y,y*=o,_=g(v,x),p[s-1]=_,o=v/_,A=x/_,v=b*o+y*A,y=-b*A+y*o,x=w*A,w*=o,a=0;a<d;a++)b=m[a][s-1],_=m[a][s],m[a][s-1]=b*o+_*A,m[a][s]=-b*A+_*o;for(_=g(v,x),f[s-1]=_,o=v/_,A=x/_,v=o*y+A*w,b=-A*y+o*w,a=0;a<h;a++)w=c[a][s-1],_=c[a][s],c[a][s-1]=w*o+_*A,c[a][s]=-w*A+_*o}p[u]=0,p[l]=v,f[l]=b}for(s=0;s<f.length;s++)f[s]<n&&(f[s]=0);for(s=0;s<d;s++)for(a=s-1;a>=0;a--)if(f[a]<f[s]){for(o=f[a],f[a]=f[s],f[s]=o,l=0;l<c.length;l++)t=c[l][s],c[l][s]=c[l][a],c[l][a]=t;for(l=0;l<m.length;l++)t=m[l][s],m[l][s]=m[l][a],m[l][a]=t;s=a}return{U:c,S:f,V:m}}}).call(this,__webpack_require__("c8ba"))},cb29:function(e,t,n){var r=n("23e7"),i=n("81d5"),o=n("44d2");r({target:"Array",proto:!0},{fill:i}),o("fill")},cd26:function(e,t,n){"use strict";var r=n("ebb5"),i=r.aTypedArray,o=r.exportTypedArrayMethod,s=Math.floor;o("reverse",(function(){var e,t=this,n=i(t).length,r=s(n/2),o=0;while(o<r)e=t[o],t[o++]=t[--n],t[n]=e;return t}))},d0ea:function(e,t,n){var r=n("808a"),i=(n("16c3"),n("1f8f"),n("5915"),n("17fb")),o=n("faa1").EventEmitter,s=function(e){this.type=e.type,this.state=e.state};t.chooseProtocol=function(e){var t;switch(e.version){case 1:case 2:case 3:case 4:case 5:case 6:t=a(e),t.sendBackground=function(e,n){e.send(t.encode({background:n}))},t.sendFocused=function(e,n){e.send(t.encode({focused:n}))},t.sendOptimizeHMD=function(e,n){e.send(t.encode({optimizeHMD:n}))};break;default:throw"unrecognized version"}return t};var a=t.JSONProtocol=function(e){var t=function(e){if(e.event)return new s(e.event);t.emit("beforeFrameCreated",e);var n=new r(e);return t.emit("afterFrameCreated",n,e),n};return t.encode=function(e){return JSON.stringify(e)},t.version=e.version,t.serviceVersion=e.serviceVersion,t.versionLong="Version "+e.version,t.type="protocol",i.extend(t,o.prototype),t}},d139:function(e,t,n){"use strict";var r=n("ebb5"),i=n("b727").find,o=r.aTypedArray,s=r.exportTypedArrayMethod;s("find",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},d30e:function(e,t,n){"use strict";e.exports=function(e,t,n){var r,i=" ",o=e.level,s=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(s||""),d="valid"+o,p=e.opts.$data&&a&&a.$data;if(p?(i+=" var schema"+o+" = "+e.util.getData(a.$data,s,e.dataPathArr)+"; ",r="schema"+o):r=a,(a||p)&&!1!==e.opts.uniqueItems){p&&(i+=" var "+d+"; if ("+r+" === false || "+r+" === undefined) "+d+" = true; else if (typeof "+r+" != 'boolean') "+d+" = false; else { "),i+=" var i = "+h+".length , "+d+" = true , j; if (i > 1) { ";var f=e.schema.items&&e.schema.items.type,m=Array.isArray(f);if(!f||"object"==f||"array"==f||m&&(f.indexOf("object")>=0||f.indexOf("array")>=0))i+=" outer: for (;i--;) { for (j = i; j--;) { if (equal("+h+"[i], "+h+"[j])) { "+d+" = false; break outer; } } } ";else{i+=" var itemIndices = {}, item; for (;i--;) { var item = "+h+"[i]; ";var g="checkDataType"+(m?"s":"");i+=" if ("+e.util[g](f,"item",e.opts.strictNumbers,!0)+") continue; ",m&&(i+=" if (typeof item == 'string') item = '\"' + item; "),i+=" if (typeof itemIndices[item] == 'number') { "+d+" = false; j = itemIndices[item]; break; } itemIndices[item] = i; } "}i+=" } ",p&&(i+="  }  "),i+=" if (!"+d+") {   ";var v=v||[];v.push(i),i="",!1!==e.createErrors?(i+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { i: i, j: j } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),e.opts.verbose&&(i+=" , schema:  ",i+=p?"validate.schema"+l:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var y=i;i=v.pop(),!e.compositeRule&&c?e.async?i+=" throw new ValidationError(["+y+"]); ":i+=" validate.errors = ["+y+"]; return false; ":i+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",c&&(i+=" else { ")}else c&&(i+=" if (true) { ");return i}},d419:function(e,t){var n=e.exports=function(e){this.steps=[],this.controller=e};n.prototype.addStep=function(e){this.steps.push(e)},n.prototype.run=function(e){for(var t=this.steps.length,n=0;n!=t;n++){if(!e)break;e=this.steps[n](e)}return e},n.prototype.removeStep=function(e){var t=this.steps.indexOf(e);if(-1===t)throw"Step not found in pipeline";this.steps.splice(t,1)},n.prototype.addWrappedStep=function(e,t){var n=this.controller,r=function(r){var i,o,s;for(i="frame"==e?[r]:r[e+"s"]||[],o=0,s=i.length;o<s;o++)t.call(n,i[o]);return r};return this.addStep(r),r}},d4c2:function(e,t){e.exports=function(){return function(e){var t=e.pointables.sort((function(e,t){return e.z-t.z}))[0];return t&&t.valid&&(e.cursorPosition=t.tipPosition),e}}},d4ec:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return r}))},d508:function(e,t,n){"use strict";e.exports=function(e,t,n){var r="",i=!0===e.schema.$async,o=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),s=e.self._getId(e.schema);if(e.opts.strictKeywords){var a=e.util.schemaUnknownRules(e.schema,e.RULES.keywords);if(a){var l="unknown keyword: "+a;if("log"!==e.opts.strictKeywords)throw new Error(l);e.logger.warn(l)}}if(e.isTop&&(r+=" var validate = ",i&&(e.async=!0,r+="async "),r+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",s&&(e.opts.sourceCode||e.opts.processCode)&&(r+=" /*# sourceURL="+s+" */ ")),"boolean"==typeof e.schema||!o&&!e.schema.$ref){t="false schema";var u=e.level,c=e.dataLevel,h=e.schema[t],d=e.schemaPath+e.util.getProperty(t),p=e.errSchemaPath+"/"+t,f=!e.opts.allErrors,m="data"+(c||""),g="valid"+u;if(!1===e.schema){e.isTop?f=!0:r+=" var "+g+" = false; ";var v=v||[];v.push(r),r="",!1!==e.createErrors?(r+=" { keyword: '"+(w||"false schema")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: {} ",!1!==e.opts.messages&&(r+=" , message: 'boolean schema is false' "),e.opts.verbose&&(r+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),r+=" } "):r+=" {} ";var y=r;r=v.pop(),!e.compositeRule&&f?e.async?r+=" throw new ValidationError(["+y+"]); ":r+=" validate.errors = ["+y+"]; return false; ":r+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else e.isTop?r+=i?" return data; ":" validate.errors = null; return true; ":r+=" var "+g+" = true; ";return e.isTop&&(r+=" }; return validate; "),r}if(e.isTop){var x=e.isTop;u=e.level=0,c=e.dataLevel=0,m="data";if(e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[void 0],void 0!==e.schema.default&&e.opts.useDefaults&&e.opts.strictDefaults){var b="default is ignored in the schema root";if("log"!==e.opts.strictDefaults)throw new Error(b);e.logger.warn(b)}r+=" var vErrors = null; ",r+=" var errors = 0;     ",r+=" if (rootData === undefined) rootData = data; "}else{u=e.level,c=e.dataLevel,m="data"+(c||"");if(s&&(e.baseId=e.resolve.url(e.baseId,s)),i&&!e.async)throw new Error("async schema in sync schema");r+=" var errs_"+u+" = errors;"}g="valid"+u,f=!e.opts.allErrors;var w,_="",A="",S=e.schema.type,E=Array.isArray(S);if(S&&e.opts.nullable&&!0===e.schema.nullable&&(E?-1==S.indexOf("null")&&(S=S.concat("null")):"null"!=S&&(S=[S,"null"],E=!0)),E&&1==S.length&&(S=S[0],E=!1),e.schema.$ref&&o){if("fail"==e.opts.extendRefs)throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');!0!==e.opts.extendRefs&&(o=!1,e.logger.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(e.schema.$comment&&e.opts.$comment&&(r+=" "+e.RULES.all.$comment.code(e,"$comment")),S){if(e.opts.coerceTypes)var M=e.util.coerceToTypes(e.opts.coerceTypes,S);var T=e.RULES.types[S];if(M||E||!0===T||T&&!te(T)){d=e.schemaPath+".type",p=e.errSchemaPath+"/type",d=e.schemaPath+".type",p=e.errSchemaPath+"/type";var C=E?"checkDataTypes":"checkDataType";if(r+=" if ("+e.util[C](S,m,e.opts.strictNumbers,!0)+") { ",M){var P="dataType"+u,R="coerced"+u;r+=" var "+P+" = typeof "+m+"; ","array"==e.opts.coerceTypes&&(r+=" if ("+P+" == 'object' && Array.isArray("+m+")) "+P+" = 'array'; "),r+=" var "+R+" = undefined; ";var L="",O=M;if(O){var D,I=-1,k=O.length-1;while(I<k)D=O[I+=1],I&&(r+=" if ("+R+" === undefined) { ",L+="}"),"array"==e.opts.coerceTypes&&"array"!=D&&(r+=" if ("+P+" == 'array' && "+m+".length == 1) { "+R+" = "+m+" = "+m+"[0]; "+P+" = typeof "+m+";  } "),"string"==D?r+=" if ("+P+" == 'number' || "+P+" == 'boolean') "+R+" = '' + "+m+"; else if ("+m+" === null) "+R+" = ''; ":"number"==D||"integer"==D?(r+=" if ("+P+" == 'boolean' || "+m+" === null || ("+P+" == 'string' && "+m+" && "+m+" == +"+m+" ","integer"==D&&(r+=" && !("+m+" % 1)"),r+=")) "+R+" = +"+m+"; "):"boolean"==D?r+=" if ("+m+" === 'false' || "+m+" === 0 || "+m+" === null) "+R+" = false; else if ("+m+" === 'true' || "+m+" === 1) "+R+" = true; ":"null"==D?r+=" if ("+m+" === '' || "+m+" === 0 || "+m+" === false) "+R+" = null; ":"array"==e.opts.coerceTypes&&"array"==D&&(r+=" if ("+P+" == 'string' || "+P+" == 'number' || "+P+" == 'boolean' || "+m+" == null) "+R+" = ["+m+"]; ")}r+=" "+L+" if ("+R+" === undefined) {   ";v=v||[];v.push(r),r="",!1!==e.createErrors?(r+=" { keyword: '"+(w||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { type: '",r+=E?""+S.join(","):""+S,r+="' } ",!1!==e.opts.messages&&(r+=" , message: 'should be ",r+=E?""+S.join(","):""+S,r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),r+=" } "):r+=" {} ";y=r;r=v.pop(),!e.compositeRule&&f?e.async?r+=" throw new ValidationError(["+y+"]); ":r+=" validate.errors = ["+y+"]; return false; ":r+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } else {  ";var N=c?"data"+(c-1||""):"parentData",F=c?e.dataPathArr[c]:"parentDataProperty";r+=" "+m+" = "+R+"; ",c||(r+="if ("+N+" !== undefined)"),r+=" "+N+"["+F+"] = "+R+"; } "}else{v=v||[];v.push(r),r="",!1!==e.createErrors?(r+=" { keyword: '"+(w||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { type: '",r+=E?""+S.join(","):""+S,r+="' } ",!1!==e.opts.messages&&(r+=" , message: 'should be ",r+=E?""+S.join(","):""+S,r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),r+=" } "):r+=" {} ";y=r;r=v.pop(),!e.compositeRule&&f?e.async?r+=" throw new ValidationError(["+y+"]); ":r+=" validate.errors = ["+y+"]; return false; ":r+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}r+=" } "}}if(e.schema.$ref&&!o)r+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",f&&(r+=" } if (errors === ",r+=x?"0":"errs_"+u,r+=") { ",A+="}");else{var V=e.RULES;if(V){var z=-1,U=V.length-1;while(z<U)if(T=V[z+=1],te(T)){if(T.type&&(r+=" if ("+e.util.checkDataType(T.type,m,e.opts.strictNumbers)+") { "),e.opts.useDefaults)if("object"==T.type&&e.schema.properties){h=e.schema.properties;var j=Object.keys(h),B=j;if(B){var H,G=-1,q=B.length-1;while(G<q){H=B[G+=1];var W=h[H];if(void 0!==W.default){var $=m+e.util.getProperty(H);if(e.compositeRule){if(e.opts.strictDefaults){b="default is ignored for: "+$;if("log"!==e.opts.strictDefaults)throw new Error(b);e.logger.warn(b)}}else r+=" if ("+$+" === undefined ","empty"==e.opts.useDefaults&&(r+=" || "+$+" === null || "+$+" === '' "),r+=" ) "+$+" = ","shared"==e.opts.useDefaults?r+=" "+e.useDefault(W.default)+" ":r+=" "+JSON.stringify(W.default)+" ",r+="; "}}}}else if("array"==T.type&&Array.isArray(e.schema.items)){var X=e.schema.items;if(X){I=-1;var Y=X.length-1;while(I<Y)if(W=X[I+=1],void 0!==W.default){$=m+"["+I+"]";if(e.compositeRule){if(e.opts.strictDefaults){b="default is ignored for: "+$;if("log"!==e.opts.strictDefaults)throw new Error(b);e.logger.warn(b)}}else r+=" if ("+$+" === undefined ","empty"==e.opts.useDefaults&&(r+=" || "+$+" === null || "+$+" === '' "),r+=" ) "+$+" = ","shared"==e.opts.useDefaults?r+=" "+e.useDefault(W.default)+" ":r+=" "+JSON.stringify(W.default)+" ",r+="; "}}}var Z=T.rules;if(Z){var J,Q=-1,K=Z.length-1;while(Q<K)if(J=Z[Q+=1],ne(J)){var ee=J.code(e,J.keyword,T.type);ee&&(r+=" "+ee+" ",f&&(_+="}"))}}if(f&&(r+=" "+_+" ",_=""),T.type&&(r+=" } ",S&&S===T.type&&!M)){r+=" else { ";d=e.schemaPath+".type",p=e.errSchemaPath+"/type",v=v||[];v.push(r),r="",!1!==e.createErrors?(r+=" { keyword: '"+(w||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(p)+" , params: { type: '",r+=E?""+S.join(","):""+S,r+="' } ",!1!==e.opts.messages&&(r+=" , message: 'should be ",r+=E?""+S.join(","):""+S,r+="' "),e.opts.verbose&&(r+=" , schema: validate.schema"+d+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),r+=" } "):r+=" {} ";y=r;r=v.pop(),!e.compositeRule&&f?e.async?r+=" throw new ValidationError(["+y+"]); ":r+=" validate.errors = ["+y+"]; return false; ":r+=" var err = "+y+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" } "}f&&(r+=" if (errors === ",r+=x?"0":"errs_"+u,r+=") { ",A+="}")}}}function te(e){for(var t=e.rules,n=0;n<t.length;n++)if(ne(t[n]))return!0}function ne(t){return void 0!==e.schema[t.keyword]||t.implements&&re(t)}function re(t){for(var n=t.implements,r=0;r<n.length;r++)if(void 0!==e.schema[n[r]])return!0}return f&&(r+=" "+A+" "),x?(i?(r+=" if (errors === 0) return data;           ",r+=" else throw new ValidationError(vErrors); "):(r+=" validate.errors = vErrors; ",r+=" return errors === 0;       "),r+=" }; return validate;"):r+=" var "+g+" = errors === errs_"+u+";",r}},d58f:function(e,t,n){var r=n("1c0b"),i=n("7b0b"),o=n("44ad"),s=n("50c4"),a=function(e){return function(t,n,a,l){r(n);var u=i(t),c=o(u),h=s(u.length),d=e?h-1:0,p=e?-1:1;if(a<2)while(1){if(d in c){l=c[d],d+=p;break}if(d+=p,e?d<0:h<=d)throw TypeError("Reduce of empty array with no initial value")}for(;e?d>=0:h>d;d+=p)d in c&&(l=n(l,c[d],d,u));return l}};e.exports={left:a(!1),right:a(!0)}},d5d6:function(e,t,n){"use strict";var r=n("ebb5"),i=n("b727").forEach,o=r.aTypedArray,s=r.exportTypedArrayMethod;s("forEach",(function(e){i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},d6ec:function(e,t,n){var r,i,o;
/*!
 * jQuery.scrollTo
 * Copyright (c) 2007-2015 Ariel Flesler - aflesler<a>gmail<d>com | http://flesler.blogspot.com
 * Licensed under MIT
 * http://flesler.blogspot.com/2007/10/jqueryscrollto.html
 * @projectDescription Lightweight, cross-browser and highly customizable animated scrolling with jQuery
 * @author Ariel Flesler
 * @version 2.1.2
 */(function(s){"use strict";i=[n("1157")],r=s,o="function"===typeof r?r.apply(t,i):r,void 0===o||(e.exports=o)})((function(e){"use strict";var t=e.scrollTo=function(t,n,r){return e(window).scrollTo(t,n,r)};function n(t){return!t.nodeName||-1!==e.inArray(t.nodeName.toLowerCase(),["iframe","#document","html","body"])}function r(t){return e.isFunction(t)||e.isPlainObject(t)?t:{top:t,left:t}}return t.defaults={axis:"xy",duration:0,limit:!0},e.fn.scrollTo=function(i,o,s){"object"===typeof o&&(s=o,o=0),"function"===typeof s&&(s={onAfter:s}),"max"===i&&(i=9e9),s=e.extend({},t.defaults,s),o=o||s.duration;var a=s.queue&&s.axis.length>1;return a&&(o/=2),s.offset=r(s.offset),s.over=r(s.over),this.each((function(){if(null!==i){var l,u=n(this),c=u?this.contentWindow||window:this,h=e(c),d=i,p={};switch(typeof d){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(d)){d=r(d);break}d=u?e(d):e(d,c);case"object":if(0===d.length)return;(d.is||d.style)&&(l=(d=e(d)).offset())}var f=e.isFunction(s.offset)&&s.offset(c,d)||s.offset;e.each(s.axis.split(""),(function(e,n){var r="x"===n?"Left":"Top",i=r.toLowerCase(),o="scroll"+r,g=h[o](),v=t.max(c,n);if(l)p[o]=l[i]+(u?0:g-h.offset()[i]),s.margin&&(p[o]-=parseInt(d.css("margin"+r),10)||0,p[o]-=parseInt(d.css("border"+r+"Width"),10)||0),p[o]+=f[i]||0,s.over[i]&&(p[o]+=d["x"===n?"width":"height"]()*s.over[i]);else{var y=d[i];p[o]=y.slice&&"%"===y.slice(-1)?parseFloat(y)/100*v:y}s.limit&&/^\d+$/.test(p[o])&&(p[o]=p[o]<=0?0:Math.min(p[o],v)),!e&&s.axis.length>1&&(g===p[o]?p={}:a&&(m(s.onAfterFirst),p={}))})),m(s.onAfter)}function m(t){var n=e.extend({},s,{queue:!0,duration:o,complete:t&&function(){t.call(c,d,s)}});h.animate(p,n)}}))},t.max=function(t,r){var i="x"===r?"Width":"Height",o="scroll"+i;if(!n(t))return t[o]-e(t)[i.toLowerCase()]();var s="client"+i,a=t.ownerDocument||t.document,l=a.documentElement,u=a.body;return Math.max(l[o],u[o])-Math.min(l[s],u[s])},e.Tween.propHooks.scrollLeft=e.Tween.propHooks.scrollTop={get:function(t){return e(t.elem)[t.prop]()},set:function(t){var n=this.get(t);if(t.options.interrupt&&t._last&&t._last!==n)return e(t.elem).stop();var r=Math.round(t.now);n!==r&&(e(t.elem)[t.prop](r),t._last=this.get(t))}},t}))},da3b:function(e,t,n){"use strict";e.exports=function(e,t,n){var r,i=" ",o=e.level,s=e.dataLevel,a=e.schema[t],l=e.schemaPath+e.util.getProperty(t),u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,h="data"+(s||""),d=e.opts.$data&&a&&a.$data;if(d?(i+=" var schema"+o+" = "+e.util.getData(a.$data,s,e.dataPathArr)+"; ",r="schema"+o):r=a,!d&&"number"!=typeof a)throw new Error(t+" must be number");var p="maxItems"==t?">":"<";i+="if ( ",d&&(i+=" ("+r+" !== undefined && typeof "+r+" != 'number') || "),i+=" "+h+".length "+p+" "+r+") { ";var f=t,m=m||[];m.push(i),i="",!1!==e.createErrors?(i+=" { keyword: '"+(f||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { limit: "+r+" } ",!1!==e.opts.messages&&(i+=" , message: 'should NOT have ",i+="maxItems"==t?"more":"fewer",i+=" than ",i+=d?"' + "+r+" + '":""+a,i+=" items' "),e.opts.verbose&&(i+=" , schema:  ",i+=d?"validate.schema"+l:""+a,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var g=i;return i=m.pop(),!e.compositeRule&&c?e.async?i+=" throw new ValidationError(["+g+"]); ":i+=" validate.errors = ["+g+"]; return false; ":i+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",c&&(i+=" else { "),i}},dd93:function(e,t,n){"use strict";e.exports=function(e,t,n){var r=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d="errs__"+i,p=e.util.copy(e);p.level++;var f="valid"+p.level,m=e.schema["then"],g=e.schema["else"],v=void 0!==m&&(e.opts.strictKeywords?"object"==typeof m&&Object.keys(m).length>0:e.util.schemaHasRules(m,e.RULES.all)),y=void 0!==g&&(e.opts.strictKeywords?"object"==typeof g&&Object.keys(g).length>0:e.util.schemaHasRules(g,e.RULES.all)),x=p.baseId;if(v||y){var b;p.createErrors=!1,p.schema=s,p.schemaPath=a,p.errSchemaPath=l,r+=" var "+d+" = errors; var "+h+" = true;  ";var w=e.compositeRule;e.compositeRule=p.compositeRule=!0,r+="  "+e.validate(p)+" ",p.baseId=x,p.createErrors=!0,r+="  errors = "+d+"; if (vErrors !== null) { if ("+d+") vErrors.length = "+d+"; else vErrors = null; }  ",e.compositeRule=p.compositeRule=w,v?(r+=" if ("+f+") {  ",p.schema=e.schema["then"],p.schemaPath=e.schemaPath+".then",p.errSchemaPath=e.errSchemaPath+"/then",r+="  "+e.validate(p)+" ",p.baseId=x,r+=" "+h+" = "+f+"; ",v&&y?(b="ifClause"+i,r+=" var "+b+" = 'then'; "):b="'then'",r+=" } ",y&&(r+=" else { ")):r+=" if (!"+f+") { ",y&&(p.schema=e.schema["else"],p.schemaPath=e.schemaPath+".else",p.errSchemaPath=e.errSchemaPath+"/else",r+="  "+e.validate(p)+" ",p.baseId=x,r+=" "+h+" = "+f+"; ",v&&y?(b="ifClause"+i,r+=" var "+b+" = 'else'; "):b="'else'",r+=" } "),r+=" if (!"+h+") {   var err =   ",!1!==e.createErrors?(r+=" { keyword: 'if' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { failingKeyword: "+b+" } ",!1!==e.opts.messages&&(r+=" , message: 'should match \"' + "+b+" + '\" schema' "),e.opts.verbose&&(r+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ",r+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&u&&(e.async?r+=" throw new ValidationError(vErrors); ":r+=" validate.errors = vErrors; return false; "),r+=" }   ",u&&(r+=" else { ")}else u&&(r+=" if (true) { ");return r}},df2a:function(e,t,n){var r=n("9052"),i=r.vec3,o=e.exports=function(e){this.valid=!0,this.center=e.center,this.size=e.size,this.width=e.size[0],this.height=e.size[1],this.depth=e.size[2]};o.prototype.denormalizePoint=function(e){return i.fromValues((e[0]-.5)*this.size[0]+this.center[0],(e[1]-.5)*this.size[1]+this.center[1],(e[2]-.5)*this.size[2]+this.center[2])},o.prototype.normalizePoint=function(e,t){var n=i.fromValues((e[0]-this.center[0])/this.size[0]+.5,(e[1]-this.center[1])/this.size[1]+.5,(e[2]-this.center[2])/this.size[2]+.5);return t&&(n[0]=Math.min(Math.max(n[0],0),1),n[1]=Math.min(Math.max(n[1],0),1),n[2]=Math.min(Math.max(n[2],0),1)),n},o.prototype.toString=function(){return"InteractionBox [ width:"+this.width+" | height:"+this.height+" | depth:"+this.depth+" ]"},o.Invalid={valid:!1}},e099:function(e,t,n){"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,a){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"===typeof e?o(s(e),(function(s){var a=encodeURIComponent(r(s))+n;return i(e[s])?o(e[s],(function(e){return a+encodeURIComponent(r(e))})).join(t):a+encodeURIComponent(r(e[s]))})).join(t):a?encodeURIComponent(r(a))+n+encodeURIComponent(r(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function o(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var s=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},e303:function(e,t,n){var r=e.exports=n("956e"),i=n("17fb"),o=e.exports=function(e){r.call(this,e);var t=this;this.on("ready",(function(){t.startFocusLoop()})),this.on("disconnect",(function(){t.stopFocusLoop()}))};i.extend(o.prototype,r.prototype),o.__proto__=r,o.prototype.useSecure=function(){return"https:"===location.protocol},o.prototype.getScheme=function(){return this.useSecure()?"wss:":"ws:"},o.prototype.getPort=function(){return this.useSecure()?6436:6437},o.prototype.setupSocket=function(){var e=this,t=new WebSocket(this.getUrl());return t.onopen=function(){e.handleOpen()},t.onclose=function(t){e.handleClose(t["code"],t["reason"])},t.onmessage=function(t){e.handleData(t.data)},t.onerror=function(t){e.useSecure()&&"wss:"===e.scheme&&(e.scheme="ws:",e.port=6437,e.disconnect(),e.connect())},t},o.prototype.startFocusLoop=function(){if(!this.focusDetectorTimer){var e=this,t=null;t="undefined"!==typeof document.hidden?"hidden":"undefined"!==typeof document.mozHidden?"mozHidden":"undefined"!==typeof document.msHidden?"msHidden":"undefined"!==typeof document.webkitHidden?"webkitHidden":void 0,void 0===e.windowVisible&&(e.windowVisible=void 0===t||!1===document[t]);var n=window.addEventListener("focus",(function(t){e.windowVisible=!0,i()})),r=window.addEventListener("blur",(function(t){e.windowVisible=!1,i()}));this.on("disconnect",(function(){window.removeEventListener("focus",n),window.removeEventListener("blur",r)}));var i=function(){var n=void 0===t||!1===document[t];e.reportFocus(n&&e.windowVisible)};i(),this.focusDetectorTimer=setInterval(i,100)}},o.prototype.stopFocusLoop=function(){this.focusDetectorTimer&&(clearTimeout(this.focusDetectorTimer),delete this.focusDetectorTimer)}},e58c:function(e,t,n){"use strict";var r=n("fc6a"),i=n("a691"),o=n("50c4"),s=n("a640"),a=n("ae40"),l=Math.min,u=[].lastIndexOf,c=!!u&&1/[1].lastIndexOf(1,-0)<0,h=s("lastIndexOf"),d=a("indexOf",{ACCESSORS:!0,1:0}),p=c||!h||!d;e.exports=p?function(e){if(c)return u.apply(this,arguments)||0;var t=r(this),n=o(t.length),s=n-1;for(arguments.length>1&&(s=l(s,i(arguments[1]))),s<0&&(s=n+s);s>=0;s--)if(s in t&&t[s]===e)return s||0;return-1}:u},e735:function(e,t){(function(){function e(e,t){try{for(var n in t)Object.defineProperty(e.prototype,n,{value:t[n],enumerable:!1})}catch(r){e.prototype=t}}function t(e){var t=-1,n=e.length,r=[];while(++t<n)r.push(e[t]);return r}function n(e){return Array.prototype.slice.call(e)}function r(){}function i(e){return e}function o(){return this}function s(){return!0}function a(e){return"function"===typeof e?e:function(){return e}}function l(e,t,n){return function(){var r=n.apply(t,arguments);return arguments.length?e:r}}function u(e){return null!=e&&!isNaN(e)}function c(e){return e.length}function h(e){return null==e}function d(e){return e.trim().replace(/\s+/g," ")}function p(e){var t=1;while(e*t%1)t*=10;return t}function f(){}function m(e){function t(){var t,r=n,i=-1,o=r.length;while(++i<o)(t=r[i].on)&&t.apply(this,arguments);return e}var n=[],i=new r;return t.on=function(t,r){var o,s=i.get(t);return arguments.length<2?s&&s.on:(s&&(s.on=null,n=n.slice(0,o=n.indexOf(s)).concat(n.slice(o+1)),i.remove(t)),r&&n.push(i.set(t,{on:r})),e)},t}function g(e,t){return t-(e?1+Math.floor(Math.log(e+Math.pow(10,1+Math.floor(Math.log(e)/Math.LN10)-t))/Math.LN10):1)}function v(e){return e+""}function y(e){var t=e.lastIndexOf("."),n=t>=0?e.substring(t):(t=e.length,""),r=[];while(t>0)r.push(e.substring(t-=3,t+3));return r.reverse().join(",")+n}function x(e,t){var n=Math.pow(10,3*Math.abs(8-t));return{scale:t>8?function(e){return e/n}:function(e){return e*n},symbol:e}}function b(e){return function(t){return t<=0?0:t>=1?1:e(t)}}function w(e){return function(t){return 1-e(1-t)}}function _(e){return function(t){return.5*(t<.5?e(2*t):2-e(2-2*t))}}function A(e){return e}function S(e){return function(t){return Math.pow(t,e)}}function E(e){return 1-Math.cos(e*Math.PI/2)}function M(e){return Math.pow(2,10*(e-1))}function T(e){return 1-Math.sqrt(1-e*e)}function C(e,t){var n;return arguments.length<2&&(t=.45),arguments.length<1?(e=1,n=t/4):n=t/(2*Math.PI)*Math.asin(1/e),function(r){return 1+e*Math.pow(2,10*-r)*Math.sin(2*(r-n)*Math.PI/t)}}function P(e){return e||(e=1.70158),function(t){return t*t*((e+1)*t-e)}}function R(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}function L(){d3.event.stopPropagation(),d3.event.preventDefault()}function O(){var e,t=d3.event;while(e=t.sourceEvent)t=e;return t}function D(e){var t=new f,n=0,r=arguments.length;while(++n<r)t[arguments[n]]=m(t);return t.of=function(n,r){return function(i){try{var o=i.sourceEvent=d3.event;i.target=e,d3.event=i,t[i.type].apply(n,r)}finally{d3.event=o}}},t}function I(e){var t=[e.a,e.b],n=[e.c,e.d],r=N(t),i=k(t,n),o=N(F(n,t,-i))||0;t[0]*n[1]<n[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,i*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-n[0],n[1]))*oi,this.translate=[e.e,e.f],this.scale=[r,o],this.skew=o?Math.atan2(i,o)*oi:0}function k(e,t){return e[0]*t[0]+e[1]*t[1]}function N(e){var t=Math.sqrt(k(e,e));return t&&(e[0]/=t,e[1]/=t),t}function F(e,t,n){return e[0]+=n*t[0],e[1]+=n*t[1],e}function V(e){return"transform"==e?d3.interpolateTransform:d3.interpolate}function z(e,t){return t=t-(e=+e)?1/(t-e):0,function(n){return(n-e)*t}}function U(e,t){return t=t-(e=+e)?1/(t-e):0,function(n){return Math.max(0,Math.min(1,(n-e)*t))}}function j(){}function B(e,t,n){return new H(e,t,n)}function H(e,t,n){this.r=e,this.g=t,this.b=n}function G(e){return e<16?"0"+Math.max(0,e).toString(16):Math.min(255,e).toString(16)}function q(e,t,n){var r,i,o,s=0,a=0,l=0;if(r=/([a-z]+)\((.*)\)/i.exec(e),r)switch(i=r[2].split(","),r[1]){case"hsl":return n(parseFloat(i[0]),parseFloat(i[1])/100,parseFloat(i[2])/100);case"rgb":return t(Y(i[0]),Y(i[1]),Y(i[2]))}return(o=ui.get(e))?t(o.r,o.g,o.b):(null!=e&&"#"===e.charAt(0)&&(4===e.length?(s=e.charAt(1),s+=s,a=e.charAt(2),a+=a,l=e.charAt(3),l+=l):7===e.length&&(s=e.substring(1,3),a=e.substring(3,5),l=e.substring(5,7)),s=parseInt(s,16),a=parseInt(a,16),l=parseInt(l,16)),t(s,a,l))}function W(e,t,n){var r,i,o=Math.min(e/=255,t/=255,n/=255),s=Math.max(e,t,n),a=s-o,l=(s+o)/2;return a?(i=l<.5?a/(s+o):a/(2-s-o),r=e==s?(t-n)/a+(t<n?6:0):t==s?(n-e)/a+2:(e-t)/a+4,r*=60):i=r=0,Z(r,i,l)}function $(e,t,n){e=X(e),t=X(t),n=X(n);var r=ae((.4124564*e+.3575761*t+.1804375*n)/pi),i=ae((.2126729*e+.7151522*t+.072175*n)/fi),o=ae((.0193339*e+.119192*t+.9503041*n)/mi);return ne(116*i-16,500*(r-i),200*(i-o))}function X(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Y(e){var t=parseFloat(e);return"%"===e.charAt(e.length-1)?Math.round(2.55*t):t}function Z(e,t,n){return new J(e,t,n)}function J(e,t,n){this.h=e,this.s=t,this.l=n}function Q(e,t,n){function r(e){return e>360?e-=360:e<0&&(e+=360),e<60?o+(s-o)*e/60:e<180?s:e<240?o+(s-o)*(240-e)/60:o}function i(e){return Math.round(255*r(e))}var o,s;return e%=360,e<0&&(e+=360),t=t<0?0:t>1?1:t,n=n<0?0:n>1?1:n,s=n<=.5?n*(1+t):n+t-n*t,o=2*n-s,B(i(e+120),i(e),i(e-120))}function K(e,t,n){return new ee(e,t,n)}function ee(e,t,n){this.h=e,this.c=t,this.l=n}function te(e,t,n){return ne(n,Math.cos(e*=Math.PI/180)*t,Math.sin(e)*t)}function ne(e,t,n){return new re(e,t,n)}function re(e,t,n){this.l=e,this.a=t,this.b=n}function ie(e,t,n){var r=(e+16)/116,i=r+t/500,o=r-n/200;return i=se(i)*pi,r=se(r)*fi,o=se(o)*mi,B(le(3.2404542*i-1.5371385*r-.4985314*o),le(-.969266*i+1.8760108*r+.041556*o),le(.0556434*i-.2040259*r+1.0572252*o))}function oe(e,t,n){return K(Math.atan2(n,t)/Math.PI*180,Math.sqrt(t*t+n*n),e)}function se(e){return e>.206893034?e*e*e:(e-4/29)/7.787037}function ae(e){return e>.008856?Math.pow(e,1/3):7.787037*e+4/29}function le(e){return Math.round(255*(e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055))}function ue(e){return qr(e,_i),e}function ce(e){return function(){return vi(e,this)}}function he(e){return function(){return yi(e,this)}}function de(e,t){function n(){this.removeAttribute(e)}function r(){this.removeAttributeNS(e.space,e.local)}function i(){this.setAttribute(e,t)}function o(){this.setAttributeNS(e.space,e.local,t)}function s(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}function a(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}return e=d3.ns.qualify(e),null==t?e.local?r:n:"function"===typeof t?e.local?a:s:e.local?o:i}function pe(e){return new RegExp("(?:^|\\s+)"+d3.requote(e)+"(?:\\s+|$)","g")}function fe(e,t){function n(){var n=-1;while(++n<i)e[n](this,t)}function r(){var n=-1,r=t.apply(this,arguments);while(++n<i)e[n](this,r)}e=e.trim().split(/\s+/).map(me);var i=e.length;return"function"===typeof t?r:n}function me(e){var t=pe(e);return function(n,r){if(i=n.classList)return r?i.add(e):i.remove(e);var i=n.className,o=null!=i.baseVal,s=o?i.baseVal:i;r?(t.lastIndex=0,t.test(s)||(s=d(s+" "+e),o?i.baseVal=s:n.className=s)):s&&(s=d(s.replace(t," ")),o?i.baseVal=s:n.className=s)}}function ge(e,t,n){function r(){this.style.removeProperty(e)}function i(){this.style.setProperty(e,t,n)}function o(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}return null==t?r:"function"===typeof t?o:i}function ve(e,t){function n(){delete this[e]}function r(){this[e]=t}function i(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}return null==t?n:"function"===typeof t?i:r}function ye(e){return{__data__:e}}function xe(e){return function(){return wi(this,e)}}function be(e){return arguments.length||(e=d3.ascending),function(t,n){return e(t&&t.__data__,n&&n.__data__)}}function we(e,t,n){function r(){var t=this[o];t&&(this.removeEventListener(e,t,t.$),delete this[o])}function i(){function i(e){var n=d3.event;d3.event=e,a[0]=s.__data__;try{t.apply(s,a)}finally{d3.event=n}}var s=this,a=arguments;r.call(this),this.addEventListener(e,this[o]=i,i.$=n),i._=t}var o="__on"+e,s=e.indexOf(".");return s>0&&(e=e.substring(0,s)),t?i:r}function _e(e,t){for(var n=0,r=e.length;n<r;n++)for(var i,o=e[n],s=0,a=o.length;s<a;s++)(i=o[s])&&t(i,s,n);return e}function Ae(e){return qr(e,Si),e}function Se(e,t,n){qr(e,Ei);var i=new r,o=d3.dispatch("start","end"),s=Di;return e.id=t,e.time=n,e.tween=function(t,n){return arguments.length<2?i.get(t):(null==n?i.remove(t):i.set(t,n),e)},e.ease=function(t){return arguments.length?(s="function"===typeof t?t:d3.ease.apply(d3,arguments),e):s},e.each=function(t,n){return arguments.length<2?Ee.call(e,t):(o.on(t,n),e)},d3.timer((function(r){return _e(e,(function(e,a,l){function u(r){return m.active>t?h():(m.active=t,i.forEach((function(t,n){(n=n.call(e,g,a))&&d.push(n)})),o.start.call(e,g,a),c(r)||d3.timer(c,0,n),1)}function c(n){if(m.active!==t)return h();var r=(n-p)/f,i=s(r),l=d.length;while(l>0)d[--l].call(e,i);return r>=1?(h(),Ti=t,o.end.call(e,g,a),Ti=0,1):void 0}function h(){return--m.count||delete e.__transition__,1}var d=[],p=e.delay,f=e.duration,m=(e=e.node).__transition__||(e.__transition__={active:0,count:0}),g=e.__data__;++m.count,p<=r?u(r):d3.timer(u,p,n)}))}),0,n),e}function Ee(e){var t=Ti,n=Di,r=Li,i=Oi;return Ti=this.id,Di=this.ease(),_e(this,(function(t,n,r){Li=t.delay,Oi=t.duration,e.call(t=t.node,t.__data__,n,r)})),Ti=t,Di=n,Li=r,Oi=i,this}function Me(e,t,n){return""!=n&&Ni}function Te(e,t){return d3.tween(e,V(t))}function Ce(){var e,t=Date.now(),n=zi;while(n)e=t-n.then,e>=n.delay&&(n.flush=n.callback(e)),n=n.next;var r=Pe()-t;r>24?(isFinite(r)&&(clearTimeout(ki),ki=setTimeout(Ce,r)),Ii=0):(Ii=1,Ui(Ce))}function Pe(){var e=null,t=zi,n=1/0;while(t)t.flush?(delete Vi[t.callback.id],t=e?e.next=t.next:zi=t.next):(n=Math.min(n,t.then+t.delay),t=(e=t).next);return n}function Re(e,t){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();if(ji<0&&(window.scrollX||window.scrollY)){n=d3.select(document.body).append("svg").style("position","absolute").style("top",0).style("left",0);var i=n[0][0].getScreenCTM();ji=!(i.f||i.e),n.remove()}return ji?(r.x=t.pageX,r.y=t.pageY):(r.x=t.clientX,r.y=t.clientY),r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}var o=e.getBoundingClientRect();return[t.clientX-o.left-e.clientLeft,t.clientY-o.top-e.clientTop]}function Le(e){var t=e[0],n=e[e.length-1];return t<n?[t,n]:[n,t]}function Oe(e){return e.rangeExtent?e.rangeExtent():Le(e.range())}function De(e,t){var n,r=0,i=e.length-1,o=e[r],s=e[i];return s<o&&(n=r,r=i,i=n,n=o,o=s,s=n),(t=t(s-o))&&(e[r]=t.floor(o),e[i]=t.ceil(s)),e}function Ie(){return Math}function ke(e,t,n,r){function i(){var i=Math.min(e.length,t.length)>2?Be:je,l=r?U:z;return s=i(e,t,l,n),a=i(t,e,l,d3.interpolate),o}function o(e){return s(e)}var s,a;return o.invert=function(e){return a(e)},o.domain=function(t){return arguments.length?(e=t.map(Number),i()):e},o.range=function(e){return arguments.length?(t=e,i()):t},o.rangeRound=function(e){return o.range(e).interpolate(d3.interpolateRound)},o.clamp=function(e){return arguments.length?(r=e,i()):r},o.interpolate=function(e){return arguments.length?(n=e,i()):n},o.ticks=function(t){return ze(e,t)},o.tickFormat=function(t){return Ue(e,t)},o.nice=function(){return De(e,Fe),i()},o.copy=function(){return ke(e,t,n,r)},i()}function Ne(e,t){return d3.rebind(e,t,"range","rangeRound","interpolate","clamp")}function Fe(e){return e=Math.pow(10,Math.round(Math.log(e)/Math.LN10)-1),e&&{floor:function(t){return Math.floor(t/e)*e},ceil:function(t){return Math.ceil(t/e)*e}}}function Ve(e,t){var n=Le(e),r=n[1]-n[0],i=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),o=t/r*i;return o<=.15?i*=10:o<=.35?i*=5:o<=.75&&(i*=2),n[0]=Math.ceil(n[0]/i)*i,n[1]=Math.floor(n[1]/i)*i+.5*i,n[2]=i,n}function ze(e,t){return d3.range.apply(d3,Ve(e,t))}function Ue(e,t){return d3.format(",."+Math.max(0,-Math.floor(Math.log(Ve(e,t)[2])/Math.LN10+.01))+"f")}function je(e,t,n,r){var i=n(e[0],e[1]),o=r(t[0],t[1]);return function(e){return o(i(e))}}function Be(e,t,n,r){var i=[],o=[],s=0,a=Math.min(e.length,t.length)-1;e[a]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());while(++s<=a)i.push(n(e[s-1],e[s])),o.push(r(t[s-1],t[s]));return function(t){var n=d3.bisect(e,t,1,a)-1;return o[n](i[n](t))}}function He(e,t){function n(n){return e(t(n))}var r=t.pow;return n.invert=function(t){return r(e.invert(t))},n.domain=function(i){return arguments.length?(t=i[0]<0?qe:Ge,r=t.pow,e.domain(i.map(t)),n):e.domain().map(r)},n.nice=function(){return e.domain(De(e.domain(),Ie)),n},n.ticks=function(){var n=Le(e.domain()),i=[];if(n.every(isFinite)){var o=Math.floor(n[0]),s=Math.ceil(n[1]),a=r(n[0]),l=r(n[1]);if(t===qe)for(i.push(r(o));o++<s;)for(var u=9;u>0;u--)i.push(r(o)*u);else{for(;o<s;o++)for(u=1;u<10;u++)i.push(r(o)*u);i.push(r(o))}for(o=0;i[o]<a;o++);for(s=i.length;i[s-1]>l;s--);i=i.slice(o,s)}return i},n.tickFormat=function(e,i){if(arguments.length<2&&(i=Bi),arguments.length<1)return i;var o,s=Math.max(.1,e/n.ticks().length),a=t===qe?(o=-1e-12,Math.floor):(o=1e-12,Math.ceil);return function(e){return e/r(a(t(e)+o))<=s?i(e):""}},n.copy=function(){return He(e.copy(),t)},Ne(n,e)}function Ge(e){return Math.log(e<0?0:e)/Math.LN10}function qe(e){return-Math.log(e>0?0:-e)/Math.LN10}function We(e,t){function n(t){return e(r(t))}var r=$e(t),i=$e(1/t);return n.invert=function(t){return i(e.invert(t))},n.domain=function(t){return arguments.length?(e.domain(t.map(r)),n):e.domain().map(i)},n.ticks=function(e){return ze(n.domain(),e)},n.tickFormat=function(e){return Ue(n.domain(),e)},n.nice=function(){return n.domain(De(n.domain(),Fe))},n.exponent=function(e){if(!arguments.length)return t;var o=n.domain();return r=$e(t=e),i=$e(1/t),n.domain(o)},n.copy=function(){return We(e.copy(),t)},Ne(n,e)}function $e(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Xe(e,t){function n(t){return s[((o.get(t)||o.set(t,e.push(t)))-1)%s.length]}function i(t,n){return d3.range(e.length).map((function(e){return t+n*e}))}var o,s,a;return n.domain=function(i){if(!arguments.length)return e;e=[],o=new r;var s,a=-1,l=i.length;while(++a<l)o.has(s=i[a])||o.set(s,e.push(s));return n[t.t].apply(n,t.a)},n.range=function(e){return arguments.length?(s=e,a=0,t={t:"range",a:arguments},n):s},n.rangePoints=function(r,o){arguments.length<2&&(o=0);var l=r[0],u=r[1],c=(u-l)/(Math.max(1,e.length-1)+o);return s=i(e.length<2?(l+u)/2:l+c*o/2,c),a=0,t={t:"rangePoints",a:arguments},n},n.rangeBands=function(r,o,l){arguments.length<2&&(o=0),arguments.length<3&&(l=o);var u=r[1]<r[0],c=r[u-0],h=r[1-u],d=(h-c)/(e.length-o+2*l);return s=i(c+d*l,d),u&&s.reverse(),a=d*(1-o),t={t:"rangeBands",a:arguments},n},n.rangeRoundBands=function(r,o,l){arguments.length<2&&(o=0),arguments.length<3&&(l=o);var u=r[1]<r[0],c=r[u-0],h=r[1-u],d=Math.floor((h-c)/(e.length-o+2*l)),p=h-c-(e.length-o)*d;return s=i(c+Math.round(p/2),d),u&&s.reverse(),a=Math.round(d*(1-o)),t={t:"rangeRoundBands",a:arguments},n},n.rangeBand=function(){return a},n.rangeExtent=function(){return Le(t.a[0])},n.copy=function(){return Xe(e,t)},n.domain(e)}function Ye(e,t){function n(){var n=0,o=(e.length,t.length);i=[];while(++n<o)i[n-1]=d3.quantile(e,n/o);return r}function r(e){return isNaN(e=+e)?NaN:t[d3.bisect(i,e)]}var i;return r.domain=function(t){return arguments.length?(e=t.filter((function(e){return!isNaN(e)})).sort(d3.ascending),n()):e},r.range=function(e){return arguments.length?(t=e,n()):t},r.quantiles=function(){return i},r.copy=function(){return Ye(e,t)},n()}function Ze(e,t,n){function r(t){return n[Math.max(0,Math.min(s,Math.floor(o*(t-e))))]}function i(){return o=n.length/(t-e),s=n.length-1,r}var o,s;return r.domain=function(n){return arguments.length?(e=+n[0],t=+n[n.length-1],i()):[e,t]},r.range=function(e){return arguments.length?(n=e,i()):n},r.copy=function(){return Ze(e,t,n)},i()}function Je(e,t){function n(n){return t[d3.bisect(e,n)]}return n.domain=function(t){return arguments.length?(e=t,n):e},n.range=function(e){return arguments.length?(t=e,n):t},n.copy=function(){return Je(e,t)},n}function Qe(e){function t(e){return+e}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=n.map(t),t):e},t.ticks=function(t){return ze(e,t)},t.tickFormat=function(t){return Ue(e,t)},t.copy=function(){return Qe(e)},t}function Ke(e){return e.innerRadius}function et(e){return e.outerRadius}function tt(e){return e.startAngle}function nt(e){return e.endAngle}function rt(e){function t(t){function s(){c.push("M",o(e(h),u))}var l,c=[],h=[],d=-1,p=t.length,f=a(n),m=a(r);while(++d<p)i.call(this,l=t[d],d)?h.push([+f.call(this,l,d),+m.call(this,l,d)]):h.length&&(s(),h=[]);return h.length&&s(),c.length?c.join(""):null}var n=it,r=ot,i=s,o=st,l=o.key,u=.7;return t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(r=e,t):r},t.defined=function(e){return arguments.length?(i=e,t):i},t.interpolate=function(e){return arguments.length?(l="function"===typeof e?o=e:(o=Yi.get(e)||st).key,t):l},t.tension=function(e){return arguments.length?(u=e,t):u},t}function it(e){return e[0]}function ot(e){return e[1]}function st(e){return e.join("L")}function at(e){return st(e)+"Z"}function lt(e){var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];while(++t<n)i.push("V",(r=e[t])[1],"H",r[0]);return i.join("")}function ut(e){var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];while(++t<n)i.push("H",(r=e[t])[0],"V",r[1]);return i.join("")}function ct(e,t){return e.length<4?st(e):e[1]+pt(e.slice(1,e.length-1),ft(e,t))}function ht(e,t){return e.length<3?st(e):e[0]+pt((e.push(e[0]),e),ft([e[e.length-2]].concat(e,[e[1]]),t))}function dt(e,t,n){return e.length<3?st(e):e[0]+pt(e,ft(e,t))}function pt(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2)return st(e);var n=e.length!=t.length,r="",i=e[0],o=e[1],s=t[0],a=s,l=1;if(n&&(r+="Q"+(o[0]-2*s[0]/3)+","+(o[1]-2*s[1]/3)+","+o[0]+","+o[1],i=e[1],l=2),t.length>1){a=t[1],o=e[l],l++,r+="C"+(i[0]+s[0])+","+(i[1]+s[1])+","+(o[0]-a[0])+","+(o[1]-a[1])+","+o[0]+","+o[1];for(var u=2;u<t.length;u++,l++)o=e[l],a=t[u],r+="S"+(o[0]-a[0])+","+(o[1]-a[1])+","+o[0]+","+o[1]}if(n){var c=e[l];r+="Q"+(o[0]+2*a[0]/3)+","+(o[1]+2*a[1]/3)+","+c[0]+","+c[1]}return r}function ft(e,t){var n,r=[],i=(1-t)/2,o=e[0],s=e[1],a=1,l=e.length;while(++a<l)n=o,o=s,s=e[a],r.push([i*(s[0]-n[0]),i*(s[1]-n[1])]);return r}function mt(e){if(e.length<3)return st(e);var t=1,n=e.length,r=e[0],i=r[0],o=r[1],s=[i,i,i,(r=e[1])[0]],a=[o,o,o,r[1]],l=[i,",",o];bt(l,s,a);while(++t<n)r=e[t],s.shift(),s.push(r[0]),a.shift(),a.push(r[1]),bt(l,s,a);t=-1;while(++t<2)s.shift(),s.push(r[0]),a.shift(),a.push(r[1]),bt(l,s,a);return l.join("")}function gt(e){if(e.length<4)return st(e);var t,n=[],r=-1,i=e.length,o=[0],s=[0];while(++r<3)t=e[r],o.push(t[0]),s.push(t[1]);n.push(xt(Qi,o)+","+xt(Qi,s)),--r;while(++r<i)t=e[r],o.shift(),o.push(t[0]),s.shift(),s.push(t[1]),bt(n,o,s);return n.join("")}function vt(e){var t,n,r=-1,i=e.length,o=i+4,s=[],a=[];while(++r<4)n=e[r%i],s.push(n[0]),a.push(n[1]);t=[xt(Qi,s),",",xt(Qi,a)],--r;while(++r<o)n=e[r%i],s.shift(),s.push(n[0]),a.shift(),a.push(n[1]),bt(t,s,a);return t.join("")}function yt(e,t){var n=e.length-1;if(n){var r,i,o=e[0][0],s=e[0][1],a=e[n][0]-o,l=e[n][1]-s,u=-1;while(++u<=n)r=e[u],i=u/n,r[0]=t*r[0]+(1-t)*(o+i*a),r[1]=t*r[1]+(1-t)*(s+i*l)}return mt(e)}function xt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function bt(e,t,n){e.push("C",xt(Zi,t),",",xt(Zi,n),",",xt(Ji,t),",",xt(Ji,n),",",xt(Qi,t),",",xt(Qi,n))}function wt(e,t){return(t[1]-e[1])/(t[0]-e[0])}function _t(e){var t=0,n=e.length-1,r=[],i=e[0],o=e[1],s=r[0]=wt(i,o);while(++t<n)r[t]=(s+(s=wt(i=o,o=e[t+1])))/2;return r[t]=s,r}function At(e){var t,n,r,i,o=[],s=_t(e),a=-1,l=e.length-1;while(++a<l)t=wt(e[a],e[a+1]),Math.abs(t)<1e-6?s[a]=s[a+1]=0:(n=s[a]/t,r=s[a+1]/t,i=n*n+r*r,i>9&&(i=3*t/Math.sqrt(i),s[a]=i*n,s[a+1]=i*r));a=-1;while(++a<=l)i=(e[Math.min(l,a+1)][0]-e[Math.max(0,a-1)][0])/(6*(1+s[a]*s[a])),o.push([i||0,s[a]*i||0]);return o}function St(e){return e.length<3?st(e):e[0]+pt(e,At(e))}function Et(e){var t,n,r,i=-1,o=e.length;while(++i<o)t=e[i],n=t[0],r=t[1]+$i,t[0]=n*Math.cos(r),t[1]=n*Math.sin(r);return e}function Mt(e){function t(t){function s(){g.push("M",u(e(y),p),d,h(e(v.reverse()),p),"Z")}var c,f,m,g=[],v=[],y=[],x=-1,b=t.length,w=a(n),_=a(i),A=n===r?function(){return f}:a(r),S=i===o?function(){return m}:a(o);while(++x<b)l.call(this,c=t[x],x)?(v.push([f=+w.call(this,c,x),m=+_.call(this,c,x)]),y.push([+A.call(this,c,x),+S.call(this,c,x)])):v.length&&(s(),v=[],y=[]);return v.length&&s(),g.length?g.join(""):null}var n=it,r=it,i=0,o=ot,l=s,u=st,c=u.key,h=u,d="L",p=.7;return t.x=function(e){return arguments.length?(n=r=e,t):r},t.x0=function(e){return arguments.length?(n=e,t):n},t.x1=function(e){return arguments.length?(r=e,t):r},t.y=function(e){return arguments.length?(i=o=e,t):o},t.y0=function(e){return arguments.length?(i=e,t):i},t.y1=function(e){return arguments.length?(o=e,t):o},t.defined=function(e){return arguments.length?(l=e,t):l},t.interpolate=function(e){return arguments.length?(c="function"===typeof e?u=e:(u=Yi.get(e)||st).key,h=u.reverse||u,d=u.closed?"M":"L",t):c},t.tension=function(e){return arguments.length?(p=e,t):p},t}function Tt(e){return e.source}function Ct(e){return e.target}function Pt(e){return e.radius}function Rt(e){return[e.x,e.y]}function Lt(e){return function(){var t=e.apply(this,arguments),n=t[0],r=t[1]+$i;return[n*Math.cos(r),n*Math.sin(r)]}}function Ot(){return 64}function Dt(){return"circle"}function It(e){var t=Math.sqrt(e/Math.PI);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function kt(e,t){e.attr("transform",(function(e){return"translate("+t(e)+",0)"}))}function Nt(e,t){e.attr("transform",(function(e){return"translate(0,"+t(e)+")"}))}function Ft(e,t,n){if(r=[],n&&t.length>1){var r,i,o,s=Le(e.domain()),a=-1,l=t.length,u=(t[1]-t[0])/++n;while(++a<l)for(i=n;--i>0;)(o=+t[a]-i*u)>=s[0]&&r.push(o);for(--a,i=0;++i<n&&(o=+t[a]+i*u)<s[1];)r.push(o)}return r}function Vt(){io||(io=d3.select("body").append("div").style("visibility","hidden").style("top",0).style("height",0).style("width",0).style("overflow-y","scroll").append("div").style("height","2000px").node().parentNode);var e,t=d3.event;try{io.scrollTop=1e3,io.dispatchEvent(t),e=1e3-io.scrollTop}catch(n){e=t.wheelDelta||5*-t.detail}return e}function zt(e){var t=e.source,n=e.target,r=jt(t,n),i=[t];while(t!==r)t=t.parent,i.push(t);var o=i.length;while(n!==r)i.splice(o,0,n),n=n.parent;return i}function Ut(e){var t=[],n=e.parent;while(null!=n)t.push(e),e=n,n=n.parent;return t.push(e),t}function jt(e,t){if(e===t)return e;var n=Ut(e),r=Ut(t),i=n.pop(),o=r.pop(),s=null;while(i===o)s=i,i=n.pop(),o=r.pop();return s}function Bt(e){e.fixed|=2}function Ht(e){e.fixed&=1}function Gt(e){e.fixed|=4}function qt(e){e.fixed&=3}function Wt(e,t,n){var r=0,i=0;if(e.charge=0,!e.leaf){var o,s=e.nodes,a=s.length,l=-1;while(++l<a)o=s[l],null!=o&&(Wt(o,t,n),e.charge+=o.charge,r+=o.charge*o.cx,i+=o.charge*o.cy)}if(e.point){e.leaf||(e.point.x+=Math.random()-.5,e.point.y+=Math.random()-.5);var u=t*n[e.point.index];e.charge+=e.pointCharge=u,r+=u*e.point.x,i+=u*e.point.y}e.cx=r/e.charge,e.cy=i/e.charge}function $t(e){return 20}function Xt(e){return 1}function Yt(e){return e.x}function Zt(e){return e.y}function Jt(e,t,n){e.y0=t,e.y=n}function Qt(e){return d3.range(e.length)}function Kt(e){var t=-1,n=e[0].length,r=[];while(++t<n)r[t]=0;return r}function en(e){for(var t,n=1,r=0,i=e[0][1],o=e.length;n<o;++n)(t=e[n][1])>i&&(r=n,i=t);return r}function tn(e){return e.reduce(nn,0)}function nn(e,t){return e+t[1]}function rn(e,t){return on(e,Math.ceil(Math.log(t.length)/Math.LN2+1))}function on(e,t){var n=-1,r=+e[0],i=(e[1]-r)/t,o=[];while(++n<=t)o[n]=i*n+r;return o}function sn(e){return[d3.min(e),d3.max(e)]}function an(e,t){return d3.rebind(e,t,"sort","children","value"),e.links=hn,e.nodes=function(t){return uo=!0,(e.nodes=e)(t)},e}function ln(e){return e.children}function un(e){return e.value}function cn(e,t){return t.value-e.value}function hn(e){return d3.merge(e.map((function(e){return(e.children||[]).map((function(t){return{source:e,target:t}}))})))}function dn(e,t){return e.value-t.value}function pn(e,t){var n=e._pack_next;e._pack_next=t,t._pack_prev=e,t._pack_next=n,n._pack_prev=t}function fn(e,t){e._pack_next=t,t._pack_prev=e}function mn(e,t){var n=t.x-e.x,r=t.y-e.y,i=e.r+t.r;return i*i-n*n-r*r>.001}function gn(e){function t(e){c=Math.min(e.x-e.r,c),h=Math.max(e.x+e.r,h),d=Math.min(e.y-e.r,d),p=Math.max(e.y+e.r,p)}if((n=e.children)&&(u=n.length)){var n,r,i,o,s,a,l,u,c=1/0,h=-1/0,d=1/0,p=-1/0;if(n.forEach(vn),r=n[0],r.x=-r.r,r.y=0,t(r),u>1&&(i=n[1],i.x=i.r,i.y=0,t(i),u>2))for(o=n[2],bn(r,i,o),t(o),pn(r,o),r._pack_prev=o,pn(o,i),i=r._pack_next,s=3;s<u;s++){bn(r,i,o=n[s]);var f=0,m=1,g=1;for(a=i._pack_next;a!==i;a=a._pack_next,m++)if(mn(a,o)){f=1;break}if(1==f)for(l=r._pack_prev;l!==a._pack_prev;l=l._pack_prev,g++)if(mn(l,o))break;f?(m<g||m==g&&i.r<r.r?fn(r,i=a):fn(r=l,i),s--):(pn(r,o),i=o,t(o))}var v=(c+h)/2,y=(d+p)/2,x=0;for(s=0;s<u;s++)o=n[s],o.x-=v,o.y-=y,x=Math.max(x,o.r+Math.sqrt(o.x*o.x+o.y*o.y));e.r=x,n.forEach(yn)}}function vn(e){e._pack_next=e._pack_prev=e}function yn(e){delete e._pack_next,delete e._pack_prev}function xn(e,t,n,r){var i=e.children;if(e.x=t+=r*e.x,e.y=n+=r*e.y,e.r*=r,i){var o=-1,s=i.length;while(++o<s)xn(i[o],t,n,r)}}function bn(e,t,n){var r=e.r+n.r,i=t.x-e.x,o=t.y-e.y;if(r&&(i||o)){var s=t.r+n.r,a=i*i+o*o;s*=s,r*=r;var l=.5+(r-s)/(2*a),u=Math.sqrt(Math.max(0,2*s*(r+a)-(r-=a)*r-s*s))/(2*a);n.x=e.x+l*i+u*o,n.y=e.y+l*o-u*i}else n.x=e.x+r,n.y=e.y}function wn(e){return 1+d3.max(e,(function(e){return e.y}))}function _n(e){return e.reduce((function(e,t){return e+t.x}),0)/e.length}function An(e){var t=e.children;return t&&t.length?An(t[0]):e}function Sn(e){var t,n=e.children;return n&&(t=n.length)?Sn(n[t-1]):e}function En(e,t){return e.parent==t.parent?1:2}function Mn(e){var t=e.children;return t&&t.length?t[0]:e._tree.thread}function Tn(e){var t,n=e.children;return n&&(t=n.length)?n[t-1]:e._tree.thread}function Cn(e,t){var n=e.children;if(n&&(i=n.length)){var r,i,o=-1;while(++o<i)t(r=Cn(n[o],t),e)>0&&(e=r)}return e}function Pn(e,t){return e.x-t.x}function Rn(e,t){return t.x-e.x}function Ln(e,t){return e.depth-t.depth}function On(e,t){function n(e,r){var i=e.children;if(i&&(s=i.length)){var o,s,a=null,l=-1;while(++l<s)o=i[l],n(o,a),a=o}t(e,r)}n(e,null)}function Dn(e){var t,n=0,r=0,i=e.children,o=i.length;while(--o>=0)t=i[o]._tree,t.prelim+=n,t.mod+=n,n+=t.shift+(r+=t.change)}function In(e,t,n){e=e._tree,t=t._tree;var r=n/(t.number-e.number);e.change+=r,t.change-=r,t.shift+=n,t.prelim+=n,t.mod+=n}function kn(e,t,n){return e._tree.ancestor.parent==t.parent?e._tree.ancestor:n}function Nn(e){return{x:e.x,y:e.y,dx:e.dx,dy:e.dy}}function Fn(e,t){var n=e.x+t[3],r=e.y+t[0],i=e.dx-t[1]-t[3],o=e.dy-t[0]-t[2];return i<0&&(n+=i/2,i=0),o<0&&(r+=o/2,o=0),{x:n,y:r,dx:i,dy:o}}function Vn(e,t){function n(e,r){d3.text(e,t,(function(e){r(e&&n.parse(e))}))}function r(t){return t.map(i).join(e)}function i(e){return s.test(e)?'"'+e.replace(/\"/g,'""')+'"':e}var o=new RegExp("\r\n|["+e+"\r\n]","g"),s=new RegExp('["'+e+"\n]"),a=e.charCodeAt(0);return n.parse=function(e){var t;return n.parseRows(e,(function(e,n){if(n){var r={},i=-1,o=t.length;while(++i<o)r[t[i]]=e[i];return r}return t=e,null}))},n.parseRows=function(e,t){function n(){if(o.lastIndex>=e.length)return l;if(i)return i=!1,s;var t=o.lastIndex;if(34===e.charCodeAt(t)){var n=t;while(n++<e.length)if(34===e.charCodeAt(n)){if(34!==e.charCodeAt(n+1))break;n++}o.lastIndex=n+2;var r=e.charCodeAt(n+1);return 13===r?(i=!0,10===e.charCodeAt(n+2)&&o.lastIndex++):10===r&&(i=!0),e.substring(t+1,n).replace(/""/g,'"')}var u=o.exec(e);return u?(i=u[0].charCodeAt(0)!==a,e.substring(t,u.index)):(o.lastIndex=e.length,e.substring(t))}var r,i,s={},l={},u=[],c=0;o.lastIndex=0;while((r=n())!==l){var h=[];while(r!==s&&r!==l)h.push(r),r=n();t&&!(h=t(h,c++))||u.push(h)}return u},n.format=function(e){return e.map(r).join("\n")},n}function zn(e,t){return function(n){return n&&e.hasOwnProperty(n.type)?e[n.type](n):t}}function Un(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function jn(e,t){ho.hasOwnProperty(e.type)&&ho[e.type](e,t)}function Bn(e,t){jn(e.geometry,t)}function Hn(e,t){for(var n=e.features,r=0,i=n.length;r<i;r++)jn(n[r].geometry,t)}function Gn(e,t){for(var n=e.geometries,r=0,i=n.length;r<i;r++)jn(n[r],t)}function qn(e,t){for(var n=e.coordinates,r=0,i=n.length;r<i;r++)t.apply(null,n[r])}function Wn(e,t){for(var n=e.coordinates,r=0,i=n.length;r<i;r++)for(var o=n[r],s=0,a=o.length;s<a;s++)t.apply(null,o[s])}function $n(e,t){for(var n=e.coordinates,r=0,i=n.length;r<i;r++)for(var o=n[r][0],s=0,a=o.length;s<a;s++)t.apply(null,o[s])}function Xn(e,t){t.apply(null,e.coordinates)}function Yn(e,t){for(var n=e.coordinates[0],r=0,i=n.length;r<i;r++)t.apply(null,n[r])}function Zn(e){return e.source}function Jn(e){return e.target}function Qn(){function e(e){var t=Math.sin(e*=p)*f,n=Math.sin(p-e)*f,r=n*o+t*h,a=n*s+t*d,l=n*i+t*c;return[Math.atan2(a,r)/co,Math.atan2(l,Math.sqrt(r*r+a*a))/co]}var t,n,r,i,o,s,a,l,u,c,h,d,p,f;return e.distance=function(){return null==p&&(f=1/Math.sin(p=Math.acos(Math.max(-1,Math.min(1,i*c+r*u*Math.cos(a-t)))))),p},e.source=function(a){var l=Math.cos(t=a[0]*co),u=Math.sin(t);return r=Math.cos(n=a[1]*co),i=Math.sin(n),o=r*l,s=r*u,p=null,e},e.target=function(t){var n=Math.cos(a=t[0]*co),r=Math.sin(a);return u=Math.cos(l=t[1]*co),c=Math.sin(l),h=u*n,d=u*r,p=null,e},e}function Kn(e,t){var n=Qn().source(e).target(t);return n.distance(),n}function er(e){var t=0,n=0;while(1){if(e(t,n))return[t,n];0===t?(t=n+1,n=0):(t-=1,n+=1)}}function tr(e,t,n,r){var i,o,s,a,l,u,c;return i=r[e],o=i[0],s=i[1],i=r[t],a=i[0],l=i[1],i=r[n],u=i[0],c=i[1],(c-s)*(a-o)-(l-s)*(u-o)>0}function nr(e,t,n){return(n[0]-t[0])*(e[1]-t[1])<(n[1]-t[1])*(e[0]-t[0])}function rr(e,t,n,r){var i=e[0],o=t[0],s=n[0],a=r[0],l=e[1],u=t[1],c=n[1],h=r[1],d=i-s,p=o-i,f=a-s,m=l-c,g=u-l,v=h-c,y=(f*m-v*d)/(v*p-f*g);return[i+y*p,l+y*g]}function ir(e,t){var n={list:e.map((function(e,t){return{index:t,x:e[0],y:e[1]}})).sort((function(e,t){return e.y<t.y?-1:e.y>t.y?1:e.x<t.x?-1:e.x>t.x?1:0})),bottomSite:null},r={list:[],leftEnd:null,rightEnd:null,init:function(){r.leftEnd=r.createHalfEdge(null,"l"),r.rightEnd=r.createHalfEdge(null,"l"),r.leftEnd.r=r.rightEnd,r.rightEnd.l=r.leftEnd,r.list.unshift(r.leftEnd,r.rightEnd)},createHalfEdge:function(e,t){return{edge:e,side:t,vertex:null,l:null,r:null}},insert:function(e,t){t.l=e,t.r=e.r,e.r.l=t,e.r=t},leftBound:function(e){var t=r.leftEnd;do{t=t.r}while(t!=r.rightEnd&&i.rightOf(t,e));return t=t.l,t},del:function(e){e.l.r=e.r,e.r.l=e.l,e.edge=null},right:function(e){return e.r},left:function(e){return e.l},leftRegion:function(e){return null==e.edge?n.bottomSite:e.edge.region[e.side]},rightRegion:function(e){return null==e.edge?n.bottomSite:e.edge.region[mo[e.side]]}},i={bisect:function(e,t){var n={region:{l:e,r:t},ep:{l:null,r:null}},r=t.x-e.x,i=t.y-e.y,o=r>0?r:-r,s=i>0?i:-i;return n.c=e.x*r+e.y*i+.5*(r*r+i*i),o>s?(n.a=1,n.b=i/r,n.c/=r):(n.b=1,n.a=r/i,n.c/=i),n},intersect:function(e,t){var n=e.edge,r=t.edge;if(!n||!r||n.region.r==r.region.r)return null;var i=n.a*r.b-n.b*r.a;if(Math.abs(i)<1e-10)return null;var o,s,a=(n.c*r.b-r.c*n.b)/i,l=(r.c*n.a-n.c*r.a)/i,u=n.region.r,c=r.region.r;u.y<c.y||u.y==c.y&&u.x<c.x?(o=e,s=n):(o=t,s=r);var h=a>=s.region.r.x;return h&&"l"===o.side||!h&&"r"===o.side?null:{x:a,y:l}},rightOf:function(e,t){var n=e.edge,r=n.region.r,i=t.x>r.x;if(i&&"l"===e.side)return 1;if(!i&&"r"===e.side)return 0;if(1===n.a){var o=t.y-r.y,s=t.x-r.x,a=0,l=0;if(!i&&n.b<0||i&&n.b>=0?l=a=o>=n.b*s:(l=t.x+t.y*n.b>n.c,n.b<0&&(l=!l),l||(a=1)),!a){var u=r.x-n.region.l.x;l=n.b*(s*s-o*o)<u*o*(1+2*s/u+n.b*n.b),n.b<0&&(l=!l)}}else{var c=n.c-n.a*t.x,h=t.y-c,d=t.x-r.x,p=c-r.y;l=h*h>d*d+p*p}return"l"===e.side?l:!l},endPoint:function(e,n,r){e.ep[n]=r,e.ep[mo[n]]&&t(e)},distance:function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}},o={list:[],insert:function(e,t,n){e.vertex=t,e.ystar=t.y+n;for(var r=0,i=o.list,s=i.length;r<s;r++){var a=i[r];if(!(e.ystar>a.ystar||e.ystar==a.ystar&&t.x>a.vertex.x))break}i.splice(r,0,e)},del:function(e){for(var t=0,n=o.list,r=n.length;t<r&&n[t]!=e;++t);n.splice(t,1)},empty:function(){return 0===o.list.length},nextEvent:function(e){for(var t=0,n=o.list,r=n.length;t<r;++t)if(n[t]==e)return n[t+1];return null},min:function(){var e=o.list[0];return{x:e.vertex.x,y:e.ystar}},extractMin:function(){return o.list.shift()}};r.init(),n.bottomSite=n.list.shift();var s,a,l,u,c,h,d,p,f,m,g,v,y,x=n.list.shift();while(1)if(o.empty()||(s=o.min()),x&&(o.empty()||x.y<s.y||x.y==s.y&&x.x<s.x))a=r.leftBound(x),l=r.right(a),d=r.rightRegion(a),v=i.bisect(d,x),h=r.createHalfEdge(v,"l"),r.insert(a,h),m=i.intersect(a,h),m&&(o.del(a),o.insert(a,m,i.distance(m,x))),a=h,h=r.createHalfEdge(v,"r"),r.insert(a,h),m=i.intersect(h,l),m&&o.insert(h,m,i.distance(m,x)),x=n.list.shift();else{if(o.empty())break;a=o.extractMin(),u=r.left(a),l=r.right(a),c=r.right(l),d=r.leftRegion(a),p=r.rightRegion(l),g=a.vertex,i.endPoint(a.edge,a.side,g),i.endPoint(l.edge,l.side,g),r.del(a),o.del(l),r.del(l),y="l",d.y>p.y&&(f=d,d=p,p=f,y="r"),v=i.bisect(d,p),h=r.createHalfEdge(v,y),r.insert(u,h),i.endPoint(v,mo[y],g),m=i.intersect(u,h),m&&(o.del(u),o.insert(u,m,i.distance(m,d))),m=i.intersect(h,c),m&&o.insert(h,m,i.distance(m,d))}for(a=r.right(r.leftEnd);a!=r.rightEnd;a=r.right(a))t(a.edge)}function or(){return{leaf:!0,nodes:[],point:null}}function sr(e,t,n,r,i,o){if(!e(t,n,r,i,o)){var s=.5*(n+i),a=.5*(r+o),l=t.nodes;l[0]&&sr(e,l[0],n,r,s,a),l[1]&&sr(e,l[1],s,r,i,a),l[2]&&sr(e,l[2],n,a,s,o),l[3]&&sr(e,l[3],s,a,i,o)}}function ar(e){return{x:e[0],y:e[1]}}function lr(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function ur(e){return e.substring(0,3)}function cr(e,t,n,r){var i,o,s=0,a=t.length,l=n.length;while(s<a){if(r>=l)return-1;if(i=t.charCodeAt(s++),37==i){if(o=Fo[t.charAt(s++)],!o||(r=o(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}function hr(e){return new RegExp("^(?:"+e.map(d3.requote).join("|")+")","i")}function dr(e){var t=new r,n=-1,i=e.length;while(++n<i)t.set(e[n].toLowerCase(),n);return t}function pr(e,t,n){Lo.lastIndex=0;var r=Lo.exec(t.substring(n));return r?n+=r[0].length:-1}function fr(e,t,n){Ro.lastIndex=0;var r=Ro.exec(t.substring(n));return r?n+=r[0].length:-1}function mr(e,t,n){Io.lastIndex=0;var r=Io.exec(t.substring(n));return r?(e.m=ko.get(r[0].toLowerCase()),n+=r[0].length):-1}function gr(e,t,n){Oo.lastIndex=0;var r=Oo.exec(t.substring(n));return r?(e.m=Do.get(r[0].toLowerCase()),n+=r[0].length):-1}function vr(e,t,n){return cr(e,No.c.toString(),t,n)}function yr(e,t,n){return cr(e,No.x.toString(),t,n)}function xr(e,t,n){return cr(e,No.X.toString(),t,n)}function br(e,t,n){Vo.lastIndex=0;var r=Vo.exec(t.substring(n,n+4));return r?(e.y=+r[0],n+=r[0].length):-1}function wr(e,t,n){Vo.lastIndex=0;var r=Vo.exec(t.substring(n,n+2));return r?(e.y=_r(+r[0]),n+=r[0].length):-1}function _r(e){return e+(e>68?1900:2e3)}function Ar(e,t,n){Vo.lastIndex=0;var r=Vo.exec(t.substring(n,n+2));return r?(e.m=r[0]-1,n+=r[0].length):-1}function Sr(e,t,n){Vo.lastIndex=0;var r=Vo.exec(t.substring(n,n+2));return r?(e.d=+r[0],n+=r[0].length):-1}function Er(e,t,n){Vo.lastIndex=0;var r=Vo.exec(t.substring(n,n+2));return r?(e.H=+r[0],n+=r[0].length):-1}function Mr(e,t,n){Vo.lastIndex=0;var r=Vo.exec(t.substring(n,n+2));return r?(e.M=+r[0],n+=r[0].length):-1}function Tr(e,t,n){Vo.lastIndex=0;var r=Vo.exec(t.substring(n,n+2));return r?(e.S=+r[0],n+=r[0].length):-1}function Cr(e,t,n){Vo.lastIndex=0;var r=Vo.exec(t.substring(n,n+3));return r?(e.L=+r[0],n+=r[0].length):-1}function Pr(e,t,n){var r=zo.get(t.substring(n,n+=2).toLowerCase());return null==r?-1:(e.p=r,n)}function Rr(e){var t=e.getTimezoneOffset(),n=t>0?"-":"+",r=~~(Math.abs(t)/60),i=Math.abs(t)%60;return n+Mo(r)+Mo(i)}function Lr(e){return e.toISOString()}function Or(e,t,n){function r(t){var n=e(t),r=o(n,1);return t-n<r-t?n:r}function i(n){return t(n=e(new go(n-1)),1),n}function o(e,n){return t(e=new go(+e),n),e}function s(e,r,o){var s=i(e),a=[];if(o>1)while(s<r)n(s)%o||a.push(new Date(+s)),t(s,1);else while(s<r)a.push(new Date(+s)),t(s,1);return a}function a(e,t,n){try{go=lr;var r=new lr;return r._=e,s(r,t,n)}finally{go=Date}}e.floor=e,e.round=r,e.ceil=i,e.offset=o,e.range=s;var l=e.utc=Dr(e);return l.floor=l,l.round=Dr(r),l.ceil=Dr(i),l.offset=Dr(o),l.range=a,e}function Dr(e){return function(t,n){try{go=lr;var r=new lr;return r._=t,e(r,n)._}finally{go=Date}}}function Ir(e,t,n){function r(t){return e(t)}return r.invert=function(t){return Nr(e.invert(t))},r.domain=function(t){return arguments.length?(e.domain(t),r):e.domain().map(Nr)},r.nice=function(e){return r.domain(De(r.domain(),(function(){return e})))},r.ticks=function(n,i){var o=kr(r.domain());if("function"!==typeof n){var s=o[1]-o[0],a=s/n,l=d3.bisect(jo,a);if(l==jo.length)return t.year(o,n);if(!l)return e.ticks(n).map(Nr);Math.log(a/jo[l-1])<Math.log(jo[l]/a)&&--l,n=t[l],i=n[1],n=n[0].range}return n(o[0],new Date(+o[1]+1),i)},r.tickFormat=function(){return n},r.copy=function(){return Ir(e.copy(),t,n)},d3.rebind(r,e,"range","rangeRound","interpolate","clamp")}function kr(e){var t=e[0],n=e[e.length-1];return t<n?[t,n]:[n,t]}function Nr(e){return new Date(e)}function Fr(e){return function(t){var n=e.length-1,r=e[n];while(!r[1](t))r=e[--n];return r[0](t)}}function Vr(e){var t=new Date(e,0,1);return t.setFullYear(e),t}function zr(e){var t=e.getFullYear(),n=Vr(t),r=Vr(t+1);return t+(e-n)/(r-n)}function Ur(e){var t=new Date(Date.UTC(e,0,1));return t.setUTCFullYear(e),t}function jr(e){var t=e.getUTCFullYear(),n=Ur(t),r=Ur(t+1);return t+(e-n)/(r-n)}Date.now||(Date.now=function(){return+new Date});try{document.createElement("div").style.setProperty("opacity",0,"")}catch(Yo){var Br=CSSStyleDeclaration.prototype,Hr=Br.setProperty;Br.setProperty=function(e,t,n){Hr.call(this,e,t+"",n)}}d3={version:"2.10.3"};var Gr=n;try{Gr(document.documentElement.childNodes)[0].nodeType}catch(Zo){Gr=t}var qr=[].__proto__?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)e[n]=t[n]};d3.map=function(e){var t=new r;for(var n in e)t.set(n,e[n]);return t},e(r,{has:function(e){return Wr+e in this},get:function(e){return this[Wr+e]},set:function(e,t){return this[Wr+e]=t},remove:function(e){return e=Wr+e,e in this&&delete this[e]},keys:function(){var e=[];return this.forEach((function(t){e.push(t)})),e},values:function(){var e=[];return this.forEach((function(t,n){e.push(n)})),e},entries:function(){var e=[];return this.forEach((function(t,n){e.push({key:t,value:n})})),e},forEach:function(e){for(var t in this)t.charCodeAt(0)===$r&&e.call(this,t.substring(1),this[t])}});var Wr="\0",$r=Wr.charCodeAt(0);d3.functor=a,d3.rebind=function(e,t){var n,r=1,i=arguments.length;while(++r<i)e[n=arguments[r]]=l(e,t,t[n]);return e},d3.ascending=function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN},d3.descending=function(e,t){return t<e?-1:t>e?1:t>=e?0:NaN},d3.mean=function(e,t){var n,r=e.length,i=0,o=-1,s=0;if(1===arguments.length)while(++o<r)u(n=e[o])&&(i+=(n-i)/++s);else while(++o<r)u(n=t.call(e,e[o],o))&&(i+=(n-i)/++s);return s?i:void 0},d3.median=function(e,t){return arguments.length>1&&(e=e.map(t)),e=e.filter(u),e.length?d3.quantile(e.sort(d3.ascending),.5):void 0},d3.min=function(e,t){var n,r,i=-1,o=e.length;if(1===arguments.length){while(++i<o&&(null==(n=e[i])||n!=n))n=void 0;while(++i<o)null!=(r=e[i])&&n>r&&(n=r)}else{while(++i<o&&(null==(n=t.call(e,e[i],i))||n!=n))n=void 0;while(++i<o)null!=(r=t.call(e,e[i],i))&&n>r&&(n=r)}return n},d3.max=function(e,t){var n,r,i=-1,o=e.length;if(1===arguments.length){while(++i<o&&(null==(n=e[i])||n!=n))n=void 0;while(++i<o)null!=(r=e[i])&&r>n&&(n=r)}else{while(++i<o&&(null==(n=t.call(e,e[i],i))||n!=n))n=void 0;while(++i<o)null!=(r=t.call(e,e[i],i))&&r>n&&(n=r)}return n},d3.extent=function(e,t){var n,r,i,o=-1,s=e.length;if(1===arguments.length){while(++o<s&&(null==(n=i=e[o])||n!=n))n=i=void 0;while(++o<s)null!=(r=e[o])&&(n>r&&(n=r),i<r&&(i=r))}else{while(++o<s&&(null==(n=i=t.call(e,e[o],o))||n!=n))n=void 0;while(++o<s)null!=(r=t.call(e,e[o],o))&&(n>r&&(n=r),i<r&&(i=r))}return[n,i]},d3.random={normal:function(e,t){var n=arguments.length;return n<2&&(t=1),n<1&&(e=0),function(){var n,r,i;do{n=2*Math.random()-1,r=2*Math.random()-1,i=n*n+r*r}while(!i||i>1);return e+t*n*Math.sqrt(-2*Math.log(i)/i)}},logNormal:function(e,t){var n=arguments.length;n<2&&(t=1),n<1&&(e=0);var r=d3.random.normal();return function(){return Math.exp(e+t*r())}},irwinHall:function(e){return function(){for(var t=0,n=0;n<e;n++)t+=Math.random();return t/e}}},d3.sum=function(e,t){var n,r=0,i=e.length,o=-1;if(1===arguments.length)while(++o<i)isNaN(n=+e[o])||(r+=n);else while(++o<i)isNaN(n=+t.call(e,e[o],o))||(r+=n);return r},d3.quantile=function(e,t){var n=(e.length-1)*t+1,r=Math.floor(n),i=e[r-1],o=n-r;return o?i+o*(e[r]-i):i},d3.transpose=function(e){return d3.zip.apply(d3,e)},d3.zip=function(){if(!(r=arguments.length))return[];for(var e=-1,t=d3.min(arguments,c),n=new Array(t);++e<t;)for(var r,i=-1,o=n[e]=new Array(r);++i<r;)o[i]=arguments[i][e];return n},d3.bisector=function(e){return{left:function(t,n,r,i){arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);while(r<i){var o=r+i>>>1;e.call(t,t[o],o)<n?r=o+1:i=o}return r},right:function(t,n,r,i){arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);while(r<i){var o=r+i>>>1;n<e.call(t,t[o],o)?i=o:r=o+1}return r}}};var Xr=d3.bisector((function(e){return e}));d3.bisectLeft=Xr.left,d3.bisect=d3.bisectRight=Xr.right,d3.first=function(e,t){var n,r=0,i=e.length,o=e[0];1===arguments.length&&(t=d3.ascending);while(++r<i)t.call(e,o,n=e[r])>0&&(o=n);return o},d3.last=function(e,t){var n,r=0,i=e.length,o=e[0];1===arguments.length&&(t=d3.ascending);while(++r<i)t.call(e,o,n=e[r])<=0&&(o=n);return o},d3.nest=function(){function e(t,a){if(a>=s.length)return i?i.call(o,t):n?t.sort(n):t;var l,u,c,h=-1,d=t.length,p=s[a++],f=new r,m={};while(++h<d)(c=f.get(l=p(u=t[h])))?c.push(u):f.set(l,[u]);return f.forEach((function(t,n){m[t]=e(n,a)})),m}function t(e,n){if(n>=s.length)return e;var r,i=[],o=a[n++];for(r in e)i.push({key:r,values:t(e[r],n)});return o&&i.sort((function(e,t){return o(e.key,t.key)})),i}var n,i,o={},s=[],a=[];return o.map=function(t){return e(t,0)},o.entries=function(n){return t(e(n,0),0)},o.key=function(e){return s.push(e),o},o.sortKeys=function(e){return a[s.length-1]=e,o},o.sortValues=function(e){return n=e,o},o.rollup=function(e){return i=e,o},o},d3.keys=function(e){var t=[];for(var n in e)t.push(n);return t},d3.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},d3.entries=function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t},d3.permute=function(e,t){var n=[],r=-1,i=t.length;while(++r<i)n[r]=e[t[r]];return n},d3.merge=function(e){return Array.prototype.concat.apply([],e)},d3.split=function(e,t){var n,r=[],i=[],o=-1,s=e.length;arguments.length<2&&(t=h);while(++o<s)t.call(i,n=e[o],o)?i=[]:(i.length||r.push(i),i.push(n));return r},d3.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n===1/0)throw new Error("infinite range");var r,i=[],o=p(Math.abs(n)),s=-1;if(e*=o,t*=o,n*=o,n<0)while((r=e+n*++s)>t)i.push(r/o);else while((r=e+n*++s)<t)i.push(r/o);return i},d3.requote=function(e){return e.replace(Yr,"\\$&")};var Yr=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g;d3.round=function(e,t){return t?Math.round(e*(t=Math.pow(10,t)))/t:Math.round(e)},d3.xhr=function(e,t,n){var r=new XMLHttpRequest;arguments.length<3?(n=t,t=null):t&&r.overrideMimeType&&r.overrideMimeType(t),r.open("GET",e,!0),t&&r.setRequestHeader("Accept",t),r.onreadystatechange=function(){if(4===r.readyState){var e=r.status;n(!e&&r.response||e>=200&&e<300||304===e?r:null)}},r.send(null)},d3.text=function(e,t,n){function r(e){n(e&&e.responseText)}arguments.length<3&&(n=t,t=null),d3.xhr(e,t,r)},d3.json=function(e,t){d3.text(e,"application/json",(function(e){t(e?JSON.parse(e):null)}))},d3.html=function(e,t){d3.text(e,"text/html",(function(e){if(null!=e){var n=document.createRange();n.selectNode(document.body),e=n.createContextualFragment(e)}t(e)}))},d3.xml=function(e,t,n){function r(e){n(e&&e.responseXML)}arguments.length<3&&(n=t,t=null),d3.xhr(e,t,r)};var Zr={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};d3.ns={prefix:Zr,qualify:function(e){var t=e.indexOf(":"),n=e;return t>=0&&(n=e.substring(0,t),e=e.substring(t+1)),Zr.hasOwnProperty(n)?{space:Zr[n],local:e}:e}},d3.dispatch=function(){var e=new f,t=-1,n=arguments.length;while(++t<n)e[arguments[t]]=m(e);return e},f.prototype.on=function(e,t){var n=e.indexOf("."),r="";return n>0&&(r=e.substring(n+1),e=e.substring(0,n)),arguments.length<2?this[e].on(r):this[e].on(r,t)},d3.format=function(e){var t=Jr.exec(e),n=t[1]||" ",r=t[3]||"",i=t[5],o=+t[6],s=t[7],a=t[8],l=t[9],u=1,c="",h=!1;switch(a&&(a=+a.substring(1)),i&&(n="0",s&&(o-=Math.floor((o-1)/4))),l){case"n":s=!0,l="g";break;case"%":u=100,c="%",l="f";break;case"p":u=100,c="%",l="r";break;case"d":h=!0,a=0;break;case"s":u=-1,l="r";break}return"r"!=l||a||(l="g"),l=Qr.get(l)||v,function(e){if(h&&e%1)return"";var t=e<0&&(e=-e)?"-":r;if(u<0){var d=d3.formatPrefix(e,a);e=d.scale(e),c=d.symbol}else e*=u;if(e=l(e,a),i){var p=e.length+t.length;p<o&&(e=new Array(o-p+1).join(n)+e),s&&(e=y(e)),e=t+e}else{s&&(e=y(e)),e=t+e;p=e.length;p<o&&(e=new Array(o-p+1).join(n)+e)}return e+c}};var Jr=/(?:([^{])?([<>=^]))?([+\- ])?(#)?(0)?([0-9]+)?(,)?(\.[0-9]+)?([a-zA-Z%])?/,Qr=d3.map({g:function(e,t){return e.toPrecision(t)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},r:function(e,t){return d3.round(e,t=g(e,t)).toFixed(Math.max(0,Math.min(20,t)))}}),Kr=["y","z","a","f","p","n","μ","m","","k","M","G","T","P","E","Z","Y"].map(x);d3.formatPrefix=function(e,t){var n=0;return e&&(e<0&&(e*=-1),t&&(e=d3.round(e,g(e,t))),n=1+Math.floor(1e-12+Math.log(e)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((n<=0?n+1:n-1)/3)))),Kr[8+n/3]};var ei=S(2),ti=S(3),ni=function(){return A},ri=d3.map({linear:ni,poly:S,quad:function(){return ei},cubic:function(){return ti},sin:function(){return E},exp:function(){return M},circle:function(){return T},elastic:C,back:P,bounce:function(){return R}}),ii=d3.map({in:A,out:w,"in-out":_,"out-in":function(e){return _(w(e))}});d3.ease=function(e){var t=e.indexOf("-"),n=t>=0?e.substring(0,t):e,r=t>=0?e.substring(t+1):"in";return n=ri.get(n)||ni,r=ii.get(r)||A,b(r(n.apply(null,Array.prototype.slice.call(arguments,1))))},d3.event=null,d3.transform=function(e){var t=document.createElementNS(d3.ns.prefix.svg,"g");return(d3.transform=function(e){t.setAttribute("transform",e);var n=t.transform.baseVal.consolidate();return new I(n?n.matrix:si)})(e)},I.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var oi=180/Math.PI,si={a:1,b:0,c:0,d:1,e:0,f:0};d3.interpolate=function(e,t){var n,r=d3.interpolators.length;while(--r>=0&&!(n=d3.interpolators[r](e,t)));return n},d3.interpolateNumber=function(e,t){return t-=e,function(n){return e+t*n}},d3.interpolateRound=function(e,t){return t-=e,function(n){return Math.round(e+t*n)}},d3.interpolateString=function(e,t){var n,r,i,o,s,a=0,l=[],u=[];for(ai.lastIndex=0,r=0;n=ai.exec(t);++r)n.index&&l.push(t.substring(a,n.index)),u.push({i:l.length,x:n[0]}),l.push(null),a=ai.lastIndex;for(a<t.length&&l.push(t.substring(a)),r=0,o=u.length;(n=ai.exec(e))&&r<o;++r)if(s=u[r],s.x==n[0]){if(s.i)if(null==l[s.i+1])for(l[s.i-1]+=s.x,l.splice(s.i,1),i=r+1;i<o;++i)u[i].i--;else for(l[s.i-1]+=s.x+l[s.i+1],l.splice(s.i,2),i=r+1;i<o;++i)u[i].i-=2;else if(null==l[s.i+1])l[s.i]=s.x;else for(l[s.i]=s.x+l[s.i+1],l.splice(s.i+1,1),i=r+1;i<o;++i)u[i].i--;u.splice(r,1),o--,r--}else s.x=d3.interpolateNumber(parseFloat(n[0]),parseFloat(s.x));while(r<o)s=u.pop(),null==l[s.i+1]?l[s.i]=s.x:(l[s.i]=s.x+l[s.i+1],l.splice(s.i+1,1)),o--;return 1===l.length?null==l[0]?u[0].x:function(){return t}:function(e){for(r=0;r<o;++r)l[(s=u[r]).i]=s.x(e);return l.join("")}},d3.interpolateTransform=function(e,t){var n,r=[],i=[],o=d3.transform(e),s=d3.transform(t),a=o.translate,l=s.translate,u=o.rotate,c=s.rotate,h=o.skew,d=s.skew,p=o.scale,f=s.scale;return a[0]!=l[0]||a[1]!=l[1]?(r.push("translate(",null,",",null,")"),i.push({i:1,x:d3.interpolateNumber(a[0],l[0])},{i:3,x:d3.interpolateNumber(a[1],l[1])})):l[0]||l[1]?r.push("translate("+l+")"):r.push(""),u!=c?(u-c>180?c+=360:c-u>180&&(u+=360),i.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:d3.interpolateNumber(u,c)})):c&&r.push(r.pop()+"rotate("+c+")"),h!=d?i.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:d3.interpolateNumber(h,d)}):d&&r.push(r.pop()+"skewX("+d+")"),p[0]!=f[0]||p[1]!=f[1]?(n=r.push(r.pop()+"scale(",null,",",null,")"),i.push({i:n-4,x:d3.interpolateNumber(p[0],f[0])},{i:n-2,x:d3.interpolateNumber(p[1],f[1])})):1==f[0]&&1==f[1]||r.push(r.pop()+"scale("+f+")"),n=i.length,function(e){var t,o=-1;while(++o<n)r[(t=i[o]).i]=t.x(e);return r.join("")}},d3.interpolateRgb=function(e,t){e=d3.rgb(e),t=d3.rgb(t);var n=e.r,r=e.g,i=e.b,o=t.r-n,s=t.g-r,a=t.b-i;return function(e){return"#"+G(Math.round(n+o*e))+G(Math.round(r+s*e))+G(Math.round(i+a*e))}},d3.interpolateHsl=function(e,t){e=d3.hsl(e),t=d3.hsl(t);var n=e.h,r=e.s,i=e.l,o=t.h-n,s=t.s-r,a=t.l-i;return o>180?o-=360:o<-180&&(o+=360),function(e){return Q(n+o*e,r+s*e,i+a*e)+""}},d3.interpolateLab=function(e,t){e=d3.lab(e),t=d3.lab(t);var n=e.l,r=e.a,i=e.b,o=t.l-n,s=t.a-r,a=t.b-i;return function(e){return ie(n+o*e,r+s*e,i+a*e)+""}},d3.interpolateHcl=function(e,t){e=d3.hcl(e),t=d3.hcl(t);var n=e.h,r=e.c,i=e.l,o=t.h-n,s=t.c-r,a=t.l-i;return o>180?o-=360:o<-180&&(o+=360),function(e){return te(n+o*e,r+s*e,i+a*e)+""}},d3.interpolateArray=function(e,t){var n,r=[],i=[],o=e.length,s=t.length,a=Math.min(e.length,t.length);for(n=0;n<a;++n)r.push(d3.interpolate(e[n],t[n]));for(;n<o;++n)i[n]=e[n];for(;n<s;++n)i[n]=t[n];return function(e){for(n=0;n<a;++n)i[n]=r[n](e);return i}},d3.interpolateObject=function(e,t){var n,r={},i={};for(n in e)n in t?r[n]=V(n)(e[n],t[n]):i[n]=e[n];for(n in t)n in e||(i[n]=t[n]);return function(e){for(n in r)i[n]=r[n](e);return i}};var ai=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;d3.interpolators=[d3.interpolateObject,function(e,t){return t instanceof Array&&d3.interpolateArray(e,t)},function(e,t){return("string"===typeof e||"string"===typeof t)&&d3.interpolateString(e+"",t+"")},function(e,t){return("string"===typeof t?ui.has(t)||/^(#|rgb\(|hsl\()/.test(t):t instanceof j)&&d3.interpolateRgb(e,t)},function(e,t){return!isNaN(e=+e)&&!isNaN(t=+t)&&d3.interpolateNumber(e,t)}],j.prototype.toString=function(){return this.rgb()+""},d3.rgb=function(e,t,n){return 1===arguments.length?e instanceof H?B(e.r,e.g,e.b):q(""+e,B,Q):B(~~e,~~t,~~n)};var li=H.prototype=new j;li.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,n=this.g,r=this.b,i=30;return t||n||r?(t&&t<i&&(t=i),n&&n<i&&(n=i),r&&r<i&&(r=i),B(Math.min(255,Math.floor(t/e)),Math.min(255,Math.floor(n/e)),Math.min(255,Math.floor(r/e)))):B(i,i,i)},li.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),B(Math.floor(e*this.r),Math.floor(e*this.g),Math.floor(e*this.b))},li.hsl=function(){return W(this.r,this.g,this.b)},li.toString=function(){return"#"+G(this.r)+G(this.g)+G(this.b)};var ui=d3.map({aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"});ui.forEach((function(e,t){ui.set(e,q(t,B,Q))})),d3.hsl=function(e,t,n){return 1===arguments.length?e instanceof J?Z(e.h,e.s,e.l):q(""+e,W,Z):Z(+e,+t,+n)};var ci=J.prototype=new j;ci.brighter=function(e){return e=Math.pow(.7,arguments.length?e:1),Z(this.h,this.s,this.l/e)},ci.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),Z(this.h,this.s,e*this.l)},ci.rgb=function(){return Q(this.h,this.s,this.l)},d3.hcl=function(e,t,n){return 1===arguments.length?e instanceof ee?K(e.h,e.c,e.l):oe(e instanceof re?e.l:(e=$((e=d3.rgb(e)).r,e.g,e.b)).l,e.a,e.b):K(+e,+t,+n)};var hi=ee.prototype=new j;hi.brighter=function(e){return K(this.h,this.c,Math.min(100,this.l+di*(arguments.length?e:1)))},hi.darker=function(e){return K(this.h,this.c,Math.max(0,this.l-di*(arguments.length?e:1)))},hi.rgb=function(){return te(this.h,this.c,this.l).rgb()},d3.lab=function(e,t,n){return 1===arguments.length?e instanceof re?ne(e.l,e.a,e.b):e instanceof ee?te(e.l,e.c,e.h):$((e=d3.rgb(e)).r,e.g,e.b):ne(+e,+t,+n)};var di=18,pi=.95047,fi=1,mi=1.08883,gi=re.prototype=new j;gi.brighter=function(e){return ne(Math.min(100,this.l+di*(arguments.length?e:1)),this.a,this.b)},gi.darker=function(e){return ne(Math.max(0,this.l-di*(arguments.length?e:1)),this.a,this.b)},gi.rgb=function(){return ie(this.l,this.a,this.b)};var vi=function(e,t){return t.querySelector(e)},yi=function(e,t){return t.querySelectorAll(e)},xi=document.documentElement,bi=xi.matchesSelector||xi.webkitMatchesSelector||xi.mozMatchesSelector||xi.msMatchesSelector||xi.oMatchesSelector,wi=function(e,t){return bi.call(e,t)};"function"===typeof Sizzle&&(vi=function(e,t){return Sizzle(e,t)[0]||null},yi=function(e,t){return Sizzle.uniqueSort(Sizzle(e,t))},wi=Sizzle.matchesSelector);var _i=[];d3.selection=function(){return Ai},d3.selection.prototype=_i,_i.select=function(e){var t,n,r,i,o=[];"function"!==typeof e&&(e=ce(e));for(var s=-1,a=this.length;++s<a;){o.push(t=[]),t.parentNode=(r=this[s]).parentNode;for(var l=-1,u=r.length;++l<u;)(i=r[l])?(t.push(n=e.call(i,i.__data__,l)),n&&"__data__"in i&&(n.__data__=i.__data__)):t.push(null)}return ue(o)},_i.selectAll=function(e){var t,n,r=[];"function"!==typeof e&&(e=he(e));for(var i=-1,o=this.length;++i<o;)for(var s=this[i],a=-1,l=s.length;++a<l;)(n=s[a])&&(r.push(t=Gr(e.call(n,n.__data__,a))),t.parentNode=n);return ue(r)},_i.attr=function(e,t){if(arguments.length<2){if("string"===typeof e){var n=this.node();return e=d3.ns.qualify(e),e.local?n.getAttributeNS(e.space,e.local):n.getAttribute(e)}for(t in e)this.each(de(t,e[t]));return this}return this.each(de(e,t))},_i.classed=function(e,t){if(arguments.length<2){if("string"===typeof e){var n=this.node(),r=(e=e.trim().split(/^|\s+/g)).length,i=-1;if(t=n.classList){while(++i<r)if(!t.contains(e[i]))return!1}else{t=n.className,null!=t.baseVal&&(t=t.baseVal);while(++i<r)if(!pe(e[i]).test(t))return!1}return!0}for(t in e)this.each(fe(t,e[t]));return this}return this.each(fe(e,t))},_i.style=function(e,t,n){var r=arguments.length;if(r<3){if("string"!==typeof e){for(n in r<2&&(t=""),e)this.each(ge(n,e[n],t));return this}if(r<2)return window.getComputedStyle(this.node(),null).getPropertyValue(e);n=""}return this.each(ge(e,t,n))},_i.property=function(e,t){if(arguments.length<2){if("string"===typeof e)return this.node()[e];for(t in e)this.each(ve(t,e[t]));return this}return this.each(ve(e,t))},_i.text=function(e){return arguments.length<1?this.node().textContent:this.each("function"===typeof e?function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}:null==e?function(){this.textContent=""}:function(){this.textContent=e})},_i.html=function(e){return arguments.length<1?this.node().innerHTML:this.each("function"===typeof e?function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}:null==e?function(){this.innerHTML=""}:function(){this.innerHTML=e})},_i.append=function(e){function t(){return this.appendChild(document.createElementNS(this.namespaceURI,e))}function n(){return this.appendChild(document.createElementNS(e.space,e.local))}return e=d3.ns.qualify(e),this.select(e.local?n:t)},_i.insert=function(e,t){function n(){return this.insertBefore(document.createElementNS(this.namespaceURI,e),vi(t,this))}function r(){return this.insertBefore(document.createElementNS(e.space,e.local),vi(t,this))}return e=d3.ns.qualify(e),this.select(e.local?r:n)},_i.remove=function(){return this.each((function(){var e=this.parentNode;e&&e.removeChild(this)}))},_i.data=function(e,t){function n(e,n){var i,o,s,a=e.length,h=n.length,d=Math.min(a,h),p=Math.max(a,h),f=[],m=[],g=[];if(t){var v,y=new r,x=[],b=n.length;for(i=-1;++i<a;)v=t.call(o=e[i],o.__data__,i),y.has(v)?g[b++]=o:y.set(v,o),x.push(v);for(i=-1;++i<h;)v=t.call(n,s=n[i],i),y.has(v)?(f[i]=o=y.get(v),o.__data__=s,m[i]=g[i]=null):(m[i]=ye(s),f[i]=g[i]=null),y.remove(v);for(i=-1;++i<a;)y.has(x[i])&&(g[i]=e[i])}else{for(i=-1;++i<d;)o=e[i],s=n[i],o?(o.__data__=s,f[i]=o,m[i]=g[i]=null):(m[i]=ye(s),f[i]=g[i]=null);for(;i<h;++i)m[i]=ye(n[i]),f[i]=g[i]=null;for(;i<p;++i)g[i]=e[i],m[i]=f[i]=null}m.update=f,m.parentNode=f.parentNode=g.parentNode=e.parentNode,l.push(m),u.push(f),c.push(g)}var i,o,s=-1,a=this.length;if(!arguments.length){e=new Array(a=(i=this[0]).length);while(++s<a)(o=i[s])&&(e[s]=o.__data__);return e}var l=Ae([]),u=ue([]),c=ue([]);if("function"===typeof e)while(++s<a)n(i=this[s],e.call(i,i.parentNode.__data__,s));else while(++s<a)n(i=this[s],e);return u.enter=function(){return l},u.exit=function(){return c},u},_i.datum=_i.map=function(e){return arguments.length<1?this.property("__data__"):this.property("__data__",e)},_i.filter=function(e){var t,n,r,i=[];"function"!==typeof e&&(e=xe(e));for(var o=0,s=this.length;o<s;o++){i.push(t=[]),t.parentNode=(n=this[o]).parentNode;for(var a=0,l=n.length;a<l;a++)(r=n[a])&&e.call(r,r.__data__,a)&&t.push(r)}return ue(i)},_i.order=function(){for(var e=-1,t=this.length;++e<t;)for(var n,r=this[e],i=r.length-1,o=r[i];--i>=0;)(n=r[i])&&(o&&o!==n.nextSibling&&o.parentNode.insertBefore(n,o),o=n);return this},_i.sort=function(e){e=be.apply(this,arguments);for(var t=-1,n=this.length;++t<n;)this[t].sort(e);return this.order()},_i.on=function(e,t,n){var r=arguments.length;if(r<3){if("string"!==typeof e){for(n in r<2&&(t=!1),e)this.each(we(n,e[n],t));return this}if(r<2)return(r=this.node()["__on"+e])&&r._;n=!1}return this.each(we(e,t,n))},_i.each=function(e){return _e(this,(function(t,n,r){e.call(t,t.__data__,n,r)}))},_i.call=function(e){return e.apply(this,(arguments[0]=this,arguments)),this},_i.empty=function(){return!this.node()},_i.node=function(e){for(var t=0,n=this.length;t<n;t++)for(var r=this[t],i=0,o=r.length;i<o;i++){var s=r[i];if(s)return s}return null},_i.transition=function(){for(var e,t,n=[],r=-1,i=this.length;++r<i;){n.push(e=[]);for(var o=this[r],s=-1,a=o.length;++s<a;)e.push((t=o[s])?{node:t,delay:Li,duration:Oi}:null)}return Se(n,Ti||++Mi,Date.now())};var Ai=ue([[document]]);Ai[0].parentNode=xi,d3.select=function(e){return"string"===typeof e?Ai.select(e):ue([[e]])},d3.selectAll=function(e){return"string"===typeof e?Ai.selectAll(e):ue([Gr(e)])};var Si=[];d3.selection.enter=Ae,d3.selection.enter.prototype=Si,Si.append=_i.append,Si.insert=_i.insert,Si.empty=_i.empty,Si.node=_i.node,Si.select=function(e){for(var t,n,r,i,o,s=[],a=-1,l=this.length;++a<l;){r=(i=this[a]).update,s.push(t=[]),t.parentNode=i.parentNode;for(var u=-1,c=i.length;++u<c;)(o=i[u])?(t.push(r[u]=n=e.call(i.parentNode,o.__data__,u)),n.__data__=o.__data__):t.push(null)}return ue(s)};var Ei=[],Mi=0,Ti=0,Ci=0,Pi=250,Ri=d3.ease("cubic-in-out"),Li=Ci,Oi=Pi,Di=Ri;Ei.call=_i.call,d3.transition=function(e){return arguments.length?Ti?e.transition():e:Ai.transition()},d3.transition.prototype=Ei,Ei.select=function(e){var t,n,r,i=[];"function"!==typeof e&&(e=ce(e));for(var o=-1,s=this.length;++o<s;){i.push(t=[]);for(var a=this[o],l=-1,u=a.length;++l<u;)(r=a[l])&&(n=e.call(r.node,r.node.__data__,l))?("__data__"in r.node&&(n.__data__=r.node.__data__),t.push({node:n,delay:r.delay,duration:r.duration})):t.push(null)}return Se(i,this.id,this.time).ease(this.ease())},Ei.selectAll=function(e){var t,n,r,i=[];"function"!==typeof e&&(e=he(e));for(var o=-1,s=this.length;++o<s;)for(var a=this[o],l=-1,u=a.length;++l<u;)if(r=a[l]){n=e.call(r.node,r.node.__data__,l),i.push(t=[]);for(var c=-1,h=n.length;++c<h;)t.push({node:n[c],delay:r.delay,duration:r.duration})}return Se(i,this.id,this.time).ease(this.ease())},Ei.filter=function(e){var t,n,r=[];"function"!==typeof e&&(e=xe(e));for(var i=0,o=this.length;i<o;i++){r.push(t=[]);for(var s=this[i],a=0,l=s.length;a<l;a++)(n=s[a])&&e.call(n.node,n.node.__data__,a)&&t.push(n)}return Se(r,this.id,this.time).ease(this.ease())},Ei.attr=function(e,t){if(arguments.length<2){for(t in e)this.attrTween(t,Te(e[t],t));return this}return this.attrTween(e,Te(t,e))},Ei.attrTween=function(e,t){function n(e,n){var r=t.call(this,e,n,this.getAttribute(i));return r===Ni?(this.removeAttribute(i),null):r&&function(e){this.setAttribute(i,r(e))}}function r(e,n){var r=t.call(this,e,n,this.getAttributeNS(i.space,i.local));return r===Ni?(this.removeAttributeNS(i.space,i.local),null):r&&function(e){this.setAttributeNS(i.space,i.local,r(e))}}var i=d3.ns.qualify(e);return this.tween("attr."+e,i.local?r:n)},Ei.style=function(e,t,n){var r=arguments.length;if(r<3){if("string"!==typeof e){for(n in r<2&&(t=""),e)this.styleTween(n,Te(e[n],n),t);return this}n=""}return this.styleTween(e,Te(t,e),n)},Ei.styleTween=function(e,t,n){return arguments.length<3&&(n=""),this.tween("style."+e,(function(r,i){var o=t.call(this,r,i,window.getComputedStyle(this,null).getPropertyValue(e));return o===Ni?(this.style.removeProperty(e),null):o&&function(t){this.style.setProperty(e,o(t),n)}}))},Ei.text=function(e){return this.tween("text",(function(t,n){this.textContent="function"===typeof e?e.call(this,t,n):e}))},Ei.remove=function(){return this.each("end.transition",(function(){var e;!this.__transition__&&(e=this.parentNode)&&e.removeChild(this)}))},Ei.delay=function(e){return _e(this,"function"===typeof e?function(t,n,r){t.delay=0|e.call(t=t.node,t.__data__,n,r)}:(e|=0,function(t){t.delay=e}))},Ei.duration=function(e){return _e(this,"function"===typeof e?function(t,n,r){t.duration=Math.max(1,0|e.call(t=t.node,t.__data__,n,r))}:(e=Math.max(1,0|e),function(t){t.duration=e}))},Ei.transition=function(){return this.select(o)},d3.tween=function(e,t){function n(n,r,i){var o=e.call(this,n,r);return null==o?""!=i&&Ni:i!=o&&t(i,o+"")}function r(n,r,i){return i!=e&&t(i,e)}return"function"===typeof e?n:null==e?Me:(e+="",r)};var Ii,ki,Ni={},Fi=0,Vi={},zi=null;d3.timer=function(e,t,n){if(arguments.length<3){if(arguments.length<2)t=0;else if(!isFinite(t))return;n=Date.now()}var r=Vi[e.id];r&&r.callback===e?(r.then=n,r.delay=t):Vi[e.id=++Fi]=zi={callback:e,then:n,delay:t,next:zi},Ii||(ki=clearTimeout(ki),Ii=1,Ui(Ce))},d3.timer.flush=function(){var e,t=Date.now(),n=zi;while(n)e=t-n.then,n.delay||(n.flush=n.callback(e)),n=n.next;Pe()};var Ui=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,17)};d3.mouse=function(e){return Re(e,O())};var ji=/WebKit/.test(navigator.userAgent)?-1:0;d3.touches=function(e,t){return arguments.length<2&&(t=O().touches),t?Gr(t).map((function(t){var n=Re(e,t);return n.identifier=t.identifier,n})):[]},d3.scale={},d3.scale.linear=function(){return ke([0,1],[0,1],d3.interpolate,!1)},d3.scale.log=function(){return He(d3.scale.linear(),Ge)};var Bi=d3.format(".0e");Ge.pow=function(e){return Math.pow(10,e)},qe.pow=function(e){return-Math.pow(10,-e)},d3.scale.pow=function(){return We(d3.scale.linear(),1)},d3.scale.sqrt=function(){return d3.scale.pow().exponent(.5)},d3.scale.ordinal=function(){return Xe([],{t:"range",a:[[]]})},d3.scale.category10=function(){return d3.scale.ordinal().range(Hi)},d3.scale.category20=function(){return d3.scale.ordinal().range(Gi)},d3.scale.category20b=function(){return d3.scale.ordinal().range(qi)},d3.scale.category20c=function(){return d3.scale.ordinal().range(Wi)};var Hi=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],Gi=["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],qi=["#393b79","#5254a3","#6b6ecf","#9c9ede","#637939","#8ca252","#b5cf6b","#cedb9c","#8c6d31","#bd9e39","#e7ba52","#e7cb94","#843c39","#ad494a","#d6616b","#e7969c","#7b4173","#a55194","#ce6dbd","#de9ed6"],Wi=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"];d3.scale.quantile=function(){return Ye([],[])},d3.scale.quantize=function(){return Ze(0,1,[0,1])},d3.scale.threshold=function(){return Je([.5],[0,1])},d3.scale.identity=function(){return Qe([0,1])},d3.svg={},d3.svg.arc=function(){function e(){var e=t.apply(this,arguments),o=n.apply(this,arguments),s=r.apply(this,arguments)+$i,a=i.apply(this,arguments)+$i,l=(a<s&&(l=s,s=a,a=l),a-s),u=l<Math.PI?"0":"1",c=Math.cos(s),h=Math.sin(s),d=Math.cos(a),p=Math.sin(a);return l>=Xi?e?"M0,"+o+"A"+o+","+o+" 0 1,1 0,"+-o+"A"+o+","+o+" 0 1,1 0,"+o+"M0,"+e+"A"+e+","+e+" 0 1,0 0,"+-e+"A"+e+","+e+" 0 1,0 0,"+e+"Z":"M0,"+o+"A"+o+","+o+" 0 1,1 0,"+-o+"A"+o+","+o+" 0 1,1 0,"+o+"Z":e?"M"+o*c+","+o*h+"A"+o+","+o+" 0 "+u+",1 "+o*d+","+o*p+"L"+e*d+","+e*p+"A"+e+","+e+" 0 "+u+",0 "+e*c+","+e*h+"Z":"M"+o*c+","+o*h+"A"+o+","+o+" 0 "+u+",1 "+o*d+","+o*p+"L0,0Z"}var t=Ke,n=et,r=tt,i=nt;return e.innerRadius=function(n){return arguments.length?(t=a(n),e):t},e.outerRadius=function(t){return arguments.length?(n=a(t),e):n},e.startAngle=function(t){return arguments.length?(r=a(t),e):r},e.endAngle=function(t){return arguments.length?(i=a(t),e):i},e.centroid=function(){var e=(t.apply(this,arguments)+n.apply(this,arguments))/2,o=(r.apply(this,arguments)+i.apply(this,arguments))/2+$i;return[Math.cos(o)*e,Math.sin(o)*e]},e};var $i=-Math.PI/2,Xi=2*Math.PI-1e-6;d3.svg.line=function(){return rt(i)};var Yi=d3.map({linear:st,"linear-closed":at,"step-before":lt,"step-after":ut,basis:mt,"basis-open":gt,"basis-closed":vt,bundle:yt,cardinal:dt,"cardinal-open":ct,"cardinal-closed":ht,monotone:St});Yi.forEach((function(e,t){t.key=e,t.closed=/-closed$/.test(e)}));var Zi=[0,2/3,1/3,0],Ji=[0,1/3,2/3,0],Qi=[0,1/6,2/3,1/6];d3.svg.line.radial=function(){var e=rt(Et);return e.radius=e.x,delete e.x,e.angle=e.y,delete e.y,e},lt.reverse=ut,ut.reverse=lt,d3.svg.area=function(){return Mt(i)},d3.svg.area.radial=function(){var e=Mt(Et);return e.radius=e.x,delete e.x,e.innerRadius=e.x0,delete e.x0,e.outerRadius=e.x1,delete e.x1,e.angle=e.y,delete e.y,e.startAngle=e.y0,delete e.y0,e.endAngle=e.y1,delete e.y1,e},d3.svg.chord=function(){function e(e,a){var l=t(this,o,e,a),u=t(this,s,e,a);return"M"+l.p0+r(l.r,l.p1,l.a1-l.a0)+(n(l,u)?i(l.r,l.p1,l.r,l.p0):i(l.r,l.p1,u.r,u.p0)+r(u.r,u.p1,u.a1-u.a0)+i(u.r,u.p1,l.r,l.p0))+"Z"}function t(e,t,n,r){var i=t.call(e,n,r),o=l.call(e,i,r),s=u.call(e,i,r)+$i,a=c.call(e,i,r)+$i;return{r:o,a0:s,a1:a,p0:[o*Math.cos(s),o*Math.sin(s)],p1:[o*Math.cos(a),o*Math.sin(a)]}}function n(e,t){return e.a0==t.a0&&e.a1==t.a1}function r(e,t,n){return"A"+e+","+e+" 0 "+ +(n>Math.PI)+",1 "+t}function i(e,t,n,r){return"Q 0,0 "+r}var o=Tt,s=Ct,l=Pt,u=tt,c=nt;return e.radius=function(t){return arguments.length?(l=a(t),e):l},e.source=function(t){return arguments.length?(o=a(t),e):o},e.target=function(t){return arguments.length?(s=a(t),e):s},e.startAngle=function(t){return arguments.length?(u=a(t),e):u},e.endAngle=function(t){return arguments.length?(c=a(t),e):c},e},d3.svg.diagonal=function(){function e(e,i){var o=t.call(this,e,i),s=n.call(this,e,i),a=(o.y+s.y)/2,l=[o,{x:o.x,y:a},{x:s.x,y:a},s];return l=l.map(r),"M"+l[0]+"C"+l[1]+" "+l[2]+" "+l[3]}var t=Tt,n=Ct,r=Rt;return e.source=function(n){return arguments.length?(t=a(n),e):t},e.target=function(t){return arguments.length?(n=a(t),e):n},e.projection=function(t){return arguments.length?(r=t,e):r},e},d3.svg.diagonal.radial=function(){var e=d3.svg.diagonal(),t=Rt,n=e.projection;return e.projection=function(e){return arguments.length?n(Lt(t=e)):t},e},d3.svg.mouse=d3.mouse,d3.svg.touches=d3.touches,d3.svg.symbol=function(){function e(e,r){return(Ki.get(t.call(this,e,r))||It)(n.call(this,e,r))}var t=Dt,n=Ot;return e.type=function(n){return arguments.length?(t=a(n),e):t},e.size=function(t){return arguments.length?(n=a(t),e):n},e};var Ki=d3.map({circle:It,cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*to)),n=t*to;return"M0,"+-t+"L"+n+",0 0,"+t+" "+-n+",0Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/eo),n=t*eo/2;return"M0,"+n+"L"+t+","+-n+" "+-t+","+-n+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/eo),n=t*eo/2;return"M0,"+-n+"L"+t+","+n+" "+-t+","+n+"Z"}});d3.svg.symbolTypes=Ki.keys();var eo=Math.sqrt(3),to=Math.tan(30*Math.PI/180);d3.svg.axis=function(){function e(e){e.each((function(){var e,h=d3.select(this),d=null==u?n.ticks?n.ticks.apply(n,l):n.domain():u,p=null==t?n.tickFormat?n.tickFormat.apply(n,l):String:t,f=Ft(n,d,c),m=h.selectAll(".minor").data(f,String),g=m.enter().insert("line","g").attr("class","tick minor").style("opacity",1e-6),v=d3.transition(m.exit()).style("opacity",1e-6).remove(),y=d3.transition(m).style("opacity",1),x=h.selectAll("g").data(d,String),b=x.enter().insert("g","path").style("opacity",1e-6),w=d3.transition(x.exit()).style("opacity",1e-6).remove(),_=d3.transition(x).style("opacity",1),A=Oe(n),S=h.selectAll(".domain").data([0]),E=(S.enter().append("path").attr("class","domain"),d3.transition(S)),M=n.copy(),T=this.__chart__||M;this.__chart__=M,b.append("line").attr("class","tick"),b.append("text");var C=b.select("line"),P=_.select("line"),R=x.select("text").text(p),L=b.select("text"),O=_.select("text");switch(r){case"bottom":e=kt,g.attr("y2",o),y.attr("x2",0).attr("y2",o),C.attr("y2",i),L.attr("y",Math.max(i,0)+a),P.attr("x2",0).attr("y2",i),O.attr("x",0).attr("y",Math.max(i,0)+a),R.attr("dy",".71em").attr("text-anchor","middle"),E.attr("d","M"+A[0]+","+s+"V0H"+A[1]+"V"+s);break;case"top":e=kt,g.attr("y2",-o),y.attr("x2",0).attr("y2",-o),C.attr("y2",-i),L.attr("y",-(Math.max(i,0)+a)),P.attr("x2",0).attr("y2",-i),O.attr("x",0).attr("y",-(Math.max(i,0)+a)),R.attr("dy","0em").attr("text-anchor","middle"),E.attr("d","M"+A[0]+","+-s+"V0H"+A[1]+"V"+-s);break;case"left":e=Nt,g.attr("x2",-o),y.attr("x2",-o).attr("y2",0),C.attr("x2",-i),L.attr("x",-(Math.max(i,0)+a)),P.attr("x2",-i).attr("y2",0),O.attr("x",-(Math.max(i,0)+a)).attr("y",0),R.attr("dy",".32em").attr("text-anchor","end"),E.attr("d","M"+-s+","+A[0]+"H0V"+A[1]+"H"+-s);break;case"right":e=Nt,g.attr("x2",o),y.attr("x2",o).attr("y2",0),C.attr("x2",i),L.attr("x",Math.max(i,0)+a),P.attr("x2",i).attr("y2",0),O.attr("x",Math.max(i,0)+a).attr("y",0),R.attr("dy",".32em").attr("text-anchor","start"),E.attr("d","M"+s+","+A[0]+"H0V"+A[1]+"H"+s);break}if(n.ticks)b.call(e,T),_.call(e,M),w.call(e,M),g.call(e,T),y.call(e,M),v.call(e,M);else{var D=M.rangeBand()/2,I=function(e){return M(e)+D};b.call(e,I),_.call(e,I)}}))}var t,n=d3.scale.linear(),r="bottom",i=6,o=6,s=6,a=3,l=[10],u=null,c=0;return e.scale=function(t){return arguments.length?(n=t,e):n},e.orient=function(t){return arguments.length?(r=t,e):r},e.ticks=function(){return arguments.length?(l=arguments,e):l},e.tickValues=function(t){return arguments.length?(u=t,e):u},e.tickFormat=function(n){return arguments.length?(t=n,e):t},e.tickSize=function(t,n,r){if(!arguments.length)return i;var a=arguments.length-1;return i=+t,o=a>1?+n:i,s=a>0?+arguments[a]:i,e},e.tickPadding=function(t){return arguments.length?(a=+t,e):a},e.tickSubdivide=function(t){return arguments.length?(c=+t,e):c},e},d3.svg.brush=function(){function e(o){o.each((function(){var o,s=d3.select(this),c=s.selectAll(".background").data([0]),h=s.selectAll(".extent").data([0]),d=s.selectAll(".resize").data(u,String);s.style("pointer-events","all").on("mousedown.brush",i).on("touchstart.brush",i),c.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),h.enter().append("rect").attr("class","extent").style("cursor","move"),d.enter().append("g").attr("class",(function(e){return"resize "+e})).style("cursor",(function(e){return no[e]})).append("rect").attr("x",(function(e){return/[ew]$/.test(e)?-3:null})).attr("y",(function(e){return/^[ns]/.test(e)?-3:null})).attr("width",6).attr("height",6).style("visibility","hidden"),d.style("display",e.empty()?"none":null),d.exit().remove(),a&&(o=Oe(a),c.attr("x",o[0]).attr("width",o[1]-o[0]),n(s)),l&&(o=Oe(l),c.attr("y",o[0]).attr("height",o[1]-o[0]),r(s)),t(s)}))}function t(e){e.selectAll(".resize").attr("transform",(function(e){return"translate("+c[+/e$/.test(e)][0]+","+c[+/^s/.test(e)][1]+")"}))}function n(e){e.select(".extent").attr("x",c[0][0]),e.selectAll(".extent,.n>rect,.s>rect").attr("width",c[1][0]-c[0][0])}function r(e){e.select(".extent").attr("y",c[0][1]),e.selectAll(".extent,.e>rect,.w>rect").attr("height",c[1][1]-c[0][1])}function i(){function i(){var e=d3.event.changedTouches;return e?d3.touches(v,e)[0]:d3.mouse(v)}function u(){32==d3.event.keyCode&&(S||(m=null,E[0]-=c[1][0],E[1]-=c[1][1],S=2),L())}function h(){32==d3.event.keyCode&&2==S&&(E[0]+=c[1][0],E[1]+=c[1][1],S=0,L())}function d(){var e=i(),o=!1;g&&(e[0]+=g[0],e[1]+=g[1]),S||(d3.event.altKey?(m||(m=[(c[0][0]+c[1][0])/2,(c[0][1]+c[1][1])/2]),E[0]=c[+(e[0]<m[0])][0],E[1]=c[+(e[1]<m[1])][1]):m=null),_&&p(e,a,0)&&(n(b),o=!0),A&&p(e,l,1)&&(r(b),o=!0),o&&(t(b),x({type:"brush",mode:S?"move":"resize"}))}function p(e,t,n){var r,i,s=Oe(t),a=s[0],l=s[1],u=E[n],h=c[1][n]-c[0][n];if(S&&(a-=u,l-=h+u),r=Math.max(a,Math.min(l,e[n])),S?i=(r+=u)+h:(m&&(u=Math.max(a,Math.min(l,2*m[n]-r))),u<r?(i=r,r=u):i=u),c[0][n]!==r||c[1][n]!==i)return o=null,c[0][n]=r,c[1][n]=i,!0}function f(){d(),b.style("pointer-events","all").selectAll(".resize").style("display",e.empty()?"none":null),d3.select("body").style("cursor",null),M.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),x({type:"brushend"}),L()}var m,g,v=this,y=d3.select(d3.event.target),x=s.of(v,arguments),b=d3.select(v),w=y.datum(),_=!/^(n|s)$/.test(w)&&a,A=!/^(e|w)$/.test(w)&&l,S=y.classed("extent"),E=i(),M=d3.select(window).on("mousemove.brush",d).on("mouseup.brush",f).on("touchmove.brush",d).on("touchend.brush",f).on("keydown.brush",u).on("keyup.brush",h);if(S)E[0]=c[0][0]-E[0],E[1]=c[0][1]-E[1];else if(w){var T=+/w$/.test(w),C=+/^n/.test(w);g=[c[1-T][0]-E[0],c[1-C][1]-E[1]],E[0]=c[T][0],E[1]=c[C][1]}else d3.event.altKey&&(m=E.slice());b.style("pointer-events","none").selectAll(".resize").style("display",null),d3.select("body").style("cursor",y.style("cursor")),x({type:"brushstart"}),d(),L()}var o,s=D(e,"brushstart","brush","brushend"),a=null,l=null,u=ro[0],c=[[0,0],[0,0]];return e.x=function(t){return arguments.length?(a=t,u=ro[!a<<1|!l],e):a},e.y=function(t){return arguments.length?(l=t,u=ro[!a<<1|!l],e):l},e.extent=function(t){var n,r,i,s,u;return arguments.length?(o=[[0,0],[0,0]],a&&(n=t[0],r=t[1],l&&(n=n[0],r=r[0]),o[0][0]=n,o[1][0]=r,a.invert&&(n=a(n),r=a(r)),r<n&&(u=n,n=r,r=u),c[0][0]=0|n,c[1][0]=0|r),l&&(i=t[0],s=t[1],a&&(i=i[1],s=s[1]),o[0][1]=i,o[1][1]=s,l.invert&&(i=l(i),s=l(s)),s<i&&(u=i,i=s,s=u),c[0][1]=0|i,c[1][1]=0|s),e):(t=o||c,a&&(n=t[0][0],r=t[1][0],o||(n=c[0][0],r=c[1][0],a.invert&&(n=a.invert(n),r=a.invert(r)),r<n&&(u=n,n=r,r=u))),l&&(i=t[0][1],s=t[1][1],o||(i=c[0][1],s=c[1][1],l.invert&&(i=l.invert(i),s=l.invert(s)),s<i&&(u=i,i=s,s=u))),a&&l?[[n,i],[r,s]]:a?[n,r]:l&&[i,s])},e.clear=function(){return o=null,c[0][0]=c[0][1]=c[1][0]=c[1][1]=0,e},e.empty=function(){return a&&c[0][0]===c[1][0]||l&&c[0][1]===c[1][1]},d3.rebind(e,s,"on")};var no={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},ro=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]];d3.behavior={},d3.behavior.drag=function(){function e(){this.on("mousedown.drag",t).on("touchstart.drag",t)}function t(){function e(){var e=a.parentNode;return c?d3.touches(e).filter((function(e){return e.identifier===c}))[0]:d3.mouse(e)}function t(){if(!a.parentNode)return i();var t=e(),n=t[0]-h[0],r=t[1]-h[1];d|=n|r,h=t,L(),l({type:"drag",x:t[0]+s[0],y:t[1]+s[1],dx:n,dy:r})}function i(){l({type:"dragend"}),d&&(L(),d3.event.target===u&&p.on("click.drag",o,!0)),p.on(c?"touchmove.drag-"+c:"mousemove.drag",null).on(c?"touchend.drag-"+c:"mouseup.drag",null)}function o(){L(),p.on("click.drag",null)}var s,a=this,l=n.of(a,arguments),u=d3.event.target,c=d3.event.touches&&d3.event.changedTouches[0].identifier,h=e(),d=0,p=d3.select(window).on(c?"touchmove.drag-"+c:"mousemove.drag",t).on(c?"touchend.drag-"+c:"mouseup.drag",i,!0);r?(s=r.apply(a,arguments),s=[s.x-h[0],s.y-h[1]]):s=[0,0],c||L(),l({type:"dragstart"})}var n=D(e,"drag","dragstart","dragend"),r=null;return e.origin=function(t){return arguments.length?(r=t,e):r},d3.rebind(e,n,"on")},d3.behavior.zoom=function(){function e(){this.on("mousedown.zoom",s).on("mousewheel.zoom",a).on("mousemove.zoom",l).on("DOMMouseScroll.zoom",a).on("dblclick.zoom",u).on("touchstart.zoom",c).on("touchmove.zoom",h).on("touchend.zoom",c)}function t(e){return[(e[0]-x[0])/b,(e[1]-x[1])/b]}function n(e){return[e[0]*b+x[0],e[1]*b+x[1]]}function r(e){b=Math.max(w[0],Math.min(w[1],e))}function i(e,t){t=n(t),x[0]+=e[0]-t[0],x[1]+=e[1]-t[1]}function o(e){m&&m.domain(f.range().map((function(e){return(e-x[0])/b})).map(f.invert)),v&&v.domain(g.range().map((function(e){return(e-x[1])/b})).map(g.invert)),d3.event.preventDefault(),e({type:"zoom",scale:b,translate:x})}function s(){function e(){u=1,i(d3.mouse(s),h),o(a)}function n(){u&&L(),c.on("mousemove.zoom",null).on("mouseup.zoom",null),u&&d3.event.target===l&&c.on("click.zoom",r,!0)}function r(){L(),c.on("click.zoom",null)}var s=this,a=_.of(s,arguments),l=d3.event.target,u=0,c=d3.select(window).on("mousemove.zoom",e).on("mouseup.zoom",n),h=t(d3.mouse(s));window.focus(),L()}function a(){d||(d=t(d3.mouse(this))),r(Math.pow(2,.002*Vt())*b),i(d3.mouse(this),d),o(_.of(this,arguments))}function l(){d=null}function u(){var e=d3.mouse(this),n=t(e);r(d3.event.shiftKey?b/2:2*b),i(e,n),o(_.of(this,arguments))}function c(){var e=d3.touches(this),n=Date.now();if(p=b,d={},e.forEach((function(e){d[e.identifier]=t(e)})),L(),1===e.length){if(n-y<500){var s=e[0],a=t(e[0]);r(2*b),i(s,a),o(_.of(this,arguments))}y=n}}function h(){var e=d3.touches(this),t=e[0],n=d[t.identifier];if(s=e[1]){var s,a=d[s.identifier];t=[(t[0]+s[0])/2,(t[1]+s[1])/2],n=[(n[0]+a[0])/2,(n[1]+a[1])/2],r(d3.event.scale*p)}i(t,n),y=null,o(_.of(this,arguments))}var d,p,f,m,g,v,y,x=[0,0],b=1,w=oo,_=D(e,"zoom");return e.translate=function(t){return arguments.length?(x=t.map(Number),e):x},e.scale=function(t){return arguments.length?(b=+t,e):b},e.scaleExtent=function(t){return arguments.length?(w=null==t?oo:t.map(Number),e):w},e.x=function(t){return arguments.length?(m=t,f=t.copy(),e):m},e.y=function(t){return arguments.length?(v=t,g=t.copy(),e):v},d3.rebind(e,_,"on")};var io,oo=[0,1/0];d3.layout={},d3.layout.bundle=function(){return function(e){var t=[],n=-1,r=e.length;while(++n<r)t.push(zt(e[n]));return t}},d3.layout.chord=function(){function e(){var e,u,h,d,p,f={},m=[],g=d3.range(o),v=[];n=[],r=[],e=0,d=-1;while(++d<o){u=0,p=-1;while(++p<o)u+=i[d][p];m.push(u),v.push(d3.range(o)),e+=u}s&&g.sort((function(e,t){return s(m[e],m[t])})),a&&v.forEach((function(e,t){e.sort((function(e,n){return a(i[t][e],i[t][n])}))})),e=(2*Math.PI-c*o)/e,u=0,d=-1;while(++d<o){h=u,p=-1;while(++p<o){var y=g[d],x=v[y][p],b=i[y][x],w=u,_=u+=b*e;f[y+"-"+x]={index:y,subindex:x,startAngle:w,endAngle:_,value:b}}r[y]={index:y,startAngle:h,endAngle:u,value:(u-h)/e},u+=c}d=-1;while(++d<o){p=d-1;while(++p<o){var A=f[d+"-"+p],S=f[p+"-"+d];(A.value||S.value)&&n.push(A.value<S.value?{source:S,target:A}:{source:A,target:S})}}l&&t()}function t(){n.sort((function(e,t){return l((e.source.value+e.target.value)/2,(t.source.value+t.target.value)/2)}))}var n,r,i,o,s,a,l,u={},c=0;return u.matrix=function(e){return arguments.length?(o=(i=e)&&i.length,n=r=null,u):i},u.padding=function(e){return arguments.length?(c=e,n=r=null,u):c},u.sortGroups=function(e){return arguments.length?(s=e,n=r=null,u):s},u.sortSubgroups=function(e){return arguments.length?(a=e,n=null,u):a},u.sortChords=function(e){return arguments.length?(l=e,n&&t(),u):l},u.chords=function(){return n||e(),n},u.groups=function(){return r||e(),r},u},d3.layout.force=function(){function e(e){return function(t,n,r,i,o){if(t.point!==e){var s=t.cx-e.x,a=t.cy-e.y,l=1/Math.sqrt(s*s+a*a);if((i-n)*l<v){var u=t.charge*l*l;return e.px-=s*u,e.py-=a*u,!0}if(t.point&&isFinite(l)){u=t.pointCharge*l*l;e.px-=s*u,e.py-=a*u}}return!t.charge}}function t(e){e.px=d3.event.x,e.py=d3.event.y,u.resume()}var n,r,o,s,l,u={},c=d3.dispatch("start","tick","end"),h=[1,1],d=.9,p=$t,f=Xt,m=-30,g=.1,v=.8,y=[],x=[];return u.tick=function(){if((r*=.99)<.005)return c.end({type:"end",alpha:r=0}),!0;var t,n,i,a,u,p,f,v,b,w=y.length,_=x.length;for(n=0;n<_;++n)i=x[n],a=i.source,u=i.target,v=u.x-a.x,b=u.y-a.y,(p=v*v+b*b)&&(p=r*s[n]*((p=Math.sqrt(p))-o[n])/p,v*=p,b*=p,u.x-=v*(f=a.weight/(u.weight+a.weight)),u.y-=b*f,a.x+=v*(f=1-f),a.y+=b*f);if((f=r*g)&&(v=h[0]/2,b=h[1]/2,n=-1,f))while(++n<w)i=y[n],i.x+=(v-i.x)*f,i.y+=(b-i.y)*f;if(m){Wt(t=d3.geom.quadtree(y),r,l),n=-1;while(++n<w)(i=y[n]).fixed||t.visit(e(i))}n=-1;while(++n<w)i=y[n],i.fixed?(i.x=i.px,i.y=i.py):(i.x-=(i.px-(i.px=i.x))*d,i.y-=(i.py-(i.py=i.y))*d);c.tick({type:"tick",alpha:r})},u.nodes=function(e){return arguments.length?(y=e,u):y},u.links=function(e){return arguments.length?(x=e,u):x},u.size=function(e){return arguments.length?(h=e,u):h},u.linkDistance=function(e){return arguments.length?(p=a(e),u):p},u.distance=u.linkDistance,u.linkStrength=function(e){return arguments.length?(f=a(e),u):f},u.friction=function(e){return arguments.length?(d=e,u):d},u.charge=function(e){return arguments.length?(m="function"===typeof e?e:+e,u):m},u.gravity=function(e){return arguments.length?(g=e,u):g},u.theta=function(e){return arguments.length?(v=e,u):v},u.alpha=function(e){return arguments.length?(r?r=e>0?e:0:e>0&&(c.start({type:"start",alpha:r=e}),d3.timer(u.tick)),u):r},u.start=function(){function e(e,r){var i,o=t(n),s=-1,a=o.length;while(++s<a)if(!isNaN(i=o[s][e]))return i;return Math.random()*r}function t(){if(!i){for(i=[],r=0;r<c;++r)i[r]=[];for(r=0;r<d;++r){var e=x[r];i[e.source.index].push(e.target),i[e.target.index].push(e.source)}}return i[n]}var n,r,i,a,c=y.length,d=x.length,g=h[0],v=h[1];for(n=0;n<c;++n)(a=y[n]).index=n,a.weight=0;for(o=[],s=[],n=0;n<d;++n)a=x[n],"number"==typeof a.source&&(a.source=y[a.source]),"number"==typeof a.target&&(a.target=y[a.target]),o[n]=p.call(this,a,n),s[n]=f.call(this,a,n),++a.source.weight,++a.target.weight;for(n=0;n<c;++n)a=y[n],isNaN(a.x)&&(a.x=e("x",g)),isNaN(a.y)&&(a.y=e("y",v)),isNaN(a.px)&&(a.px=a.x),isNaN(a.py)&&(a.py=a.y);if(l=[],"function"===typeof m)for(n=0;n<c;++n)l[n]=+m.call(this,y[n],n);else for(n=0;n<c;++n)l[n]=m;return u.resume()},u.resume=function(){return u.alpha(.1)},u.stop=function(){return u.alpha(0)},u.drag=function(){n||(n=d3.behavior.drag().origin(i).on("dragstart",Bt).on("drag",t).on("dragend",Ht)),this.on("mouseover.force",Gt).on("mouseout.force",qt).call(n)},d3.rebind(u,c,"on")},d3.layout.partition=function(){function e(t,n,r,i){var o=t.children;if(t.x=n,t.y=t.depth*i,t.dx=r,t.dy=i,o&&(s=o.length)){var s,a,l,u=-1;r=t.value?r/t.value:0;while(++u<s)e(a=o[u],n,l=a.value*r,i),n+=l}}function t(e){var n=e.children,r=0;if(n&&(i=n.length)){var i,o=-1;while(++o<i)r=Math.max(r,t(n[o]))}return 1+r}function n(n,o){var s=r.call(this,n,o);return e(s[0],0,i[0],i[1]/t(s[0])),s}var r=d3.layout.hierarchy(),i=[1,1];return n.size=function(e){return arguments.length?(i=e,n):i},an(n,r)},d3.layout.pie=function(){function e(o,s){var a=o.map((function(n,r){return+t.call(e,n,r)})),l=+("function"===typeof r?r.apply(this,arguments):r),u=(("function"===typeof i?i.apply(this,arguments):i)-r)/d3.sum(a),c=d3.range(o.length);null!=n&&c.sort(n===so?function(e,t){return a[t]-a[e]}:function(e,t){return n(o[e],o[t])});var h=[];return c.forEach((function(e){var t;h[e]={data:o[e],value:t=a[e],startAngle:l,endAngle:l+=t*u}})),h}var t=Number,n=so,r=0,i=2*Math.PI;return e.value=function(n){return arguments.length?(t=n,e):t},e.sort=function(t){return arguments.length?(n=t,e):n},e.startAngle=function(t){return arguments.length?(r=t,e):r},e.endAngle=function(t){return arguments.length?(i=t,e):i},e};var so={};d3.layout.stack=function(){function e(i,l){var u=i.map((function(n,r){return t.call(e,n,r)})),c=u.map((function(t,n){return t.map((function(t,n){return[s.call(e,t,n),a.call(e,t,n)]}))})),h=n.call(e,c,l);u=d3.permute(u,h),c=d3.permute(c,h);var d,p,f,m=r.call(e,c,l),g=u.length,v=u[0].length;for(p=0;p<v;++p)for(o.call(e,u[0][p],f=m[p],c[0][p][1]),d=1;d<g;++d)o.call(e,u[d][p],f+=c[d-1][p][1],c[d][p][1]);return i}var t=i,n=Qt,r=Kt,o=Jt,s=Yt,a=Zt;return e.values=function(n){return arguments.length?(t=n,e):t},e.order=function(t){return arguments.length?(n="function"===typeof t?t:ao.get(t)||Qt,e):n},e.offset=function(t){return arguments.length?(r="function"===typeof t?t:lo.get(t)||Kt,e):r},e.x=function(t){return arguments.length?(s=t,e):s},e.y=function(t){return arguments.length?(a=t,e):a},e.out=function(t){return arguments.length?(o=t,e):o},e};var ao=d3.map({"inside-out":function(e){var t,n,r=e.length,i=e.map(en),o=e.map(tn),s=d3.range(r).sort((function(e,t){return i[e]-i[t]})),a=0,l=0,u=[],c=[];for(t=0;t<r;++t)n=s[t],a<l?(a+=o[n],u.push(n)):(l+=o[n],c.push(n));return c.reverse().concat(u)},reverse:function(e){return d3.range(e.length).reverse()},default:Qt}),lo=d3.map({silhouette:function(e){var t,n,r,i=e.length,o=e[0].length,s=[],a=0,l=[];for(n=0;n<o;++n){for(t=0,r=0;t<i;t++)r+=e[t][n][1];r>a&&(a=r),s.push(r)}for(n=0;n<o;++n)l[n]=(a-s[n])/2;return l},wiggle:function(e){var t,n,r,i,o,s,a,l,u,c=e.length,h=e[0],d=h.length,p=[];for(p[0]=l=u=0,n=1;n<d;++n){for(t=0,i=0;t<c;++t)i+=e[t][n][1];for(t=0,o=0,a=h[n][0]-h[n-1][0];t<c;++t){for(r=0,s=(e[t][n][1]-e[t][n-1][1])/(2*a);r<t;++r)s+=(e[r][n][1]-e[r][n-1][1])/a;o+=s*e[t][n][1]}p[n]=l-=i?o/i*a:0,l<u&&(u=l)}for(n=0;n<d;++n)p[n]-=u;return p},expand:function(e){var t,n,r,i=e.length,o=e[0].length,s=1/i,a=[];for(n=0;n<o;++n){for(t=0,r=0;t<i;t++)r+=e[t][n][1];if(r)for(t=0;t<i;t++)e[t][n][1]/=r;else for(t=0;t<i;t++)e[t][n][1]=s}for(n=0;n<o;++n)a[n]=0;return a},zero:Kt});d3.layout.histogram=function(){function e(e,o){var s,a,l=[],u=e.map(n,this),c=r.call(this,u,o),h=i.call(this,c,u,o),d=(o=-1,u.length),p=h.length-1,f=t?1:1/d;while(++o<p)s=l[o]=[],s.dx=h[o+1]-(s.x=h[o]),s.y=0;if(p>0){o=-1;while(++o<d)a=u[o],a>=c[0]&&a<=c[1]&&(s=l[d3.bisect(h,a,1,p)-1],s.y+=f,s.push(e[o]))}return l}var t=!0,n=Number,r=sn,i=rn;return e.value=function(t){return arguments.length?(n=t,e):n},e.range=function(t){return arguments.length?(r=a(t),e):r},e.bins=function(t){return arguments.length?(i="number"===typeof t?function(e){return on(e,t)}:a(t),e):i},e.frequency=function(n){return arguments.length?(t=!!n,e):t},e},d3.layout.hierarchy=function(){function e(t,s,a){var l=i.call(n,t,s),u=uo?t:{data:t};if(u.depth=s,a.push(u),l&&(c=l.length)){var c,h,d=-1,p=u.children=[],f=0,m=s+1;while(++d<c)h=e(l[d],m,a),h.parent=u,p.push(h),f+=h.value;r&&p.sort(r),o&&(u.value=f)}else o&&(u.value=+o.call(n,t,s)||0);return u}function t(e,r){var i=e.children,s=0;if(i&&(a=i.length)){var a,l=-1,u=r+1;while(++l<a)s+=t(i[l],u)}else o&&(s=+o.call(n,uo?e:e.data,r)||0);return o&&(e.value=s),s}function n(t){var n=[];return e(t,0,n),n}var r=cn,i=ln,o=un;return n.sort=function(e){return arguments.length?(r=e,n):r},n.children=function(e){return arguments.length?(i=e,n):i},n.value=function(e){return arguments.length?(o=e,n):o},n.revalue=function(e){return t(e,0),e},n};var uo=!1;d3.layout.pack=function(){function e(e,i){var o=t.call(this,e,i),s=o[0];s.x=0,s.y=0,On(s,(function(e){e.r=Math.sqrt(e.value)})),On(s,gn);var a=r[0],l=r[1],u=Math.max(2*s.r/a,2*s.r/l);if(n>0){var c=n*u/2;On(s,(function(e){e.r+=c})),On(s,gn),On(s,(function(e){e.r-=c})),u=Math.max(2*s.r/a,2*s.r/l)}return xn(s,a/2,l/2,1/u),o}var t=d3.layout.hierarchy().sort(dn),n=0,r=[1,1];return e.size=function(t){return arguments.length?(r=t,e):r},e.padding=function(t){return arguments.length?(n=+t,e):n},an(e,t)},d3.layout.cluster=function(){function e(e,i){var o,s=t.call(this,e,i),a=s[0],l=0;On(a,(function(e){var t=e.children;t&&t.length?(e.x=_n(t),e.y=wn(t)):(e.x=o?l+=n(e,o):0,e.y=0,o=e)}));var u=An(a),c=Sn(a),h=u.x-n(u,c)/2,d=c.x+n(c,u)/2;return On(a,(function(e){e.x=(e.x-h)/(d-h)*r[0],e.y=(1-(a.y?e.y/a.y:1))*r[1]})),s}var t=d3.layout.hierarchy().sort(null).value(null),n=En,r=[1,1];return e.separation=function(t){return arguments.length?(n=t,e):n},e.size=function(t){return arguments.length?(r=t,e):r},an(e,t)},d3.layout.tree=function(){function e(e,i){function o(e,t){var r=e.children,i=e._tree;if(r&&(s=r.length)){var s,l,u,c=r[0],h=c,d=-1;while(++d<s)u=r[d],o(u,l),h=a(u,l,h),l=u;Dn(e);var p=.5*(c._tree.prelim+u._tree.prelim);t?(i.prelim=t._tree.prelim+n(e,t),i.mod=i.prelim-p):i.prelim=p}else t&&(i.prelim=t._tree.prelim+n(e,t))}function s(e,t){e.x=e._tree.prelim+t;var n=e.children;if(n&&(r=n.length)){var r,i=-1;t+=e._tree.mod;while(++i<r)s(n[i],t)}}function a(e,t,r){if(t){var i,o=e,s=e,a=t,l=e.parent.children[0],u=o._tree.mod,c=s._tree.mod,h=a._tree.mod,d=l._tree.mod;while(a=Tn(a),o=Mn(o),a&&o)l=Mn(l),s=Tn(s),s._tree.ancestor=e,i=a._tree.prelim+h-o._tree.prelim-u+n(a,o),i>0&&(In(kn(a,e,r),e,i),u+=i,c+=i),h+=a._tree.mod,u+=o._tree.mod,d+=l._tree.mod,c+=s._tree.mod;a&&!Tn(s)&&(s._tree.thread=a,s._tree.mod+=h-c),o&&!Mn(l)&&(l._tree.thread=o,l._tree.mod+=u-d,r=e)}return r}var l=t.call(this,e,i),u=l[0];On(u,(function(e,t){e._tree={ancestor:e,prelim:0,mod:0,change:0,shift:0,number:t?t._tree.number+1:0}})),o(u),s(u,-u._tree.prelim);var c=Cn(u,Rn),h=Cn(u,Pn),d=Cn(u,Ln),p=c.x-n(c,h)/2,f=h.x+n(h,c)/2,m=d.depth||1;return On(u,(function(e){e.x=(e.x-p)/(f-p)*r[0],e.y=e.depth/m*r[1],delete e._tree})),l}var t=d3.layout.hierarchy().sort(null).value(null),n=En,r=[1,1];return e.separation=function(t){return arguments.length?(n=t,e):n},e.size=function(t){return arguments.length?(r=t,e):r},an(e,t)},d3.layout.treemap=function(){function e(e,t){var n,r,i=-1,o=e.length;while(++i<o)r=(n=e[i]).value*(t<0?0:t),n.area=isNaN(r)||r<=0?0:r}function t(n){var o=n.children;if(o&&o.length){var s,a,l,u=h(n),c=[],d=o.slice(),p=1/0,f=Math.min(u.dx,u.dy);e(d,u.dx*u.dy/n.value),c.area=0;while((l=d.length)>0)c.push(s=d[l-1]),c.area+=s.area,(a=r(c,f))<=p?(d.pop(),p=a):(c.area-=c.pop().area,i(c,f,u,!1),f=Math.min(u.dx,u.dy),c.length=c.area=0,p=1/0);c.length&&(i(c,f,u,!0),c.length=c.area=0),o.forEach(t)}}function n(t){var r=t.children;if(r&&r.length){var o,s=h(t),a=r.slice(),l=[];e(a,s.dx*s.dy/t.value),l.area=0;while(o=a.pop())l.push(o),l.area+=o.area,null!=o.z&&(i(l,o.z?s.dx:s.dy,s,!a.length),l.length=l.area=0);r.forEach(n)}}function r(e,t){var n,r=e.area,i=0,o=1/0,s=-1,a=e.length;while(++s<a)(n=e[s].area)&&(n<o&&(o=n),n>i&&(i=n));return r*=r,t*=t,r?Math.max(t*i*p/r,r/(t*o*p)):1/0}function i(e,t,n,r){var i,o=-1,s=e.length,a=n.x,u=n.y,c=t?l(e.area/t):0;if(t==n.dx){(r||c>n.dy)&&(c=n.dy);while(++o<s)i=e[o],i.x=a,i.y=u,i.dy=c,a+=i.dx=Math.min(n.x+n.dx-a,c?l(i.area/c):0);i.z=!0,i.dx+=n.x+n.dx-a,n.y+=c,n.dy-=c}else{(r||c>n.dx)&&(c=n.dx);while(++o<s)i=e[o],i.x=a,i.y=u,i.dx=c,u+=i.dy=Math.min(n.y+n.dy-u,c?l(i.area/c):0);i.z=!1,i.dy+=n.y+n.dy-u,n.x+=c,n.dx-=c}}function o(r){var i=s||a(r),o=i[0];return o.x=0,o.y=0,o.dx=u[0],o.dy=u[1],s&&a.revalue(o),e([o],o.dx*o.dy/o.value),(s?n:t)(o),d&&(s=i),i}var s,a=d3.layout.hierarchy(),l=Math.round,u=[1,1],c=null,h=Nn,d=!1,p=.5*(1+Math.sqrt(5));return o.size=function(e){return arguments.length?(u=e,o):u},o.padding=function(e){function t(t){var n=e.call(o,t,t.depth);return null==n?Nn(t):Fn(t,"number"===typeof n?[n,n,n,n]:n)}function n(t){return Fn(t,e)}return arguments.length?(h=null==(c=e)?Nn:"function"===(r=typeof e)?t:"number"===r?(e=[e,e,e,e],n):n,o):c;var r},o.round=function(e){return arguments.length?(l=e?Math.round:Number,o):l!=Number},o.sticky=function(e){return arguments.length?(d=e,s=null,o):d},o.ratio=function(e){return arguments.length?(p=e,o):p},an(o,a)},d3.csv=Vn(",","text/csv"),d3.tsv=Vn("\t","text/tab-separated-values"),d3.geo={};var co=Math.PI/180;d3.geo.azimuthal=function(){function e(e){var t,r=e[0]*co-n,u=e[1]*co,c=Math.cos(r),h=Math.sin(r),d=Math.cos(u),p=Math.sin(u),f="orthographic"!==s?o*p+i*d*c:null,m="stereographic"===s?1/(1+f):"gnomonic"===s?1/f:"equidistant"===s?(t=Math.acos(f),t?t/Math.sin(t):0):"equalarea"===s?Math.sqrt(2/(1+f)):1,g=m*d*h,v=m*(o*d*c-i*p);return[a*g+l[0],a*v+l[1]]}var t,n,r,i,o,s="orthographic",a=200,l=[480,250];return e.invert=function(e){var t=(e[0]-l[0])/a,r=(e[1]-l[1])/a,u=Math.sqrt(t*t+r*r),c="stereographic"===s?2*Math.atan(u):"gnomonic"===s?Math.atan(u):"equidistant"===s?u:"equalarea"===s?2*Math.asin(.5*u):Math.asin(u),h=Math.sin(c),d=Math.cos(c);return[(n+Math.atan2(t*h,u*i*d+r*o*h))/co,Math.asin(d*o-(u?r*h*i/u:0))/co]},e.mode=function(t){return arguments.length?(s=t+"",e):s},e.origin=function(s){return arguments.length?(t=s,n=t[0]*co,r=t[1]*co,i=Math.cos(r),o=Math.sin(r),e):t},e.scale=function(t){return arguments.length?(a=+t,e):a},e.translate=function(t){return arguments.length?(l=[+t[0],+t[1]],e):l},e.origin([0,0])},d3.geo.albers=function(){function e(e){var t=r*(co*e[0]-n),s=Math.sqrt(i-2*r*Math.sin(co*e[1]))/r;return[l*s*Math.sin(t)+u[0],l*(s*Math.cos(t)-o)+u[1]]}function t(){var t=co*a[0],l=co*a[1],u=co*s[1],c=Math.sin(t),h=Math.cos(t);return n=co*s[0],r=.5*(c+Math.sin(l)),i=h*h+2*r*c,o=Math.sqrt(i-2*r*Math.sin(u))/r,e}var n,r,i,o,s=[-98,38],a=[29.5,45.5],l=1e3,u=[480,250];return e.invert=function(e){var t=(e[0]-u[0])/l,s=(e[1]-u[1])/l,a=o+s,c=Math.atan2(t,a),h=Math.sqrt(t*t+a*a);return[(n+c/r)/co,Math.asin((i-h*h*r*r)/(2*r))/co]},e.origin=function(e){return arguments.length?(s=[+e[0],+e[1]],t()):s},e.parallels=function(e){return arguments.length?(a=[+e[0],+e[1]],t()):a},e.scale=function(t){return arguments.length?(l=+t,e):l},e.translate=function(t){return arguments.length?(u=[+t[0],+t[1]],e):u},t()},d3.geo.albersUsa=function(){function e(e){var o=e[0],s=e[1];return(s>50?n:o<-140?r:s<21?i:t)(e)}var t=d3.geo.albers(),n=d3.geo.albers().origin([-160,60]).parallels([55,65]),r=d3.geo.albers().origin([-160,20]).parallels([8,18]),i=d3.geo.albers().origin([-60,10]).parallels([8,18]);return e.scale=function(o){return arguments.length?(t.scale(o),n.scale(.6*o),r.scale(o),i.scale(1.5*o),e.translate(t.translate())):t.scale()},e.translate=function(o){if(!arguments.length)return t.translate();var s=t.scale()/1e3,a=o[0],l=o[1];return t.translate(o),n.translate([a-400*s,l+170*s]),r.translate([a-190*s,l+200*s]),i.translate([a+580*s,l+430*s]),e},e.scale(t.scale())},d3.geo.bonne=function(){function e(e){var a=e[0]*co-t,l=e[1]*co-n;if(r){var u=i+r-l,c=a*Math.cos(l)/u;a=u*Math.sin(c),l=u*Math.cos(c)-i}else a*=Math.cos(l),l*=-1;return[o*a+s[0],o*l+s[1]]}var t,n,r,i,o=200,s=[480,250];return e.invert=function(e){var n=(e[0]-s[0])/o,a=(e[1]-s[1])/o;if(r){var l=i+a,u=Math.sqrt(n*n+l*l);a=i+r-u,n=t+u*Math.atan2(n,l)/Math.cos(a)}else a*=-1,n/=Math.cos(a);return[n/co,a/co]},e.parallel=function(t){return arguments.length?(i=1/Math.tan(r=t*co),e):r/co},e.origin=function(r){return arguments.length?(t=r[0]*co,n=r[1]*co,e):[t/co,n/co]},e.scale=function(t){return arguments.length?(o=+t,e):o},e.translate=function(t){return arguments.length?(s=[+t[0],+t[1]],e):s},e.origin([0,0]).parallel(45)},d3.geo.equirectangular=function(){function e(e){var r=e[0]/360,i=-e[1]/360;return[t*r+n[0],t*i+n[1]]}var t=500,n=[480,250];return e.invert=function(e){var r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return[360*r,-360*i]},e.scale=function(n){return arguments.length?(t=+n,e):t},e.translate=function(t){return arguments.length?(n=[+t[0],+t[1]],e):n},e},d3.geo.mercator=function(){function e(e){var r=e[0]/360,i=-Math.log(Math.tan(Math.PI/4+e[1]*co/2))/co/360;return[t*r+n[0],t*Math.max(-.5,Math.min(.5,i))+n[1]]}var t=500,n=[480,250];return e.invert=function(e){var r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return[360*r,2*Math.atan(Math.exp(-360*i*co))/co-90]},e.scale=function(n){return arguments.length?(t=+n,e):t},e.translate=function(t){return arguments.length?(n=[+t[0],+t[1]],e):n},e},d3.geo.path=function(){function e(e,t){"function"===typeof o&&(s=Un(o.apply(this,arguments))),u(e);var n=l.length?l.join(""):null;return l=[],n}function t(e){return a(e).join(",")}function n(e){var t=i(e[0]),n=0,r=e.length;while(++n<r)t-=i(e[n]);return t}function r(e){var t=d3.geom.polygon(e[0].map(a)),n=t.area(),r=t.centroid(n<0?(n*=-1,1):-1),i=r[0],o=r[1],s=n,l=0,u=e.length;while(++l<u)t=d3.geom.polygon(e[l].map(a)),n=t.area(),r=t.centroid(n<0?(n*=-1,1):-1),i-=r[0],o-=r[1],s-=n;return[i,o,6*s]}function i(e){return Math.abs(d3.geom.polygon(e.map(a)).area())}var o=4.5,s=Un(o),a=d3.geo.albersUsa(),l=[],u=zn({FeatureCollection:function(e){var t=e.features,n=-1,r=t.length;while(++n<r)l.push(u(t[n].geometry))},Feature:function(e){u(e.geometry)},Point:function(e){l.push("M",t(e.coordinates),s)},MultiPoint:function(e){var n=e.coordinates,r=-1,i=n.length;while(++r<i)l.push("M",t(n[r]),s)},LineString:function(e){var n=e.coordinates,r=-1,i=n.length;l.push("M");while(++r<i)l.push(t(n[r]),"L");l.pop()},MultiLineString:function(e){var n,r,i,o=e.coordinates,s=-1,a=o.length;while(++s<a){n=o[s],r=-1,i=n.length,l.push("M");while(++r<i)l.push(t(n[r]),"L");l.pop()}},Polygon:function(e){var n,r,i,o=e.coordinates,s=-1,a=o.length;while(++s<a)if(n=o[s],r=-1,(i=n.length-1)>0){l.push("M");while(++r<i)l.push(t(n[r]),"L");l[l.length-1]="Z"}},MultiPolygon:function(e){var n,r,i,o,s,a,u=e.coordinates,c=-1,h=u.length;while(++c<h){n=u[c],r=-1,i=n.length;while(++r<i)if(o=n[r],s=-1,(a=o.length-1)>0){l.push("M");while(++s<a)l.push(t(o[s]),"L");l[l.length-1]="Z"}}},GeometryCollection:function(e){var t=e.geometries,n=-1,r=t.length;while(++n<r)l.push(u(t[n]))}}),c=e.area=zn({FeatureCollection:function(e){var t=0,n=e.features,r=-1,i=n.length;while(++r<i)t+=c(n[r]);return t},Feature:function(e){return c(e.geometry)},Polygon:function(e){return n(e.coordinates)},MultiPolygon:function(e){var t=0,r=e.coordinates,i=-1,o=r.length;while(++i<o)t+=n(r[i]);return t},GeometryCollection:function(e){var t=0,n=e.geometries,r=-1,i=n.length;while(++r<i)t+=c(n[r]);return t}},0),h=e.centroid=zn({Feature:function(e){return h(e.geometry)},Polygon:function(e){var t=r(e.coordinates);return[t[0]/t[2],t[1]/t[2]]},MultiPolygon:function(e){var t,n=e.coordinates,i=0,o=0,s=0,a=-1,l=n.length;while(++a<l)t=r(n[a]),i+=t[0],o+=t[1],s+=t[2];return[i/s,o/s]}});return e.projection=function(t){return a=t,e},e.pointRadius=function(t){return"function"===typeof t?o=t:(o=+t,s=Un(o)),e},e},d3.geo.bounds=function(e){var t=1/0,n=1/0,r=-1/0,i=-1/0;return jn(e,(function(e,o){e<t&&(t=e),e>r&&(r=e),o<n&&(n=o),o>i&&(i=o)})),[[t,n],[r,i]]};var ho={Feature:Bn,FeatureCollection:Hn,GeometryCollection:Gn,LineString:qn,MultiLineString:Wn,MultiPoint:qn,MultiPolygon:$n,Point:Xn,Polygon:Yn};d3.geo.circle=function(){function e(){}function t(e){return l.distance(e)<a}function n(e){var t,n,i,o,s,u=-1,c=e.length,h=[];while(++u<c)s=l.distance(i=e[u]),s<a?(n&&h.push(Kn(n,i)((o-a)/(o-s))),h.push(i),t=n=null):(n=i,!t&&h.length&&(h.push(Kn(h[h.length-1],n)((a-o)/(s-o))),t=n)),o=s;return t=e[0],n=h[0],!n||i[0]!==t[0]||i[1]!==t[1]||i[0]===n[0]&&i[1]===n[1]||h.push(n),r(h)}function r(e){var t,n,r,i=0,o=e.length,s=o?[e[0]]:e,a=l.source();while(++i<o)for(r=l.source(e[i-1])(e[i]).coordinates,t=0,n=r.length;++t<n;)s.push(r[t]);return l.source(a),s}var o=[0,0],s=89.99,a=s*co,l=d3.geo.greatArc().source(o).target(i);e.clip=function(e){return"function"===typeof o&&l.source(o.apply(this,arguments)),u(e)||null};var u=zn({FeatureCollection:function(e){var t=e.features.map(u).filter(i);return t&&(e=Object.create(e),e.features=t,e)},Feature:function(e){var t=u(e.geometry);return t&&(e=Object.create(e),e.geometry=t,e)},Point:function(e){return t(e.coordinates)&&e},MultiPoint:function(e){var n=e.coordinates.filter(t);return n.length&&{type:e.type,coordinates:n}},LineString:function(e){var t=n(e.coordinates);return t.length&&(e=Object.create(e),e.coordinates=t,e)},MultiLineString:function(e){var t=e.coordinates.map(n).filter((function(e){return e.length}));return t.length&&(e=Object.create(e),e.coordinates=t,e)},Polygon:function(e){var t=e.coordinates.map(n);return t[0].length&&(e=Object.create(e),e.coordinates=t,e)},MultiPolygon:function(e){var t=e.coordinates.map((function(e){return e.map(n)})).filter((function(e){return e[0].length}));return t.length&&(e=Object.create(e),e.coordinates=t,e)},GeometryCollection:function(e){var t=e.geometries.map(u).filter(i);return t.length&&(e=Object.create(e),e.geometries=t,e)}});return e.origin=function(t){return arguments.length?(o=t,"function"!==typeof o&&l.source(o),e):o},e.angle=function(t){return arguments.length?(a=(s=+t)*co,e):s},d3.rebind(e,l,"precision")},d3.geo.greatArc=function(){function e(){var r=e.distance.apply(this,arguments),i=0,a=o/r,l=[t];while((i+=a)<1)l.push(s(i));return l.push(n),{type:"LineString",coordinates:l}}var t,n,r=Zn,i=Jn,o=6*co,s=Qn();return e.distance=function(){return"function"===typeof r&&s.source(t=r.apply(this,arguments)),"function"===typeof i&&s.target(n=i.apply(this,arguments)),s.distance()},e.source=function(n){return arguments.length?(r=n,"function"!==typeof r&&s.source(t=r),e):r},e.target=function(t){return arguments.length?(i=t,"function"!==typeof i&&s.target(n=i),e):i},e.precision=function(t){return arguments.length?(o=t*co,e):o/co},e},d3.geo.greatCircle=d3.geo.circle,d3.geom={},d3.geom.contour=function(e,t){var n=t||er(e),r=[],i=n[0],o=n[1],s=0,a=0,l=NaN,u=NaN,c=0;do{c=0,e(i-1,o-1)&&(c+=1),e(i,o-1)&&(c+=2),e(i-1,o)&&(c+=4),e(i,o)&&(c+=8),6===c?(s=-1===u?-1:1,a=0):9===c?(s=0,a=1===l?-1:1):(s=po[c],a=fo[c]),s!=l&&a!=u&&(r.push([i,o]),l=s,u=a),i+=s,o+=a}while(n[0]!=i||n[1]!=o);return r};var po=[1,0,1,1,-1,0,-1,1,0,0,0,0,-1,0,-1,NaN],fo=[0,-1,0,0,0,-1,0,0,1,-1,1,1,0,-1,0,NaN];d3.geom.hull=function(e){if(e.length<3)return[];var t,n,r,i,o,s,a,l,u,c,h=e.length,d=h-1,p=[],f=[],m=0;for(t=1;t<h;++t)e[t][1]<e[m][1]?m=t:e[t][1]==e[m][1]&&(m=e[t][0]<e[m][0]?t:m);for(t=0;t<h;++t)t!==m&&(i=e[t][1]-e[m][1],r=e[t][0]-e[m][0],p.push({angle:Math.atan2(i,r),index:t}));for(p.sort((function(e,t){return e.angle-t.angle})),u=p[0].angle,l=p[0].index,a=0,t=1;t<d;++t)n=p[t].index,u==p[t].angle?(r=e[l][0]-e[m][0],i=e[l][1]-e[m][1],o=e[n][0]-e[m][0],s=e[n][1]-e[m][1],r*r+i*i>=o*o+s*s?p[t].index=-1:(p[a].index=-1,u=p[t].angle,a=t,l=n)):(u=p[t].angle,a=t,l=n);for(f.push(m),t=0,n=0;t<2;++n)-1!==p[n].index&&(f.push(p[n].index),t++);for(c=f.length;n<d;++n)if(-1!==p[n].index){while(!tr(f[c-2],f[c-1],p[n].index,e))--c;f[c++]=p[n].index}var g=[];for(t=0;t<c;++t)g.push(e[f[t]]);return g},d3.geom.polygon=function(e){return e.area=function(){var t=0,n=e.length,r=e[n-1][0]*e[0][1],i=e[n-1][1]*e[0][0];while(++t<n)r+=e[t-1][0]*e[t][1],i+=e[t-1][1]*e[t][0];return.5*(i-r)},e.centroid=function(t){var n,r,i=-1,o=e.length,s=0,a=0,l=e[o-1];arguments.length||(t=-1/(6*e.area()));while(++i<o)n=l,l=e[i],r=n[0]*l[1]-l[0]*n[1],s+=(n[0]+l[0])*r,a+=(n[1]+l[1])*r;return[s*t,a*t]},e.clip=function(t){var n,r,i,o,s,a,l=-1,u=e.length,c=e[u-1];while(++l<u){n=t.slice(),t.length=0,o=e[l],s=n[(i=n.length)-1],r=-1;while(++r<i)a=n[r],nr(a,c,o)?(nr(s,c,o)||t.push(rr(s,a,c,o)),t.push(a)):nr(s,c,o)&&t.push(rr(s,a,c,o)),s=a;c=o}return t},e},d3.geom.voronoi=function(e){var t=e.map((function(){return[]}));return ir(e,(function(e){var n,r,i,o,s,a;1===e.a&&e.b>=0?(n=e.ep.r,r=e.ep.l):(n=e.ep.l,r=e.ep.r),1===e.a?(s=n?n.y:-1e6,i=e.c-e.b*s,a=r?r.y:1e6,o=e.c-e.b*a):(i=n?n.x:-1e6,s=e.c-e.a*i,o=r?r.x:1e6,a=e.c-e.a*o);var l=[i,s],u=[o,a];t[e.region.l.index].push(l,u),t[e.region.r.index].push(l,u)})),t.map((function(t,n){var r=e[n][0],i=e[n][1];return t.forEach((function(e){e.angle=Math.atan2(e[0]-r,e[1]-i)})),t.sort((function(e,t){return e.angle-t.angle})).filter((function(e,n){return!n||e.angle-t[n-1].angle>1e-10}))}))};var mo={l:"r",r:"l"};d3.geom.delaunay=function(e){var t=e.map((function(){return[]})),n=[];return ir(e,(function(n){t[n.region.l.index].push(e[n.region.r.index])})),t.forEach((function(t,r){var i=e[r],o=i[0],s=i[1];t.forEach((function(e){e.angle=Math.atan2(e[0]-o,e[1]-s)})),t.sort((function(e,t){return e.angle-t.angle}));for(var a=0,l=t.length-1;a<l;a++)n.push([i,t[a],t[a+1]])})),n},d3.geom.quadtree=function(e,t,n,r,i){function o(e,t,n,r,i,o){if(!isNaN(t.x)&&!isNaN(t.y))if(e.leaf){var a=e.point;a?(Math.abs(a.x-t.x)+Math.abs(a.y-t.y)<.01||(e.point=null,s(e,a,n,r,i,o)),s(e,t,n,r,i,o)):e.point=t}else s(e,t,n,r,i,o)}function s(e,t,n,r,i,s){var a=.5*(n+i),l=.5*(r+s),u=t.x>=a,c=t.y>=l,h=(c<<1)+u;e.leaf=!1,e=e.nodes[h]||(e.nodes[h]=or()),u?n=a:i=a,c?r=l:s=l,o(e,t,n,r,i,s)}var a,l=-1,u=e.length;if(u&&isNaN(e[0].x)&&(e=e.map(ar)),arguments.length<5)if(3===arguments.length)i=r=n,n=t;else{t=n=1/0,r=i=-1/0;while(++l<u)a=e[l],a.x<t&&(t=a.x),a.y<n&&(n=a.y),a.x>r&&(r=a.x),a.y>i&&(i=a.y);var c=r-t,h=i-n;c>h?i=n+c:r=t+h}var d=or();return d.add=function(e){o(d,e,t,n,r,i)},d.visit=function(e){sr(e,d,t,n,r,i)},e.forEach(d.add),d},d3.time={};var go=Date,vo=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];lr.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){yo.setUTCDate.apply(this._,arguments)},setDay:function(){yo.setUTCDay.apply(this._,arguments)},setFullYear:function(){yo.setUTCFullYear.apply(this._,arguments)},setHours:function(){yo.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){yo.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){yo.setUTCMinutes.apply(this._,arguments)},setMonth:function(){yo.setUTCMonth.apply(this._,arguments)},setSeconds:function(){yo.setUTCSeconds.apply(this._,arguments)},setTime:function(){yo.setTime.apply(this._,arguments)}};var yo=Date.prototype,xo="%a %b %e %H:%M:%S %Y",bo="%m/%d/%y",wo="%H:%M:%S",_o=vo,Ao=_o.map(ur),So=["January","February","March","April","May","June","July","August","September","October","November","December"],Eo=So.map(ur);d3.time.format=function(e){function t(t){var r,i,o=[],s=-1,a=0;while(++s<n)37==e.charCodeAt(s)&&(o.push(e.substring(a,s),(i=No[r=e.charAt(++s)])?i(t):r),a=s+1);return o.push(e.substring(a,s)),o.join("")}var n=e.length;return t.parse=function(t){var n={y:1900,m:0,d:1,H:0,M:0,S:0,L:0},r=cr(n,e,t,0);if(r!=t.length)return null;"p"in n&&(n.H=n.H%12+12*n.p);var i=new go;return i.setFullYear(n.y,n.m,n.d),i.setHours(n.H,n.M,n.S,n.L),i},t.toString=function(){return e},t};var Mo=d3.format("02d"),To=d3.format("03d"),Co=d3.format("04d"),Po=d3.format("2d"),Ro=hr(_o),Lo=hr(Ao),Oo=hr(So),Do=dr(So),Io=hr(Eo),ko=dr(Eo),No={a:function(e){return Ao[e.getDay()]},A:function(e){return _o[e.getDay()]},b:function(e){return Eo[e.getMonth()]},B:function(e){return So[e.getMonth()]},c:d3.time.format(xo),d:function(e){return Mo(e.getDate())},e:function(e){return Po(e.getDate())},H:function(e){return Mo(e.getHours())},I:function(e){return Mo(e.getHours()%12||12)},j:function(e){return To(1+d3.time.dayOfYear(e))},L:function(e){return To(e.getMilliseconds())},m:function(e){return Mo(e.getMonth()+1)},M:function(e){return Mo(e.getMinutes())},p:function(e){return e.getHours()>=12?"PM":"AM"},S:function(e){return Mo(e.getSeconds())},U:function(e){return Mo(d3.time.sundayOfYear(e))},w:function(e){return e.getDay()},W:function(e){return Mo(d3.time.mondayOfYear(e))},x:d3.time.format(bo),X:d3.time.format(wo),y:function(e){return Mo(e.getFullYear()%100)},Y:function(e){return Co(e.getFullYear()%1e4)},Z:Rr,"%":function(e){return"%"}},Fo={a:pr,A:fr,b:mr,B:gr,c:vr,d:Sr,e:Sr,H:Er,I:Er,L:Cr,m:Ar,M:Mr,p:Pr,S:Tr,x:yr,X:xr,y:wr,Y:br},Vo=/^\s*\d+/,zo=d3.map({am:0,pm:1});d3.time.format.utc=function(e){function t(e){try{go=lr;var t=new go;return t._=e,n(t)}finally{go=Date}}var n=d3.time.format(e);return t.parse=function(e){try{go=lr;var t=n.parse(e);return t&&t._}finally{go=Date}},t.toString=n.toString,t};var Uo=d3.time.format.utc("%Y-%m-%dT%H:%M:%S.%LZ");d3.time.format.iso=Date.prototype.toISOString?Lr:Uo,Lr.parse=function(e){var t=new Date(e);return isNaN(t)?null:t},Lr.toString=Uo.toString,d3.time.second=Or((function(e){return new go(1e3*Math.floor(e/1e3))}),(function(e,t){e.setTime(e.getTime()+1e3*Math.floor(t))}),(function(e){return e.getSeconds()})),d3.time.seconds=d3.time.second.range,d3.time.seconds.utc=d3.time.second.utc.range,d3.time.minute=Or((function(e){return new go(6e4*Math.floor(e/6e4))}),(function(e,t){e.setTime(e.getTime()+6e4*Math.floor(t))}),(function(e){return e.getMinutes()})),d3.time.minutes=d3.time.minute.range,d3.time.minutes.utc=d3.time.minute.utc.range,d3.time.hour=Or((function(e){var t=e.getTimezoneOffset()/60;return new go(36e5*(Math.floor(e/36e5-t)+t))}),(function(e,t){e.setTime(e.getTime()+36e5*Math.floor(t))}),(function(e){return e.getHours()})),d3.time.hours=d3.time.hour.range,d3.time.hours.utc=d3.time.hour.utc.range,d3.time.day=Or((function(e){var t=new go(1970,0);return t.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t}),(function(e,t){e.setDate(e.getDate()+t)}),(function(e){return e.getDate()-1})),d3.time.days=d3.time.day.range,d3.time.days.utc=d3.time.day.utc.range,d3.time.dayOfYear=function(e){var t=d3.time.year(e);return Math.floor((e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},vo.forEach((function(e,t){e=e.toLowerCase(),t=7-t;var n=d3.time[e]=Or((function(e){return(e=d3.time.day(e)).setDate(e.getDate()-(e.getDay()+t)%7),e}),(function(e,t){e.setDate(e.getDate()+7*Math.floor(t))}),(function(e){var n=d3.time.year(e).getDay();return Math.floor((d3.time.dayOfYear(e)+(n+t)%7)/7)-(n!==t)}));d3.time[e+"s"]=n.range,d3.time[e+"s"].utc=n.utc.range,d3.time[e+"OfYear"]=function(e){var n=d3.time.year(e).getDay();return Math.floor((d3.time.dayOfYear(e)+(n+t)%7)/7)}})),d3.time.week=d3.time.sunday,d3.time.weeks=d3.time.sunday.range,d3.time.weeks.utc=d3.time.sunday.utc.range,d3.time.weekOfYear=d3.time.sundayOfYear,d3.time.month=Or((function(e){return e=d3.time.day(e),e.setDate(1),e}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e){return e.getMonth()})),d3.time.months=d3.time.month.range,d3.time.months.utc=d3.time.month.utc.range,d3.time.year=Or((function(e){return e=d3.time.day(e),e.setMonth(0,1),e}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e){return e.getFullYear()})),d3.time.years=d3.time.year.range,d3.time.years.utc=d3.time.year.utc.range;var jo=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],Bo=[[d3.time.second,1],[d3.time.second,5],[d3.time.second,15],[d3.time.second,30],[d3.time.minute,1],[d3.time.minute,5],[d3.time.minute,15],[d3.time.minute,30],[d3.time.hour,1],[d3.time.hour,3],[d3.time.hour,6],[d3.time.hour,12],[d3.time.day,1],[d3.time.day,2],[d3.time.week,1],[d3.time.month,1],[d3.time.month,3],[d3.time.year,1]],Ho=[[d3.time.format("%Y"),function(e){return!0}],[d3.time.format("%B"),function(e){return e.getMonth()}],[d3.time.format("%b %d"),function(e){return 1!=e.getDate()}],[d3.time.format("%a %d"),function(e){return e.getDay()&&1!=e.getDate()}],[d3.time.format("%I %p"),function(e){return e.getHours()}],[d3.time.format("%I:%M"),function(e){return e.getMinutes()}],[d3.time.format(":%S"),function(e){return e.getSeconds()}],[d3.time.format(".%L"),function(e){return e.getMilliseconds()}]],Go=d3.scale.linear(),qo=Fr(Ho);Bo.year=function(e,t){return Go.domain(e.map(zr)).ticks(t).map(Vr)},d3.time.scale=function(){return Ir(d3.scale.linear(),Bo,qo)};var Wo=Bo.map((function(e){return[e[0].utc,e[1]]})),$o=[[d3.time.format.utc("%Y"),function(e){return!0}],[d3.time.format.utc("%B"),function(e){return e.getUTCMonth()}],[d3.time.format.utc("%b %d"),function(e){return 1!=e.getUTCDate()}],[d3.time.format.utc("%a %d"),function(e){return e.getUTCDay()&&1!=e.getUTCDate()}],[d3.time.format.utc("%I %p"),function(e){return e.getUTCHours()}],[d3.time.format.utc("%I:%M"),function(e){return e.getUTCMinutes()}],[d3.time.format.utc(":%S"),function(e){return e.getUTCSeconds()}],[d3.time.format.utc(".%L"),function(e){return e.getUTCMilliseconds()}]],Xo=Fr($o);Wo.year=function(e,t){return Go.domain(e.map(jr)).ticks(t).map(Ur)},d3.time.scale.utc=function(){return Ir(d3.scale.linear(),Wo,Xo)}})()},e8c2:function(e,t,n){"use strict";e.exports=function(e,t,n){var r=" ",i=e.level,o=e.dataLevel,s=e.schema[t],a=e.schemaPath+e.util.getProperty(t),l=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c="data"+(o||""),h="valid"+i,d=e.opts.$data&&s&&s.$data;d&&(r+=" var schema"+i+" = "+e.util.getData(s.$data,o,e.dataPathArr)+"; ");var p="i"+i,f="schema"+i;d||(r+=" var "+f+" = validate.schema"+a+";"),r+="var "+h+";",d&&(r+=" if (schema"+i+" === undefined) "+h+" = true; else if (!Array.isArray(schema"+i+")) "+h+" = false; else {"),r+=h+" = false;for (var "+p+"=0; "+p+"<"+f+".length; "+p+"++) if (equal("+c+", "+f+"["+p+"])) { "+h+" = true; break; }",d&&(r+="  }  "),r+=" if (!"+h+") {   ";var m=m||[];m.push(r),r="",!1!==e.createErrors?(r+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(l)+" , params: { allowedValues: schema"+i+" } ",!1!==e.opts.messages&&(r+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(r+=" , schema: validate.schema"+a+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+c+" "),r+=" } "):r+=" {} ";var g=r;return r=m.pop(),!e.compositeRule&&u?e.async?r+=" throw new ValidationError(["+g+"]); ":r+=" validate.errors = ["+g+"]; return false; ":r+=" var err = "+g+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",r+=" }",u&&(r+=" else { "),r}},e91a:function(e,t,n){t.UI={Region:n("4a75"),Cursor:n("d4c2")}},e91f:function(e,t,n){"use strict";var r=n("ebb5"),i=n("4d64").indexOf,o=r.aTypedArray,s=r.exportTypedArrayMethod;s("indexOf",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0)}))},ea07:function(e,t,n){"use strict";e.exports=function(e,t,n){var r=" ",i=e.schema[t],o=e.schemaPath+e.util.getProperty(t),s=e.errSchemaPath+"/"+t,a=!e.opts.allErrors,l=e.util.copy(e),u="";l.level++;var c="valid"+l.level,h=l.baseId,d=!0,p=i;if(p){var f,m=-1,g=p.length-1;while(m<g)f=p[m+=1],(e.opts.strictKeywords?"object"==typeof f&&Object.keys(f).length>0:e.util.schemaHasRules(f,e.RULES.all))&&(d=!1,l.schema=f,l.schemaPath=o+"["+m+"]",l.errSchemaPath=s+"/"+m,r+="  "+e.validate(l)+" ",l.baseId=h,a&&(r+=" if ("+c+") { ",u+="}"))}return a&&(r+=d?" if (true) { ":" "+u.slice(0,-1)+" "),r}},ea9c:function(e,t,n){"use strict";var r=e.exports=function(){this._cache={}};r.prototype.put=function(e,t){this._cache[e]=t},r.prototype.get=function(e){return this._cache[e]},r.prototype.del=function(e){delete this._cache[e]},r.prototype.clear=function(){this._cache={}}},ebb5:function(e,t,n){"use strict";var r,i=n("a981"),o=n("83ab"),s=n("da84"),a=n("861d"),l=n("5135"),u=n("f5df"),c=n("9112"),h=n("6eeb"),d=n("9bf2").f,p=n("e163"),f=n("d2bb"),m=n("b622"),g=n("90e3"),v=s.Int8Array,y=v&&v.prototype,x=s.Uint8ClampedArray,b=x&&x.prototype,w=v&&p(v),_=y&&p(y),A=Object.prototype,S=A.isPrototypeOf,E=m("toStringTag"),M=g("TYPED_ARRAY_TAG"),T=i&&!!f&&"Opera"!==u(s.opera),C=!1,P={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},R=function(e){var t=u(e);return"DataView"===t||l(P,t)},L=function(e){return a(e)&&l(P,u(e))},O=function(e){if(L(e))return e;throw TypeError("Target is not a typed array")},D=function(e){if(f){if(S.call(w,e))return e}else for(var t in P)if(l(P,r)){var n=s[t];if(n&&(e===n||S.call(n,e)))return e}throw TypeError("Target is not a typed array constructor")},I=function(e,t,n){if(o){if(n)for(var r in P){var i=s[r];i&&l(i.prototype,e)&&delete i.prototype[e]}_[e]&&!n||h(_,e,n?t:T&&y[e]||t)}},k=function(e,t,n){var r,i;if(o){if(f){if(n)for(r in P)i=s[r],i&&l(i,e)&&delete i[e];if(w[e]&&!n)return;try{return h(w,e,n?t:T&&v[e]||t)}catch(a){}}for(r in P)i=s[r],!i||i[e]&&!n||h(i,e,t)}};for(r in P)s[r]||(T=!1);if((!T||"function"!=typeof w||w===Function.prototype)&&(w=function(){throw TypeError("Incorrect invocation")},T))for(r in P)s[r]&&f(s[r],w);if((!T||!_||_===A)&&(_=w.prototype,T))for(r in P)s[r]&&f(s[r].prototype,_);if(T&&p(b)!==_&&f(b,_),o&&!l(_,E))for(r in C=!0,d(_,E,{get:function(){return a(this)?this[M]:void 0}}),P)s[r]&&c(s[r],M,r);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:T,TYPED_ARRAY_TAG:C&&M,aTypedArray:O,aTypedArrayConstructor:D,exportTypedArrayMethod:I,exportTypedArrayStaticMethod:k,isView:R,isTypedArray:L,TypedArray:w,TypedArrayPrototype:_}},f21a:function(e,t,n){},f71e:function(e,t,n){"use strict";e.exports=function(e,t){t||(t={}),"function"===typeof t&&(t={cmp:t});var n="boolean"===typeof t.cycles&&t.cycles,r=t.cmp&&function(e){return function(t){return function(n,r){var i={key:n,value:t[n]},o={key:r,value:t[r]};return e(i,o)}}}(t.cmp),i=[];return function e(t){if(t&&t.toJSON&&"function"===typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!==typeof t)return JSON.stringify(t);var o,s;if(Array.isArray(t)){for(s="[",o=0;o<t.length;o++)o&&(s+=","),s+=e(t[o])||"null";return s+"]"}if(null===t)return"null";if(-1!==i.indexOf(t)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=i.push(t)-1,l=Object.keys(t).sort(r&&r(t));for(s="",o=0;o<l.length;o++){var u=l[o],c=e(t[u]);c&&(s&&(s+=","),s+=JSON.stringify(u)+":"+c)}return i.splice(a,1),"{"+s+"}"}}(e)}},f8cd:function(e,t,n){var r=n("a691");e.exports=function(e){var t=r(e);if(t<0)throw RangeError("The argument can't be less than 0");return t}},faa1:function(e,t,n){"use strict";var r,i="object"===typeof Reflect?Reflect:null,o=i&&"function"===typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};function s(e){console&&console.warn&&console.warn(e)}r=i&&"function"===typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!==e};function l(){l.init.call(this)}e.exports=l,e.exports.once=b,l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var u=10;function c(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function h(e){return void 0===e._maxListeners?l.defaultMaxListeners:e._maxListeners}function d(e,t,n,r){var i,o,a;if(c(n),o=e._events,void 0===o?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"===typeof a?a=o[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),i=h(e),i>0&&a.length>i&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,s(l)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=p.bind(r);return i.listener=n,r.wrapFn=i,i}function m(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"===typeof i?n?[i.listener||i]:[i]:n?x(i):v(i,i.length)}function g(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function v(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function y(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function x(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function b(e,t){return new Promise((function(n,r){function i(){void 0!==o&&e.removeListener("error",o),n([].slice.call(arguments))}var o;"error"!==t&&(o=function(n){e.removeListener(t,i),r(n)},e.once("error",o)),e.once(t,i)}))}Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!==typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),l.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},l.prototype.getMaxListeners=function(){return h(this)},l.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=i[e];if(void 0===l)return!1;if("function"===typeof l)o(l,this,t);else{var u=l.length,c=v(l,u);for(n=0;n<u;++n)o(c[n],this,t)}return!0},l.prototype.addListener=function(e,t){return d(this,e,t,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(e,t){return d(this,e,t,!0)},l.prototype.once=function(e,t){return c(t),this.on(e,f(this,e,t)),this},l.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,f(this,e,t)),this},l.prototype.removeListener=function(e,t){var n,r,i,o,s;if(c(t),r=this._events,void 0===r)return this;if(n=r[e],void 0===n)return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():y(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(e){var t,n,r;if(n=this._events,void 0===n)return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)i=o[r],"removeListener"!==i&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],"function"===typeof t)this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},l.prototype.listeners=function(e){return m(this,e,!0)},l.prototype.rawListeners=function(e){return m(this,e,!1)},l.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},l.prototype.listenerCount=g,l.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},fb2c:function(e,t,n){var r=n("74e8");r("Uint32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},fbda:function(e,t,n){"use strict";function r(e,t){for(var n in t=t||{},e)t[n]=e[n];return t}function i(e,t,n,r){var i=r?" !== ":" === ",o=r?" || ":" && ",s=r?"!":"",a=r?"":"!";switch(e){case"null":return t+i+"null";case"array":return s+"Array.isArray("+t+")";case"object":return"("+s+t+o+"typeof "+t+i+'"object"'+o+a+"Array.isArray("+t+"))";case"integer":return"(typeof "+t+i+'"number"'+o+a+"("+t+" % 1)"+o+t+i+t+(n?o+s+"isFinite("+t+")":"")+")";case"number":return"(typeof "+t+i+'"'+e+'"'+(n?o+s+"isFinite("+t+")":"")+")";default:return"typeof "+t+i+'"'+e+'"'}}function o(e,t,n){switch(e.length){case 1:return i(e[0],t,n,!0);default:var r="",o=l(e);for(var s in o.array&&o.object&&(r=o.null?"(":"(!"+t+" || ",r+="typeof "+t+' !== "object")',delete o.null,delete o.array,delete o.object),o.number&&delete o.integer,o)r+=(r?" && ":"")+i(s,t,n,!0);return r}}e.exports={copy:r,checkDataType:i,checkDataTypes:o,coerceToTypes:a,toHash:l,getProperty:h,escapeQuotes:d,equal:n("694b"),ucs2length:n("775e"),varOccurences:p,varReplace:f,schemaHasRules:m,schemaHasRulesExcept:g,schemaUnknownRules:v,toQuotedString:y,getPathExpr:x,getPath:b,getData:A,unescapeFragment:E,unescapeJsonPointer:C,escapeFragment:M,escapeJsonPointer:T};var s=l(["string","number","integer","boolean","null"]);function a(e,t){if(Array.isArray(t)){for(var n=[],r=0;r<t.length;r++){var i=t[r];(s[i]||"array"===e&&"array"===i)&&(n[n.length]=i)}if(n.length)return n}else{if(s[t])return[t];if("array"===e&&"array"===t)return["array"]}}function l(e){for(var t={},n=0;n<e.length;n++)t[e[n]]=!0;return t}var u=/^[a-z$_][a-z$_0-9]*$/i,c=/'|\\/g;function h(e){return"number"==typeof e?"["+e+"]":u.test(e)?"."+e:"['"+d(e)+"']"}function d(e){return e.replace(c,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}function p(e,t){t+="[^0-9]";var n=e.match(new RegExp(t,"g"));return n?n.length:0}function f(e,t,n){return t+="([^0-9])",n=n.replace(/\$/g,"$$$$"),e.replace(new RegExp(t,"g"),n+"$1")}function m(e,t){if("boolean"==typeof e)return!e;for(var n in e)if(t[n])return!0}function g(e,t,n){if("boolean"==typeof e)return!e&&"not"!=n;for(var r in e)if(r!=n&&t[r])return!0}function v(e,t){if("boolean"!=typeof e)for(var n in e)if(!t[n])return n}function y(e){return"'"+d(e)+"'"}function x(e,t,n,r){var i=n?"'/' + "+t+(r?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):r?"'[' + "+t+" + ']'":"'[\\'' + "+t+" + '\\']'";return S(e,i)}function b(e,t,n){var r=y(n?"/"+T(t):h(t));return S(e,r)}var w=/^\/(?:[^~]|~0|~1)*$/,_=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function A(e,t,n){var r,i,o,s;if(""===e)return"rootData";if("/"==e[0]){if(!w.test(e))throw new Error("Invalid JSON-pointer: "+e);i=e,o="rootData"}else{if(s=e.match(_),!s)throw new Error("Invalid JSON-pointer: "+e);if(r=+s[1],i=s[2],"#"==i){if(r>=t)throw new Error("Cannot access property/index "+r+" levels up, current level is "+t);return n[t-r]}if(r>t)throw new Error("Cannot access data "+r+" levels up, current level is "+t);if(o="data"+(t-r||""),!i)return o}for(var a=o,l=i.split("/"),u=0;u<l.length;u++){var c=l[u];c&&(o+=h(C(c)),a+=" && "+o)}return a}function S(e,t){return'""'==e?t:(e+" + "+t).replace(/([^\\])' \+ '/g,"$1")}function E(e){return C(decodeURIComponent(e))}function M(e){return encodeURIComponent(T(e))}function T(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}function C(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}},fff2:function(e,t,n){"use strict";var r=/^[a-z_$][a-z0-9_$-]*$/i,i=n("7236"),o=n("7976");function s(e,t){var n=this.RULES;if(n.keywords[e])throw new Error("Keyword "+e+" is already defined");if(!r.test(e))throw new Error("Keyword "+e+" is not a valid identifier");if(t){this.validateKeyword(t,!0);var o=t.type;if(Array.isArray(o))for(var s=0;s<o.length;s++)l(e,o[s],t);else l(e,o,t);var a=t.metaSchema;a&&(t.$data&&this._opts.$data&&(a={anyOf:[a,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]}),t.validateSchema=this.compile(a,!0))}function l(e,t,r){for(var o,s=0;s<n.length;s++){var a=n[s];if(a.type==t){o=a;break}}o||(o={type:t,rules:[]},n.push(o));var l={keyword:e,definition:r,custom:!0,code:i,implements:r.implements};o.rules.push(l),n.custom[e]=l}return n.keywords[e]=n.all[e]=!0,this}function a(e){var t=this.RULES.custom[e];return t?t.definition:this.RULES.keywords[e]||!1}function l(e){var t=this.RULES;delete t.keywords[e],delete t.all[e],delete t.custom[e];for(var n=0;n<t.length;n++)for(var r=t[n].rules,i=0;i<r.length;i++)if(r[i].keyword==e){r.splice(i,1);break}return this}function u(e,t){u.errors=null;var n=this._validateKeyword=this._validateKeyword||this.compile(o,!0);if(n(e))return!0;if(u.errors=n.errors,t)throw new Error("custom keyword definition is invalid: "+this.errorsText(n.errors));return!1}e.exports={add:s,get:a,remove:l,validate:u}}}]);
//# sourceMappingURL=vendor~wrapper.a4c1bf24.js.map